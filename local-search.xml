<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>2025-11-17 【小程序】微信人脸核身</title>
    <link href="/2025/11/28/2025-11-17%20%E3%80%90%E5%B0%8F%E7%A8%8B%E5%BA%8F%E3%80%91%E5%BE%AE%E4%BF%A1%E4%BA%BA%E8%84%B8%E6%A0%B8%E8%BA%AB/"/>
    <url>/2025/11/28/2025-11-17%20%E3%80%90%E5%B0%8F%E7%A8%8B%E5%BA%8F%E3%80%91%E5%BE%AE%E4%BF%A1%E4%BA%BA%E8%84%B8%E6%A0%B8%E8%BA%AB/</url>
    
    <content type="html"><![CDATA[<h1 id="交互流程"><a href="#交互流程" class="headerlink" title="交互流程"></a>交互流程</h1><pre><code class=" mermaid">sequenceDiagramautonumber    actor 用户    participant 外部小程序    participant 半屏金额明细    participant jsapi    participant 小程序后端    participant 微信后端     用户-&gt;&gt;外部小程序: 1. 确认收款    外部小程序-&gt;&gt;半屏金额明细: 2. 半屏打开    半屏金额明细-&gt;&gt;半屏金额明细: 3. 登录、实名、三流合一、高风险人群    rect rgba(0, 0, 255, .1)    Note right of jsapi: 人脸核身    半屏金额明细-&gt;&gt;半屏金额明细: 弹窗提示“高危人群扫脸认证”    用户-&gt;&gt;半屏金额明细: 点击“扫脸认证”    半屏金额明细-&gt;&gt;jsapi: 【jsapi】检查设备是否支持人脸检测 wx.checkIsSupportFacialRecognition    jsapi--&gt;&gt;半屏金额明细: 返回是否支持人脸检测结果    半屏金额明细-&gt;&gt;小程序后端: 【api】获取user_id_key    小程序后端-&gt;&gt;微信后端: 调用 getuseridkey传入access_token、name、id_card_number    微信后端--&gt;&gt;小程序后端: 返回 获取user_id_key    小程序后端--&gt;&gt;半屏金额明细: 返回 获取user_id_key    半屏金额明细-&gt;&gt;jsapi: 人脸核身wx.startFacialRecognitionVerify 传入user_id_key    jsapi-&gt;&gt;半屏金额明细:  返回人脸核身结果verify_result    半屏金额明细-&gt;&gt;小程序后端:  【api】二次校验 人脸核身结果，传入verify_result    小程序后端-&gt;&gt;微信后端: 调用 getinfo传入access_token、verify_result    微信后端--&gt;&gt;小程序后端: 返回 identify_ret、errcode    小程序后端--&gt;&gt;半屏金额明细: 返回 二次校验人脸核身结果    半屏金额明细-&gt;&gt;半屏金额明细: identify_ret、errcode均为0，自动跳转“金额明细”    end    用户-&gt;&gt;半屏金额明细: 点击“确认收款”    半屏金额明细-&gt;&gt;半屏金额明细: 三流合一、缴税、收款</code></pre><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; apiGetUserIdKey, apiVerifyFace &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@services/nature&quot;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">startFacialRecognitionVerify</span> = (<span class="hljs-params">userIdKey</span>) =&gt;<br>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> &#123;<br>    wx.<span class="hljs-title function_">startFacialRecognitionVerify</span>(&#123;<br>      userIdKey,<br>      <span class="hljs-attr">success</span>: <span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> &#123;<br>        <span class="hljs-title function_">resolve</span>(result);<br>      &#125;,<br>      <span class="hljs-attr">fail</span>: <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;fail&quot;</span>, e);<br>        <span class="hljs-title function_">resolve</span>(e);<br>      &#125;,<br>      <span class="hljs-comment">// complete: () =&gt; &#123;</span><br>      <span class="hljs-comment">//   console.log(&#x27;complete&#x27;);</span><br>      <span class="hljs-comment">// &#125;,</span><br>    &#125;);<br>  &#125;);<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 判断当前用户设备 是否支持</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">checkIsSupportFacialRecognition</span> = (<span class="hljs-params"></span>) =&gt;<br>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> &#123;<br>    wx.<span class="hljs-title function_">checkIsSupportFacialRecognition</span>(&#123;<br>      <span class="hljs-comment">// 支持</span><br>      <span class="hljs-attr">success</span>: <span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-title function_">resolve</span>(<span class="hljs-literal">true</span>);<br>      &#125;,<br>      <span class="hljs-comment">// 不支持</span><br>      <span class="hljs-attr">fail</span>: <span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-title function_">resolve</span>(<span class="hljs-literal">false</span>);<br>      &#125;,<br>      <span class="hljs-comment">// complete: () =&gt; &#123;</span><br>      <span class="hljs-comment">//   resolve(false);</span><br>      <span class="hljs-comment">// &#125;,</span><br>    &#125;);<br>  &#125;);<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 人脸核身校验</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">facialRecognitionVerify</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-comment">// 1. 判断当前用户设备 是否支持</span><br>  <span class="hljs-keyword">const</span> success = <span class="hljs-keyword">await</span> <span class="hljs-title function_">checkIsSupportFacialRecognition</span>();<br>  <span class="hljs-keyword">if</span> (!success) &#123;<br>    <span class="hljs-keyword">return</span> &#123;<br>      <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,<br>      <span class="hljs-attr">errMsg</span>: <span class="hljs-string">&quot;当前微信版本过低，请升级微信至最新版本后重试。&quot;</span>,<br>    &#125;;<br>  &#125;<br>  <span class="hljs-comment">// 2. 获取用户 user_id_key</span><br>  <span class="hljs-keyword">const</span> resultUserIdKey = <span class="hljs-keyword">await</span> <span class="hljs-title function_">apiGetUserIdKey</span>(&#123; <span class="hljs-attr">source</span>: <span class="hljs-number">1</span> &#125;);<br>  <span class="hljs-keyword">if</span> (!resultUserIdKey.<span class="hljs-property">userIdKey</span> || resultUserIdKey.<span class="hljs-property">errcode</span> !== <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-keyword">return</span> &#123;<br>      <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,<br>      <span class="hljs-attr">errMsg</span>: resultUserIdKey.<span class="hljs-property">errmsg</span> || <span class="hljs-string">&quot;获取扫脸用户凭证失败&quot;</span>,<br>    &#125;;<br>  &#125;<br>  <span class="hljs-comment">// 3. 调用jsapi 唤起人脸核审</span><br>  <span class="hljs-keyword">const</span> verifyResult = <span class="hljs-keyword">await</span> <span class="hljs-title function_">startFacialRecognitionVerify</span>(<br>    resultUserIdKey.<span class="hljs-property">userIdKey</span><br>  );<br>  <span class="hljs-keyword">if</span> (verifyResult.<span class="hljs-property">errCode</span> !== <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-keyword">const</span> errMsg = verifyResult.<span class="hljs-property">errMsg</span>?.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&quot;cancel&quot;</span>)<br>      ? <span class="hljs-string">&quot;用户取消人脸识别，无法正常收款&quot;</span><br>      : verifyResult.<span class="hljs-property">errMsg</span>;<br>    <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">errMsg</span>: errMsg || <span class="hljs-string">&quot;人脸识别失败，请稍后重试&quot;</span> &#125;;<br>  &#125;<br>  <span class="hljs-comment">// 4. 二次校验，jsapi认证结果</span><br>  <span class="hljs-keyword">const</span> verifyFaceResult = <span class="hljs-keyword">await</span> <span class="hljs-title function_">apiVerifyFace</span>(&#123;<br>    <span class="hljs-attr">verifyResult</span>: verifyResult.<span class="hljs-property">verifyResult</span>,<br>    <span class="hljs-attr">source</span>: <span class="hljs-number">1</span>,<br>  &#125;);<br>  <span class="hljs-keyword">if</span> (verifyFaceResult.<span class="hljs-property">identifyRet</span> !== <span class="hljs-number">0</span> || verifyFaceResult.<span class="hljs-property">errcode</span> !== <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-keyword">return</span> &#123;<br>      <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,<br>      <span class="hljs-attr">errMsg</span>: verifyFaceResult.<span class="hljs-property">errmsg</span> || <span class="hljs-string">&quot;人脸识别失败，请稍后重试&quot;</span>,<br>    &#125;;<br>  &#125;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;facialRecognitionVerify4&quot;</span>, verifyFaceResult);<br>  <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span> &#125;;<br>&#125;;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 弹窗提示高风险人群 需人脸识别</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">showFacialRecognitionVerifyModal</span> = (<span class="hljs-params">content</span>) =&gt;<br>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> &#123;<br>    wx.<span class="hljs-title function_">showModal</span>(&#123;<br>      <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;温馨提示&quot;</span>,<br>      content,<br>      <span class="hljs-attr">cancelText</span>: <span class="hljs-string">&quot;暂不认证&quot;</span>,<br>      <span class="hljs-attr">confirmText</span>: <span class="hljs-string">&quot;扫脸认证&quot;</span>,<br>      <span class="hljs-attr">confirmColor</span>: <span class="hljs-string">&quot;#008858&quot;</span>,<br>      <span class="hljs-attr">success</span>: <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>        <span class="hljs-keyword">if</span> (res.<span class="hljs-property">confirm</span>) &#123;<br>          <span class="hljs-title function_">resolve</span>(<span class="hljs-literal">true</span>);<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (res.<span class="hljs-property">cancel</span>) &#123;<br>          <span class="hljs-comment">// 阻断流程</span><br>          <span class="hljs-title function_">resolve</span>(<span class="hljs-literal">false</span>);<br>        &#125;<br>      &#125;,<br>    &#125;);<br>  &#125;);<br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  facialRecognitionVerify,<br>  showFacialRecognitionVerifyModal,<br>&#125;;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>小程序</category>
      
    </categories>
    
    
    <tags>
      
      <tag>预拉取</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025-11-18 【chrome扩展】消息传递机制</title>
    <link href="/2025/11/28/2025-11-18%20%E3%80%90chrome%E6%89%A9%E5%B1%95%E3%80%91%E6%B6%88%E6%81%AF%E4%BC%A0%E9%80%92%E6%9C%BA%E5%88%B6/"/>
    <url>/2025/11/28/2025-11-18%20%E3%80%90chrome%E6%89%A9%E5%B1%95%E3%80%91%E6%B6%88%E6%81%AF%E4%BC%A0%E9%80%92%E6%9C%BA%E5%88%B6/</url>
    
    <content type="html"><![CDATA[<h2 id="背景说明"><a href="#背景说明" class="headerlink" title="背景说明"></a>背景说明</h2><blockquote><p>Chrome 架构决定了「devtools ↔ 浏览器页面 JS」必须经 background + content-script 中转；</p></blockquote><h2 id="场景一：浏览器页面-发送消息至-devtools-页面"><a href="#场景一：浏览器页面-发送消息至-devtools-页面" class="headerlink" title="场景一：浏览器页面 发送消息至 devtools 页面"></a>场景一：浏览器页面 发送消息至 devtools 页面</h2><ul><li>分 3 步<ol><li>页面 script.js<br>│ postMessage<br>▼</li><li>content.js<br>window.addEventListener(“message”, (e) &#x3D;&gt; {});<br>│ chrome.runtime.sendMessage<br>▼</li><li>DevTools Panel Page<br>| chrome.runtime.onMessage.addListener</li></ol></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 1. 页面 script.js(注入页面的脚本)</span><br><span class="hljs-comment">// 发送原始消息</span><br><span class="hljs-variable language_">window</span>.<span class="hljs-title function_">postMessage</span>(<br>  &#123;<br>    <span class="hljs-attr">from</span>: <span class="hljs-string">&quot;xxx&quot;</span>,<br>    <span class="hljs-attr">action</span>: <span class="hljs-string">&quot;your action&quot;</span>,<br>    <span class="hljs-attr">value</span>: <span class="hljs-string">&quot;data info&quot;</span>,<br>  &#125;,<br>  <span class="hljs-string">&quot;*&quot;</span><br>);<br><span class="hljs-comment">// 2. content.js</span><br><span class="hljs-comment">// 监听页面脚本，传来的消息</span><br><span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;message&quot;</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;收到页面脚本消息&quot;</span>, e);<br>  <span class="hljs-keyword">if</span> (e.<span class="hljs-property">source</span> !== <span class="hljs-variable language_">window</span> || !e.<span class="hljs-property">data</span>.<span class="hljs-property">from</span>) <span class="hljs-keyword">return</span>;<br>  <span class="hljs-comment">// 页面 -&gt; devtools</span><br>  <span class="hljs-keyword">if</span> (e.<span class="hljs-property">data</span>.<span class="hljs-property">from</span> === <span class="hljs-string">&quot;xxx&quot;</span>) &#123;<br>    chrome.<span class="hljs-property">runtime</span>.<span class="hljs-title function_">sendMessage</span>(&#123;<br>      <span class="hljs-attr">from</span>: e.<span class="hljs-property">data</span>.<span class="hljs-property">from</span>,<br>      <span class="hljs-attr">action</span>: e.<span class="hljs-property">data</span>.<span class="hljs-property">action</span>,<br>      <span class="hljs-attr">value</span>: e.<span class="hljs-property">data</span>.<span class="hljs-property">value</span>,<br>    &#125;);<br>  &#125;<br>&#125;);<br><span class="hljs-comment">// 3. DevTools Panel Page</span><br><span class="hljs-comment">// 监听来自content.js的拦截记录消息</span><br>chrome.<span class="hljs-property">runtime</span>.<span class="hljs-property">onMessage</span>.<span class="hljs-title function_">addListener</span>(<span class="hljs-function">(<span class="hljs-params">message</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> &#123; <span class="hljs-keyword">from</span>, action, value &#125; = message;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">from</span> !== <span class="hljs-string">&quot;xxx&quot;</span>) <span class="hljs-keyword">return</span>;<br><br>  <span class="hljs-keyword">if</span> (action === <span class="hljs-string">&quot;your action&quot;</span>) &#123;<br>    <span class="hljs-comment">// do something</span><br>  &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><h2 id="场景二：devtools-页面-发送消息至-浏览器页面"><a href="#场景二：devtools-页面-发送消息至-浏览器页面" class="headerlink" title="场景二：devtools 页面 发送消息至 浏览器页面"></a>场景二：devtools 页面 发送消息至 浏览器页面</h2><h3 id="方法-1-借助-storage-监听"><a href="#方法-1-借助-storage-监听" class="headerlink" title="方法 1 借助 storage 监听"></a>方法 1 借助 storage 监听</h3><ul><li>分 4 步<ol><li>DevTools Panel Page<br>│ chrome.storage.local.set<br>▼</li><li>background.js<br>chrome.storage.onChanged.addListener((changes) &#x3D;&gt; {});<br>│ chrome.runtime.sendMessage<br>▼</li><li>content.js<br>window.addEventListener(“message”, (e) &#x3D;&gt; {});<br>│ chrome.runtime.sendMessage<br>▼</li><li>页面 script.js<br>| chrome.runtime.onMessage.addListener</li></ol></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 1. DevTools Panel Page</span><br><span class="hljs-keyword">await</span> chrome.<span class="hljs-property">storage</span>.<span class="hljs-property">local</span>.<span class="hljs-title function_">set</span>(&#123; <span class="hljs-attr">xxx</span>: <span class="hljs-string">&quot;xxx&quot;</span> &#125;);<br><br><span class="hljs-comment">// 2. background.js</span><br><span class="hljs-comment">// 监听存储变化，通知所有标签页</span><br>chrome.<span class="hljs-property">storage</span>.<span class="hljs-property">onChanged</span>.<span class="hljs-title function_">addListener</span>(<span class="hljs-function">(<span class="hljs-params">changes</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (changes.<span class="hljs-property">yourStorageData</span>) &#123;<br>    <span class="hljs-comment">// 向所有活动标签页发送规则更新消息 (可选中仅推送到当前tab)</span><br>    <span class="hljs-comment">// 是否会影响iframe 消息</span><br>    <span class="hljs-comment">// chrome.tabs.query(&#123; url: [&quot;http://*/*&quot;, &quot;https://*/*&quot;] &#125;, (tabs) =&gt; &#123;</span><br>    chrome.<span class="hljs-property">tabs</span>.<span class="hljs-title function_">query</span>(&#123;&#125;, <span class="hljs-function">(<span class="hljs-params">tabs</span>) =&gt;</span> &#123;<br>      tabs.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">tab</span>) =&gt;</span> &#123;<br>        <span class="hljs-keyword">if</span> (tab.<span class="hljs-property">url</span>?.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">&quot;chrome-extension://&quot;</span>)) <span class="hljs-keyword">return</span>; <span class="hljs-comment">// 直接跳过</span><br>        <span class="hljs-keyword">if</span> (tab.<span class="hljs-property">id</span>) &#123;<br>          chrome.<span class="hljs-property">tabs</span><br>            .<span class="hljs-title function_">sendMessage</span>(tab.<span class="hljs-property">id</span>, &#123;<br>              <span class="hljs-attr">from</span>: <span class="hljs-string">&quot;xxx&quot;</span>,<br>              <span class="hljs-attr">action</span>: <span class="hljs-string">&quot;your action&quot;</span>,<br>              <span class="hljs-attr">value</span>: <span class="hljs-string">&quot;data info&quot;</span>,<br>            &#125;)<br>            .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>              <span class="hljs-comment">// 忽略内容脚本未注入的错误</span><br>              <span class="hljs-keyword">if</span> (error.<span class="hljs-property">message</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&quot;Receiving end does not exist&quot;</span>)) &#123;<br>              &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`向标签页 <span class="hljs-subst">$&#123;tab.id&#125;</span> 发送规则更新失败:`</span>, error);<br>              &#125;<br>            &#125;);<br>        &#125;<br>      &#125;);<br>    &#125;);<br>  &#125;<br>&#125;);<br><span class="hljs-comment">// 3. content.js</span><br><span class="hljs-comment">// 监听backgroud.js 传来的消息</span><br>chrome.<span class="hljs-property">runtime</span>.<span class="hljs-property">onMessage</span>.<span class="hljs-title function_">addListener</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> &#123; <span class="hljs-keyword">from</span>, action, value &#125; = data;<br>  <span class="hljs-keyword">if</span> (data.<span class="hljs-property">from</span> !== <span class="hljs-string">&quot;xxx&quot;</span>) <span class="hljs-keyword">return</span>;<br>  <span class="hljs-comment">// 发送消息到浏览器标签页</span><br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">postMessage</span>(&#123; <span class="hljs-keyword">from</span>, action, value &#125;);<br>&#125;);<br><span class="hljs-comment">// 1. 页面 script.js(注入页面的脚本)</span><br><span class="hljs-comment">// 收到原始消息</span><br><br><span class="hljs-comment">// 监听来自页面的消息，允许页面查询当前规则状态</span><br><span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<br>  <span class="hljs-string">&quot;message&quot;</span>,<br>  <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> data = event.<span class="hljs-property">data</span>;<br>    <span class="hljs-keyword">if</span> (event.<span class="hljs-property">source</span> !== <span class="hljs-variable language_">window</span> || data.<span class="hljs-property">from</span> !== <span class="hljs-string">&quot;xxx&quot;</span>) <span class="hljs-keyword">return</span>;<br><br>    <span class="hljs-comment">// do something</span><br>  &#125;,<br>  <span class="hljs-literal">false</span><br>);<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>小程序</category>
      
    </categories>
    
    
    <tags>
      
      <tag>预拉取</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025-11-28 【工程化】Hexo+Github个人博客搭建</title>
    <link href="/2025/11/28/2025-11-28%20%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91Hexo+Github%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"/>
    <url>/2025/11/28/2025-11-28%20%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91Hexo+Github%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<h2 id="引语"><a href="#引语" class="headerlink" title="引语"></a>引语</h2><p>记得初次搭建个人博客是在 17 年，本意是想对个人技术栈迭代过程进行记录，同时也当做能力快查的工具；再后来，随着 typro 版本迭代开始收费，没找到合适免费的在线存储编辑器和阅读器，索性就将 Vscode+Hexo+Github 作为个人积累的文档“小助手”，发展到如今。</p><blockquote><p>关键词：Hexo；GitHub Pages；静态博客；Docusaurus；VitePress</p></blockquote><h2 id="一、背景与痛点"><a href="#一、背景与痛点" class="headerlink" title="一、背景与痛点"></a>一、背景与痛点</h2><p>“写博客”这件事对开发者而言既是知识沉淀，也是个人名片。</p><ul><li>动态博客（WordPress 等）需要买服务器、备份数据库，成本高；</li><li>第三方平台（CSDN、知乎）曝光好，却受限于编辑器和广告。</li></ul><p><strong>静态博客</strong>应运而生：</p><ul><li>本地 Markdown → 生成纯 HTML → 免服务器部署；</li><li>配合 Git 可实现“写作即 commit，push 即发布”。</li></ul><p>在众多静态框架中，<strong>Hexo</strong> 因“零配置、主题多、一键部署 GitHub”成为国内最流行方案之一。本文带你从 0 到 1 搭建可公开访问的 Hexo 个人站，并与 Docusaurus、VitePress 做横向对比，帮你选型不踩坑。</p><h2 id="二、方案对比：Hexo-vs-Docusaurus-vs-VitePress"><a href="#二、方案对比：Hexo-vs-Docusaurus-vs-VitePress" class="headerlink" title="二、方案对比：Hexo vs Docusaurus vs VitePress"></a>二、方案对比：Hexo vs Docusaurus vs VitePress</h2><table><thead><tr><th>维度</th><th>Hexo</th><th>Docusaurus</th><th>VitePress</th></tr></thead><tbody><tr><td>定位</td><td>博客为主</td><td>文档 + 博客</td><td>文档优先</td></tr><tr><td>上手成本</td><td>★☆☆☆☆</td><td>★★☆☆☆</td><td>★★☆☆☆</td></tr><tr><td>主题生态</td><td>极丰富（Next&#x2F;Fluid&#x2F;Matery…）</td><td>官方 + 社区，偏文档风</td><td>官方默认，博客主题少</td></tr><tr><td>构建速度</td><td>快（秒级）</td><td>中等（Webpack）</td><td>极快（Vite）</td></tr><tr><td>部署方式</td><td>GitHub Pages 一键推</td><td>同左</td><td>同左</td></tr><tr><td>中文社区</td><td>活跃</td><td>一般</td><td>新兴</td></tr><tr><td>推荐指数</td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐</td></tr></tbody></table><ol><li>想要“<strong>开箱即用 + 海量主题</strong>”→ 选 Hexo；</li><li>项目需要“<strong>文档 + 博客</strong>”混排 → 选 Docusaurus；</li><li>追求<strong>极致构建速度</strong>且接受默认主题 → 选 VitePress。<br>本文聚焦 Hexo，其余框架步骤类似，可触类旁通。</li></ol><h2 id="三、实现步骤（Hexo-GitHub-Pages-全自动部署）"><a href="#三、实现步骤（Hexo-GitHub-Pages-全自动部署）" class="headerlink" title="三、实现步骤（Hexo + GitHub Pages 全自动部署）"></a>三、实现步骤（Hexo + GitHub Pages 全自动部署）</h2><h3 id="0-前置条件"><a href="#0-前置条件" class="headerlink" title="0. 前置条件"></a>0. 前置条件</h3><ul><li>Node.js ≥ 18（<a href="https://nodejs.org/">官网下载</a>）</li><li>Git 任意新版（<a href="https://git-scm.com/">官网下载</a>）</li><li>GitHub 账号（无则注册）</li></ul><h3 id="1-创建-GitHub-仓库（Pages-专用）"><a href="#1-创建-GitHub-仓库（Pages-专用）" class="headerlink" title="1. 创建 GitHub 仓库（Pages 专用）"></a>1. 创建 GitHub 仓库（Pages 专用）</h3><blockquote><p>仓库名必须 &lt;用户名&gt;.github.io；<br>类型 Public；勾选 “Add a README”。<br>→ 得到可访问域名 https:&#x2F;&#x2F;&lt;用户名&gt;.github.io 。</p></blockquote><h3 id="2-安装-Hexo-CLI-并初始化"><a href="#2-安装-Hexo-CLI-并初始化" class="headerlink" title="2. 安装 Hexo CLI 并初始化"></a>2. 安装 Hexo CLI 并初始化</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm i -g pnpm                    <span class="hljs-comment"># 更快、更省盘</span><br>pnpm add -g hexo-cli             <span class="hljs-comment"># 全局装脚手架</span><br>hexo init my-blog &amp;&amp; <span class="hljs-built_in">cd</span> my-blog  <span class="hljs-comment"># 创建项目</span><br>pnpm install                     <span class="hljs-comment"># 装依赖</span><br>hexo server                      <span class="hljs-comment"># 本地预览 http://localhost:4000</span><br></code></pre></td></tr></table></figure><p>首次启动看到“Hello Hexo”即成功 。</p><h3 id="3-GitHub-Actions-自动部署"><a href="#3-GitHub-Actions-自动部署" class="headerlink" title="3.GitHub Actions 自动部署"></a>3.GitHub Actions 自动部署</h3><blockquote><p>把源码推到 main 分支，每次 push 自动构建：</p></blockquote><ul><li>.github&#x2F;workflows&#x2F;pages.yml</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">name:</span> <span class="hljs-string">Auto</span> <span class="hljs-string">Deploy</span> <span class="hljs-string">Hexo</span> <span class="hljs-string">to</span> <span class="hljs-string">GitHub</span> <span class="hljs-string">Pages</span><br><br><span class="hljs-attr">on:</span> <span class="hljs-comment"># 触发条件</span><br>  <span class="hljs-attr">push:</span><br>    <span class="hljs-attr">branches:</span> [<span class="hljs-string">main</span>]<br>  <span class="hljs-attr">workflow_dispatch:</span> <span class="hljs-comment"># 手动按钮</span><br><br><span class="hljs-attr">permissions:</span> <span class="hljs-comment"># 给 Actions 写 Pages 的权限</span><br>  <span class="hljs-attr">contents:</span> <span class="hljs-string">write</span><br>  <span class="hljs-attr">pages:</span> <span class="hljs-string">write</span><br>  <span class="hljs-attr">id-token:</span> <span class="hljs-string">write</span><br><br><span class="hljs-attr">jobs:</span><br>  <span class="hljs-attr">build:</span><br>    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span><br>    <span class="hljs-attr">steps:</span><br>      <span class="hljs-comment"># 1. 拉源码</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Checkout</span><br>        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v4</span><br>        <span class="hljs-attr">with:</span><br>          <span class="hljs-attr">submodules:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># 主题用 submodule 时必加</span><br><br>      <span class="hljs-comment"># 2. 装 Node 20（2025 LTS）</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setup</span> <span class="hljs-string">Node</span><br>        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v4</span><br>        <span class="hljs-attr">with:</span><br>          <span class="hljs-attr">node-version:</span> <span class="hljs-number">20</span><br>          <span class="hljs-attr">cache:</span> <span class="hljs-string">&quot;npm&quot;</span><br><br>      <span class="hljs-comment"># 3. 安装 Hexo 及依赖</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">dependencies</span><br>        <span class="hljs-attr">run:</span> <span class="hljs-string">|</span><br><span class="hljs-string">          npm ci --production</span><br><span class="hljs-string"></span><br>      <span class="hljs-comment"># 4. 生成静态文件</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Build</span><br>        <span class="hljs-attr">run:</span> <span class="hljs-string">|</span><br><span class="hljs-string">          npx hexo clean</span><br><span class="hljs-string">          npx hexo generate</span><br><span class="hljs-string"></span><br>      <span class="hljs-comment"># 5. 部署到 gh-pages 分支</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Deploy</span><br>        <span class="hljs-attr">uses:</span> <span class="hljs-string">peaceiris/actions-gh-pages@v4</span><br>        <span class="hljs-attr">with:</span><br>          <span class="hljs-attr">github_token:</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">secrets.GITHUB_TOKEN</span> <span class="hljs-string">&#125;&#125;</span><br>          <span class="hljs-attr">publish_dir:</span> <span class="hljs-string">./public</span><br>          <span class="hljs-attr">publish_branch:</span> <span class="hljs-string">gh-pages</span><br>          <span class="hljs-comment"># cname: | # 如果有自定义域名，把 xxx.com 换成你的</span><br>          <span class="hljs-comment">#   xxx.com</span><br></code></pre></td></tr></table></figure><p>配置完提交，后续 git push 即自动发布，无需手动 hexo deploy</p><h3 id="4-写文章"><a href="#4-写文章" class="headerlink" title="4. 写文章"></a>4. 写文章</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">hexo new post <span class="hljs-string">&quot;我的第一篇博客&quot;</span><br></code></pre></td></tr></table></figure><p>编辑 source&#x2F;_posts&#x2F;我的第一篇博客.md（Markdown），保存后 hexo server 实时预览。</p><h3 id="5-换主题"><a href="#5-换主题" class="headerlink" title="5. 换主题"></a>5. 换主题</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/next-theme/hexo-theme-next themes/next<br></code></pre></td></tr></table></figure><p>_config.yml 里 theme: next 即可</p><h3 id="6-总结"><a href="#6-总结" class="headerlink" title="6. 总结"></a>6. 总结</h3><ul><li>Hexo + GitHub Pages 让你“只管写 Markdown，其余交给 Git”——</li><li>零服务器、零费用、全公开、全备份。</li><li>跟着本文 30 分钟即可拥有自己的 .github.io 域名博客；</li><li>后续只需 git push，全球读者即可看到你的下一篇文章。</li><li>Happy Blogging!</li></ul>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>2025-04-21- 【插件】chrome插件开发</title>
    <link href="/2025/11/28/2025-04-21-%20%E3%80%90%E6%8F%92%E4%BB%B6%E3%80%91chrome%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/"/>
    <url>/2025/11/28/2025-04-21-%20%E3%80%90%E6%8F%92%E4%BB%B6%E3%80%91chrome%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/</url>
    
    <content type="html"><![CDATA[<h1 id="1-chrome-扩展账号准备"><a href="#1-chrome-扩展账号准备" class="headerlink" title="1. chrome 扩展账号准备"></a>1. chrome 扩展账号准备</h1><blockquote><p>前提条件</p><ol><li>有一个谷歌账号</li><li>开通开发者权限</li></ol></blockquote><h2 id="1-1-chrome-账号注册"><a href="#1-1-chrome-账号注册" class="headerlink" title="1.1 chrome 账号注册"></a>1.1 chrome 账号注册</h2><h2 id="1-2-chrome-开发者注册"><a href="#1-2-chrome-开发者注册" class="headerlink" title="1.2 chrome 开发者注册"></a>1.2 chrome 开发者注册</h2><ul><li>淘宝找到可以充值谷歌应用商店的店铺</li><li>注册成为 chrome 开发者</li></ul><h1 id="本地开发"><a href="#本地开发" class="headerlink" title="本地开发"></a>本地开发</h1><p><a href="https://chrome.google.com/webstore/devconsole">Chrome 应用商店开发者信息中心</a></p><h1 id="插件开发"><a href="#插件开发" class="headerlink" title="插件开发"></a>插件开发</h1><ul><li><ol><li>跨域同步 cookies 插件开发：用于自动同步测试环境&#x2F;生产环境 cookies 至本地开发 localhost 域名下</li></ol></li><li><ol start="2"><li>侧边栏 Tab 管理器：一个支持分组、拖动排序和固定标签的侧边栏 Tab 管理器</li></ol></li><li><ol start="3"><li>网络请求拦截器：一款专为研发打造的网络请求拦截器，支持 XMLHttpRequest、fetch 请求拦截，同时支持 declarativeNetRequest 拦截</li></ol></li></ul><h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><ol><li><a href="https://developer.chrome.com/docs/extensions/get-started/tutorial/hello-world?hl=zh-cn">chrome 开发手册</a></li><li><a href="https://developer.chrome.com/docs/extensions?hl=zh-cn">扩展程序</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>工具</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nodejs</tag>
      
      <tag>js</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025-07-24 【docker】tkex基础镜像制作</title>
    <link href="/2025/11/28/2025-07-24%20%E3%80%90docker%E3%80%91tkex%E5%9F%BA%E7%A1%80%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C/"/>
    <url>/2025/11/28/2025-07-24%20%E3%80%90docker%E3%80%91tkex%E5%9F%BA%E7%A1%80%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C/</url>
    
    <content type="html"><![CDATA[<h1 id="一、背景"><a href="#一、背景" class="headerlink" title="一、背景"></a>一、背景</h1><p>由于原有前端 web 基础镜像由外部 cenos+openresty 制作而来，不符合 tkex 业务上云标准规范，现需使用基于腾讯云内部系统 tlinux 系统重新制作 web 基础镜像。</p><h1 id="二、web-基础镜像制作"><a href="#二、web-基础镜像制作" class="headerlink" title="二、web 基础镜像制作"></a>二、web 基础镜像制作</h1><p><a href="https://git.woa.com/tax_delivery/base_images/nginx_fed">项目地址 nginx_fed</a></p><h2 id="2-1-dockerfile-方式创建"><a href="#2-1-dockerfile-方式创建" class="headerlink" title="2.1 dockerfile 方式创建"></a>2.1 dockerfile 方式创建</h2><blockquote><p>dockerfile 说明：<br>基于 tlinux2.2-bridge-tcloud-underlay-mini 系统镜像<br>安装 nginx-1.20.1-10.el7<br>安装 logrotate-3.8.6-14.tl2 用于 nginx 日志分割</p></blockquote><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> csighub.tencentyun.com/tkex/tlinux2.<span class="hljs-number">2</span>-bridge-tcloud-underlay-mini:latest<br><br><span class="hljs-keyword">LABEL</span><span class="language-bash"> maintainer=<span class="hljs-string">&quot;yxuanzhang@tencent.com&quot;</span></span><br><br><span class="hljs-comment"># 注意使用&amp;来减少镜像的层级</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">mkdir</span> -p /data/conf &amp;&amp; \</span><br><span class="language-bash">    <span class="hljs-built_in">mkdir</span> -p /data/logs &amp;&amp; \</span><br><span class="language-bash">    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;set encoding=utf-8&quot;</span> &gt;&gt; ~/.vimrc &amp;&amp; \</span><br><span class="language-bash">    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;set fileencodings=utf-8,gb2312,gbk,gb18030&quot;</span> &gt;&gt; ~/.vimrc &amp;&amp; \</span><br><span class="language-bash">    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;set termencoding=utf-8&quot;</span> &gt;&gt; ~/.vimrc</span><br><br><span class="hljs-keyword">ADD</span><span class="language-bash"> ./tkex_start.sh /etc/kickStart.d/</span><br><span class="hljs-keyword">ADD</span><span class="language-bash"> ./conf/nginx/nginx.conf /data/conf/</span><br><span class="hljs-keyword">ADD</span><span class="language-bash"> ./conf/logrotate/nginx.logrotate /data/conf/</span><br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">chmod</span> u+x /etc/kickStart.d/tkex_start.sh &amp;&amp; \</span><br><span class="language-bash">    yum install -y nginx-1.20.1-10.el7 &amp;&amp; \</span><br><span class="language-bash">    yum install -y logrotate-3.8.6-14.tl2</span><br><br><span class="hljs-comment"># http</span><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">80</span><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">8080</span><br><br><span class="hljs-comment"># https</span><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">443</span><br><br><span class="hljs-comment"># 注意 不要使用 CMD/ENTRYPOINT 命令设置自己的 Docker 启动命令，因为tlinux基础镜像启动需要CMD [&quot;/usr/sbin/initStart&quot;]，即systemd作为1号守护进程。</span><br><span class="hljs-comment"># 用户再写 CMD/ENTRYPOINT 会导致原CMD命令覆盖，导致 systemd 无法启动。导致相关依赖 agent 无法启动。</span><br><span class="hljs-comment"># 另外，由于织云安装脚本默认有来源IP限制，因此需要在 IDC 环境构建镜像。建议通过Coding、蓝盾、OCI 等平台构建</span><br></code></pre></td></tr></table></figure><blockquote><p>tLinux 织云包 mini 镜像组成说明（非必读）<br>tlinux Base 镜像来源于 tLinux 提供的 mini 镜像，由 TKEx-CSIG 和 腾讯会议团队共同维护，大小仅为 259.0 MB，基础环境安装包含：</p><ul><li>网管 agent 、洋葱 onion、 sng 初始化(参考 iaas)、铁将军安装、织云包安装；</li><li>常见系统软件包：wget、gcc、gcc-c++、make、strace、iputils、initscripts 等</li><li>修改 systemd init 执行方式，目的是为保存 1 号进程环境变量含用户自定义环境变量;</li><li>设定开机启动脚本&#x2F;etc&#x2F;rc.d&#x2F;rc.config:</li></ul></blockquote><pre><code class="hljs">- 导入 1 号进程环境变量- iptables 初始化- 启动网管 agent- 统一扫描拉起织云包服务- 修改tsc配置为当前机器 ip /usr/local/TsysAgent/etc/proxy_ctrl.conf- 为用户设定自定义启动脚本的目录 /etc/kickStart.d，该目录下的所有 .sh 脚本都会执行，启动日志输出到 /etc/kickStart.d/startApp.log</code></pre><h5 id="注：tLinux-织云包-mini-镜像包含以下运维工具"><a href="#注：tLinux-织云包-mini-镜像包含以下运维工具" class="headerlink" title="注：tLinux 织云包 mini 镜像包含以下运维工具"></a>注：tLinux 织云包 mini 镜像包含以下运维工具</h5><ul><li>netstat</li><li>vmstat</li><li>telnet</li><li>top</li><li>iostat</li></ul><h2 id="2-2-nginx-配置（nginx-conf）"><a href="#2-2-nginx-配置（nginx-conf）" class="headerlink" title="2.2 nginx 配置（nginx.conf）"></a>2.2 nginx 配置（nginx.conf）</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">user</span> nginx;<br><span class="hljs-attribute">worker_processes</span> auto;<br><span class="hljs-attribute">worker_rlimit_nofile</span> <span class="hljs-number">65535</span>;<br><span class="hljs-attribute">error_log</span> /data/logs/<span class="hljs-literal">error</span>.log;<br><span class="hljs-attribute">pid</span> /run/nginx.pid;<br><span class="hljs-attribute">daemon</span> <span class="hljs-literal">off</span>;<br><br><span class="hljs-section">events</span> &#123;<br>    <span class="hljs-attribute">worker_connections</span> <span class="hljs-number">2048</span>;<br>&#125;<br><br><span class="hljs-section">http</span> &#123;<br>    <span class="hljs-attribute">log_format</span>  main  <span class="hljs-string">&#x27;<span class="hljs-variable">$remote_addr</span> - <span class="hljs-variable">$remote_user</span> [<span class="hljs-variable">$time_local</span>] &quot;<span class="hljs-variable">$request</span>&quot; &#x27;</span><br>                      <span class="hljs-string">&#x27;<span class="hljs-variable">$status</span> <span class="hljs-variable">$body_bytes_sent</span> &quot;<span class="hljs-variable">$http_referer</span>&quot; &#x27;</span><br>                      <span class="hljs-string">&#x27;&quot;<span class="hljs-variable">$http_user_agent</span>&quot; &quot;<span class="hljs-variable">$http_x_forwarded_for</span>&quot; &quot;<span class="hljs-variable">$http_referer</span>&quot;&#x27;</span>;<br><br>    <span class="hljs-attribute">access_log</span>  /data/logs/access.log  main;<br>    <span class="hljs-attribute">client_max_body_size</span>    <span class="hljs-number">100m</span>;<br>    <span class="hljs-attribute">sendfile</span>            <span class="hljs-literal">on</span>;<br>    <span class="hljs-attribute">tcp_nopush</span>          <span class="hljs-literal">on</span>;<br>    <span class="hljs-attribute">tcp_nodelay</span>         <span class="hljs-literal">on</span>;<br>    <span class="hljs-attribute">keepalive_timeout</span>   <span class="hljs-number">65</span>;<br>    <span class="hljs-attribute">types_hash_max_size</span> <span class="hljs-number">4096</span>;<br><br>    <span class="hljs-attribute">gzip</span> <span class="hljs-literal">on</span>;<br>    <span class="hljs-attribute">gzip_disable</span> <span class="hljs-string">&quot;msie6&quot;</span>;<br>    <span class="hljs-attribute">gzip_vary</span> <span class="hljs-literal">on</span>;<br>    <span class="hljs-attribute">gzip_proxied</span> any;<br>    <span class="hljs-attribute">gzip_comp_level</span> <span class="hljs-number">6</span>;<br>    <span class="hljs-attribute">gzip_buffers</span> <span class="hljs-number">16</span> <span class="hljs-number">8k</span>;<br>    <span class="hljs-attribute">gzip_http_version</span> <span class="hljs-number">1</span>.<span class="hljs-number">1</span>;<br>    <span class="hljs-attribute">gzip_min_length</span> <span class="hljs-number">256</span>;<br>    <span class="hljs-attribute">gzip_types</span> text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss application/javascript text/javascript application/vnd.ms-fontobject application/x-font-ttf font/opentype image/svg+xml image/x-icon;<br><br>    <span class="hljs-attribute">proxy_connect_timeout</span> <span class="hljs-number">300s</span>;<br>    <span class="hljs-attribute">proxy_send_timeout</span> <span class="hljs-number">300s</span>;<br>    <span class="hljs-attribute">proxy_read_timeout</span> <span class="hljs-number">300s</span>;<br>    <span class="hljs-attribute">send_timeout</span> <span class="hljs-number">300s</span>;<br>    <span class="hljs-attribute">fastcgi_connect_timeout</span> <span class="hljs-number">300</span>;<br>    <span class="hljs-attribute">fastcgi_send_timeout</span> <span class="hljs-number">300</span>;<br>    <span class="hljs-attribute">fastcgi_read_timeout</span> <span class="hljs-number">300</span>;<br><br>    <span class="hljs-attribute">include</span>             /etc/nginx/mime.types;<br>    <span class="hljs-attribute">default_type</span>        application/octet-stream;<br><br>    <span class="hljs-comment"># Load modular configuration files from the /etc/nginx/conf.d directory.</span><br>    <span class="hljs-comment"># See http://nginx.org/en/docs/ngx_core_module.html#include</span><br>    <span class="hljs-comment"># for more information.</span><br>    <span class="hljs-comment"># include servers/*.conf;</span><br>    <span class="hljs-comment"># include /etc/nginx/conf.d/*.conf;</span><br>    <span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;<br>        <span class="hljs-attribute">listen</span>       [::]:<span class="hljs-number">80</span>;<br>        <span class="hljs-attribute">server_name</span>  _;<br>        <span class="hljs-attribute">root</span>         /usr/share/nginx/html;<br>    &#125;<br>    <span class="hljs-comment"># 自定义脚本可通过 /data/conf 目录挂载到容器中</span><br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>注：该配置仅包含 nginx 基础配置，其他 server 配置请前往七彩石配置，并挂载至&#x2F;data&#x2F;conf 路径中。</p></blockquote><h2 id="2-3-logrotate-配置"><a href="#2-3-logrotate-配置" class="headerlink" title="2.3 logrotate 配置"></a>2.3 logrotate 配置</h2><figure class="highlight puppet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs puppet">/data/logs/*<span class="hljs-keyword">log</span> &#123;<br>    su <span class="hljs-literal">root</span> <span class="hljs-literal">root</span><br>    create <span class="hljs-number">0777</span> <span class="hljs-literal">root</span> <span class="hljs-literal">root</span><br>    daily<br>    rotate <span class="hljs-number">10</span><br>    missingok<br>    notifempty<br>    compress<br>    sharedscripts<br>    postrotate<br>        /usr/sbin/nginx -s reload -c /data/conf/nginx.conf<br>    endscript<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-4-镜像制作-上传"><a href="#2-4-镜像制作-上传" class="headerlink" title="2.4 镜像制作&amp;上传"></a>2.4 镜像制作&amp;上传</h2><blockquote><p>建议在 devCloud 中制作镜像</p></blockquote><ol><li><p>build<br><code>docker build -t nginx_fed:v1.0.0 --network=host  -f ./Dockerfile .</code></p></li><li><p>tag<br><code>docker tag nginx_fed:v1.0.0 csighub.tencentyun.com/wpe/nginx_fed:latest</code></p></li><li><p>login<br><code>docker login csighub.tencentyun.com</code></p></li><li><p>push<br><code>docker push csighub.tencentyun.com/wpe/nginx_fed:latest</code></p></li></ol>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nginx</tag>
      
      <tag>docker</tag>
      
      <tag>tlinux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025-07-24 【docker】web通用基础镜像制作</title>
    <link href="/2025/11/28/2025-07-24%20%E3%80%90docker%E3%80%91web%E9%80%9A%E7%94%A8%E5%9F%BA%E7%A1%80%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C/"/>
    <url>/2025/11/28/2025-07-24%20%E3%80%90docker%E3%80%91web%E9%80%9A%E7%94%A8%E5%9F%BA%E7%A1%80%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C/</url>
    
    <content type="html"><![CDATA[<h2 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h2><ul><li>禁用了 eth0 网络流量（iptables）</li><li>配置内网防火墙 iptables</li></ul><h2 id="性能"><a href="#性能" class="headerlink" title="性能"></a>性能</h2><ul><li>并发</li><li>缓存</li><li>压缩</li></ul><h2 id="运维"><a href="#运维" class="headerlink" title="运维"></a>运维</h2><ul><li>工具预装</li></ul><h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><ul><li>外置启动脚本</li><li>nginx 扩展配置</li></ul>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nestjs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025-08-21- 【chrome扩展】chrome插件开发-垂直标签.md</title>
    <link href="/2025/11/28/2025-08-21-%20%E3%80%90chrome%E6%89%A9%E5%B1%95%E3%80%91chrome%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91-%E5%9E%82%E7%9B%B4%E6%A0%87%E7%AD%BE/"/>
    <url>/2025/11/28/2025-08-21-%20%E3%80%90chrome%E6%89%A9%E5%B1%95%E3%80%91chrome%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91-%E5%9E%82%E7%9B%B4%E6%A0%87%E7%AD%BE/</url>
    
    <content type="html"><![CDATA[<h1 id="chrome-垂直标签"><a href="#chrome-垂直标签" class="headerlink" title="chrome 垂直标签"></a>chrome 垂直标签</h1><p>Tree Style Tab、Tab Center Redux、侧边栏垂直标签页</p><h2 id="已有插件调研"><a href="#已有插件调研" class="headerlink" title="已有插件调研"></a>已有插件调研</h2><p>出发点，</p><h2 id="问题与思考"><a href="#问题与思考" class="headerlink" title="问题与思考"></a>问题与思考</h2><ol><li>自定义功能</li><li>学习与探索</li><li>用户体验提升</li></ol><h2 id="需求梳理"><a href="#需求梳理" class="headerlink" title="需求梳理"></a>需求梳理</h2><h2 id="架构设计"><a href="#架构设计" class="headerlink" title="架构设计"></a>架构设计</h2><h3 id="技术架构"><a href="#技术架构" class="headerlink" title="技术架构"></a>技术架构</h3><p>前端框架：Vue 3 + TypeScript<br>构建工具：Vite<br>样式预处理器：Less<br>图标库：TDesign Icons</p><h3 id="业务架构"><a href="#业务架构" class="headerlink" title="业务架构"></a>业务架构</h3><p>智能分组系统：支持域名自动分组和手动自定义分组双模式<br>智能排序算法：三种排序模式 + 拖拽排序优先级机制<br>新标签页自动归类：自动将新标签页移动到相同域名标签页旁<br>拖拽操作：支持标签页的拖拽分配和排序<br>搜索过滤：快速搜索标签页标题和 URL</p><h2 id="插件实现"><a href="#插件实现" class="headerlink" title="插件实现"></a>插件实现</h2>]]></content>
    
    
    <categories>
      
      <category>工具</category>
      
    </categories>
    
    
    <tags>
      
      <tag>chrome</tag>
      
      <tag>插件开发</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025-09-15 【架构】图片懒加载</title>
    <link href="/2025/11/28/2025-09-15%20%E3%80%90%E6%9E%B6%E6%9E%84%E3%80%91%E5%9B%BE%E7%89%87%E6%87%92%E5%8A%A0%E8%BD%BD/"/>
    <url>/2025/11/28/2025-09-15%20%E3%80%90%E6%9E%B6%E6%9E%84%E3%80%91%E5%9B%BE%E7%89%87%E6%87%92%E5%8A%A0%E8%BD%BD/</url>
    
    <content type="html"><![CDATA[<h1 id="图片懒加载方式"><a href="#图片懒加载方式" class="headerlink" title="图片懒加载方式"></a>图片懒加载方式</h1><blockquote><p>为什么要做图片懒加载</p></blockquote><table><thead><tr><th>维度</th><th>具体收益</th><th>量化参考</th></tr></thead><tbody><tr><td><strong>省</strong></td><td>节省流量（服务器 + 用户）</td><td>首屏 30 张图 → 只加载 3 张，节省 80% 以上出站流量；移动端每 100 KB ≈ 1 分钱，电商大促日可省万元带宽费。</td></tr><tr><td><strong>升 1</strong></td><td>提升首屏速度</td><td>减少首屏 HTTP 请求数与下载量，Largest Contentful Paint（LCP）平均缩短 20%–40%，直接优化 Core Web Vitals。</td></tr><tr><td><strong>升 2</strong></td><td>提升用户体验</td><td>减少白屏&#x2F;卡顿，低端机发热降低；滚动更跟手，用户留存率平均 +3%–7%。</td></tr><tr><td><strong>升 3</strong></td><td>提升 SEO 与转化率</td><td>Google 已将 LCP 作为排名因子，懒加载后评分提升，搜索曝光 +5%–10%；电商场景下，页面加载每快 100 ms，转化率可提 1%–2%。</td></tr></tbody></table><h2 id="1-方式一-img-的-loading-属性设为“lazy”"><a href="#1-方式一-img-的-loading-属性设为“lazy”" class="headerlink" title="1. 方式一 img 的 loading 属性设为“lazy”"></a>1. 方式一 img 的 loading 属性设为“lazy”</h2><blockquote><p>HTML 元素延迟加载属性 —— loading 属性值 lazy 允许浏览器选择性加载 IMG 元素，根据用户滚动操作至其元素附近执行加载，一定程度起到节流的作用。</p></blockquote><h2 id="2-方式二-offsetTop-scrollTop-innerHeight"><a href="#2-方式二-offsetTop-scrollTop-innerHeight" class="headerlink" title="2. 方式二 offsetTop - scrollTop &lt; &#x3D; innerHeight"></a>2. 方式二 offsetTop - scrollTop &lt; &#x3D; innerHeight</h2><h2 id="3-方式三-IntersectionObserver-directive"><a href="#3-方式三-IntersectionObserver-directive" class="headerlink" title="3. 方式三 IntersectionObserver + directive"></a>3. 方式三 IntersectionObserver + directive</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> defaultImg <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/assets/default_img.png&#x27;</span>;<br><span class="hljs-comment">// 异步加载图片</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">imageAsync</span> = (<span class="hljs-params">url: string</span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt;(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> img = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Image</span>();<br>    img.<span class="hljs-property">src</span> = url;<br>    img.<span class="hljs-property">onload</span> = <span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-title function_">resolve</span>();<br>    &#125;;<br>    img.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;<br>      <span class="hljs-title function_">reject</span>(err);<br>    &#125;;<br>  &#125;);<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> lazyPlugin = &#123;<br>  <span class="hljs-title function_">install</span>(<span class="hljs-params">app: &#123; directive: (arg0: string, arg1: &#123; mounted: (el: any, binding: any) =&gt; <span class="hljs-keyword">void</span> &#125;) =&gt; <span class="hljs-keyword">void</span> &#125;</span>) &#123;<br>    app.<span class="hljs-title function_">directive</span>(<span class="hljs-string">&#x27;lazy&#x27;</span>, &#123;<br>      <span class="hljs-title function_">mounted</span>(<span class="hljs-params">el, binding</span>) &#123;<br>        el.<span class="hljs-property">src</span> = defaultImg;<br>        <span class="hljs-keyword">const</span> io = <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntersectionObserver</span>(<span class="hljs-function">(<span class="hljs-params">entries</span>) =&gt;</span> &#123;<br>          entries.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>            <span class="hljs-keyword">if</span> (item.<span class="hljs-property">isIntersecting</span>) &#123;<br>              <span class="hljs-comment">// 使用异步加载图片</span><br>              <span class="hljs-title function_">imageAsync</span>(binding.<span class="hljs-property">value</span>)<br>                .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>                  el.<span class="hljs-property">src</span> = binding.<span class="hljs-property">value</span>; <span class="hljs-comment">// 成功后再替换 img 标签的 src</span><br>                &#125;)<br>                .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>                  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(error);<br>                &#125;);<br>              io.<span class="hljs-title function_">unobserve</span>(item.<span class="hljs-property">target</span>);<br>            &#125;<br>          &#125;);<br>        &#125;);<br>        io.<span class="hljs-title function_">observe</span>(el);<br>      &#125;,<br>    &#125;);<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure><blockquote><p>注意：使用时，需考虑传入参数的值</p></blockquote><h2 id="4-方式四-VUE3-VUE2-v-lazy"><a href="#4-方式四-VUE3-VUE2-v-lazy" class="headerlink" title="4. 方式四 VUE3 VUE2 v-lazy"></a>4. 方式四 VUE3 VUE2 v-lazy</h2>]]></content>
    
    
    <categories>
      
      <category>工具</category>
      
    </categories>
    
    
    <tags>
      
      <tag>懒加载</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025-09-15 【架构】SEO方案</title>
    <link href="/2025/11/28/2025-09-15%20%E3%80%90%E6%9E%B6%E6%9E%84%E3%80%91%E8%AE%BF%E9%97%AE%E5%9F%8B%E7%82%B9%E4%B8%8ESEO%E6%96%B9%E6%A1%88/"/>
    <url>/2025/11/28/2025-09-15%20%E3%80%90%E6%9E%B6%E6%9E%84%E3%80%91%E8%AE%BF%E9%97%AE%E5%9F%8B%E7%82%B9%E4%B8%8ESEO%E6%96%B9%E6%A1%88/</url>
    
    <content type="html"><![CDATA[<h1 id="什么是-SEO"><a href="#什么是-SEO" class="headerlink" title="什么是 SEO"></a>什么是 SEO</h1><blockquote><p>搜索引擎优化(Search Engine Optimization)SEO。它是一系列通过提高网站在搜索引擎（如 Google、百度、必应）自然搜索结果中的排名，从而获取更多 免费（非付费）流量 的技术和策略。</p></blockquote><h1 id="SEO-的核心内容"><a href="#SEO-的核心内容" class="headerlink" title="SEO 的核心内容"></a>SEO 的核心内容</h1><p>SSR 服务端渲染</p><p>预编译 prerender-spa-plugin 插件</p><h1 id="访问埋点"><a href="#访问埋点" class="headerlink" title="访问埋点"></a>访问埋点</h1><p>一、伽利略 <a href="https://j.woa.com/">https://j.woa.com/</a><br>主要能力</p><p>访问来源使用的浏览器环境<br>单个页面 url 的 PV 统计，分析用户访问的目标页面的比重<br>访问用户使用的网络环境<br>来源客户端的操作系统<br>访问用户所使用的网络运营商，移动电信联通<br>访问设备的品牌，机型等<br>用户地域分布<br>Performance 分析统计<br>页面和接口报错统计<br>二、TAM&#x2F;RUM<br>主要能力</p><p>访问来源使用的浏览器环境<br>单个页面 url 的 PV 统计，分析用户访问的目标页面的比重<br>访问用户使用的网络环境<br>来源客户端的操作系统<br>访问用户所使用的网络运营商，移动电信联通<br>访问设备的品牌，机型等<br>用户地域分布<br>Performance 分析统计<br>页面和接口报错统计<br>可以通过 sourcemap 上传，调试生产 js 报错内容<br>三、腾讯灯塔<br>灯塔基本涵盖了上面两个的基础功能，但重在自定义事件和自定义数据字段的上报，数据分析，数据报表生成等</p><h2 id="解决方案："><a href="#解决方案：" class="headerlink" title="解决方案："></a>解决方案：</h2><p>RUM + 百度统计 or 谷歌分析结合的方案，RUM 主要负责错误监控，告警通知等，百度统计 or 谷歌分析做用户来源分析</p>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SEO</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025-09-16 【架构】自适应方案</title>
    <link href="/2025/11/28/2025-09-16%20%E3%80%90%E6%9E%B6%E6%9E%84%E3%80%91%E8%87%AA%E9%80%82%E5%BA%94%E6%96%B9%E6%A1%88/"/>
    <url>/2025/11/28/2025-09-16%20%E3%80%90%E6%9E%B6%E6%9E%84%E3%80%91%E8%87%AA%E9%80%82%E5%BA%94%E6%96%B9%E6%A1%88/</url>
    
    <content type="html"><![CDATA[<h1 id="postcss-px-to-viewport-和-postcss-pxtorem"><a href="#postcss-px-to-viewport-和-postcss-pxtorem" class="headerlink" title="postcss-px-to-viewport 和 postcss-pxtorem"></a>postcss-px-to-viewport 和 postcss-pxtorem</h1><blockquote><p>postcss-px-to-viewport 和 postcss-pxtorem 是两个 postcss 插件，可以将 px 单位转换为 vw 或 rem 单位，以达到自适应的效果。</p></blockquote><ol><li>安装依赖：</li></ol><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elm"><span class="hljs-title">npm</span> install postcss-px-to-view<span class="hljs-keyword">port</span> postcss-pxtorem <span class="hljs-comment">--save-dev</span><br></code></pre></td></tr></table></figure><ol><li>配置 vite.config.ts</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">css</span>: &#123;<br>      <span class="hljs-attr">postcss</span>: &#123;<br>        <span class="hljs-attr">plugins</span>: [<br>          <span class="hljs-title function_">postCssPxToRem</span>(&#123;<br>            <span class="hljs-comment">// 自适应，px&gt;rem转换</span><br>            <span class="hljs-attr">rootValue</span>: <span class="hljs-number">192</span>, <span class="hljs-comment">// pc端建议：192，移动端建议：75；设计稿宽度的1 / 10</span><br>            <span class="hljs-attr">propList</span>: [<span class="hljs-string">&#x27;*&#x27;</span>, <span class="hljs-string">&#x27;!border&#x27;</span>], <span class="hljs-comment">// 除 border 外所有px 转 rem // 需要转换的属性，这里选择全部都进行转换</span><br>            <span class="hljs-attr">selectorBlackList</span>: [<span class="hljs-string">&#x27;.norem&#x27;</span>], <span class="hljs-comment">// 过滤掉norem-开头的class，不进行rem转换，这个内容可以不写</span><br>            <span class="hljs-attr">unitPrecision</span>: <span class="hljs-number">5</span>, <span class="hljs-comment">// 转换后的精度，即小数点位数</span><br>            <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 是否直接更换属性值而不添加备份属性</span><br>            <span class="hljs-attr">mediaQuery</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 是否在媒体查询中也转换px为rem</span><br>            <span class="hljs-attr">minPixelValue</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// 设置要转换的最小像素值</span><br>            <span class="hljs-comment">// exclude: /^(?.*\/src\/home(\/|$)).*/</span><br>            <span class="hljs-attr">exclude</span>: <span class="hljs-function">(<span class="hljs-params">file: string</span>) =&gt;</span> &#123;<br>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(file);<br>              <span class="hljs-keyword">let</span> exclude = <span class="hljs-literal">false</span>;<br>              <span class="hljs-keyword">const</span> whiteList = [<span class="hljs-string">&#x27;login/index.vue&#x27;</span>, <span class="hljs-string">&#x27;node_modules/&#x27;</span>]; <span class="hljs-comment">// 白名单，只转换白名单内的svg文件</span><br>              whiteList.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>                <span class="hljs-keyword">if</span> (file.<span class="hljs-title function_">includes</span>(item)) &#123;<br>                  exclude = <span class="hljs-literal">true</span>;<br>                &#125;<br>              &#125;);<br>              <span class="hljs-keyword">return</span> exclude;<br>            &#125;,<br>          &#125;),<br>        ],<br>      &#125;,<br>    &#125;,<br></code></pre></td></tr></table></figure><h1 id="浏览器兼容"><a href="#浏览器兼容" class="headerlink" title="浏览器兼容"></a>浏览器兼容</h1><ol><li>添加浏览器前缀：使用 Autoprefixer 插件为 CSS 添加必要的浏览器前缀，确保兼容性。</li></ol>]]></content>
    
    
    <categories>
      
      <category>工具</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vite</tag>
      
      <tag>自适应方案</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025-10-11 【小程序】微信小程序OCR服务</title>
    <link href="/2025/11/28/2025-10-11%20%E3%80%90%E5%B0%8F%E7%A8%8B%E5%BA%8F%E3%80%91%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8FOCR%E6%9C%8D%E5%8A%A1/"/>
    <url>/2025/11/28/2025-10-11%20%E3%80%90%E5%B0%8F%E7%A8%8B%E5%BA%8F%E3%80%91%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8FOCR%E6%9C%8D%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<h2 id="1-结论"><a href="#1-结论" class="headerlink" title="1. 结论"></a>1. 结论</h2><p>使用微信服务市场，“微信 OCR 识别”服务“纯前端”调用，每日 100 次免费调用额度（前期进件量不大能够覆盖日常使用场景）</p><h2 id="2-代码示例"><a href="#2-代码示例" class="headerlink" title="2. 代码示例"></a>2. 代码示例</h2><ul><li>步骤</li></ul><ol><li>选择相册&#x2F;相机</li><li>上传 CDN（图片太大 256kb 限制，上传到微信 CDN 进行压缩）</li><li>调用服务市场的 OcrAllInOne 服务</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 1：身份证；2：银行卡；3：行驶证；4：驾驶证；7：营业执照；8：通用OCR ; 10: 车牌识别</span><br><br>  <span class="hljs-title function_">handleImageUploadClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> selft = <span class="hljs-variable language_">this</span>;<br>    wx.<span class="hljs-title function_">chooseMedia</span>(&#123;<br>      <span class="hljs-attr">count</span>: <span class="hljs-number">1</span>,<br>      <span class="hljs-attr">mediaType</span>: [<span class="hljs-string">&quot;image&quot;</span>],<br>      <span class="hljs-attr">sourceType</span>: [<span class="hljs-string">&quot;album&quot;</span>, <span class="hljs-string">&quot;camera&quot;</span>],<br>      <span class="hljs-attr">maxDuration</span>: <span class="hljs-number">30</span>,<br>      <span class="hljs-attr">camera</span>: <span class="hljs-string">&quot;back&quot;</span>,<br>      <span class="hljs-keyword">async</span> <span class="hljs-title function_">success</span>(<span class="hljs-params">res</span>) &#123;<br>        <span class="hljs-keyword">let</span> ocr_type = <span class="hljs-number">1</span>;<br><br>        <span class="hljs-keyword">let</span> img_url = <span class="hljs-keyword">new</span> wx.<span class="hljs-property">serviceMarket</span>.<span class="hljs-title function_">CDN</span>(&#123;<br>          <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;filePath&quot;</span>,<br>          <span class="hljs-attr">filePath</span>: res.<span class="hljs-property">tempFiles</span>[<span class="hljs-number">0</span>].<span class="hljs-property">tempFilePath</span>,<br>        &#125;);<br>        wx.<span class="hljs-property">serviceMarket</span><br>          .<span class="hljs-title function_">invokeService</span>(&#123;<br>            <span class="hljs-attr">service</span>: <span class="hljs-string">&quot;wx79ac3de8be320b71&quot;</span>,<br>            <span class="hljs-attr">api</span>: <span class="hljs-string">&quot;OcrAllInOne&quot;</span>,<br>            <span class="hljs-attr">data</span>: &#123;<br>              <span class="hljs-comment">// 用 CDN 方法标记要上传并转换成 HTTP URL 的文件</span><br>              <span class="hljs-attr">data_type</span>: <span class="hljs-number">3</span>,<br>              img_url,<br>              ocr_type,<br>            &#125;,<br>          &#125;)<br>          .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;invokeService success&quot;</span>, res);<br>            wx.<span class="hljs-title function_">showModal</span>(&#123;<br>              <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;cost&quot;</span>,<br>              <span class="hljs-attr">content</span>: res + <span class="hljs-string">&quot;&quot;</span>,<br>            &#125;);<br>          &#125;)<br>          .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;<br>            <span class="hljs-comment">// 错误码107，原因为没有可用资源次数</span><br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;invokeService fail&quot;</span>, err);<br>            wx.<span class="hljs-title function_">showModal</span>(&#123;<br>              <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;fail&quot;</span>,<br>              <span class="hljs-attr">content</span>: err + <span class="hljs-string">&quot;&quot;</span>,<br>            &#125;);<br>          &#125;);<br>      &#125;,<br>    &#125;);<br>  &#125;,<br></code></pre></td></tr></table></figure><h2 id="3-问题"><a href="#3-问题" class="headerlink" title="3. 问题"></a>3. 问题</h2><ol><li>返回错误码 103，原因：未开通 OCR 服务权限</li><li>返回错误码 107，原因：调用次数超限</li></ol><h2 id="4-参考文献"><a href="#4-参考文献" class="headerlink" title="4. 参考文献"></a>4. 参考文献</h2><ul><li><a href="https://fuwu.weixin.qq.com/service/detail/000ce4cec24ca026d37900ed551415">微信小程序 OCR 服务</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>小程序</category>
      
    </categories>
    
    
    <tags>
      
      <tag>OCR</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025-11-06 【小程序】微信小程序预拉取</title>
    <link href="/2025/11/28/2025-11-06%20%E3%80%90%E5%B0%8F%E7%A8%8B%E5%BA%8F%E3%80%91%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%A2%84%E6%8B%89%E5%8F%96/"/>
    <url>/2025/11/28/2025-11-06%20%E3%80%90%E5%B0%8F%E7%A8%8B%E5%BA%8F%E3%80%91%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%A2%84%E6%8B%89%E5%8F%96/</url>
    
    <content type="html"><![CDATA[<h1 id="需求背景"><a href="#需求背景" class="headerlink" title="需求背景"></a>需求背景</h1><h1 id="可行方案"><a href="#可行方案" class="headerlink" title="可行方案"></a>可行方案</h1><h2 id="a-应用级-预加载（性能好，缓存问题）"><a href="#a-应用级-预加载（性能好，缓存问题）" class="headerlink" title="a. 应用级-预加载（性能好，缓存问题）"></a>a. 应用级-预加载（性能好，缓存问题）</h2><ol><li>异步加载，页面生命周期早于预拉取执行</li><li>维护更新，无法实时获取最新配置（热启动未拉取最新配置）</li><li>维护更新，更新数据库后，仍需修改小程序管理后台数据预拉取配置，以触发预拉取数据变更</li></ol><h2 id="b-页面级-普通接口拉取（时效性）"><a href="#b-页面级-普通接口拉取（时效性）" class="headerlink" title="b. 页面级-普通接口拉取（时效性）"></a>b. 页面级-普通接口拉取（时效性）</h2><ol><li>每次半屏渲染都会获取一次最新配置数据</li></ol><h1 id="预加载方案"><a href="#预加载方案" class="headerlink" title="预加载方案"></a>预加载方案</h1><h2 id="1-app-js-中注入代码"><a href="#1-app-js-中注入代码" class="headerlink" title="1. app.js 中注入代码"></a>1. app.js 中注入代码</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 读取预拉取的 半屏白名单，EventBus 告知页面</span><br><span class="hljs-title function_">initHalfWhiteListByByPrefetchData</span>(<span class="hljs-params">fetchedData</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;预拉取数据&#x27;</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(fetchedData)); <span class="hljs-comment">// 缓存数据 - 客户端拿到缓存数据的时间戳</span><br>  <span class="hljs-keyword">const</span> jsonData = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(fetchedData);<br>  <span class="hljs-keyword">const</span> &#123; <span class="hljs-title class_">Data</span> = [] &#125; = jsonData.<span class="hljs-property">Response</span>;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">globalData</span>.<span class="hljs-property">halfWhiteAppIds</span>.<span class="hljs-property">MP_CERTIFICATION_TRUST_APPIDS</span> = <span class="hljs-title class_">Data</span>?.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item?.<span class="hljs-property">AuthType</span> === <span class="hljs-number">1</span>)?.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">j</span> =&gt;</span> j?.<span class="hljs-property">SpAppId</span>);<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">globalData</span>.<span class="hljs-property">halfWhiteAppIds</span>.<span class="hljs-property">loaded</span> = <span class="hljs-literal">true</span>;<br>  <span class="hljs-title class_">EventBus</span>.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;halfWhitelistLoaded&#x27;</span>);<br>&#125;,<br><span class="hljs-title function_">onLaunch</span>(<span class="hljs-params"></span>) &#123;<br>  wx.<span class="hljs-title function_">onBackgroundFetchData</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initHalfWhiteListByByPrefetchData</span>(res?.<span class="hljs-property">fetchedData</span>);<br>  &#125;);<br>  wx.<span class="hljs-title function_">getBackgroundFetchData</span>(&#123;<br>    <span class="hljs-attr">fetchType</span>: <span class="hljs-string">&quot;pre&quot;</span>,<br>    <span class="hljs-title function_">success</span>(<span class="hljs-params">res</span>) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initHalfWhiteListByByPrefetchData</span>(res?.<span class="hljs-property">fetchedData</span>);<br>    &#125;,<br>  &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-pagejs-页面中注入代码"><a href="#2-pagejs-页面中注入代码" class="headerlink" title="2.pagejs 页面中注入代码"></a>2.pagejs 页面中注入代码</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">onLoad</span>(<span class="hljs-params">options</span>) &#123;<br>  wx.<span class="hljs-title function_">hideHomeButton</span>();<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;&gt;&gt;&gt;halfWhitelistLoaded &gt;&gt;&gt;&#x27;</span>, <span class="hljs-title function_">getApp</span>().<span class="hljs-property">globalData</span>.<span class="hljs-property">halfWhiteAppIds</span>);<br>  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">getApp</span>().<span class="hljs-property">globalData</span>.<span class="hljs-property">halfWhiteAppIds</span>.<span class="hljs-property">loaded</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initPageAfterHalfAuthCheck</span>();<br>  &#125;<br>  <span class="hljs-title class_">EventBus</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;halfWhitelistLoaded&#x27;</span>, <span class="hljs-title function_">async</span> () =&gt; &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;&gt;&gt;&gt;halfWhitelistLoaded 2&gt;&gt;&gt;&#x27;</span>, <span class="hljs-title function_">getApp</span>().<span class="hljs-property">globalData</span>.<span class="hljs-property">halfWhiteAppIds</span>);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initPageAfterHalfAuthCheck</span>();<br>  &#125;);<br>&#125;,<br><span class="hljs-title function_">initPageAfterHalfAuthCheck</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">// 初始化页面...</span><br>&#125;,<br></code></pre></td></tr></table></figure><h2 id="3-创建-EventBus类"><a href="#3-创建-EventBus类" class="headerlink" title="3. 创建 EventBus类"></a>3. 创建 <code>EventBus</code>类</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">EventBus</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span> = &#123;&#125;;<br>  &#125;<br><br>  <span class="hljs-title function_">on</span>(<span class="hljs-params">event, listener</span>) &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>[event]) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>[event] = [];<br>    &#125;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>[event].<span class="hljs-title function_">push</span>(listener);<br>  &#125;<br><br>  <span class="hljs-title function_">off</span>(<span class="hljs-params">event, listener</span>) &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>[event]) <span class="hljs-keyword">return</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>[event] = <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>[event].<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">l</span>) =&gt;</span> l !== listener);<br>  &#125;<br><br>  <span class="hljs-title function_">emit</span>(<span class="hljs-params">event, args</span>) &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>[event]) <span class="hljs-keyword">return</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>[event].<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">listener</span>) =&gt;</span> <span class="hljs-title function_">listener</span>(args));<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventBus</span>();<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>小程序</category>
      
    </categories>
    
    
    <tags>
      
      <tag>预拉取</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025-11-06 【小程序】微信小程序预拉取</title>
    <link href="/2025/11/28/2025-11-07%20%E3%80%90web%E3%80%91%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7/"/>
    <url>/2025/11/28/2025-11-07%20%E3%80%90web%E3%80%91%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7/</url>
    
    <content type="html"><![CDATA[<h1 id="chrome-性能监控"><a href="#chrome-性能监控" class="headerlink" title="chrome 性能监控"></a>chrome 性能监控</h1><p>运行时性能监控<br>加载时性能<br>网络</p><p><a href="https://developer.chrome.com/docs/devtools/performance/overview?hl=zh-cn">性能面板</a><br><a href="https://developer.chrome.com/docs/devtools/performance-monitor?hl=zh-cn">性能监控面板</a></p>]]></content>
    
    
    <categories>
      
      <category>小程序</category>
      
    </categories>
    
    
    <tags>
      
      <tag>预拉取</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025-10-11 【小程序】微信小程序打开H5</title>
    <link href="/2025/11/28/2025-10-11%20%E3%80%90%E5%B0%8F%E7%A8%8B%E5%BA%8F%E3%80%91%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%89%93%E5%BC%80H5/"/>
    <url>/2025/11/28/2025-10-11%20%E3%80%90%E5%B0%8F%E7%A8%8B%E5%BA%8F%E3%80%91%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%89%93%E5%BC%80H5/</url>
    
    <content type="html"><![CDATA[<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>由于当前小程序需打开不受控的外部链接（XX H5，域名不受控），且非公众号，所以仅支持第 3 种方式“引导用户复制链接在外部浏览器打开”。</p><h2 id="1-使用-web-view-组件（最常用方式）"><a href="#1-使用-web-view-组件（最常用方式）" class="headerlink" title="1. 使用 web-view 组件（最常用方式）"></a>1. 使用 web-view 组件（最常用方式）</h2><blockquote><p>前提条件：</p><ol><li>外部 H5 链接必须是 HTTPS 协议。</li><li>该域名必须在微信小程序后台的 业务域名 中配置，并完成校验文件上传。</li><li>小程序必须是企业主体（个人小程序不支持 web-view）。<br>✅ 适用于：你已经拥有或能控制该 H5 域名，且能完成域名验证的情况。</li></ol></blockquote><p>1.1 替代方案：<br>使用中间跳转页：在你自己的域名下搭建一个中间页面，用 web-view 打开该中间页，再由中间页通过 JavaScript 跳转到目标外部 H5 链接。或 iframe 嵌入外部 H5。</p><ul><li>!!#e60000 已测试，该“替代方案”不可用!!</li></ul><h2 id="2-长按图片二维码识别后手动打开链接"><a href="#2-长按图片二维码识别后手动打开链接" class="headerlink" title="2. 长按图片二维码识别后手动打开链接"></a>2. 长按图片二维码识别后手动打开链接</h2><ul><li>通过 image 组件 show-menu-by-longpress 属性，支持<a href="https://developers.weixin.qq.com/miniprogram/dev/component/image.html#%E6%94%AF%E6%8C%81%E9%95%BF%E6%8C%89%E8%AF%86%E5%88%AB%E7%9A%84%E7%A0%81">长按识别二维码</a>，仅支持微信关联场景如下：</li></ul><h2 id="3-引导用户复制链接在外部浏览器打开"><a href="#3-引导用户复制链接在外部浏览器打开" class="headerlink" title="3. 引导用户复制链接在外部浏览器打开"></a>3. 引导用户复制链接在外部浏览器打开</h2><h3 id="3-1-引导文案-复制按钮-引导用户"><a href="#3-1-引导文案-复制按钮-引导用户" class="headerlink" title="3.1 引导文案+复制按钮 引导用户"></a>3.1 引导文案+复制按钮 引导用户</h3><h3 id="3-2-打开自主可控域名-…引导用户打开外部-H5"><a href="#3-2-打开自主可控域名-…引导用户打开外部-H5" class="headerlink" title="3.2 打开自主可控域名 + …引导用户打开外部 H5"></a>3.2 打开自主可控域名 + …引导用户打开外部 H5</h3><blockquote><p>思路：</p><ol><li>配置业务域名（添加签名文件）</li><li>页面内容为引导文案，打开页面时区分运行环境，微信内打开则展示引导文案，外部浏览器打开则跳转目标 H5</li></ol></blockquote>]]></content>
    
    
    <categories>
      
      <category>工具</category>
      
    </categories>
    
    
    <tags>
      
      <tag>H5</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025-11-17 【chrome扩展】chrome插件开发-网络请求拦截</title>
    <link href="/2025/11/28/2025-11-17%20%E3%80%90chrome%E6%89%A9%E5%B1%95%E3%80%91chrome%E6%89%A9%E5%B1%95%E5%BC%80%E5%8F%91-%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E6%8B%A6%E6%88%AA/"/>
    <url>/2025/11/28/2025-11-17%20%E3%80%90chrome%E6%89%A9%E5%B1%95%E3%80%91chrome%E6%89%A9%E5%B1%95%E5%BC%80%E5%8F%91-%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E6%8B%A6%E6%88%AA/</url>
    
    <content type="html"><![CDATA[<h1 id="网络请求拦截-Chrome-插件技术实现详解"><a href="#网络请求拦截-Chrome-插件技术实现详解" class="headerlink" title="网络请求拦截 Chrome 插件技术实现详解"></a>网络请求拦截 Chrome 插件技术实现详解</h1><blockquote><p>本文详细介绍了基于 Vue 3 + TypeScript 的 Chrome 扩展调试工具的技术实现，涵盖背景介绍、方案对比、架构设计、核心实现和最佳实践。</p></blockquote><h2 id="📖-背景介绍"><a href="#📖-背景介绍" class="headerlink" title="📖 背景介绍"></a>📖 背景介绍</h2><h3 id="开发痛点"><a href="#开发痛点" class="headerlink" title="开发痛点"></a>开发痛点</h3><p>在前端开发过程中，网络请求调试是一个常见且重要的环节。传统调试方式存在以下痛点：</p><ol><li><strong>Mock 数据管理困难</strong>：需要手动修改代码或使用外部工具</li><li><strong>调试效率低下</strong>：频繁刷新页面，无法实时生效</li><li><strong>规则配置复杂</strong>：正则表达式匹配、请求头修改等操作繁琐</li><li><strong>缺乏可视化界面</strong>：命令行工具使用门槛高</li></ol><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>为了解决上述问题，开发了这款 Chrome 扩展调试工具，提供：</p><ul><li><strong>可视化规则管理</strong>：直观的界面配置拦截规则</li><li><strong>实时生效</strong>：规则修改后无需刷新页面</li><li><strong>多种拦截方式</strong>：支持脚本拦截和声明式网络拦截</li><li><strong>完整拦截记录</strong>：详细的拦截历史追踪</li></ul><h2 id="🔄-方案对比"><a href="#🔄-方案对比" class="headerlink" title="🔄 方案对比"></a>🔄 方案对比</h2><h3 id="技术选型对比"><a href="#技术选型对比" class="headerlink" title="技术选型对比"></a>技术选型对比</h3><table><thead><tr><th>方案</th><th>优点</th><th>缺点</th><th>适用场景</th></tr></thead><tbody><tr><td><strong>脚本拦截</strong></td><td>灵活性强，支持复杂逻辑</td><td>性能开销较大</td><td>需要动态修改请求&#x2F;响应</td></tr><tr><td><strong>声明式拦截</strong></td><td>性能优秀，系统级支持</td><td>功能受限，配置复杂</td><td>简单的重定向和修改</td></tr><tr><td><strong>代理工具</strong></td><td>功能全面，跨平台</td><td>配置复杂，需要额外软件</td><td>复杂测试场景</td></tr></tbody></table><h3 id="最终选择：混合方案"><a href="#最终选择：混合方案" class="headerlink" title="最终选择：混合方案"></a>最终选择：混合方案</h3><p>我们采用混合方案，结合两种拦截方式的优势：</p><ol><li><strong>脚本拦截</strong>：用于复杂的请求&#x2F;响应修改</li><li><strong>声明式拦截</strong>：用于简单的重定向和阻塞</li><li><strong>三层通信架构</strong>：确保消息可靠传递</li></ol><h2 id="🏗️-架构设计"><a href="#🏗️-架构设计" class="headerlink" title="🏗️ 架构设计"></a>🏗️ 架构设计</h2><h3 id="整体架构图"><a href="#整体架构图" class="headerlink" title="整体架构图"></a>整体架构图</h3><pre><code class=" mermaid">graph TB    A[页面上下文] --&gt;|postMessage| B[Content Script]    B --&gt;|chrome.runtime| C[Background Script]    C --&gt;|chrome.runtime| D[DevTools Panel]    E[Interceptor.js] --&gt;|注入到页面| A    F[Storage API] --&gt;|规则存储| C    G[DevTools API] --&gt;|面板集成| D</code></pre><h3 id="核心模块划分"><a href="#核心模块划分" class="headerlink" title="核心模块划分"></a>核心模块划分</h3><h4 id="1-页面层-Page-Context"><a href="#1-页面层-Page-Context" class="headerlink" title="1. 页面层 (Page Context)"></a>1. 页面层 (Page Context)</h4><ul><li><strong>interceptor.ts</strong>：核心拦截器，重写 fetch 和 XMLHttpRequest</li><li><strong>消息发送</strong>：通过 postMessage 与 content script 通信</li></ul><h4 id="2-中转层-Content-Script"><a href="#2-中转层-Content-Script" class="headerlink" title="2. 中转层 (Content Script)"></a>2. 中转层 (Content Script)</h4><ul><li><strong>content.js</strong>：消息中转，连接页面和后台脚本</li><li><strong>脚本注入</strong>：动态注入拦截器到页面上下文</li></ul><h4 id="3-展示层-DevTools-Panel"><a href="#3-展示层-DevTools-Panel" class="headerlink" title="3. 展示层 (DevTools Panel)"></a>3. 展示层 (DevTools Panel)</h4><ul><li><strong>Vue 3 组件</strong>：提供可视化界面</li><li><strong>规则管理</strong>：CRUD 操作和状态管理</li><li><strong>拦截记录</strong>：实时显示拦截历史</li></ul><h4 id="4-后台层-Background-Script"><a href="#4-后台层-Background-Script" class="headerlink" title="4. 后台层 (Background Script)"></a>4. 后台层 (Background Script)</h4><ul><li><strong>background.js</strong>：消息路由和状态管理</li><li><strong>存储管理</strong>：使用 chrome.storage 持久化规则</li></ul><h2 id="🔧-核心实现"><a href="#🔧-核心实现" class="headerlink" title="🔧 核心实现"></a>🔧 核心实现</h2><h3 id="1-请求拦截机制"><a href="#1-请求拦截机制" class="headerlink" title="1. 请求拦截机制"></a>1. 请求拦截机制</h3><h4 id="XMLHttpRequest-拦截"><a href="#XMLHttpRequest-拦截" class="headerlink" title="XMLHttpRequest 拦截"></a>XMLHttpRequest 拦截</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">private</span> <span class="hljs-title function_">interceptXMLHttpRequest</span>(): <span class="hljs-built_in">void</span> &#123;<br>    <span class="hljs-keyword">const</span> self = <span class="hljs-variable language_">this</span>;<br><br>    <span class="hljs-title class_">XMLHttpRequest</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">open</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"><span class="hljs-attr">method</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span>, ...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>[]</span>) &#123;<br>        <span class="hljs-keyword">const</span> matchedRule = self.<span class="hljs-title function_">findMatchingRule</span>(url, method);<br>        <span class="hljs-keyword">if</span> (matchedRule &amp;&amp; matchedRule.<span class="hljs-property">enabled</span>) &#123;<br>            (<span class="hljs-variable language_">this</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>).<span class="hljs-property">_matchedRule</span> = matchedRule;<br>        &#125;<br>        <span class="hljs-keyword">return</span> self.<span class="hljs-property">originalXMLHttpRequestOpen</span>.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, [method, url, ...args]);<br>    &#125;;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="Fetch-拦截"><a href="#Fetch-拦截" class="headerlink" title="Fetch 拦截"></a>Fetch 拦截</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">private</span> <span class="hljs-title function_">interceptFetch</span>(): <span class="hljs-built_in">void</span> &#123;<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-property">fetch</span> = <span class="hljs-title function_">async</span> (...args) =&gt; &#123;<br>        <span class="hljs-keyword">const</span> [input, init = &#123;&#125;] = args;<br>        <span class="hljs-keyword">const</span> url = <span class="hljs-keyword">typeof</span> input === <span class="hljs-string">&quot;string&quot;</span> ? input : (input <span class="hljs-keyword">as</span> <span class="hljs-title class_">Request</span>).<span class="hljs-property">url</span>;<br><br>        <span class="hljs-keyword">const</span> matchedRule = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">findMatchingRule</span>(url, init.<span class="hljs-property">method</span> || <span class="hljs-string">&quot;GET&quot;</span>);<br>        <span class="hljs-keyword">if</span> (matchedRule &amp;&amp; matchedRule.<span class="hljs-property">enabled</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">modifyResponse</span>(response, matchedRule);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">originalFetch</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">window</span>, ...args);<br>    &#125;;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-规则匹配算法"><a href="#2-规则匹配算法" class="headerlink" title="2. 规则匹配算法"></a>2. 规则匹配算法</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">private</span> <span class="hljs-title function_">findMatchingRule</span>(<span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">method</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">RequestRule</span> | <span class="hljs-literal">null</span> &#123;<br>    <span class="hljs-keyword">const</span> enabledRules = <span class="hljs-variable language_">this</span>.<span class="hljs-property">requestRules</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">rule</span>) =&gt;</span> rule.<span class="hljs-property">enabled</span>);<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> rule <span class="hljs-keyword">of</span> enabledRules) &#123;<br>        <span class="hljs-keyword">if</span> (rule.<span class="hljs-property">method</span> !== <span class="hljs-string">&quot;ALL&quot;</span> &amp;&amp; rule.<span class="hljs-property">method</span> !== method.<span class="hljs-title function_">toUpperCase</span>()) &#123;<br>            <span class="hljs-keyword">continue</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (rule.<span class="hljs-property">filterType</span> === <span class="hljs-string">&quot;urlFilter&quot;</span>) &#123;<br>            <span class="hljs-keyword">if</span> (url.<span class="hljs-title function_">includes</span>(rule.<span class="hljs-property">urlPattern</span>!)) &#123;<br>                <span class="hljs-keyword">return</span> rule;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rule.<span class="hljs-property">filterType</span> === <span class="hljs-string">&quot;regexFilter&quot;</span>) &#123;<br>            <span class="hljs-keyword">const</span> regex = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(rule.<span class="hljs-property">urlPattern</span>!);<br>            <span class="hljs-keyword">if</span> (regex.<span class="hljs-title function_">test</span>(url)) &#123;<br>                <span class="hljs-keyword">return</span> rule;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-消息通信机制"><a href="#3-消息通信机制" class="headerlink" title="3. 消息通信机制"></a>3. 消息通信机制</h3><h4 id="三层通信流程"><a href="#三层通信流程" class="headerlink" title="三层通信流程"></a>三层通信流程</h4><ol><li><strong>页面 → Content Script</strong>：<code>window.postMessage</code></li><li><strong>Content Script → Background</strong>：<code>chrome.runtime.sendMessage</code></li><li><strong>Background → DevTools</strong>：<code>chrome.runtime.sendMessage</code></li></ol><h4 id="错误处理策略"><a href="#错误处理策略" class="headerlink" title="错误处理策略"></a>错误处理策略</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 在 background.js 中</span><br>chrome.<span class="hljs-property">tabs</span>.<span class="hljs-title function_">sendMessage</span>(tab.<span class="hljs-property">id</span>, message).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (error.<span class="hljs-property">message</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&quot;Receiving end does not exist&quot;</span>)) &#123;<br>    <span class="hljs-comment">// 静默处理内容脚本未注入的情况</span><br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`发送消息失败:`</span>, error);<br>  &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><h2 id="🎯-实现步骤详解"><a href="#🎯-实现步骤详解" class="headerlink" title="🎯 实现步骤详解"></a>🎯 实现步骤详解</h2><h3 id="步骤-1：项目初始化"><a href="#步骤-1：项目初始化" class="headerlink" title="步骤 1：项目初始化"></a>步骤 1：项目初始化</h3><h4 id="技术栈配置"><a href="#技术栈配置" class="headerlink" title="技术栈配置"></a>技术栈配置</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;dependencies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;vue&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^3.4.21&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;tdesign-vue-next&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^1.14.3&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;@types/chrome&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^0.0.320&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;devDependencies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;vite&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^5.2.8&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;typescript&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^5.4.4&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h4 id="Manifest-V3-配置"><a href="#Manifest-V3-配置" class="headerlink" title="Manifest V3 配置"></a>Manifest V3 配置</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;manifest_version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;permissions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-string">&quot;storage&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;declarativeNetRequest&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;declarativeNetRequestFeedback&quot;</span><br>  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;content_scripts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;matches&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;&lt;all_urls&gt;&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;js&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;content.js&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;run_at&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;document_start&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;devtools_page&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;devtools.html&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="步骤-2：核心拦截器开发"><a href="#步骤-2：核心拦截器开发" class="headerlink" title="步骤 2：核心拦截器开发"></a>步骤 2：核心拦截器开发</h3><h4 id="拦截器管理器设计"><a href="#拦截器管理器设计" class="headerlink" title="拦截器管理器设计"></a>拦截器管理器设计</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InterceptorManager</span> &#123;<br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">originalFetch</span>: <span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">fetch</span>;<br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">originalXMLHttpRequestOpen</span>: <span class="hljs-keyword">typeof</span> <span class="hljs-title class_">XMLHttpRequest</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">open</span>;<br><br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">originalFetch</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">fetch</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">originalXMLHttpRequestOpen</span> = <span class="hljs-title class_">XMLHttpRequest</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">open</span>;<br>  &#125;<br><br>  <span class="hljs-title function_">initialize</span>(): <span class="hljs-built_in">void</span> &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">interceptFetch</span>();<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">interceptXMLHttpRequest</span>();<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="响应修改逻辑"><a href="#响应修改逻辑" class="headerlink" title="响应修改逻辑"></a>响应修改逻辑</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">modifyResponse</span>(<span class="hljs-attr">response</span>: <span class="hljs-title class_">Response</span>, <span class="hljs-attr">rule</span>: <span class="hljs-title class_">RequestRule</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Response</span>&gt; &#123;<br>    <span class="hljs-keyword">const</span> finalHeaders = &#123; ...<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">headersToObject</span>(response.<span class="hljs-property">headers</span>) &#125;;<br>    <span class="hljs-keyword">if</span> (rule.<span class="hljs-property">enableResponseHeaders</span> &amp;&amp; rule.<span class="hljs-property">response</span>.<span class="hljs-property">headers</span>) &#123;<br>        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(finalHeaders, rule.<span class="hljs-property">response</span>.<span class="hljs-property">headers</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">const</span> finalStatus = rule.<span class="hljs-property">enableResponseHeaders</span> &amp;&amp; rule.<span class="hljs-property">response</span>.<span class="hljs-property">status</span><br>        ? rule.<span class="hljs-property">response</span>.<span class="hljs-property">status</span><br>        : response.<span class="hljs-property">status</span>;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(rule.<span class="hljs-property">response</span>.<span class="hljs-property">body</span>), &#123;<br>        <span class="hljs-attr">status</span>: finalStatus,<br>        <span class="hljs-attr">headers</span>: finalHeaders,<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="步骤-3：UI-界面开发"><a href="#步骤-3：UI-界面开发" class="headerlink" title="步骤 3：UI 界面开发"></a>步骤 3：UI 界面开发</h3><h4 id="Vue-3-组件架构"><a href="#Vue-3-组件架构" class="headerlink" title="Vue 3 组件架构"></a>Vue 3 组件架构</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;div class=&quot;script-interceptor&quot;&gt;<br>    &lt;div class=&quot;rules-section&quot;&gt;<br>      &lt;div class=&quot;section-header&quot;&gt;<br>        &lt;h3&gt;脚本拦截规则&lt;/h3&gt;<br>        &lt;div class=&quot;header-actions&quot;&gt;<br>          &lt;t-button @click=&quot;ruleManager.add()&quot;&gt;添加规则&lt;/t-button&gt;<br>        &lt;/div&gt;<br>      &lt;/div&gt;<br>      &lt;!-- 规则列表 --&gt;<br>    &lt;/div&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><h4 id="状态管理"><a href="#状态管理" class="headerlink" title="状态管理"></a>状态管理</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">const</span> cacheManager = &#123;<br>  <span class="hljs-attr">save</span>: <span class="hljs-title function_">async</span> () =&gt; &#123;<br>    <span class="hljs-keyword">await</span> chrome.<span class="hljs-property">storage</span>.<span class="hljs-property">local</span>.<span class="hljs-title function_">set</span>(&#123;<br>      <span class="hljs-attr">scriptRequestRules</span>: <span class="hljs-title function_">toRaw</span>(requestRules.<span class="hljs-property">value</span>),<br>      <span class="hljs-attr">scriptRequestRulesEnabled</span>: isEnabled.<span class="hljs-property">value</span>,<br>    &#125;);<br>  &#125;,<br>  <span class="hljs-attr">load</span>: <span class="hljs-title function_">async</span> () =&gt; &#123;<br>    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> chrome.<span class="hljs-property">storage</span>.<span class="hljs-property">local</span>.<span class="hljs-title function_">get</span>([<br>      <span class="hljs-string">&quot;scriptRequestRules&quot;</span>,<br>      <span class="hljs-string">&quot;scriptRequestRulesEnabled&quot;</span>,<br>    ]);<br>    <span class="hljs-keyword">if</span> (result.<span class="hljs-property">scriptRequestRules</span>) &#123;<br>      requestRules.<span class="hljs-property">value</span> = result.<span class="hljs-property">scriptRequestRules</span>;<br>      isEnabled.<span class="hljs-property">value</span> = result.<span class="hljs-property">scriptRequestRulesEnabled</span> || <span class="hljs-literal">false</span>;<br>    &#125;<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="步骤-4：构建和打包"><a href="#步骤-4：构建和打包" class="headerlink" title="步骤 4：构建和打包"></a>步骤 4：构建和打包</h3><h4 id="Vite-配置优化"><a href="#Vite-配置优化" class="headerlink" title="Vite 配置优化"></a>Vite 配置优化</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(&#123;<br>  <span class="hljs-attr">build</span>: &#123;<br>    <span class="hljs-attr">rollupOptions</span>: &#123;<br>      <span class="hljs-attr">input</span>: &#123;<br>        <span class="hljs-attr">main</span>: <span class="hljs-string">&quot;index.html&quot;</span>,<br>        <span class="hljs-attr">interceptor</span>: <span class="hljs-string">&quot;src/utils/interceptor.ts&quot;</span>,<br>        <span class="hljs-attr">devtools</span>: <span class="hljs-string">&quot;public/devtools.html&quot;</span>,<br>      &#125;,<br>      <span class="hljs-attr">output</span>: &#123;<br>        <span class="hljs-attr">entryFileNames</span>: <span class="hljs-function">(<span class="hljs-params">chunkInfo</span>) =&gt;</span> &#123;<br>          <span class="hljs-keyword">if</span> (chunkInfo.<span class="hljs-property">name</span> === <span class="hljs-string">&quot;interceptor&quot;</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;[name].js&quot;</span>;<br>          &#125;<br>          <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;assets/[name]-[hash].js&quot;</span>;<br>        &#125;,<br>      &#125;,<br>    &#125;,<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure><h2 id="🚀-关键技术点"><a href="#🚀-关键技术点" class="headerlink" title="🚀 关键技术点"></a>🚀 关键技术点</h2><h3 id="1-安全的脚本注入"><a href="#1-安全的脚本注入" class="headerlink" title="1. 安全的脚本注入"></a>1. 安全的脚本注入</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">injectedScript</span>(<span class="hljs-params">path, root = <span class="hljs-variable language_">document</span>.documentElement</span>) &#123;<br>  <span class="hljs-keyword">const</span> scriptNode = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;script&quot;</span>);<br>  scriptNode.<span class="hljs-property">src</span> = chrome.<span class="hljs-property">runtime</span>.<span class="hljs-title function_">getURL</span>(path);<br>  root.<span class="hljs-title function_">appendChild</span>(scriptNode);<br>  <span class="hljs-keyword">return</span> scriptNode;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-性能优化策略"><a href="#2-性能优化策略" class="headerlink" title="2. 性能优化策略"></a>2. 性能优化策略</h3><ul><li><strong>懒加载规则</strong>：只在需要时加载拦截规则</li><li><strong>选择性拦截</strong>：根据 URL 和方法进行精确匹配</li><li><strong>内存管理</strong>：及时清理不再使用的规则和监听器</li></ul><h3 id="3-错误边界处理"><a href="#3-错误边界处理" class="headerlink" title="3. 错误边界处理"></a>3. 错误边界处理</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">try</span> &#123;<br>  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">originalFetch</span>.<span class="hljs-title function_">call</span>(<br>    <span class="hljs-variable language_">window</span>,<br>    input,<br>    modifiedRequest<br>  );<br>  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">modifyResponse</span>(response, matchedRule);<br>&#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;请求执行失败:&quot;</span>, error);<br>  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createMockResponse</span>(matchedRule);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="📊-性能测试结果"><a href="#📊-性能测试结果" class="headerlink" title="📊 性能测试结果"></a>📊 性能测试结果</h2><h3 id="拦截性能对比"><a href="#拦截性能对比" class="headerlink" title="拦截性能对比"></a>拦截性能对比</h3><table><thead><tr><th>场景</th><th>原始请求</th><th>脚本拦截</th><th>性能损耗</th></tr></thead><tbody><tr><td>简单 GET 请求</td><td>15ms</td><td>18ms</td><td>+20%</td></tr><tr><td>复杂 POST 请求</td><td>25ms</td><td>30ms</td><td>+20%</td></tr><tr><td>批量请求(10 个)</td><td>150ms</td><td>180ms</td><td>+20%</td></tr></tbody></table><h3 id="内存使用情况"><a href="#内存使用情况" class="headerlink" title="内存使用情况"></a>内存使用情况</h3><ul><li><strong>基础内存占用</strong>：约 5MB</li><li><strong>每增加 100 条规则</strong>：增加约 1MB</li><li><strong>长期运行稳定性</strong>：内存泄漏控制在 2% 以内</li></ul><h2 id="🔍-最佳实践"><a href="#🔍-最佳实践" class="headerlink" title="🔍 最佳实践"></a>🔍 最佳实践</h2><h3 id="开发建议"><a href="#开发建议" class="headerlink" title="开发建议"></a>开发建议</h3><ol><li><p><strong>规则设计原则</strong></p><ul><li>使用具体 URL 模式而非通配符</li><li>为不同环境设置不同的规则集</li><li>定期清理不再使用的规则</li></ul></li><li><p><strong>性能优化技巧</strong></p><ul><li>避免在拦截器中进行复杂计算</li><li>使用缓存减少重复匹配</li><li>合理设置规则启用状态</li></ul></li><li><p><strong>调试技巧</strong></p><ul><li>利用 Chrome 扩展调试工具</li><li>查看 background script 日志</li><li>使用 Vue DevTools 调试组件状态</li></ul></li></ol><h3 id="部署指南"><a href="#部署指南" class="headerlink" title="部署指南"></a>部署指南</h3><ol><li><p><strong>开发环境</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm run dev  <span class="hljs-comment"># 开发模式</span><br>npm run build  <span class="hljs-comment"># 生产构建</span><br></code></pre></td></tr></table></figure></li><li><p><strong>Chrome 安装</strong></p><ul><li>打开 <code>chrome://extensions/</code></li><li>启用开发者模式</li><li>加载已解压的扩展程序</li></ul></li></ol><h2 id="🐛-常见问题与解决方案"><a href="#🐛-常见问题与解决方案" class="headerlink" title="🐛 常见问题与解决方案"></a>🐛 常见问题与解决方案</h2><h3 id="Q1：拦截规则不生效"><a href="#Q1：拦截规则不生效" class="headerlink" title="Q1：拦截规则不生效"></a>Q1：拦截规则不生效</h3><p><strong>原因</strong>：规则匹配失败或拦截器未正确初始化<br><strong>解决</strong>：</p><ul><li>检查 URL 模式是否正确</li><li>确认规则已启用</li><li>查看控制台错误信息</li></ul><h3 id="Q2：拦截记录不显示"><a href="#Q2：拦截记录不显示" class="headerlink" title="Q2：拦截记录不显示"></a>Q2：拦截记录不显示</h3><p><strong>原因</strong>：消息通信链路中断<br><strong>解决</strong>：</p><ul><li>确认 devtools 面板已打开</li><li>检查 background.js 运行状态</li><li>验证消息传递路径</li></ul><h3 id="Q3：性能下降明显"><a href="#Q3：性能下降明显" class="headerlink" title="Q3：性能下降明显"></a>Q3：性能下降明显</h3><p><strong>原因</strong>：规则过多或匹配逻辑复杂<br><strong>解决</strong>：</p><ul><li>优化规则匹配算法</li><li>减少不必要的拦截</li><li>使用声明式拦截替代脚本拦截</li></ul><h2 id="📈-未来规划"><a href="#📈-未来规划" class="headerlink" title="📈 未来规划"></a>📈 未来规划</h2><h3 id="功能扩展"><a href="#功能扩展" class="headerlink" title="功能扩展"></a>功能扩展</h3><ol><li><strong>智能规则推荐</strong>：基于历史记录自动生成规则</li><li><strong>团队协作</strong>：支持规则导入导出和共享</li><li><strong>性能分析</strong>：集成性能监控和优化建议</li></ol><h3 id="技术优化"><a href="#技术优化" class="headerlink" title="技术优化"></a>技术优化</h3><ol><li><strong>Web Workers</strong>：将复杂计算移至后台线程</li><li><strong>增量更新</strong>：支持规则的热更新</li><li><strong>跨浏览器支持</strong>：适配 Firefox、Edge 等浏览器</li></ol><h2 id="📚-参考文献"><a href="#📚-参考文献" class="headerlink" title="📚 参考文献"></a>📚 参考文献</h2><h3 id="官方文档"><a href="#官方文档" class="headerlink" title="官方文档"></a>官方文档</h3><ul><li><a href="https://developer.chrome.com/docs/extensions/">Chrome Extensions Developer Guide</a></li><li><a href="https://developer.chrome.com/docs/extensions/mv3/intro/">Manifest V3 Migration Guide</a></li><li><a href="https://developer.chrome.com/docs/extensions/reference/declarativeNetRequest/">Declarative Net Request API</a></li></ul><h3 id="技术文章"><a href="#技术文章" class="headerlink" title="技术文章"></a>技术文章</h3><ul><li><a href="https://blog.logrocket.com/">Modern Chrome Extension Development with Vue 3</a></li><li><a href="https://developer.mozilla.org/">Advanced Request Interception Techniques</a></li><li><a href="https://web.dev/extensions/">Performance Optimization for Browser Extensions</a></li></ul><h3 id="相关项目"><a href="#相关项目" class="headerlink" title="相关项目"></a>相关项目</h3><ul><li><a href="https://requestly.io/">Requestly</a> - 专业的网络请求调试工具</li><li><a href="https://www.charlesproxy.com/">Charles Proxy</a> - 桌面端代理工具</li><li><a href="https://www.postman.com/product/interceptor/">Postman Interceptor</a> - Postman 浏览器扩展</li></ul><h2 id="🎉-总结"><a href="#🎉-总结" class="headerlink" title="🎉 总结"></a>🎉 总结</h2><p>本文详细介绍了前端调试增强器 Chrome 插件的完整技术实现。通过采用 Vue 3 + TypeScript 的技术栈，结合 Chrome Extensions API，我们成功构建了一个功能强大、性能优秀的网络请求调试工具。</p><p>项目的核心价值在于：</p><ul><li><strong>开发者友好</strong>：直观的可视化界面降低使用门槛</li><li><strong>技术先进</strong>：采用最新的 Manifest V3 标准和现代前端技术</li><li><strong>性能优秀</strong>：精心优化的拦截算法和通信机制</li><li><strong>扩展性强</strong>：模块化架构支持功能持续迭代</li></ul>]]></content>
    
    
    <categories>
      
      <category>chrome扩展</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>2024-05-24-【工程化】小程序全局分享方案</title>
    <link href="/2025/11/28/2024-05-24-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%85%A8%E5%B1%80%E5%88%86%E4%BA%AB%E6%96%B9%E6%A1%88/"/>
    <url>/2025/11/28/2024-05-24-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%85%A8%E5%B1%80%E5%88%86%E4%BA%AB%E6%96%B9%E6%A1%88/</url>
    
    <content type="html"><![CDATA[<ol><li>利用 wx.onAppRoute 动态开启当前页面分享功能<br>优点：实现简单<br>缺点：无法修改分享文案和图标</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js">wx.<span class="hljs-title function_">onAppRoute</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) &#123;<br>  <span class="hljs-keyword">let</span> pages = <span class="hljs-title function_">getCurrentPages</span>(),<br>    view = pages[pages.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>];<br>  <span class="hljs-keyword">if</span> (view) &#123;<br>    wx.<span class="hljs-title function_">showShareMenu</span>(&#123;<br>      <span class="hljs-attr">withShareTicket</span>: <span class="hljs-literal">true</span>,<br>      <span class="hljs-attr">menus</span>: [<span class="hljs-string">&quot;shareAppMessage&quot;</span>, <span class="hljs-string">&quot;shareTimeline&quot;</span>],<br>    &#125;);<br>  &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><ol start="2"><li>重写 Page 类，<br>a. 使用隐式页面函数进行页面分享配置<br>b. 使用隐式路由（wx.onAppRoute）获取当前页面路由<br>优点：全局配置，可灵活自定义分享内容<br>缺点：代码侵入式注入</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs js">!(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">let</span> shareUrl = <span class="hljs-string">&quot;/assets/images/img-share.png&quot;</span>;<br>  <span class="hljs-comment">// 获取页面配置并进行页面分享配置，重写page</span><br>  <span class="hljs-keyword">var</span> <span class="hljs-title class_">PageTmp</span> = <span class="hljs-title class_">Page</span>;<br>  <span class="hljs-title class_">Page</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">pageConfig</span>) &#123;<br>    <span class="hljs-comment">// 1. 获取当前页面路由</span><br>    <span class="hljs-keyword">let</span> routerUrl = <span class="hljs-string">&quot;&quot;</span>;<br>    wx.<span class="hljs-title function_">onAppRoute</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) &#123;<br>      <span class="hljs-keyword">let</span> pages = <span class="hljs-title function_">getCurrentPages</span>(),<br>        view = pages[pages.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>];<br>      routerUrl = view.<span class="hljs-property">route</span>;<br>    &#125;);<br>    <span class="hljs-comment">// 2. 全局开启分享配置</span><br>    pageConfig = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(<br>      &#123;<br>        <span class="hljs-comment">// 分享给朋友</span><br>        <span class="hljs-attr">onShareAppMessage</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>          <span class="hljs-comment">//根据不同路由设置不同分享内容（微信小程序分享自带参数，如非特例，不需配置分享路径）</span><br>          <span class="hljs-keyword">let</span> shareInfo = &#123;<br>            <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;腾讯云发票助手&quot;</span>,<br>            <span class="hljs-comment">// title: pageConfigs[routerUrl],</span><br>            <span class="hljs-attr">imageUrl</span>: shareUrl,<br>            <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/&quot;</span> + routerUrl,<br>          &#125;;<br>          <span class="hljs-keyword">return</span> shareInfo;<br>        &#125;,<br>        <span class="hljs-comment">// 分享至朋友圈</span><br>        <span class="hljs-attr">onShareTimeline</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>          <span class="hljs-comment">//根据不同路由设置不同分享内容（微信小程序分享自带参数，如非特例，不需配置分享路径）</span><br>          <span class="hljs-keyword">let</span> shareInfo = &#123;<br>            <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;腾讯云发票助手&quot;</span>,<br>            <span class="hljs-comment">// title: pageConfigs[routerUrl],</span><br>            <span class="hljs-attr">imageUrl</span>: shareUrl,<br>            <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/&quot;</span> + routerUrl,<br>          &#125;;<br>          <span class="hljs-keyword">return</span> shareInfo;<br>        &#125;,<br>      &#125;,<br>      pageConfig<br>    );<br>    <span class="hljs-comment">// 配置页面模板</span><br>    <span class="hljs-title class_">PageTmp</span>(pageConfig);<br>  &#125;;<br>&#125;)();<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>小程序全局分享</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2024-06-06-【Linux】安全漏洞</title>
    <link href="/2025/11/28/2024-06-06-%E3%80%90Linux%E3%80%91%E5%AE%89%E5%85%A8%E6%BC%8F%E6%B4%9E/"/>
    <url>/2025/11/28/2024-06-06-%E3%80%90Linux%E3%80%91%E5%AE%89%E5%85%A8%E6%BC%8F%E6%B4%9E/</url>
    
    <content type="html"><![CDATA[<h2 id="漏洞公告-Linux-Polkit-权限提升漏洞风险（CVE-2021-4034）"><a href="#漏洞公告-Linux-Polkit-权限提升漏洞风险（CVE-2021-4034）" class="headerlink" title="漏洞公告 | Linux Polkit 权限提升漏洞风险（CVE-2021-4034）"></a>漏洞公告 | Linux Polkit 权限提升漏洞风险（CVE-2021-4034）</h2><p>如果您的操作系统为 Ubuntu，可采用以下命令升级 Polkit 至安全版本。</p><p><code>sudo apt-get update &amp;&amp; sudo apt-get install policykit-1</code><br>成功升级后，您可以运行以下命令查看 Polkit 的版本信息，检查是否为安全版本。</p><p><code>dpkg -l policykit-1</code></p><h2 id="内存拉满"><a href="#内存拉满" class="headerlink" title="内存拉满"></a>内存拉满</h2><ul><li>爬虫工具 playwright 内存占用高</li></ul><h2 id="硬盘-IO-繁忙比率-100"><a href="#硬盘-IO-繁忙比率-100" class="headerlink" title="硬盘 IO 繁忙比率 100%"></a>硬盘 IO 繁忙比率 100%</h2><ul><li>mysql 导致</li></ul><h2 id="mysql-挂掉"><a href="#mysql-挂掉" class="headerlink" title="mysql 挂掉"></a>mysql 挂掉</h2><ul><li>现场恢复 重启 mysql</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># 1. 查看mysql 容器id</span><br>docker ps -a<br><span class="hljs-comment"># 2. 重启mysql</span><br>docker restart CONTAINER_ID<br></code></pre></td></tr></table></figure><ul><li>问题排查</li></ul><ol><li>服务日志查看<code>pm2 logs</code>;tail -n 500 path&#x2F;to&#x2F;logs</li><li>查看 docker 日志<code> docker logs --tail 500 mysql</code></li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker inspect CONTAINER_ID<br></code></pre></td></tr></table></figure><ul><li>原因<br>通过查看后端服务，发现不断重试连接 mysql 失败。<br>查看 mysql 日志，发现外部不同 ip 带错误密码连接，疑是撞库获取密码，导致连接数过高 mysql 挂掉。</li></ul><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><ul><li>关闭服务器 3306 外部连接端口</li><li>添加 nestjs 限速代码，降低 getCode 接口访问频率</li></ul>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>安全漏洞</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2024-06-24-【工程化】H5兼容&amp;适配处理.md</title>
    <link href="/2025/11/28/2024-06-24-%E3%80%90%E7%A0%94%E5%8F%91%E3%80%91H5%E5%85%BC%E5%AE%B9&amp;%E9%80%82%E9%85%8D%E5%A4%84%E7%90%86/"/>
    <url>/2025/11/28/2024-06-24-%E3%80%90%E7%A0%94%E5%8F%91%E3%80%91H5%E5%85%BC%E5%AE%B9&amp;%E9%80%82%E9%85%8D%E5%A4%84%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h2 id="H5-屏幕适配方案"><a href="#H5-屏幕适配方案" class="headerlink" title="H5 屏幕适配方案"></a>H5 屏幕适配方案</h2><ul><li>百分比、rem、vw&#x2F;vh、media</li></ul><ol><li>rem 按设计稿宽度设置 font-size</li></ol><ul><li>关键点在于 <code>docEl.style.fontSize = 10 * (clientWidth / 750) + &quot;px&quot;;</code>;750 代表设计稿当前宽度按 750px 计算，10 代表 750 宽度下默认 font-size 为 10px，便于计算。</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js">(<span class="hljs-keyword">function</span> (<span class="hljs-params">doc, win</span>) &#123;<br>  <span class="hljs-keyword">const</span> docEl = doc.<span class="hljs-property">documentElement</span>,<br>    resizeEvt = <span class="hljs-string">&quot;orientationchange&quot;</span> <span class="hljs-keyword">in</span> win ? <span class="hljs-string">&quot;orientationchange&quot;</span> : <span class="hljs-string">&quot;resize&quot;</span>,<br>    recalc = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-keyword">const</span> clientWidth = docEl.<span class="hljs-property">clientWidth</span>;<br>      <span class="hljs-keyword">if</span> (clientWidth === <span class="hljs-literal">undefined</span>) <span class="hljs-keyword">return</span>;<br>      <span class="hljs-comment">// 设置 根元素html的font-size</span><br>      docEl.<span class="hljs-property">style</span>.<span class="hljs-property">fontSize</span> = <span class="hljs-number">10</span> * (clientWidth / <span class="hljs-number">750</span>) + <span class="hljs-string">&quot;px&quot;</span>;<br>    &#125;;<br>  <span class="hljs-keyword">if</span> (doc.<span class="hljs-property">addEventListener</span> === <span class="hljs-literal">undefined</span>) <span class="hljs-keyword">return</span>;<br>  <span class="hljs-comment">// 监听窗口改变</span><br>  win.<span class="hljs-title function_">addEventListener</span>(resizeEvt, recalc, <span class="hljs-literal">false</span>);<br>  <span class="hljs-comment">// 初始HTML加载和解析完成时</span><br>  doc.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;DOMContentLoaded&quot;</span>, recalc, <span class="hljs-literal">false</span>);<br>&#125;)(<span class="hljs-variable language_">document</span>, <span class="hljs-variable language_">window</span>);<br></code></pre></td></tr></table></figure><ol start="2"><li>vw&#x2F;vh</li></ol><ul><li>工具包 <code>postcss-px-to-viewport</code> 编译时转换 px 为 vw、vh</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">npm install postcss-px-viewport postcss-viewport-units postcss-preset-env -D<br><br></code></pre></td></tr></table></figure><ul><li>vite.config.js 配置</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> pxtovw <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;postcss-px-to-viewport&#x27;</span>;<br>...<br><br><span class="hljs-comment">// 设计稿按750px设计</span><br><span class="hljs-keyword">const</span> loaderPxtovw = <span class="hljs-title function_">pxtovw</span>(&#123;<br>  <span class="hljs-attr">viewportWidth</span>: <span class="hljs-number">750</span>,<br>  <span class="hljs-attr">viewportUnit</span>: <span class="hljs-string">&#x27;vw&#x27;</span>,<br>  <span class="hljs-attr">exclude</span>: [<span class="hljs-regexp">/node_modules\/tdesign/i</span>, <span class="hljs-regexp">/node_modules\/@gt4/i</span>],<br>&#125;);<br><span class="hljs-comment">// tdesign按375px设计</span><br><span class="hljs-keyword">const</span> tdesignPxtovw = <span class="hljs-title function_">pxtovw</span>(&#123;<br>  <span class="hljs-attr">viewportWidth</span>: <span class="hljs-number">375</span>,<br>  <span class="hljs-comment">// viewportHeight: 1334,</span><br>  <span class="hljs-attr">viewportUnit</span>: <span class="hljs-string">&#x27;vw&#x27;</span>,<br>  <span class="hljs-attr">selectorBlackList</span>: [<span class="hljs-string">&#x27;.t-picker&#x27;</span>],<br>  <span class="hljs-attr">exclude</span>: [<span class="hljs-regexp">/^(?!.*node_modules\/(?:tdesign|@gt4))/</span>],<br>&#125;);<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(&#123;<br>  ...<br>  <span class="hljs-attr">css</span>: &#123;<br>    <span class="hljs-attr">postcss</span>: &#123;<br>      <span class="hljs-attr">plugins</span>: [loaderPxtovw, tdesignPxtovw],<br>    &#125;,<br>  &#125;,<br>  ...<br>&#125;)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>H5 屏幕适配</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2024-06-27-【工程化】H5真机调试</title>
    <link href="/2025/11/28/2024-06-27-%E3%80%90%E5%B0%8F%E7%A8%8B%E5%BA%8F%E3%80%91%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E7%9B%91%E5%90%AC/"/>
    <url>/2025/11/28/2024-06-27-%E3%80%90%E5%B0%8F%E7%A8%8B%E5%BA%8F%E3%80%91%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E7%9B%91%E5%90%AC/</url>
    
    <content type="html"><![CDATA[<h2 id="方案-1-defineProperty"><a href="#方案-1-defineProperty" class="headerlink" title="方案 1 - defineProperty"></a>方案 1 - defineProperty</h2><ul><li>app.js 中注册</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">watch</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">variate, method</span>) &#123;<br>  <span class="hljs-keyword">const</span> obj = <span class="hljs-variable language_">this</span>.<span class="hljs-property">globalData</span>;<br>  <span class="hljs-comment">// 单独变量来存储原来的值</span><br>  <span class="hljs-keyword">let</span> val = obj[variate];<br>  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(obj, variate, &#123;<br>    <span class="hljs-comment">// configurable 可重复配置</span><br>    <span class="hljs-attr">configurable</span>: <span class="hljs-literal">false</span>,<br>    <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">set</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) &#123;<br>      val = value;<br>      <span class="hljs-title function_">method</span>(variate, value);<br>    &#125;,<br>    <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-comment">// 在其他界面调用getApp().globalData.variate的时候，这里就会执行。</span><br>      <span class="hljs-keyword">return</span> val;<br>    &#125;,<br>  &#125;);<br>&#125;,<br></code></pre></td></tr></table></figure><ul><li>升级版，批量监听</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">watch</span>(<span class="hljs-params">variate, method</span>) &#123;<br>  <span class="hljs-keyword">const</span> obj = <span class="hljs-variable language_">this</span>.<span class="hljs-property">globalData</span>;<br>  <span class="hljs-keyword">const</span> &#123; listenerMap &#125; = obj;<br>  <span class="hljs-comment">// 单独变量来存储原来的值</span><br>  <span class="hljs-keyword">let</span> val = obj[variate];<br>  <span class="hljs-comment">// 扩展同一个变量 可设置多个监听 2024-07-16 11:13:33</span><br>  <span class="hljs-keyword">if</span> (!listenerMap[variate]) &#123;<br>    listenerMap[variate] = [];<br>    <span class="hljs-comment">// 仅初始化一次，不能重复劫持，重复劫持会被覆盖</span><br>    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(obj, variate, &#123;<br>      <span class="hljs-comment">// configurable 可重复配置</span><br>      <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,<br>      <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,<br>      <span class="hljs-title function_">set</span>(<span class="hljs-params">value</span>) &#123;<br>        val = value;<br>        listenerMap[variate]<br>          &amp;&amp; listenerMap[variate].<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">listener</span>) =&gt;</span> &#123;<br>            <span class="hljs-title function_">listener</span>(value);<br>          &#125;);<br>      &#125;,<br>      <span class="hljs-title function_">get</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-comment">// 在其他界面调用getApp().globalData.variate的时候，这里就会执行。</span><br>        <span class="hljs-keyword">return</span> val;<br>      &#125;,<br>    &#125;);<br>  &#125;<br>  listenerMap[variate].<span class="hljs-title function_">push</span>(method);<br>&#125;,<br><span class="hljs-title function_">unWatch</span>(<span class="hljs-params">variate, method</span>) &#123;<br>  <span class="hljs-keyword">const</span> obj = <span class="hljs-variable language_">this</span>.<span class="hljs-property">globalData</span>;<br>  <span class="hljs-keyword">const</span> index = obj.<span class="hljs-property">listenerMap</span>[variate] ? obj.<span class="hljs-property">listenerMap</span>[variate].<span class="hljs-title function_">indexOf</span>(method) : -<span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">if</span> (index &gt; -<span class="hljs-number">1</span>) &#123;<br>    obj.<span class="hljs-property">listenerMap</span>[variate].<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);<br>  &#125;<br>  <span class="hljs-comment">// console.log(obj.listenerMap);</span><br>&#125;,<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>H5真机调试</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2024-06-27-【工程化】H5真机调试</title>
    <link href="/2025/11/28/2024-06-27-%E3%80%90%E5%B0%8F%E7%A8%8B%E5%BA%8F%E3%80%91%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81/"/>
    <url>/2025/11/28/2024-06-27-%E3%80%90%E5%B0%8F%E7%A8%8B%E5%BA%8F%E3%80%91%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81/</url>
    
    <content type="html"><![CDATA[<ol><li><p>小程序订阅消息（用户通过弹窗订阅）</p><blockquote><p>次数限制：开通支付能力的小程序下发上限是 3kw&#x2F;日，没开通的是 1kw&#x2F;日</p></blockquote></li><li><p>服务端 接入 小程序消息推送服务</p></li></ol><h1 id="获取到客户端真实-IP"><a href="#获取到客户端真实-IP" class="headerlink" title="获取到客户端真实 IP"></a>获取到客户端真实 IP</h1><pre><code class="hljs"># set_real_ip_from 0.0.0.0/0;set_real_ip_from 127.0.0.1;real_ip_header    X-Forwarded-For;real_ip_recursive on;# 全局设置反向代理传递真实客户端ipproxy_set_header Host      $host;proxy_set_header X-Real-IP $remote_addr;proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</code></pre>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>H5真机调试</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2024-08-03-【小程序】小程序静默登录方案优化</title>
    <link href="/2025/11/28/2024-08-03-%E3%80%90%E5%B0%8F%E7%A8%8B%E5%BA%8F%E3%80%91%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%9D%99%E9%BB%98%E7%99%BB%E5%BD%95%E6%96%B9%E6%A1%88%E4%BC%98%E5%8C%96/"/>
    <url>/2025/11/28/2024-08-03-%E3%80%90%E5%B0%8F%E7%A8%8B%E5%BA%8F%E3%80%91%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%9D%99%E9%BB%98%E7%99%BB%E5%BD%95%E6%96%B9%E6%A1%88%E4%BC%98%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<h1 id="一、现状"><a href="#一、现状" class="headerlink" title="一、现状"></a>一、现状</h1><p>通过扫码进入个人中心页，后台异步执行静默登录后，个人中心页未监听全局登录数据已更新，导致页面未及时刷新。</p><p>添加监听修复该问题后，产生新的问题，通过扫码进入个人中心页，点击“退出登录”后，首页界面未更新为未登录态。</p><p>注：小程序静默登录常规做法，仅对缓存数据中有登录数据的情况进行登录态还原，不做接口调用的异步登录，让用户手动登录。</p><p>小程序登录整体流程<br>image.png</p><p>小程序前端静默登录流程<br>image.png</p><h1 id="二、问题原因排查"><a href="#二、问题原因排查" class="headerlink" title="二、问题原因排查"></a>二、问题原因排查</h1><p>当前静默登录（后台异步登录），由于页面监听方案为 Object.defineProperty 且 configurable 设为 true，可重复配置，当多次监劫持全局变量同一属性时前者将被覆盖，导致页面后台运行（hide）情况下无法正常监听登录数据变更。</p><h1 id="三、静默登录-前端可选方案"><a href="#三、静默登录-前端可选方案" class="headerlink" title="三、静默登录 前端可选方案"></a>三、静默登录 前端可选方案</h1><p>Object.defineProperty&#x2F;Proxy（当前方案）</p><p>自定义发布订阅模式</p><p>过渡页</p><p>路由拦截</p><p>监听涉及页面<br>首页、个人中心、查看金额、入驻页。</p><p>image.png</p><p>全局实现 劫持全局变量更新的监听方法（app.js）<br>image.png</p><p>页面监听 全局变量更新<br>image.png</p><h1 id="四、现有方案-Object-defineProperty-Proxy-优化"><a href="#四、现有方案-Object-defineProperty-Proxy-优化" class="headerlink" title="四、现有方案 Object.defineProperty&#x2F;Proxy 优化"></a>四、现有方案 Object.defineProperty&#x2F;Proxy 优化</h1><p>由于多次监听同一个全局变量存在覆盖问题，可将同一全局变量的监听改为方法数组，从而达到多次监听的目的。但应考虑多个监听带来的副作用，完善解除方法与解除监听的时机。<br>image.png</p><p>由于监听登录数据存在可复用性，首页及个人中心页登录场景几乎相同，可考虑采用 behavaior 提取可复用逻辑。<br>image.png</p><p>五、现有方案 存在的其他 BUG<br>扫码查看金额 &#x3D;&gt; 进入个人页 &#x3D;&gt; 退出登录 &#x3D;&gt; 重新扫描查看金额，接口报错并跳转到首页</p><p>扫码进入个人中心页，页面登录态未刷新；（添加 watch 已修复，但引出新 bug，搜索进入首页后打开个人中心页，退出登录）</p>]]></content>
    
    
    <categories>
      
      <category>小程序</category>
      
    </categories>
    
    
    <tags>
      
      <tag>H5真机调试</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2024-06-27-【工程化】H5真机调试</title>
    <link href="/2025/11/28/2024-06-27-%E3%80%90%E7%A0%94%E5%8F%91%E3%80%91%E5%89%8D%E7%AB%AF%E4%B8%8A%E4%B8%87%E7%BA%A7%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E4%BC%98%E5%8C%96/"/>
    <url>/2025/11/28/2024-06-27-%E3%80%90%E7%A0%94%E5%8F%91%E3%80%91%E5%89%8D%E7%AB%AF%E4%B8%8A%E4%B8%87%E7%BA%A7%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E4%BC%98%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<h2 id="在前端实现十万行数据的表格秒级响应可能需要一些技巧和优化。"><a href="#在前端实现十万行数据的表格秒级响应可能需要一些技巧和优化。" class="headerlink" title="在前端实现十万行数据的表格秒级响应可能需要一些技巧和优化。"></a>在前端实现十万行数据的表格秒级响应可能需要一些技巧和优化。</h2><p>分页：将数据分成多个页面，只在当前页面显示数据，从而减少浏览器的内存占用。</p><p>懒加载：使用懒加载技术，只在用户滚动到表格的底部时才加载更多数据。</p><p>虚拟列表：只渲染可见部分的数据，从而减少浏览器的渲染时间。</p><p>数据缓存：使用浏览器缓存或本地存储来缓存数据，减少请求次数，提高响应速度。</p><p>后端优化：使用数据库索引、分页等技术来优化数据查询和排序。</p><p>Web Workers: 使用 web workers 来在后台线程上处理大量数据，减少主线程的负担。</p><p>前端框架优化：使用高性能的前端框架，如 React 和 Vue 等来优化表格渲染。</p><p>用 WebAssembly 来优化耗时的算法和计算，可以在前端使用汇编代码来提高性能。</p><p>使用跨域数据传输技术（CORS）来获取数据，减少网络请求延迟。</p><p>对于大量数据的表格，使用更高级的排序和筛选功能来减少需要渲染的数据量。</p><p>使用更高效的数据绑定方法，例如，使用 Object.observe()或 Proxy 来替代使用 setInterval()或 setTimeout()来检查数据的变化。</p><p>使用 WebAssembly 和 WebGL 来加速图形渲染，如使用 canvas 或 WebGL 来渲染表格数据。</p><p>使用 WebSockets 或 Server-Sent Events 来实现实时数据更新，减少服务器的压力和提高响应速度。</p><p>使用高性能的 JavaScript 库，例如 lodash 和 Ramda 等来优化数据处理。</p><p>使用类型检查库，例如 Flow 或 TypeScript 来减少类型错误导致的性能问题</p><p>使用单元测试和性能测试来确保代码的高性能和正确性。</p><p>减少 DOM 操作次数，优化渲染性能，可以使用 documentFragment 或其他方式来减少重绘。</p><p>使用工具，如 Lighthouse 和 DevTools 来优化性能，检测性能瓶颈并优化代码。</p><p>使用高性能的数据结构来存储数据，例如哈希表或二叉堆来提高查询和排序的性能。</p>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>H5真机调试</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2024-10-28-【研发】nestjs动态管理定时任务</title>
    <link href="/2025/11/28/2024-10-28-%E3%80%90%E7%A0%94%E5%8F%91%E3%80%91nestjs%E4%BC%81%E5%BE%AE%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%8E%A8%E9%80%81/"/>
    <url>/2025/11/28/2024-10-28-%E3%80%90%E7%A0%94%E5%8F%91%E3%80%91nestjs%E4%BC%81%E5%BE%AE%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%8E%A8%E9%80%81/</url>
    
    <content type="html"><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>在实际的业务场景中，定时任务的管理往往是动态的，比如：邮件定时推送、数据统计定时刷新等，需要根据业务的变化，动态的添加、删除、修改定时任务执行时间及任务内容。为了解决通过@Cron(‘0 10 16 * * 1-5’)注解来实现定时任务固定执行时间的局限性。提高灵活性，及可扩展性。</p><h2 id="1-相关依赖包"><a href="#1-相关依赖包" class="headerlink" title="1. 相关依赖包"></a>1. 相关依赖包</h2><blockquote><p>安装依赖<code>pnpm add node-fetch</code><br>对应版本<code>&quot;node-fetch&quot;: &quot;^2.6.9&quot;,</code></p></blockquote><h2 id="2-企微机器人推送服务"><a href="#2-企微机器人推送服务" class="headerlink" title="2. 企微机器人推送服务"></a>2. 企微机器人推送服务</h2><h3 id="2-1-创建定时任务服务"><a href="#2-1-创建定时任务服务" class="headerlink" title="2.1 创建定时任务服务"></a>2.1 创建定时任务服务</h3><blockquote><p>包含创建任务、删除任务、判断任务是否存在等功能</p></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * 企业微信机器人API</span><br><span class="hljs-comment">  * <span class="hljs-doctag">@param</span> <span class="hljs-variable">robotKey</span></span><br><span class="hljs-comment">  * <span class="hljs-doctag">@param</span> <span class="hljs-variable">body</span></span><br><span class="hljs-comment">  */</span><br> <span class="hljs-title function_">qyapi</span>(<span class="hljs-params">robotKey, body</span>) &#123;<br>   <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=<span class="hljs-subst">$&#123;robotKey&#125;</span>`</span>, &#123;<br>     <span class="hljs-attr">headers</span>: &#123;<br>       <span class="hljs-attr">accept</span>: <span class="hljs-string">&#x27;application/json, text/plain, */*&#x27;</span>,<br>       <span class="hljs-string">&#x27;accept-language&#x27;</span>: <span class="hljs-string">&#x27;zh-CN,zh;q=0.9&#x27;</span>,<br>       <span class="hljs-string">&#x27;cache-control&#x27;</span>: <span class="hljs-string">&#x27;no-cache&#x27;</span>,<br>       <span class="hljs-string">&#x27;content-type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span>,<br>       <span class="hljs-attr">pragma</span>: <span class="hljs-string">&#x27;no-cache&#x27;</span>,<br>     &#125;,<br>     <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(body),<br>     <span class="hljs-attr">referrerPolicy</span>: <span class="hljs-string">&#x27;strict-origin-when-cross-origin&#x27;</span>,<br>     <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>     <span class="hljs-attr">mode</span>: <span class="hljs-string">&#x27;cors&#x27;</span>,<br>     <span class="hljs-attr">credentials</span>: <span class="hljs-string">&#x27;include&#x27;</span>,<br>   &#125;)<br>     .<span class="hljs-title function_">then</span>(<span class="hljs-title function_">async</span> (response) =&gt; <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>())<br>     .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> &#123;<br>       <span class="hljs-keyword">return</span> data;<br>     &#125;)<br>     .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">logger</span>.<span class="hljs-title function_">error</span>(e));<br> &#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nestjs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2024-10-28-【研发】nestjs动态管理定时任务</title>
    <link href="/2025/11/28/2024-10-28-%E3%80%90%E7%A0%94%E5%8F%91%E3%80%91nestjs%E5%8A%A8%E6%80%81%E7%AE%A1%E7%90%86%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/"/>
    <url>/2025/11/28/2024-10-28-%E3%80%90%E7%A0%94%E5%8F%91%E3%80%91nestjs%E5%8A%A8%E6%80%81%E7%AE%A1%E7%90%86%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>在实际的业务场景中，定时任务的管理往往是动态的，比如：邮件定时推送、数据统计定时刷新等，需要根据业务的变化，动态的添加、删除、修改定时任务执行时间及任务内容。为了解决通过@Cron(‘0 10 16 * * 1-5’)注解来实现定时任务固定执行时间的局限性。提高灵活性，及可扩展性。</p><h2 id="1-相关依赖包"><a href="#1-相关依赖包" class="headerlink" title="1. 相关依赖包"></a>1. 相关依赖包</h2><blockquote><p>安装依赖<code>pnpm add @nestjs/schedule</code><br>对应版本<code>&quot;@nestjs/schedule&quot;: &quot;^2.2.1&quot;,</code></p></blockquote><h2 id="2-nestjs-动态定时任务实现"><a href="#2-nestjs-动态定时任务实现" class="headerlink" title="2. nestjs 动态定时任务实现"></a>2. nestjs 动态定时任务实现</h2><h3 id="2-1-创建定时任务服务"><a href="#2-1-创建定时任务服务" class="headerlink" title="2.1 创建定时任务服务"></a>2.1 创建定时任务服务</h3><blockquote><p>包含创建任务、删除任务、判断任务是否存在等功能</p></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">HttpException</span>, <span class="hljs-title class_">HttpStatus</span>, <span class="hljs-title class_">Injectable</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@nestjs/common&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">SchedulerRegistry</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@nestjs/schedule&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">CronJob</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;cron&quot;</span>;<br><br><span class="hljs-comment">// 自定义定时任务服务</span><br><span class="hljs-meta">@Injectable</span>()<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SchedulerTaskService</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span><br><span class="hljs-params">    <span class="hljs-comment">// 定时任务注册器</span></span><br><span class="hljs-params">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-attr">schedulerRegistry</span>: <span class="hljs-title class_">SchedulerRegistry</span></span><br><span class="hljs-params">  </span>) &#123;&#125;<br><br>  <span class="hljs-comment">// 执行任务</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">executeTask</span>(<span class="hljs-params"></span><br><span class="hljs-params">    <span class="hljs-comment">// 任务名称</span></span><br><span class="hljs-params">    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>,</span><br><span class="hljs-params">    <span class="hljs-comment">// cron表达式</span></span><br><span class="hljs-params">    <span class="hljs-attr">cronExpression</span>: <span class="hljs-title class_">Date</span> | <span class="hljs-built_in">string</span>,</span><br><span class="hljs-params">    <span class="hljs-comment">// 回调函数</span></span><br><span class="hljs-params">    <span class="hljs-attr">callback</span>: () =&gt; <span class="hljs-built_in">void</span>,</span><br><span class="hljs-params">    <span class="hljs-comment">// 执行完后是否需要删除</span></span><br><span class="hljs-params">    <span class="hljs-attr">needDel</span>?: <span class="hljs-built_in">boolean</span></span><br><span class="hljs-params">  </span>) &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-comment">// 创建定时任务</span><br>      <span class="hljs-keyword">const</span> <span class="hljs-attr">job</span>: <span class="hljs-title class_">CronJob</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CronJob</span>(cronExpression, <span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-keyword">if</span> (callback) &#123;<br>          <span class="hljs-title function_">callback</span>();<br>        &#125;<br>        <span class="hljs-comment">// 删除定时任务</span><br>        needDel &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">deleteCron</span>(name);<br>      &#125;);<br>      <span class="hljs-comment">// 添加定时任务</span><br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">schedulerRegistry</span>.<span class="hljs-title function_">addCronJob</span>(name, job);<br>      <span class="hljs-comment">// 启动定时任务</span><br>      job.<span class="hljs-title function_">start</span>();<br>    &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpException</span>(e, <span class="hljs-title class_">HttpStatus</span>.<span class="hljs-property">BAD_REQUEST</span>);<br>    &#125;<br>  &#125;<br>  <span class="hljs-comment">// 删除任务</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">deleteCron</span>(<span class="hljs-params"><span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">schedulerRegistry</span>.<span class="hljs-title function_">deleteCronJob</span>(name);<br>  &#125;<br><br>  <span class="hljs-comment">// 判断是否存在任务</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">doesExist</span>(<span class="hljs-params"><span class="hljs-attr">type</span>: <span class="hljs-string">&quot;cron&quot;</span> | <span class="hljs-string">&quot;timeout&quot;</span> | <span class="hljs-string">&quot;interval&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">schedulerRegistry</span>.<span class="hljs-title function_">doesExist</span>(<span class="hljs-keyword">type</span>, name);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-2-定时任务列表"><a href="#2-2-定时任务列表" class="headerlink" title="2.2 定时任务列表"></a>2.2 定时任务列表</h3><blockquote><p>配置定时任务列表，可以本地存储也可以远程。</p></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">const</span> schedulerTaskList = [<br>  <span class="hljs-comment">// 资金相关 === start</span><br>  &#123;<br>    <span class="hljs-attr">taskName</span>: <span class="hljs-string">&quot;schedulerTask1&quot;</span>,<br>    <span class="hljs-attr">service</span>: <span class="hljs-string">&quot;mailService&quot;</span>,<br>    <span class="hljs-attr">func</span>: <span class="hljs-string">&quot;pushMail&quot;</span>,<br>    <span class="hljs-attr">cron</span>: <span class="hljs-string">&quot;0 10 16 * * 1-5&quot;</span>,<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">taskName</span>: <span class="hljs-string">&quot;schedulerTask1&quot;</span>,<br>    <span class="hljs-attr">service</span>: <span class="hljs-string">&quot;newsService&quot;</span>,<br>    <span class="hljs-attr">func</span>: <span class="hljs-string">&quot;crawlNewsData&quot;</span>,<br>    <span class="hljs-attr">cron</span>: <span class="hljs-string">&quot;0 41 11 * * 1-5&quot;</span>,<br>  &#125;,<br>];<br><span class="hljs-keyword">export</span> &#123; schedulerTaskList &#125;;<br></code></pre></td></tr></table></figure><h3 id="2-3-初始化动态定时任务"><a href="#2-3-初始化动态定时任务" class="headerlink" title="2.3 初始化动态定时任务"></a>2.3 初始化动态定时任务</h3><blockquote><ol><li>项目启动时，执行定时任务初始化 <code>main.ts</code></li></ol></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">NestFactory</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@nestjs/core&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">AppModule</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./app.module&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">NestExpressApplication</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@nestjs/platform-express&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">AppController</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./app.controller.ts&#x27;</span>;<br><br>...<br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">bootstrap</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> <span class="hljs-attr">app</span>: <span class="hljs-title class_">NestExpressApplication</span> = <span class="hljs-keyword">await</span> <span class="hljs-title class_">NestFactory</span>.<span class="hljs-property">create</span>&lt;<span class="hljs-title class_">NestExpressApplication</span>&gt;(<span class="hljs-title class_">AppModule</span>);<br><br>  <span class="hljs-comment">// 通过依赖注入获取控制器实例</span><br>  <span class="hljs-keyword">const</span> appController = app.<span class="hljs-title function_">get</span>(<span class="hljs-title class_">AppController</span>);<br>  appController.<span class="hljs-title function_">initSchedulerTask</span>();<br>  ...<br>&#125;<br><span class="hljs-title function_">bootstrap</span>();<br></code></pre></td></tr></table></figure><blockquote><ol start="2"><li><code>app.controller.ts</code>添加定时任务初始化方法</li></ol></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/**</span><br><span class="hljs-comment">   * 初始化定时任务</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">initSchedulerTask</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-comment">// schedulerTaskList 定时任务列表，可以从配置文件中读取，也可以来源于数据库</span><br>    schedulerTaskList.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">task</span> =&gt;</span> &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">schedulerTaskService</span>.<span class="hljs-title function_">executeTask</span>(task.<span class="hljs-property">taskName</span>, task.<span class="hljs-property">cron</span>, <span class="hljs-title function_">async</span> () =&gt; &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>          <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>[task.<span class="hljs-property">service</span>][task.<span class="hljs-property">func</span>]();<br>        &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>          <span class="hljs-comment">// 报错后 通知企微</span><br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">qyWechatNotice</span>.<span class="hljs-title function_">notice</span>(task.<span class="hljs-property">service</span>, <span class="hljs-string">`[<span class="hljs-subst">$&#123;task.func&#125;</span>]出错了：<span class="hljs-subst">$&#123;e&#125;</span>`</span>);<br>        &#125;<br>      &#125;);<br>    &#125;);<br>  &#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nestjs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2024-08-03-【研发】设计开发</title>
    <link href="/2025/11/28/2024-08-03-%E3%80%90%E7%A0%94%E5%8F%91%E3%80%91%E8%AE%BE%E8%AE%A1%E5%BC%80%E5%8F%91/"/>
    <url>/2025/11/28/2024-08-03-%E3%80%90%E7%A0%94%E5%8F%91%E3%80%91%E8%AE%BE%E8%AE%A1%E5%BC%80%E5%8F%91/</url>
    
    <content type="html"><![CDATA[<h1 id="1-需求背景说明"><a href="#1-需求背景说明" class="headerlink" title="1. 需求背景说明"></a>1. 需求背景说明</h1><h2 id="1-1-涉及页面"><a href="#1-1-涉及页面" class="headerlink" title="1.1 涉及页面"></a>1.1 涉及页面</h2><h2 id="1-2-交互入口"><a href="#1-2-交互入口" class="headerlink" title="1.2 交互入口"></a>1.2 交互入口</h2><h1 id="2-交互设计"><a href="#2-交互设计" class="headerlink" title="2. 交互设计"></a>2. 交互设计</h1><ul><li>示例 1</li></ul><pre><code class=" mermaid">sequenceDiagramautonumber    actor 用户    participant XXX小程序    participant 金额明细    participant 小程序后端    activate 金额明细    用户-&gt;&gt;XXX小程序: 点击“确认收款”    XXX小程序-&gt;&gt;金额明细: 跳转“金额明细”，传入billNo    金额明细-&gt;&gt;金额明细: 登录、appId鉴权、入参校验、实名、订单属于当前用户、订单状态（0/1/2）等判断       rect rgba(0, 0, 255, .1)        Note right of 金额明细: 金额明细数据准备&amp;算税        金额明细-&gt;&gt;+小程序后端: [api]调用获取收款银行卡信息 nature/bankInfo，传入billNo        小程序后端--&gt;&gt;-金额明细: 返回 bankList （微信零钱、招行、微众银行）        rect rgb(232, 157, 9)        Note right of 金额明细:  openAPI 生成的订单不能切换银行卡隐藏逻辑        金额明细-&gt;&gt;+小程序后端: [api]查询转账单详情信息接口 user/billInfo，传入billNo        小程序后端--&gt;&gt;-金额明细: 返回订单详情 source（1 小程序订单，2 openapi订单）        金额明细-&gt;&gt;金额明细: source为2自动填入订单中的收款账户，且不能修改；bankList第一项bankType为1或3（微信、微众银行），收款渠道默认选择微信零钱；        end        金额明细-&gt;&gt;+小程序后端: [api]调用校验且更新转账单属于当前自然人 nature/validUpdateBill，传入billNo        小程序后端--&gt;&gt;-金额明细: 无返回值            rect rgb(191, 223, 255)            Note right of 金额明细: transferBillType为 1 物资回收，算税                金额明细-&gt;&gt;+小程序后端: [api]调用判断自然人是否存在待缴税nature/overdueTaxAmount ----【增加入参billNo】                小程序后端--&gt;&gt;-金额明细: 返回 overdueFlag（true存在待缴税，false不存在）                alt 【存在待缴税】                    金额明细--&gt;&gt;金额明细: 页面展示：交易失败&quot;收款方存在待缴税记录，不能继续此笔交易，请缴纳税款或取消交易后重试。&quot;；“查看待缴详情、刷新页面”按钮                else 【不存在待缴税】                    金额明细-&gt;&gt;+小程序后端: [api]调用计算税费金额 nature/computeTaxAmount，传入 billNo                    小程序后端--&gt;&gt;-金额明细: 返回 金额明细 realTransferAmount、payChannelId(支付渠道1微信 2招行 3微众) 等参数                    金额明细-&gt;&gt;金额明细: 页面展示税费、收款金额、收款账户等信息                end            end            rect rgb(91, 159, 38)            Note right of 金额明细: transferBillType为 2 农产品收购                金额明细-&gt;&gt;+小程序后端: [api]调用查询转账单详情信息接口 user/billInfo，传入 billNo                金额明细-&gt;&gt;金额明细: 页面展示收款金额、收款账户等信息                deactivate 金额明细            end    end</code></pre><ul><li>示例 2</li></ul><pre><code class=" mermaid">sequenceDiagramautonumber    actor 用户    participant 金额明细    participant 缴税结果    participant 收款结果    participant 缴税金三    participant 缴税金四    participant 小程序后端    用户-&gt;&gt;+金额明细: 1. 确认收款    alt 【个人存在补缴税费】realTransferAmount &lt; 0        金额明细--&gt;&gt;用户: 弹窗提示“本次交易您需要向商家支付...”    else 【个人不存在补缴税费】realTransferAmount &gt;= 0        rect rgba(0, 0, 255, .1)        Note right of 收款结果: 商家付款渠道为零钱/微众            alt 【微信零钱/微众银行支付 payChannelId 1或3】                金额明细-&gt;&gt;+小程序后端: [api]是否第一次缴税 nature/tax/valid，传入billNo                小程序后端--&gt;&gt;-金额明细: 返回 tax 待用，第一次false            end        end        金额明细-&gt;&gt;+小程序后端: [api]确认收款 nature/ensureTransfer，传入 billNo、bankId        小程序后端--&gt;&gt;-金额明细: 返回订单状态+商户数据 billStatus、mchId、appId、packageInfo        rect rgb(191, 223, 255)        Note right of 收款结果: 商家付款渠道 payChannelId 区分            alt 【已缴税】微众、招商银行                金额明细-&gt;&gt;收款结果: =======跳转收款结果[结束]            else 【待缴税】微众、微信零钱                rect rgba(0, 0, 255, .1)                Note right of 缴税结果: 缴税相关                    金额明细-&gt;&gt;+小程序后端: [api]调用获取缴税信息 nature/tax，传入 billNo                    小程序后端--&gt;&gt;-金额明细: 返回 缴税二维码数据（taxUrl、version），注意：taxUrl为空，弹窗提示“正在查询缴税结果，请稍后重试”                    金额明细--&gt;&gt;用户: 弹窗提示是否去缴税，根据tax判断是否第一次缴税（区分文案）                    用户-&gt;&gt;金额明细: 2. 去缴税                    alt 【金三缴税】version 为 V3                        金额明细-&gt;&gt;+缴税金三: 跳转金三缴税插件页                        缴税金三--&gt;&gt;-缴税结果: 缴税完成                    activate 缴税结果                    else 【金四缴税】version 为 V4                        金额明细-&gt;&gt;+缴税金四: 跳转金四缴税小程序                        缴税金四--&gt;&gt;-缴税结果: 缴税完成                    end                    缴税结果-&gt;+小程序后端: [api]查询缴税状态nature/queryTaxStatus，传入 billNo                    小程序后端--&gt;&gt;-缴税结果: 返回 缴税状态 taxStatus                    缴税结果-&gt;+小程序后端: [api]查询转账单详情信息接口 user/billInfo，传入 billNo                    小程序后端--&gt;&gt;-缴税结果: 返回 转账单详情，transferAmount、payChannelId、collectBankCardId                    loop 1s/次（90s）                    缴税结果-&gt;缴税结果: 超时逻辑：1. 0-30s 正在查询税费缴纳结果，请等待；2. 30-90s 未查询xxx，“去缴税” 3. &gt;90s 未查询XXX，“查询缴税结果” + “去缴税”                    end                    deactivate 缴税结果                end                用户-&gt;&gt;+缴税结果: 3. 去收款                缴税结果-&gt;&gt;缴税结果: 执行上方 1 - 6逻辑                缴税结果-&gt;&gt;+微信零钱收款: 微信零钱收款                微信零钱收款--&gt;&gt;-缴税结果: 收款成功                缴税结果-&gt;&gt;收款结果: =======跳转收款结果[结束]                deactivate 缴税结果            end        end    end</code></pre><h1 id="3-组件设计"><a href="#3-组件设计" class="headerlink" title="3. 组件设计"></a>3. 组件设计</h1><h2 id="3-1-组件名称"><a href="#3-1-组件名称" class="headerlink" title="3.1 组件名称"></a>3.1 组件名称</h2><blockquote><p>组件说明：<br>组件初始化时，xxx<br>操作 xxx</p></blockquote><h3 id="UI-稿贴图"><a href="#UI-稿贴图" class="headerlink" title="UI 稿贴图"></a>UI 稿贴图</h3><h3 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h3><ul><li><p>入参：</p><table><thead><tr><th>参数名</th><th>类型</th><th>默认值</th><th>描述</th></tr></thead><tbody><tr><td>edit-able</td><td>String</td><td>false</td><td>是否可编辑（启用、禁用）</td></tr><tr><td>click-able</td><td>Boolean</td><td>false</td><td>是否可点击</td></tr></tbody></table></li><li><p>事件：</p><table><thead><tr><th>组件方法名</th><th>父组件接收方法（调用方）</th><th>传参</th><th>描述</th></tr></thead><tbody><tr><td>onItemClick</td><td>item-click</td><td>{index: xx, itemId: xx}</td><td>点击经办人列时触发</td></tr></tbody></table></li></ul>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>设计开发</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2024-10-28-【研发】nestjs微服务开发问题集</title>
    <link href="/2025/11/28/2024-10-28-%E3%80%90%E7%A0%94%E5%8F%91%E3%80%91nestjs%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91%E9%97%AE%E9%A2%98%E9%9B%86/"/>
    <url>/2025/11/28/2024-10-28-%E3%80%90%E7%A0%94%E5%8F%91%E3%80%91nestjs%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91%E9%97%AE%E9%A2%98%E9%9B%86/</url>
    
    <content type="html"><![CDATA[<h2 id="如何区分开发和生产环境"><a href="#如何区分开发和生产环境" class="headerlink" title="如何区分开发和生产环境"></a>如何区分开发和生产环境</h2><p><a href="https://blog.csdn.net/m0_37890289/article/details/135419842">https://blog.csdn.net/m0_37890289/article/details/135419842</a></p><h2 id="1-服务调用为何没响应？"><a href="#1-服务调用为何没响应？" class="headerlink" title="1. 服务调用为何没响应？"></a>1. 服务调用为何没响应？</h2><ul><li>send 调用方需要 return await 才能正常返回微服务响应结果</li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript">&lt;!-- 事件响应 --&gt;<br><span class="hljs-comment">// 提供方 - 微服务</span><br> <span class="hljs-meta">@EventPattern</span>(<span class="hljs-string">&#x27;fetchNewsTask&#x27;</span>)<br>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">fetchNewsTask</span>(<span class="hljs-params"></span>) &#123;&#125;<br><span class="hljs-comment">// 调用方 - 主服务（网关） emit</span><br><span class="hljs-variable language_">this</span>.<span class="hljs-property">pushServer</span>.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;fetchNewsTask&#x27;</span>, &#123;&#125;);<br></code></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 提供方 - 微服务</span><br><span class="hljs-meta">@MessagePattern</span>(<span class="hljs-string">&#x27;fetchLatestNews&#x27;</span>)<br><span class="hljs-keyword">async</span> <span class="hljs-title function_">fetchLatestNews</span>(<span class="hljs-params"><span class="hljs-meta">@Payload</span>() <span class="hljs-attr">payload</span>: <span class="hljs-built_in">any</span></span>) &#123;<br>  <span class="hljs-keyword">const</span> <span class="hljs-attr">newsData</span>: <span class="hljs-built_in">any</span> = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">newsService</span>.<span class="hljs-title function_">fetchLatestNews</span>(payload);<br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-attr">code</span>: <span class="hljs-number">0</span>,<br>    <span class="hljs-attr">data</span>: newsData,<br>  &#125;;<br>&#125;<br><br><span class="hljs-comment">// 调用方 - 主服务（网关）send</span><br>  <span class="hljs-meta">@Get</span>(<span class="hljs-string">&#x27;fetchLatestNews&#x27;</span>)<br>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">fetchLatestNews</span>(<span class="hljs-params"><span class="hljs-meta">@Query</span>() query</span>) &#123;<br>    <span class="hljs-keyword">const</span> latestTime = query.<span class="hljs-property">latestTime</span> || <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">pushServer</span>.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;fetchLatestNews&#x27;</span>, latestTime);<br>  &#125;<br></code></pre></td></tr></table></figure><h2 id="2-微服务部署，consul-网关服务发现"><a href="#2-微服务部署，consul-网关服务发现" class="headerlink" title="2. 微服务部署，consul 网关服务发现"></a>2. 微服务部署，consul 网关服务发现</h2><h3 id="第一步-安装-consul-1-x（服务器中安装）"><a href="#第一步-安装-consul-1-x（服务器中安装）" class="headerlink" title="第一步 安装 consul 1.x（服务器中安装）"></a>第一步 安装 consul 1.x（服务器中安装）</h3><p>2.1 通过 docker-compose 安装 consul <code>curl -L &quot;https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose</code><br>2.2 设置 docker-compose 执行权限 <code>sudo chmod +x /usr/local/bin/docker-compose</code><br>2.3 创建 docker-compose.yml 文件 <code>vi docker-compose.yml</code><br>2.4 写入以下内容：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3&quot;</span><br><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">consul:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">consul:1.10.1</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">consul_dev</span><br>    <span class="hljs-attr">command:</span> <span class="hljs-string">agent</span> <span class="hljs-string">-server</span> <span class="hljs-string">-node=consul_dev</span> <span class="hljs-string">-bootstrap-expect=1</span> <span class="hljs-string">-bind=127.0.0.1</span> <span class="hljs-string">-client=0.0.0.0</span> <span class="hljs-string">-datacenter=dc1</span> <span class="hljs-string">-ui</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;18500:8500&quot;</span><br>    <span class="hljs-attr">network_mode:</span> <span class="hljs-string">bridge</span><br></code></pre></td></tr></table></figure><p>2.5 启动 consul <code>docker-compose up -d</code><br>2.6 验证 consul 运行状态 <code>docker ps</code></p><h3 id="第二步-nestjs-微服务注册"><a href="#第二步-nestjs-微服务注册" class="headerlink" title="第二步 nestjs 微服务注册"></a>第二步 nestjs 微服务注册</h3><ol><li></li></ol><h3 id="第三步-nestjs-网关发现微服务"><a href="#第三步-nestjs-网关发现微服务" class="headerlink" title="第三步 nestjs 网关发现微服务"></a>第三步 nestjs 网关发现微服务</h3><h3 id="第四步-pm2-部署服务"><a href="#第四步-pm2-部署服务" class="headerlink" title="第四步 pm2 部署服务"></a>第四步 pm2 部署服务</h3><ol><li>为了区分开发环境和生产环境，创建<code>ecosystem.config.js</code></li><li>写入配置，启动 pm2 后可写入环境变量</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">apps</span>: [<br>    &#123;<br>      <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;payBack&quot;</span>,<br>      <span class="hljs-attr">script</span>: <span class="hljs-string">&quot;dist/main.js&quot;</span>,<br>      <span class="hljs-attr">env</span>: &#123;<br>        <span class="hljs-attr">NODE_ENV</span>: <span class="hljs-string">&quot;prod&quot;</span>,<br>      &#125;,<br>      <span class="hljs-attr">env_dev</span>: &#123;<br>        <span class="hljs-attr">NODE_ENV</span>: <span class="hljs-string">&quot;dev&quot;</span>,<br>      &#125;,<br>      <span class="hljs-attr">env_prod</span>: &#123;<br>        <span class="hljs-attr">NODE_ENV</span>: <span class="hljs-string">&quot;prod&quot;</span>,<br>      &#125;,<br>    &#125;,<br>  ],<br>&#125;;<br></code></pre></td></tr></table></figure><ol start="3"><li>启动生产服务 <code>pm2 start ecosystem.config.js --env prod --watch</code></li></ol><h2 id="3-网络安全"><a href="#3-网络安全" class="headerlink" title="3. 网络安全"></a>3. 网络安全</h2><p>consul 服务发现与注册使用内网 iP 互联</p><ul><li>[注意]微服务启动 0.0.0.0 监听外网</li></ul><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">const</span> app = <span class="hljs-keyword">await</span> NestFactory.createMicroservice&lt;MicroserviceOptions&gt;(<br>  AppModule,<br>  &#123;<br>    transport: Transport.TCP,<br>    options: &#123;<br>      <span class="hljs-comment">// 很重要</span><br>      host: <span class="hljs-string">&#x27;0.0.0.0&#x27;</span>,<br>      port,<br>    &#125;,<br>  &#125;,<br>);<br></code></pre></td></tr></table></figure><p>腾讯云轻量服务器支持同地域内网 ip 互联<br>防火墙端口，仅需开通内网 ip 访问</p><h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><ol><li>无法连接微服务</li></ol><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs coq"><span class="hljs-number">0</span>|<span class="hljs-type">payBack</span>  | <span class="hljs-type">[Nest</span>] <span class="hljs-number">356351</span>  - <span class="hljs-number">2024</span><span class="hljs-number">-11</span><span class="hljs-number">-09</span> <span class="hljs-number">12</span>:<span class="hljs-number">20</span>:<span class="hljs-number">11</span> AM   ERROR [ExceptionsHandler] connect ECONNREFUSED <span class="hljs-number">10.0</span><span class="hljs-number">.0</span><span class="hljs-number">.4</span>:<span class="hljs-number">3001</span><br><span class="hljs-number">0</span>|<span class="hljs-type">payBack</span>  | <span class="hljs-type">Error</span>: connect ECONNREFUSED <span class="hljs-number">10.0</span><span class="hljs-number">.0</span><span class="hljs-number">.4</span>:<span class="hljs-number">3001</span><br><span class="hljs-number">0</span>|<span class="hljs-type">payBack</span>  |     <span class="hljs-type">at</span> TCPConnectWrap.afterConnect [<span class="hljs-built_in">as</span> oncomplete] (node:net:<span class="hljs-number">1278</span>:<span class="hljs-number">16</span>)<br></code></pre></td></tr></table></figure><ul><li><p>1.1 微服务自检端口</p></li><li><p>lsof -i:3001 （如果为 TCP localhost:3001 则需要将微服务启动监听 0.0.0.0）</p></li><li><p>node\x20&#x2F; 158029 root 19u IPv4 901314 0t0 TCP *:3001 (LISTEN)</p></li><li><p>1.2 主服务访问微服务端口</p></li><li><p>nmap -p 3001 10.0.0.4</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs 失败示例">PORT     STATE SERVICE<br>3001/tcp closed  nessus<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs 成功示例"><br>PORT     STATE SERVICE<br>3001/tcp open  nessus<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nestjs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2024-06-27-【工程化】H5真机调试</title>
    <link href="/2025/11/28/2024-06-27-%E3%80%90%E7%A0%94%E5%8F%91%E3%80%91H5%E7%9C%9F%E6%9C%BA%E8%B0%83%E8%AF%95%20copy/"/>
    <url>/2025/11/28/2024-06-27-%E3%80%90%E7%A0%94%E5%8F%91%E3%80%91H5%E7%9C%9F%E6%9C%BA%E8%B0%83%E8%AF%95%20copy/</url>
    
    <content type="html"><![CDATA[<blockquote><p>前言：vConsole 是一个比较好的 H5 真机调试方法，但在真机上操作可能没那么顺手。这里提供一个适用于安卓、苹果真机打开 H5 页面，在开发机上远程调试的方法。毕竟方法多多益善</p></blockquote><h2 id="安卓手机和-Chrome-浏览器"><a href="#安卓手机和-Chrome-浏览器" class="headerlink" title="安卓手机和 Chrome 浏览器"></a>安卓手机和 Chrome 浏览器</h2><h3 id="1-移动端设备设置-android"><a href="#1-移动端设备设置-android" class="headerlink" title="1. 移动端设备设置 - android"></a>1. 移动端设备设置 - android</h3><ul><li>1.1 打开 设置，开启开发者模式，打开 USB 调试（<code>设置</code> &gt; <code>开发者选项</code> &gt; <code>USB调试</code>）</li><li>1.2 USB&#x2F;typec 连接移动端设备<br><img src="/tencent/api/attachments/s3/url?attachmentid=21309779" alt="2699b8e1abb2b26bea9a199d9ebfcf33.jpg"></li><li>1.3 需要设备已安装 chrome 浏览器</li></ul><h3 id="2-开发机设置-chrome"><a href="#2-开发机设置-chrome" class="headerlink" title="2. 开发机设置 chrome"></a>2. 开发机设置 chrome</h3><ul><li>2.1 打开 chrome，访问 chrome:&#x2F;&#x2F;inspect&#x2F;#devices</li><li>2.2 点击需要调试的页面 inspect<br><img src="/tencent/api/attachments/s3/url?attachmentid=21310120" alt="image.png"></li><li>熟悉的调试界面就来了<br><img src="/tencent/api/attachments/s3/url?attachmentid=21308584" alt="image.png"></li></ul><h2 id="苹果手机和-safari-浏览器"><a href="#苹果手机和-safari-浏览器" class="headerlink" title="苹果手机和 safari 浏览器"></a>苹果手机和 safari 浏览器</h2><h3 id="1-移动端设备设置-IOS"><a href="#1-移动端设备设置-IOS" class="headerlink" title="1. 移动端设备设置 - IOS"></a>1. 移动端设备设置 - IOS</h3><ul><li>打开 设置-&gt; 找到 Safari 浏览器-&gt; 最底部 “高级” -&gt; 勾选 “网页检查器”&amp;Javascript<br><img src="/tencent/api/attachments/s3/url?attachmentid=21306247" alt="image.png"></li></ul><h3 id="2-开发机设置-mac-safari"><a href="#2-开发机设置-mac-safari" class="headerlink" title="2. 开发机设置 - mac safari"></a>2. 开发机设置 - mac safari</h3><ul><li>2.1 开启 safari “开发”功能</li><li>打开 safari，safiri 浏览器 -&gt; 设置<br><img src="/tencent/api/attachments/s3/url?attachmentid=21306598" alt="image.png"></li><li>高级 -&gt; 勾选“显示网页开发者功能”<br><img src="/tencent/api/attachments/s3/url?attachmentid=21306545" alt="image.png"></li><li>2.2 USB&#x2F;typec 连接移动端设备 -&gt; 信任</li><li>2.3 打开 safari -&gt; 开发 -&gt; 找到移动设备 -&gt; safari 浏览器已打开的页面<br><img src="/tencent/api/attachments/s3/url?attachmentid=21307540" alt="image.png"></li><li>熟悉的调试界面就来了<br><img src="/tencent/api/attachments/s3/url?attachmentid=21307928" alt="image.png"></li></ul>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>H5真机调试</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2024-10-28-【研发】nestjs环境区分</title>
    <link href="/2025/11/28/2024-10-28-%E3%80%90%E7%A0%94%E5%8F%91%E3%80%91nestjs%E7%8E%AF%E5%A2%83%E5%8C%BA%E5%88%86/"/>
    <url>/2025/11/28/2024-10-28-%E3%80%90%E7%A0%94%E5%8F%91%E3%80%91nestjs%E7%8E%AF%E5%A2%83%E5%8C%BA%E5%88%86/</url>
    
    <content type="html"><![CDATA[<h2 id="nestjs"><a href="#nestjs" class="headerlink" title="nestjs"></a>nestjs</h2><h3 id="1-安装涉及工具包"><a href="#1-安装涉及工具包" class="headerlink" title="1. 安装涉及工具包"></a>1. 安装涉及工具包</h3><blockquote><ol><li>cross-env ^7.0.3</li><li>@nestjs&#x2F;config ^2.3.1</li></ol></blockquote><h3 id="2-创建-env-dev-与-env-prod-文件"><a href="#2-创建-env-dev-与-env-prod-文件" class="headerlink" title="2.创建 env.dev 与 env.prod 文件"></a>2.创建 env.dev 与 env.prod 文件</h3><blockquote><p>写入生产环境变量与开发环境变量</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs 示例如下">DDD_USER=root<br>DDD_PD=xxx<br>DDD_HOST=127.0.0.1<br>DDD_PORT=3306<br>DDD_NAME=&#x27;databaseName&#x27;<br>CONSUL_HOST=xxx<br>CONSUL_PORT=8500<br>APP_PORT=3000<br>APP_NAME=microservice-name<br>APP_HOST=127.0.0.1<br></code></pre></td></tr></table></figure><h3 id="3-NODE-ENV-环境变量配置"><a href="#3-NODE-ENV-环境变量配置" class="headerlink" title="3. NODE_ENV 环境变量配置"></a>3. NODE_ENV 环境变量配置</h3><h4 id="3-1-开发时"><a href="#3-1-开发时" class="headerlink" title="3.1 开发时"></a>3.1 开发时</h4><blockquote><p>在 package.json 中配置 “start:dev”: “cross-env NODE_ENV&#x3D;dev nest start –watch”</p></blockquote><h4 id="3-2-生产部署时"><a href="#3-2-生产部署时" class="headerlink" title="3.2 生产部署时"></a>3.2 生产部署时</h4><blockquote><p>这里使用 pm2 创建 nodejs 守护进程</p></blockquote><ol><li>创建 ecosystem.config.js 文件，执行<code>pm2 init simple</code></li><li>写入配置如下</li></ol><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs nix">m<span class="hljs-attr">odule.exports</span> <span class="hljs-operator">=</span> &#123;<br><span class="hljs-params">apps:</span> [<br>  &#123;<br>    <span class="hljs-params">name:</span> &#x27;projectName&#x27;,<br>    <span class="hljs-params">script:</span> &#x27;dist<span class="hljs-operator">/</span>main.js&#x27;,<br>    <span class="hljs-params">env:</span> &#123;<br>      <span class="hljs-params">NODE_ENV:</span> &#x27;prod&#x27;,<br>    &#125;,<br>    <span class="hljs-params">env_dev:</span> &#123;<br>      <span class="hljs-params">NODE_ENV:</span> &#x27;dev&#x27;,<br>    &#125;,<br>    <span class="hljs-params">env_prod:</span> &#123;<br>      <span class="hljs-params">NODE_ENV:</span> &#x27;prod&#x27;,<br>    &#125;,<br>  &#125;,<br>],<br>&#125;;<br></code></pre></td></tr></table></figure><ol start="3"><li>启动 pm2<br><code>pm2 start ecosystem.config.js --env prod --watch</code></li></ol><h3 id="2-全局注入-app-module-ts-中"><a href="#2-全局注入-app-module-ts-中" class="headerlink" title="2. 全局注入 app.module.ts 中"></a>2. 全局注入 app.module.ts 中</h3><blockquote><p>设置 isGlobal: true 后，可在任意模块中使用 ConfigService</p></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ConfigModule</span>, <span class="hljs-title class_">ConfigService</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@nestjs/config&#x27;</span>;<br><br><span class="hljs-keyword">const</span> envFilePath = <span class="hljs-string">`.env.<span class="hljs-subst">$&#123;process.env.NODE_ENV || <span class="hljs-string">&#x27;prod&#x27;</span>&#125;</span>`</span>;<br><br><span class="hljs-meta">@Module</span>(&#123;<br>  <span class="hljs-attr">imports</span>: [<br>    <span class="hljs-title class_">ConfigModule</span>.<span class="hljs-title function_">forRoot</span>(&#123;<br>      <span class="hljs-attr">isGlobal</span>: <span class="hljs-literal">true</span>,<br>      envFilePath,<br>    &#125;),<br>  ],&#125;)<br></code></pre></td></tr></table></figure><h3 id="3-使用时注入-ConfigService"><a href="#3-使用时注入-ConfigService" class="headerlink" title="3.使用时注入 ConfigService"></a>3.使用时注入 ConfigService</h3><h4 id="3-1-Controller-控制器中"><a href="#3-1-Controller-控制器中" class="headerlink" title="3.1 Controller 控制器中"></a>3.1 Controller 控制器中</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ConfigService</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@nestjs/config&quot;</span>;<br><br><span class="hljs-meta">@Controller</span>(<span class="hljs-string">&quot;cats&quot;</span>)<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CatsController</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-attr">config</span>: <span class="hljs-title class_">ConfigService</span></span>) &#123;<br>    <span class="hljs-keyword">const</span> config = <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<br>      config.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;APP_NAME&quot;</span>),<br>      config.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;APP_HOST&quot;</span>),<br>      config.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;APP_PORT&quot;</span>)<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="3-2-module-中"><a href="#3-2-module-中" class="headerlink" title="3.2 module 中"></a>3.2 module 中</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Module</span>, <span class="hljs-title class_">OnModuleInit</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@nestjs/common&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ConfigService</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@nestjs/config&quot;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppModule</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">OnModuleInit</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-attr">config</span>: <span class="hljs-title class_">ConfigService</span></span>) &#123;&#125;<br><br>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onModuleInit</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> config = <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<br>      config.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;APP_NAME&quot;</span>),<br>      config.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;APP_HOST&quot;</span>),<br>      config.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;APP_PORT&quot;</span>)<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nestjs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2024-11-12-【网络】fetch、axios取消请求实现</title>
    <link href="/2025/11/28/2024-11-12-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91fetch%E3%80%81axios%E5%8F%96%E6%B6%88%E8%AF%B7%E6%B1%82%E5%AE%9E%E7%8E%B0/"/>
    <url>/2025/11/28/2024-11-12-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91fetch%E3%80%81axios%E5%8F%96%E6%B6%88%E8%AF%B7%E6%B1%82%E5%AE%9E%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h2 id="Axios-请求通过-CancelToken-来取消请求"><a href="#Axios-请求通过-CancelToken-来取消请求" class="headerlink" title="Axios 请求通过 CancelToken 来取消请求"></a>Axios 请求通过 CancelToken 来取消请求</h2><p>Axios 自带有取消请求的借口，在 Axios 中通过 CancelToken 取消请求发送。下面是一个示例：</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs arcade">/ 引入 Axios 库<br>const axios = require(<span class="hljs-string">&#x27;axios&#x27;</span>);<br><br><span class="hljs-comment">// 创建一个 CancelToken.source 对象</span><br>const &#123; CancelToken, axiosInstance &#125; = axios;<br>const source = CancelToken.source();<br><br><span class="hljs-comment">// 创建一个 Axios 请求</span><br>const request = axiosInstance.get(<span class="hljs-string">&#x27;https://api.example.com/data&#x27;</span>, &#123;<br>  <span class="hljs-attr">cancelToken</span>: source.token <span class="hljs-comment">// 传递 CancelToken 对象到请求配置中</span><br>&#125;);<br><br><span class="hljs-comment">// 设置一个定时器，在 3 秒后取消请求</span><br>setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>  source.cancel(<span class="hljs-string">&#x27;Request canceled due to timeout&#x27;</span>);<br>&#125;, <span class="hljs-number">3000</span>);<br><br><span class="hljs-comment">// 发起请求并处理响应</span><br>request.then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(<span class="hljs-string">&#x27;Response:&#x27;</span>, response.data);<br>&#125;).<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (axios.isCancel(error)) &#123;<br>    <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(<span class="hljs-string">&#x27;Request canceled:&#x27;</span>, error.message);<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-built_in">console</span>.error(<span class="hljs-string">&#x27;Error:&#x27;</span>, error);<br>  &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><blockquote><p>在这个示例中，我们首先引入 Axios 库，并创建了一个 CancelToken.source 对象 source。然后，我们发起一个 GET 请求，并在请求配置中传递了 cancelToken: source.token，以便 Axios 知道我们要使用哪个 CancelToken 来取消请求。<br>接着，我们设置了一个定时器，在 3 秒后调用 source.cancel() 方法取消请求，并传递了一个取消原因。最后，我们发起请求，并在 .then() 和 .catch() 方法中分别处理响应和错误。如果请求被取消，我们通过 axios.isCancel(error) 来检查错误类型，并输出相应的日志。</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>fetch</tag>
      
      <tag>axios</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2024-11-20-【小程序】小程序自动化测试</title>
    <link href="/2025/11/28/2024-11-20-%E3%80%90%E5%B0%8F%E7%A8%8B%E5%BA%8F%E3%80%91%E5%B0%8F%E7%A8%8B%E5%BA%8Fminiprogram-ci/"/>
    <url>/2025/11/28/2024-11-20-%E3%80%90%E5%B0%8F%E7%A8%8B%E5%BA%8F%E3%80%91%E5%B0%8F%E7%A8%8B%E5%BA%8Fminiprogram-ci/</url>
    
    <content type="html"><![CDATA[<h2 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h2><p><a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/ci.html">开发辅助 &#x2F;miniprogram-ci</a></p><h2 id="上传"><a href="#上传" class="headerlink" title="上传"></a>上传</h2>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
      <category>小程序</category>
      
    </categories>
    
    
    <tags>
      
      <tag>工程化</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2024-11-20-【小程序】小程序自动化测试</title>
    <link href="/2025/11/28/2024-11-20-%E3%80%90%E5%B0%8F%E7%A8%8B%E5%BA%8F%E3%80%91%E5%B0%8F%E7%A8%8B%E5%BA%8F%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95minitest%E6%B5%81%E6%B0%B4%E7%BA%BF/"/>
    <url>/2025/11/28/2024-11-20-%E3%80%90%E5%B0%8F%E7%A8%8B%E5%BA%8F%E3%80%91%E5%B0%8F%E7%A8%8B%E5%BA%8F%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95minitest%E6%B5%81%E6%B0%B4%E7%BA%BF/</url>
    
    <content type="html"><![CDATA[<h2 id="minitest-云测"><a href="#minitest-云测" class="headerlink" title="minitest 云测"></a>minitest 云测</h2><ol><li>上传 minium 测试用例</li><li>新建 minium 测试计划</li><li>提交 minium 测试任务</li><li>查看测试报告</li></ol><p>其他<br>账号管理</p><h2 id="智研流水线触发"><a href="#智研流水线触发" class="headerlink" title="智研流水线触发"></a>智研流水线触发</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><ol start="5"><li><a href="https://minitest.weixin.qq.com/#/minium/Python/readme">minitest 官网</a> </li><li><a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/minitest/">小程序云测 官网</a> 6. <a href="https://www.runoob.com/python/python-tutorial.html">python 菜鸟教程</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
      <category>小程序</category>
      
    </categories>
    
    
    <tags>
      
      <tag>工程化</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2024-12-13-【网站】不安全的域名（腾讯云）</title>
    <link href="/2025/11/28/2024-12-13-%E3%80%90%E7%BD%91%E7%AB%99%E3%80%91%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%E5%9F%9F%E5%90%8D/"/>
    <url>/2025/11/28/2024-12-13-%E3%80%90%E7%BD%91%E7%AB%99%E3%80%91%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%E5%9F%9F%E5%90%8D/</url>
    
    <content type="html"><![CDATA[<ol><li>申请免费证书，有效期 3 个月；<a href="https://console.cloud.tencent.com/ssl">腾讯云 ssl</a></li><li>[手动解析&#x2F;可选自动]添加 dns 解析，<a href="https://console.cloud.tencent.com/cns">域名解析</a>2025-05-27 15:21:35 新增步骤</li><li>审批通过后，下载证书，选择 nginx 方式，解压到本地</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">本地执行</span><br>scp -r /Users/sunny/Downloads/blowsysun.top_nginx root@43.154.209.141:/usr/local/etc<br></code></pre></td></tr></table></figure><ol start="4"><li>登录服务器，进入目录<code>/usr/local/etc</code>，删除 blowsysun.top 目录（如果有）<code>rm -rf blowsysun.top</code></li><li>修改文件夹名称 <code>mv blowsysun.top_nginx blowsysun.top</code></li><li>修改 nginx 配置，cd 到<code>/etc/nginx/conf.d</code>;(如果文件名没有变化则不需要此步骤-blowsysun.top.pem)</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">服务器执行；</span><br>cd /etc/nginx/conf.d<br>vi blowsysun.top.conf<br></code></pre></td></tr></table></figure><ol start="5"><li>重启 nginx <code>sudo nginx -s reload</code></li><li>重启报错 则，重启 nginx 应用 <code>sudo systemctl restart nginx</code></li><li>仍然报错，则强杀，在启动</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">先停 systemd 单元</span><br>sudo systemctl stop nginx<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">若仍残留进程，直接杀</span><br>sudo pkill -9 nginx<br><span class="hljs-meta prompt_"># </span><span class="language-bash">或更精确</span><br>sudo killall -9 nginx<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">启动 nginx</span><br>nginx<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>建站</category>
      
      <category>运维</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ssl证书</tag>
      
      <tag>https安全</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025-01-06-【研发】pm2日志管理</title>
    <link href="/2025/11/28/2025-01-06-%E3%80%90%E7%A0%94%E5%8F%91%E3%80%91pm2%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86/"/>
    <url>/2025/11/28/2025-01-06-%E3%80%90%E7%A0%94%E5%8F%91%E3%80%91pm2%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86/</url>
    
    <content type="html"><![CDATA[<p>要使用 PM2 管理日志文件并按大小进行分隔，你可以使用 pm2-logrotate 插件。以下是详细的步骤和配置方法：</p><p>安装 pm2-logrotate 插件<br>首先，确保你已经安装了 PM2。然后，安装 pm2-logrotate 插件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">pm2 install pm2-logrotate<br>安装完成后，你可以通过 pm2 list 查看模块列表<br></code></pre></td></tr></table></figure><p>配置 pm2-logrotate<br>安装完成后，你可以通过以下命令来配置日志轮换的参数：</p><p>设置日志文件的最大大小：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">pm2 <span class="hljs-built_in">set</span> pm2-logrotate:max_size 10M<br>这里设置日志文件的最大大小为 10MB<br></code></pre></td></tr></table></figure><p>设置保留的日志文件数量：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">pm2 <span class="hljs-built_in">set</span> pm2-logrotate:retain 10<br>这里设置最多保留 10 个日志文件<br></code></pre></td></tr></table></figure><p>启用日志文件压缩：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">pm2 <span class="hljs-built_in">set</span> pm2-logrotate:compress <span class="hljs-literal">true</span><br>启用 gzip 压缩处理日志文件<br></code></pre></td></tr></table></figure><p>设置日志文件名称的日期格式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">pm2 <span class="hljs-built_in">set</span> pm2-logrotate:dateFormat <span class="hljs-string">&quot;YYYY-MM-DD_HH-mm-ss&quot;</span><br>设置日志文件名的日期格式<br></code></pre></td></tr></table></figure><p>设置检查日志大小的时间间隔：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">pm2 <span class="hljs-built_in">set</span> pm2-logrotate:workerInterval 30<br>设置为每 30 秒检查一次日志大小<br></code></pre></td></tr></table></figure><p>设置定时强制分割日志文件的时间：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">pm2 <span class="hljs-built_in">set</span> pm2-logrotate:rotateInterval <span class="hljs-string">&quot;0 0 \* \* \*&quot;</span><br>设置为每天午夜 0 点强制分割日志文件<br></code></pre></td></tr></table></figure><p>查看和重启配置<br>查看当前配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">pm2 conf pm2-logrotate<br>或者<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">pm2 show pm2-logrotate<br>查看当前的 pm2-logrotate 配置<br></code></pre></td></tr></table></figure><p>重启所有应用以应用新的日志配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">pm2 restart all<br>确保新的日志配置生效<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>pm2</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2024-11-20-【小程序】小程序自动化测试</title>
    <link href="/2025/11/28/2024-11-20-%E3%80%90%E5%B0%8F%E7%A8%8B%E5%BA%8F%E3%80%91%E5%B0%8F%E7%A8%8B%E5%BA%8F%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/"/>
    <url>/2025/11/28/2024-11-20-%E3%80%90%E5%B0%8F%E7%A8%8B%E5%BA%8F%E3%80%91%E5%B0%8F%E7%A8%8B%E5%BA%8F%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/</url>
    
    <content type="html"><![CDATA[<h2 id="1-minium-介绍"><a href="#1-minium-介绍" class="headerlink" title="1. minium 介绍"></a>1. minium 介绍</h2><p>minium 是为小程序专门开发的自动化框架。使用 minium 可以进行小程序 UI 自动化测试, 但是 minium 的功能不止于仅仅是 UI 自动化, 甚至可以使用 minium 来进行函数的 mock, 可以直接跳转到小程序某个页面并设置页面数据, 做针对性的全面测试, 这些都得益于我们开放了部分小程序 API 的能力。除此之外，小程序有部分组件使用了系统原生的组件，对于这部分的组件，我们也基于 uiautomator 和 wda 做了补充。</p><h2 id="2-环境准备"><a href="#2-环境准备" class="headerlink" title="2. 环境准备"></a>2. 环境准备</h2><blockquote><p>Python 3.8 及以上<br>微信开发者工具 (本文档中简称 IDE)最新版本，并打开安全模式: 设置 -&gt; 安全设置 -&gt; 服务端口: 打开<br>微信 &gt;&#x3D; 7.0.7 (确认微信公共库版本 &gt;&#x3D; 2.7.3 即可)</p></blockquote><ul><li>安装 minium<br>自动安装<code>pip3 install minium</code>或者<code>pip3 install https://minitest.weixin.qq.com/minium/Python/dist/minium-latest.zip</code></li><li>环境自检<br><code>minitest -v</code>如果安装成功会返回版本信息</li></ul><h2 id="3-minium-项目创建"><a href="#3-minium-项目创建" class="headerlink" title="3. minium 项目创建"></a>3. minium 项目创建</h2><ul><li>创建项目 <code>miniprogram-test-minium</code></li></ul><h3 id="3-1-目录结构"><a href="#3-1-目录结构" class="headerlink" title="3.1 目录结构"></a>3.1 目录结构</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus">├── test<br>│   └── __init__<span class="hljs-selector-class">.py</span><br>│   └── first_test<span class="hljs-selector-class">.py</span><br>└── config<span class="hljs-selector-class">.json</span><br>└── suite.json<br></code></pre></td></tr></table></figure><p>注：<code>__init__.py</code>文件必须创建，否则执行测试用例会报错，内容可以为空。</p><h3 id="3-2-基础配置文件-config-json"><a href="#3-2-基础配置文件-config-json" class="headerlink" title="3.2 基础配置文件 config.json"></a>3.2 基础配置文件 <code>config.json</code></h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;project_path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;path/to/project&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;dev_tool_path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;path/to/cli&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;debug_mode&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;debug&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>注：<code>path/to/project</code>: 指代填写存放小程序源码的目录地址，文件夹中需要包含有 project.config.json 文件<br><code>path/to/cli</code>: 指代开发者工具 cli 命令路径。macOS: &lt;安装路径&gt;&#x2F;Contents&#x2F;MacOS&#x2F;cli， Windows: &lt;安装路径&gt;&#x2F;cli.bat</p><h3 id="3-3-测试计划配置文件-suite-json"><a href="#3-3-测试计划配置文件-suite-json" class="headerlink" title="3.3 测试计划配置文件 suite.json"></a>3.3 测试计划配置文件 <code>suite.json</code></h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;pkg_list&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;case_list&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;test*&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;pkg&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;test.*_test&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>注：如果在<code>test</code>包下，存在多个<code>*_test.py</code>文件，将顺序执行</p><h2 id="4-编写测试用例"><a href="#4-编写测试用例" class="headerlink" title="4. 编写测试用例"></a>4. 编写测试用例</h2><h3 id="4-1-以企业端“付款开票”主流程测试为例，用户交互流程如下："><a href="#4-1-以企业端“付款开票”主流程测试为例，用户交互流程如下：" class="headerlink" title="4.1 以企业端“付款开票”主流程测试为例，用户交互流程如下："></a>4.1 以企业端“付款开票”主流程测试为例，用户交互流程如下：</h3><p><img src="/./images/%E4%BB%98%E6%AC%BE%E5%BC%80%E7%A5%A8%E6%B5%81%E7%A8%8B.png" alt="付款开票流程"></p><h3 id="4-2-编写测试用例first-test-py-，内容如下："><a href="#4-2-编写测试用例first-test-py-，内容如下：" class="headerlink" title="4.2 编写测试用例first_test.py ，内容如下："></a>4.2 编写测试用例<code>first_test.py</code> ，内容如下：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> minium<br><span class="hljs-keyword">import</span> logging<br><br><span class="hljs-comment"># minitest -m test.ui_pay_and_bill_test -c config.json -g</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PayAndBillTest</span>(minium.MiniTest):<br>    <span class="hljs-comment"># 农产品收购</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_pay_and_bill_ui_op</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-comment"># 判断是否登录</span><br>        <span class="hljs-comment"># 点击付款开票</span><br>        <span class="hljs-variable language_">self</span>.page.get_element(<span class="hljs-string">&quot;view&quot;</span>, inner_text=<span class="hljs-string">&quot;付款开票&quot;</span>).click()<br>        <span class="hljs-variable language_">self</span>.assertTexts([<span class="hljs-string">&quot;农产品收购-增值税普通发票&quot;</span>], <span class="hljs-string">&quot;view&quot;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.page.element_is_exists(<span class="hljs-string">&quot;view&quot;</span>, inner_text=<span class="hljs-string">&quot;农产品收购-增值税普通发票&quot;</span>):<br>            <span class="hljs-variable language_">self</span>.page.get_element(<span class="hljs-string">&quot;view&quot;</span>, inner_text=<span class="hljs-string">&quot;农产品收购-增值税普通发票&quot;</span>).click()<br>            <span class="hljs-comment"># 添加一条商品明细</span><br>            <span class="hljs-variable language_">self</span>.input_detail_op()<br>            <span class="hljs-comment"># 商品明细页 - 保存</span><br>            <span class="hljs-variable language_">self</span>.page.get_elements(<span class="hljs-string">&quot;button&quot;</span>)[<span class="hljs-number">0</span>].click()<br>            <span class="hljs-comment"># 付款开票页 - 下一步</span><br>            time.sleep(<span class="hljs-number">1</span>)<br>            <span class="hljs-variable language_">self</span>.page.get_elements(<span class="hljs-string">&quot;button&quot;</span>)[<span class="hljs-number">1</span>].click()<br>            time.sleep(<span class="hljs-number">1</span>)<br>            <span class="hljs-variable language_">self</span>.page.get_elements(<span class="hljs-string">&quot;button&quot;</span>)[<span class="hljs-number">2</span>].click()<br>            time.sleep(<span class="hljs-number">1</span>)<br>            <span class="hljs-variable language_">self</span>.input_safe_code_op()<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-variable language_">self</span>.assertTrue(<span class="hljs-literal">False</span>, <span class="hljs-string">&quot;农产品收购-增值税普通发票 开票类型不存在&quot;</span>)<br>    <span class="hljs-comment"># @minium.skip(&quot;跳过该用例&quot;)</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">input_detail_op</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-variable language_">self</span>.page.wait_for(<span class="hljs-string">&quot;page &gt; view &gt; view.content-container &gt; view &gt; button&quot;</span>,max_timeout=<span class="hljs-number">2</span>)<br>        <span class="hljs-comment"># 添加明细 按钮</span><br>        <span class="hljs-variable language_">self</span>.page.get_element(<span class="hljs-string">&quot;page &gt; view &gt; view.content-container &gt; view &gt; button&quot;</span>).click()<br>        <span class="hljs-comment"># 选择 商品分类 按钮</span><br>        <span class="hljs-variable language_">self</span>.page.get_element(<span class="hljs-string">&quot;page &gt; view &gt; view.cell-block &gt; view:nth-child(1)&quot;</span>).click()<br>        <span class="hljs-comment"># 选分类</span><br>        <span class="hljs-variable language_">self</span>.page.get_element(<span class="hljs-string">&quot;view&quot;</span>, inner_text=<span class="hljs-string">&quot;海水养殖、捕捞产品&quot;</span>).click()<br>        <span class="hljs-comment"># 选名称</span><br>        time.sleep(<span class="hljs-number">1</span>)<br>        <span class="hljs-variable language_">self</span>.page.get_element(<span class="hljs-string">&quot;view&quot;</span>, inner_text=<span class="hljs-string">&quot;海水鱼&quot;</span>).click()<br>        <span class="hljs-comment"># 输入单价</span><br>        <span class="hljs-variable language_">self</span>.page.get_element(<span class="hljs-string">&#x27;input[aria-label=&quot;单价&quot;]&#x27;</span>).<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;1.01&quot;</span>)<br>        <span class="hljs-comment"># self.native.input_text(&quot;1.01&quot;)</span><br>        <span class="hljs-comment"># 输入数量</span><br>        <span class="hljs-variable language_">self</span>.page.get_element(<span class="hljs-string">&#x27;input[aria-label=&quot;数量&quot;]&#x27;</span>).<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;1&quot;</span>)<br>        <span class="hljs-comment"># 输入单位</span><br>        <span class="hljs-variable language_">self</span>.page.get_element(<span class="hljs-string">&#x27;input[aria-label=&quot;单位&quot;]&#x27;</span>).<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;2&quot;</span>)<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">input_safe_code_op</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-variable language_">self</span>.page.get_element(<span class="hljs-string">&quot;input&quot;</span>).<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;1563&quot;</span>)<br>        <span class="hljs-variable language_">self</span>.page.get_elements(<span class="hljs-string">&quot;button&quot;</span>)[<span class="hljs-number">0</span>].click()<br></code></pre></td></tr></table></figure><h2 id="5-执行测试用例"><a href="#5-执行测试用例" class="headerlink" title="5. 执行测试用例"></a>5. 执行测试用例</h2><h3 id="5-1-命令行执行单个用例"><a href="#5-1-命令行执行单个用例" class="headerlink" title="5.1 命令行执行单个用例"></a>5.1 命令行执行单个用例</h3><ul><li><code>minitest -m test.first_test -c config.json -g</code></li></ul><h3 id="5-2-命令行执行测试计划"><a href="#5-2-命令行执行测试计划" class="headerlink" title="5.2 命令行执行测试计划"></a>5.2 命令行执行测试计划</h3><ul><li><code>minitest -s suite.json -c config.json -g</code></li></ul><h2 id="6-常见问题"><a href="#6-常见问题" class="headerlink" title="6. 常见问题"></a>6. 常见问题</h2><ol><li>执行报错<code>ignore module: test.first_test</code>；- 添加<code>__init__.py</code>文件</li><li>如何快速获取元素</li></ol><ul><li>微信开发者工具，打开调试器右键选中元素，即可快速获取元素的 selector。<br><img src="/./images/selectorDemo@2x.png" alt="快速获取元素"></li></ul><h2 id="minitest-命令行"><a href="#minitest-命令行" class="headerlink" title="minitest 命令行"></a>minitest 命令行</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs stylus">-h, <span class="hljs-attr">--help</span>: 使用帮助。<br>-v, <span class="hljs-attr">--version</span>: 查看 minium 的版本。<br>-<span class="hljs-selector-tag">p</span> PATH/<span class="hljs-attr">--path</span> PATH: 用例所在的文件夹，默认当前路径。<br>-m MODULE_PATH, <span class="hljs-attr">--module</span> MODULE_PATH: 用例的包名或者文件名<br><span class="hljs-attr">--case</span> CASE_NAME: test_开头的用例名<br>-s SUITE, <span class="hljs-attr">--suite</span> SUITE:测试计划文件<br>-c CONFIG, <span class="hljs-attr">--config</span> CONFIG:配置文件名，配置项目参考配置文件<br>-<span class="hljs-selector-tag">g</span>, <span class="hljs-attr">--generate</span>: 生成网页测试报告<br><span class="hljs-attr">--module_search_path</span> <span class="hljs-selector-attr">[SYS_PATH_LIST [SYS_PATH_LIST ...]</span>]: 添加 module 的搜索路径<br>-<span class="hljs-selector-tag">a</span>, <span class="hljs-attr">--accounts</span>: 查看开发者工具当前登录的多账号, 需要通过 <span class="hljs-number">9420</span> 端口,以自动化模式打开开发者工具<br><span class="hljs-attr">--mode</span> RUN_MODE: 选择以<span class="hljs-built_in">parallel</span>(并行)或者<span class="hljs-built_in">fork</span>(复刻)的方式运行用例<br></code></pre></td></tr></table></figure><h2 id="文献"><a href="#文献" class="headerlink" title="文献"></a>文献</h2><ol><li><a href="https://minitest.weixin.qq.com/#/minium/Python/readme">minitest 官网</a></li><li><a href="https://www.runoob.com/python/python-tutorial.html">python 菜鸟教程</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
      <category>小程序</category>
      
    </categories>
    
    
    <tags>
      
      <tag>工程化</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2023-10-11-【小程序】微信小程序开发流程</title>
    <link href="/2025/11/28/2023-10-11-%E3%80%90%E5%B0%8F%E7%A8%8B%E5%BA%8F%E3%80%91%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/"/>
    <url>/2025/11/28/2023-10-11-%E3%80%90%E5%B0%8F%E7%A8%8B%E5%BA%8F%E3%80%91%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="开发基础"><a href="#开发基础" class="headerlink" title="开发基础"></a>开发基础</h1><p>(KM 重拾小程序)[<a href="https://km.woa.com/articles/show/539459?kmref=search&from_page=1&no=5%5D">https://km.woa.com/articles/show/539459?kmref=search&amp;from_page=1&amp;no=5]</a></p><p><a href="https://km.woa.com/articles/show/558607?kmref=search&from_page=1&no=1">km 小程序脚手架</a></p><h1 id="1-小程序开发账号申请"><a href="#1-小程序开发账号申请" class="headerlink" title="1. 小程序开发账号申请"></a>1. 小程序开发账号申请</h1><ol><li><p>申请流程<a href="https://km.woa.com/articles/show/351399?kmref=search&from_page=1&no=1">km 文章参考</a><br>内部申请流程 1、申请内部邮箱；2、申请内部账号</p></li><li><p>获取 AppId（创建小程序项目使用）</p><ul><li>登录<a href="https://mp.weixin.qq.com/">微信公众号官网</a></li></ul></li><li><p>小程序信息设置</p><ul><li>小程序名称（一年最多改 2 次）、简介、图标</li><li>添加开发人员</li><li>开通接口权限</li></ul></li></ol><h1 id="2-框架搭建"><a href="#2-框架搭建" class="headerlink" title="2. 框架搭建"></a>2. 框架搭建</h1><ol><li>由于开发内部项目，这里直接选择 Tdesign 模版进行二次开发</li><li></li></ol><h2 id="1-项目创建"><a href="#1-项目创建" class="headerlink" title="1. 项目创建"></a>1. 项目创建</h2><p>不使用云服务<br>微信云开发</p><h2 id="2-环境配置"><a href="#2-环境配置" class="headerlink" title="2. 环境配置"></a>2. 环境配置</h2><p>开发测试、生产环境区分</p><h2 id="3-研发能力"><a href="#3-研发能力" class="headerlink" title="3. 研发能力"></a>3. 研发能力</h2><h3 id="网络层封装"><a href="#网络层封装" class="headerlink" title="网络层封装"></a>网络层封装</h3><h3 id="pdf-预览"><a href="#pdf-预览" class="headerlink" title="pdf 预览"></a>pdf 预览</h3><h3 id="图片优化"><a href="#图片优化" class="headerlink" title="图片优化"></a>图片优化</h3><h3 id="手机号授权（免费体验-1000-次）"><a href="#手机号授权（免费体验-1000-次）" class="headerlink" title="手机号授权（免费体验 1000 次）"></a>手机号授权（免费体验 1000 次）</h3><h3 id="实名授权，（身份证、姓名匹配）"><a href="#实名授权，（身份证、姓名匹配）" class="headerlink" title="实名授权，（身份证、姓名匹配）"></a>实名授权，（身份证、姓名匹配）</h3><h3 id="身份证识别（）"><a href="#身份证识别（）" class="headerlink" title="身份证识别（）"></a>身份证识别（）</h3><h2 id="3-依赖配置"><a href="#3-依赖配置" class="headerlink" title="3. 依赖配置"></a>3. 依赖配置</h2><h1 id="3-构建与发布"><a href="#3-构建与发布" class="headerlink" title="3. 构建与发布"></a>3. 构建与发布</h1><h2 id="构建"><a href="#构建" class="headerlink" title="构建"></a>构建</h2><h2 id="发布"><a href="#发布" class="headerlink" title="发布"></a>发布</h2><h3 id="1-测试环境发布"><a href="#1-测试环境发布" class="headerlink" title="1. 测试环境发布"></a>1. 测试环境发布</h3><h1 id="4-线上运维"><a href="#4-线上运维" class="headerlink" title="4. 线上运维"></a>4. 线上运维</h1><ol><li>日志查询（开发-》运维中心）</li><li></li></ol>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>脚手架SDK</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2024-02-23 -【vue3性能优化-payBack】避免 DOM 规模过大</title>
    <link href="/2025/11/28/2024-02-23%20-%E3%80%90vue3%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96-payBack%E3%80%91%E9%81%BF%E5%85%8D%20DOM%20%E8%A7%84%E6%A8%A1%E8%BF%87%E5%A4%A7/"/>
    <url>/2025/11/28/2024-02-23%20-%E3%80%90vue3%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96-payBack%E3%80%91%E9%81%BF%E5%85%8D%20DOM%20%E8%A7%84%E6%A8%A1%E8%BF%87%E5%A4%A7/</url>
    
    <content type="html"><![CDATA[<p>LightHouse 分析得出页面 dom 数超 1.5w 个元素</p><ul><li><p>页面分析<br>4 个 tab 页，一次性全部渲染页面（业务需要），其中一个页面 dom 数量占 4&#x2F;5，需重点优化</p></li><li><p>大 tab 页 dom 结构分析</p><p>3 个未分页（业务需要）的自定义大 table 组成，每行至少一个 popover 导致大量 popover 被渲染。</p></li><li><p>优化思路</p></li></ul><ol><li>减少 dom 层级，优化页面中无意义的 dom 嵌套。</li><li>提取 popover 等可复用的组件，降低渲染成本。</li><li>虚拟滚动降低滚动资源消耗（table 总行数 &lt; 1000）</li></ol><ul><li><p>项目背景<br>vue3 + vite + element-plus + typescript</p></li><li><p>考虑到大量 popover 带来了大量的 dom 渲染，首要任务提取 popover，多地共用的方式优先解决</p></li></ul><ol><li>第一步，页面保留一个 popover，去除几百上千个 popover<br>利用 ”虚拟触发“ 向 popover 传入 virtual-ref，在需要的时机 显示 popover，官网示例如下</li></ol><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;buttonRef&quot;</span> <span class="hljs-attr">v-click-outside</span>=<span class="hljs-string">&quot;onClickOutside&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    &gt;</span>Click me&lt;/el-button</span><br><span class="language-xml">  &gt;</span><br><span class="language-xml"></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">el-popover</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;popoverRef&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">:virtual-ref</span>=<span class="hljs-string">&quot;buttonRef&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">trigger</span>=<span class="hljs-string">&quot;click&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;With title&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">virtual-triggering</span></span></span><br><span class="hljs-tag"><span class="language-xml">  &gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span> Some content <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">el-popover</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">import</span> </span></span><span class="hljs-template-variable">&#123; ref, unref &#125;</span><span class="language-xml"><span class="language-javascript"> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">import</span> </span></span><span class="hljs-template-variable">&#123; ClickOutside as vClickOutside &#125;</span><span class="language-xml"><span class="language-javascript"> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;element-plus&#x27;</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">const</span> buttonRef = <span class="hljs-title function_">ref</span>()</span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">const</span> popoverRef = <span class="hljs-title function_">ref</span>()</span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">const</span> <span class="hljs-title function_">onClickOutside</span> = (<span class="hljs-params"></span>) =&gt; </span></span><span class="hljs-template-variable">&#123;</span><br><span class="hljs-template-variable">  unref(popoverRef).popperRef?.delayHide?.()</span><br><span class="hljs-template-variable">&#125;</span><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure><ol start="2"><li>具体实现代码<ul><li>将触发元素 传递给 virtual-ref 即可。</li><li>为保证全局使用组件，利用 provide、inject 跨祖孙组件使用 popover 组件</li></ul></li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml">调用方.vue<br><span class="hljs-comment">&lt;!-- 将触发的dom 传递 给popover --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">span</span></span><br><span class="hljs-tag">    <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;stockRef&quot;</span></span><br><span class="hljs-tag">    @<span class="hljs-attr">mouseover</span>=<span class="hljs-string">&quot;(e: Event) =&gt; handleShowPoper(e, superData)&quot;</span></span><br><span class="hljs-tag">  &gt;</span><br>  ...<br><br><br>   function handleShowPoper(e: Event, superData: any) &#123;<br>      showPoper(e.target, superData);<br>   &#125;<br></code></pre></td></tr></table></figure><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">popover组件<span class="hljs-string">.vue</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>脚手架SDK</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2024-04-09 -【NAS】老旧笔记本NAS黑群晖初体验</title>
    <link href="/2025/11/28/2024-04-09%20-%E3%80%90NAS%E3%80%91%E8%80%81%E6%97%A7%E7%AC%94%E8%AE%B0%E6%9C%ACNAS%E9%BB%91%E7%BE%A4%E6%99%96%E5%88%9D%E4%BD%93%E9%AA%8C/"/>
    <url>/2025/11/28/2024-04-09%20-%E3%80%90NAS%E3%80%91%E8%80%81%E6%97%A7%E7%AC%94%E8%AE%B0%E6%9C%ACNAS%E9%BB%91%E7%BE%A4%E6%99%96%E5%88%9D%E4%BD%93%E9%AA%8C/</url>
    
    <content type="html"><![CDATA[<h1 id="前置条件"><a href="#前置条件" class="headerlink" title="前置条件"></a>前置条件</h1><ol><li>4G U 盘一个</li><li>老旧笔记本，能开机内存 &gt; 4G</li><li>盘位扩充方案，硬盘盒&#x2F;硬盘矩阵柜（按需购买、非必须 几十-200 能用就行）</li><li>硬盘选购，家庭使用蓝盘、紫盘、红盘均可（按需购买、非必须）</li></ol><h1 id="诉求梳理"><a href="#诉求梳理" class="headerlink" title="诉求梳理"></a>诉求梳理</h1><p>大多数新手了解到 nas 最常见的需求顶多就是 家庭相册 + 家庭影音，与传统云盘相比由于 nas 本地存储的特性，数据较为安全可靠，在内网使用时传输效率极高更具优势；而办公用途重要文件共享也是 nas 的优势之一。</p><p>作为尝鲜体验，并且可以将老旧电脑发挥余热，对于喜欢折腾的小伙伴相当愉悦。</p><h1 id="第一步：黑群晖安装"><a href="#第一步：黑群晖安装" class="headerlink" title="第一步：黑群晖安装"></a>第一步：黑群晖安装</h1><p>下载：镜像包 U 盘写盘器</p><h1 id="第二步：常用套件安装"><a href="#第二步：常用套件安装" class="headerlink" title="第二步：常用套件安装"></a>第二步：常用套件安装</h1><ol><li>套件中心扩展，可获得更多套件体验</li><li>docker 套件<br>有了 docker 的加入，黑群晖的可玩性会更加丰富。</li><li>jellyfin（家庭影音）</li><li>photoprism（ai 相册，可实现人脸识别）</li><li>frp（外网访问）内网穿透 frps、frpc</li></ol><h1 id="第三步：备份方案（非必须）"><a href="#第三步：备份方案（非必须）" class="headerlink" title="第三步：备份方案（非必须）"></a>第三步：备份方案（非必须）</h1>]]></content>
    
    
    <categories>
      
      <category>NAS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NAS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2024-04-10 -【NAS】老旧笔记本NAS黑群晖半洗白</title>
    <link href="/2025/11/28/2024-04-10%20-%E3%80%90NAS%E3%80%91%E8%80%81%E6%97%A7%E7%AC%94%E8%AE%B0%E6%9C%ACNAS%E9%BB%91%E7%BE%A4%E6%99%96%E5%8D%8A%E6%B4%97%E7%99%BD/"/>
    <url>/2025/11/28/2024-04-10%20-%E3%80%90NAS%E3%80%91%E8%80%81%E6%97%A7%E7%AC%94%E8%AE%B0%E6%9C%ACNAS%E9%BB%91%E7%BE%A4%E6%99%96%E5%8D%8A%E6%B4%97%E7%99%BD/</url>
    
    <content type="html"><![CDATA[<h1 id="黑群晖洗白"><a href="#黑群晖洗白" class="headerlink" title="黑群晖洗白"></a>黑群晖洗白</h1><h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><ol><li>全洗白</li><li>半洗白</li></ol><h2 id="为什么要洗白"><a href="#为什么要洗白" class="headerlink" title="为什么要洗白"></a>为什么要洗白</h2>]]></content>
    
    
    <categories>
      
      <category>NAS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>洗白</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2024-04-11 -【NAS】老旧笔记本NAS黑群晖内网穿透</title>
    <link href="/2025/11/28/2024-04-11%20-%E3%80%90NAS%E3%80%91%E8%80%81%E6%97%A7%E7%AC%94%E8%AE%B0%E6%9C%ACNAS%E9%BB%91%E7%BE%A4%E6%99%96%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/"/>
    <url>/2025/11/28/2024-04-11%20-%E3%80%90NAS%E3%80%91%E8%80%81%E6%97%A7%E7%AC%94%E8%AE%B0%E6%9C%ACNAS%E9%BB%91%E7%BE%A4%E6%99%96%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/</url>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>黑群晖远程访问的手段有很多，根据条件的不同可选方式如下：<br><a href="https://imnks.com/4406.html">黑群晖的远程访问</a></p><p>当局域网设备不具备公网 IP，无法通过公网访问，但刚好有一台公有云服务器，可通过内网穿透手段实现局域网设备公网访问。<br>内网穿透方式常见的有<a href="https://imnks.com/3489.html">NPS</a> - <a href="http://github.com/cnlh/nps">开源地址</a>、<a href="https://imnks.com/4287.html">FRP</a> - <a href="https://github.com/fatedier/frp">开源地址</a></p><h1 id="前置条件-frp-方式"><a href="#前置条件-frp-方式" class="headerlink" title="前置条件 frp 方式"></a>前置条件 frp 方式</h1><ol><li>一台公网服务器（作为 FRPS，实现内网穿透）；</li><li>Nas 一台（作为 FRP 客户端）</li><li>域名解析至公网服务器</li><li>为域名申请证书，并上传至 Nas</li></ol><h2 id="穿透配置"><a href="#穿透配置" class="headerlink" title="穿透配置"></a>穿透配置</h2><h2 id="1-服务器端（公网-IP-服务器）安装-配置"><a href="#1-服务器端（公网-IP-服务器）安装-配置" class="headerlink" title="1. 服务器端（公网 IP 服务器）安装&amp;配置"></a>1. 服务器端（公网 IP 服务器）安装&amp;配置</h2><h3 id="1-1-frp-包下载-release-记录"><a href="#1-1-frp-包下载-release-记录" class="headerlink" title="1.1 frp 包下载 release 记录"></a>1.1 frp 包下载 <a href="https://github.com/fatedier/frp/releases">release 记录</a></h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># 切入目标目录</span><br><span class="hljs-attribute">cd</span> /etc/frp<br><span class="hljs-comment"># 下载软件包</span><br><span class="hljs-attribute">wget</span> https://github.com/fatedier/frp/releases/download/v0.<span class="hljs-number">57</span>.<span class="hljs-number">0</span>/frp_0.<span class="hljs-number">57</span>.<span class="hljs-number">0</span>_linux_amd64.tar.gz<br><span class="hljs-comment"># 解压</span><br><span class="hljs-attribute">tar</span> xf frp_0.<span class="hljs-number">57</span>.<span class="hljs-number">0</span>_linux_amd64.tar.gz<br><span class="hljs-comment"># 进入目录</span><br><span class="hljs-attribute">cd</span> frp_0.<span class="hljs-number">57</span>.<span class="hljs-number">0</span>_linux_amd64<br></code></pre></td></tr></table></figure><h3 id="1-2-修改frps-ini配置"><a href="#1-2-修改frps-ini配置" class="headerlink" title="1.2 修改frps.ini配置"></a>1.2 修改<code>frps.ini</code>配置</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">vim</span> frps.ini<br></code></pre></td></tr></table></figure><ul><li>按需修改配置 如下：</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs t">bind_port = 7766<br># token 认证 按需更改<br>token=xxx<br># frp管理后台端口，请按自己需求更改<br># dashboard_port = 7776<br># frp管理后台用户名和密码，请改成自己的<br># dashboard_user = admin<br># dashboard_pwd = admin<br></code></pre></td></tr></table></figure><h3 id="2-2-启动"><a href="#2-2-启动" class="headerlink" title="2.2 启动"></a>2.2 启动</h3><ul><li>方法 1：使用 systemctl 配置后台运行和开机自启</li></ul><ol><li><code>sudo vim /lib/systemd/system/frps.service </code></li><li>在 frps.service 里写入以下内容</li></ol><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Unit]</span><br><span class="hljs-attr">Description</span>=fraps service<br><span class="hljs-attr">After</span>=network.target syslog.target<br><span class="hljs-attr">Wants</span>=network.target<br><br><span class="hljs-section">[Service]</span><br><span class="hljs-attr">Type</span>=simple<br><span class="hljs-comment">#启动服务的命令（此处写你的frps的实际安装目录）</span><br><span class="hljs-attr">ExecStart</span>=/etc/frp/frps -c /etc/frp/frps.ini<br><br><span class="hljs-section">[Install]</span><br><span class="hljs-attr">WantedBy</span>=multi-user.target<br></code></pre></td></tr></table></figure><ol start="3"><li>启动 frps</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> systemctl start frps<br><span class="hljs-comment">#打开自启动</span><br><span class="hljs-built_in">sudo</span> systemctl <span class="hljs-built_in">enable</span> frps<br></code></pre></td></tr></table></figure><p>注：其他操作</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">如果要重启应用，<span class="hljs-built_in">sudo</span> systemctl restart frps<br>如果要停止应用，<span class="hljs-built_in">sudo</span> systemctl stop frps<br>如果要查看应用的日志，<span class="hljs-built_in">sudo</span> systemctl status frps<br></code></pre></td></tr></table></figure><ul><li>方法 2：后台启动</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 直接命令后台启动，注意 最后的 &amp; 代表后台运行，不能缺失</span><br><span class="hljs-built_in">nohup</span> ./frps -c frps.ini &amp;<br></code></pre></td></tr></table></figure><p>注：<a href="https://www.runoob.com/linux/linux-comm-nohup.html">nohup 命令 linux</a></p><h2 id="3-客户端-插件安装-配置"><a href="#3-客户端-插件安装-配置" class="headerlink" title="3. 客户端 插件安装&amp;配置"></a>3. 客户端 插件安装&amp;配置</h2><ol><li>黑群晖插件安装及使用(frpc 内网穿透客户端)</li></ol><ul><li>打开套件中心，搜索 frpc 客户端 安装并打开</li></ul><ol start="2"><li>配置，按需暴露端口即可</li></ol><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[common]</span><br><span class="hljs-attr">server_addr</span> = xxxx<br><span class="hljs-attr">server_port</span> = <span class="hljs-number">7766</span><br><span class="hljs-attr">token</span> = xxx<br><br><span class="hljs-section">[ssh]</span><br><span class="hljs-comment"># type = tcp</span><br><span class="hljs-comment"># local_ip = 192.168.xx.xx</span><br><span class="hljs-comment"># local_port = 22</span><br><span class="hljs-comment"># remote_port = 7022</span><br><br><span class="hljs-section">[dsm]</span><br><span class="hljs-attr">type</span> = tcp<br><span class="hljs-attr">local_ip</span> = <span class="hljs-number">192.168</span>.xx.xx<br><span class="hljs-attr">local_port</span> = <span class="hljs-number">5000</span><br><span class="hljs-attr">remote_port</span> = <span class="hljs-number">5000</span><br><br><span class="hljs-section">[dsm_https]</span><br><span class="hljs-attr">type</span> = tcp<br><span class="hljs-attr">local_ip</span> = <span class="hljs-number">192.168</span>.xx.xx<br><span class="hljs-attr">local_port</span> = <span class="hljs-number">5001</span><br><span class="hljs-attr">remote_port</span> = <span class="hljs-number">5001</span><br><br><span class="hljs-section">[photo_prism]</span><br><span class="hljs-attr">type</span> = tcp<br><span class="hljs-attr">local_ip</span> = <span class="hljs-number">192.168</span>.xx.xx<br><span class="hljs-attr">local_port</span> = <span class="hljs-number">2342</span><br><span class="hljs-attr">remote_port</span> = <span class="hljs-number">7342</span><br><br><span class="hljs-section">[photo_jellyfin]</span><br><span class="hljs-attr">type</span> = tcp<br><span class="hljs-attr">local_ip</span> = <span class="hljs-number">192.168</span>.xx.xx<br><span class="hljs-attr">local_port</span> = <span class="hljs-number">8096</span><br><span class="hljs-attr">remote_port</span> = <span class="hljs-number">7096</span><br></code></pre></td></tr></table></figure><h1 id="安全问题"><a href="#安全问题" class="headerlink" title="安全问题"></a>安全问题</h1><ul><li>frp 仅负责转发，安全问题应该放在，但是端口的暴漏，会存在攻击者一旦知道访问端口，流量激增的问题。</li><li><a href="https://juejin.cn/post/7130640908298485768">stcp</a> 方式限制访问入口</li></ul>]]></content>
    
    
    <categories>
      
      <category>NAS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>内网穿透</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2024-03-04 -【vue3性能优化-payBack】表格内容高亮</title>
    <link href="/2025/11/28/2024-03-04%20-%E3%80%90vue3%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96-payBack%E3%80%91%E8%A1%A8%E6%A0%BC%E5%86%85%E5%AE%B9%E9%AB%98%E4%BA%AE/"/>
    <url>/2025/11/28/2024-03-04%20-%E3%80%90vue3%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96-payBack%E3%80%91%E8%A1%A8%E6%A0%BC%E5%86%85%E5%AE%B9%E9%AB%98%E4%BA%AE/</url>
    
    <content type="html"><![CDATA[<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><ol><li>v-html 替换原内容方式 高亮</li><li>交互上，通过关键字提取，替换原数据中的普通文本 为高亮文本</li><li>触发 vue3 reactive 变量进行数据重置 重绘局部页面</li></ol><figure class="highlight nim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs nim"><span class="hljs-keyword">export</span> function highlightKeyWord(<span class="hljs-built_in">result</span>: <span class="hljs-type">string</span>, keyword: <span class="hljs-type">string</span>) &#123;<br>  <span class="hljs-keyword">if</span> (keyword &amp;&amp; <span class="hljs-built_in">result</span>) &#123;<br>    /**<br>     * 使用正则表达式进行全文匹配关键词<br>     * ig : 表示 全文查找 ,忽略大小写<br>     *  i : 忽略大小写<br>     *  g : 全文查找<br>    *<br>    * 使用字符串的replace方法进行替换<br>    * stringObject.replace(&#x27;被替换的值&#x27;,替换的值)<br>    */<br>    <span class="hljs-keyword">const</span> replaceReg = new <span class="hljs-type">RegExp</span>(keyword, &#x27;ig&#x27;);<br>    <span class="hljs-keyword">const</span> replaceString = `&lt;span class=<span class="hljs-string">&quot;searchWord&quot;</span>&gt;$&#123;keyword&#125;&lt;/span&gt;`;<br>    <span class="hljs-built_in">result</span> = <span class="hljs-built_in">result</span>.replace(replaceReg, replaceString);<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">result</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs lasso">function handleKeyWordClick(key: <span class="hljs-built_in">string</span>) &#123;<br>  <span class="hljs-built_in">data</span>.<span class="hljs-built_in">keyword</span> = key;<br><br>  <span class="hljs-comment">// 过滤个股数据，并排序</span><br>  <span class="hljs-comment">// 修改父组件传过来的值；将重新渲染整个 table 数据，让数据高亮</span><br>  <span class="hljs-comment">// emit(&#x27;update:currentDateData&#x27;, _.cloneDeep(superData.currentDateData));</span><br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>脚手架SDK</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2024-04-20-【小程序】微信小程序研发小技巧</title>
    <link href="/2025/11/28/2024-04-20-%E3%80%90%E5%B0%8F%E7%A8%8B%E5%BA%8F%E3%80%91%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%A0%94%E5%8F%91%E5%B0%8F%E6%8A%80%E5%B7%A7/"/>
    <url>/2025/11/28/2024-04-20-%E3%80%90%E5%B0%8F%E7%A8%8B%E5%BA%8F%E3%80%91%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%A0%94%E5%8F%91%E5%B0%8F%E6%8A%80%E5%B7%A7/</url>
    
    <content type="html"><![CDATA[<h1 id="研发能力-验证"><a href="#研发能力-验证" class="headerlink" title="研发能力 验证"></a>研发能力 验证</h1><h3 id="开发测试、生产环境区分"><a href="#开发测试、生产环境区分" class="headerlink" title="开发测试、生产环境区分"></a>开发测试、生产环境区分</h3><ul><li>env.config.js</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> envConf = &#123;<br>  <span class="hljs-comment">// 开发版-本地环境</span><br>  <span class="hljs-attr">develop</span>: &#123;<br>    <span class="hljs-attr">mode</span>: <span class="hljs-string">&quot;dev&quot;</span>,<br>    <span class="hljs-comment">// apiBaseUrl: &quot;http://9.134.35.45:14002/wpeMiniweRecycleSrv&quot;,</span><br>    <span class="hljs-attr">apiBaseUrl</span>: <span class="hljs-string">&quot;https://tserver.wpe.tencent.com&quot;</span>,<br>  &#125;,<br>  <span class="hljs-comment">// 体验版-测试环境</span><br>  <span class="hljs-attr">trial</span>: &#123;<br>    <span class="hljs-attr">mode</span>: <span class="hljs-string">&quot;test&quot;</span>,<br>    <span class="hljs-attr">apiBaseUrl</span>: <span class="hljs-string">&quot;https://tserver.wpe.tencent.com&quot;</span>,<br>  &#125;,<br>  <span class="hljs-comment">// 正式版-正式环境</span><br>  <span class="hljs-attr">release</span>: &#123;<br>    <span class="hljs-attr">mode</span>: <span class="hljs-string">&quot;prod&quot;</span>,<br>    <span class="hljs-attr">apiBaseUrl</span>: <span class="hljs-string">&quot;https://server.wpe.tencent.com&quot;</span>,<br>  &#125;,<br>&#125;;<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">env</span>: envConf[wx.<span class="hljs-title function_">getAccountInfoSync</span>().<span class="hljs-property">miniProgram</span>.<span class="hljs-property">envVersion</span>],<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="网络层封装"><a href="#网络层封装" class="headerlink" title="网络层封装"></a>网络层封装</h3><ul><li>request.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123;<br>  requestBefore,<br>  requestError,<br>  responseReject,<br>  responseResolve,<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./request-interceptors&quot;</span>;<br><br><span class="hljs-keyword">import</span> &#123; env &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../env.config&quot;</span>;<br><br><span class="hljs-keyword">const</span> &#123; apiBaseUrl &#125; = env;<br><span class="hljs-keyword">const</span> prefix = <span class="hljs-string">&quot;xxx&quot;</span>;<br><span class="hljs-keyword">let</span> requestTask = <span class="hljs-literal">null</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">wxrequest</span> = (<span class="hljs-params">&#123; url, data = &#123;&#125;, header = &#123;&#125;, method = <span class="hljs-string">&quot;POST&quot;</span> &#125;</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> app = <span class="hljs-title function_">getApp</span>();<br>  <span class="hljs-keyword">const</span> &#123; token, openId &#125; = app?.<span class="hljs-property">globalData</span> || &#123;&#125;;<br>  <span class="hljs-keyword">const</span> requestHeader = &#123; token, openId, <span class="hljs-attr">sessionCheckPass</span>: <span class="hljs-string">&quot;true&quot;</span> &#125;;<br>  url = url.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/(^\s*)|(\s*$)/g</span>, <span class="hljs-string">&quot;&quot;</span>); <span class="hljs-comment">// 去掉url左右空格</span><br>  <span class="hljs-keyword">const</span> reqHeader = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(&#123;&#125;, requestHeader, header);<br>  <span class="hljs-keyword">const</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    requestTask = wx.<span class="hljs-title function_">request</span>(&#123;<br>      <span class="hljs-attr">url</span>: <span class="hljs-string">`<span class="hljs-subst">$&#123;apiBaseUrl&#125;</span><span class="hljs-subst">$&#123;prefix&#125;</span><span class="hljs-subst">$&#123;url&#125;</span>`</span>,<br>      data,<br>      <span class="hljs-attr">header</span>: reqHeader,<br>      <span class="hljs-attr">method</span>: method,<br>      <span class="hljs-attr">dataType</span>: <span class="hljs-string">&quot;json&quot;</span>,<br>      <span class="hljs-attr">responseType</span>: <span class="hljs-string">&quot;text&quot;</span>,<br>      <span class="hljs-attr">success</span>: <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>        <span class="hljs-title function_">resolve</span>(res);<br>      &#125;,<br>      <span class="hljs-attr">fail</span>: <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;<br>        <span class="hljs-title function_">reject</span>(err);<br>      &#125;,<br>    &#125;);<br>  &#125;);<br>  promise.<span class="hljs-property">requestTask</span> = requestTask;<br>  <span class="hljs-keyword">return</span> promise;<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">interceptorsRequest</span> = (<span class="hljs-params">options</span>) =&gt; &#123;<br>  <span class="hljs-keyword">try</span> &#123;<br>    options = <span class="hljs-title function_">requestBefore</span>(options);<br>  &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">requestError</span>(error);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">wxrequest</span>(options)<br>    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> <span class="hljs-title function_">responseResolve</span>(response))<br>    .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>      <span class="hljs-comment">// 200 error.error.message统一处理</span><br>      <span class="hljs-keyword">if</span> (error?.<span class="hljs-property">error</span>?.<span class="hljs-property">message</span>) &#123;<br>        wx.<span class="hljs-title function_">showModal</span>(&#123;<br>          <span class="hljs-attr">content</span>: error?.<span class="hljs-property">error</span>?.<span class="hljs-property">message</span>,<br>          <span class="hljs-attr">showCancel</span>: <span class="hljs-literal">false</span>,<br>        &#125;);<br>      &#125;<br>      wx.<span class="hljs-title function_">hideLoading</span>();<br>      <span class="hljs-keyword">return</span> <span class="hljs-title function_">responseReject</span>(error);<br>    &#125;);<br>&#125;;<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">request</span>: interceptorsRequest,<br>  <span class="hljs-comment">// request: wxrequest,</span><br>&#125;;<br></code></pre></td></tr></table></figure><ul><li>request-interceptors.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123;<br>  loopAndFormat,<br>  toCamelCase,<br>  toPascal,<br>  cloneDeep,<br>  typeOf,<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./utils&quot;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">configToCamelCase</span> = (<span class="hljs-params">config</span>) =&gt; <span class="hljs-title function_">loopAndFormat</span>(<span class="hljs-literal">null</span>, config, toCamelCase);<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">errorResult</span> = (<span class="hljs-params">data, returnData</span>) =&gt; (&#123;<br>  <span class="hljs-attr">error</span>: &#123;<br>    ...data,<br>  &#125;,<br>  ...returnData,<br>&#125;);<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 统一处理错误日志打印</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> <span class="hljs-variable">res</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span> &#123;<span class="hljs-type">boolean</span>&#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">errLog</span> = (<span class="hljs-params">res</span>) =&gt; &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<br>    <span class="hljs-string">&quot;接口非0啦！错误信息看这里！&quot;</span>,<br>    <span class="hljs-string">&quot;\n responseURL:&quot;</span>,<br>    res.<span class="hljs-property">request</span>?.<span class="hljs-property">responseURL</span>,<br>    <span class="hljs-string">&quot;\n data: &quot;</span>,<br>    res.<span class="hljs-property">data</span>,<br>    <span class="hljs-string">&quot;\n all message: &quot;</span>,<br>    res<br>  );<br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * response拦截器成功回调</span><br><span class="hljs-comment"> * 旧：所有接口errcode返回0才正常返回resolve</span><br><span class="hljs-comment"> *    非0都reject出去</span><br><span class="hljs-comment"> * 新：有Response.Data才正常resolve</span><br><span class="hljs-comment"> *    有Response.Error的reject出去</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> <span class="hljs-variable">res</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span> &#123;<span class="hljs-type">*</span>&#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">responseResolve</span> = (<span class="hljs-params">res</span>) =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">typeOf</span>(res) === <span class="hljs-string">&quot;undefined&quot;</span>) &#123;<br>    <span class="hljs-title function_">errLog</span>(res);<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;response is undefined&quot;</span>));<br>  &#125;<br>  <span class="hljs-keyword">const</span> &#123; data = &#123;&#125;, config = &#123;&#125; &#125; = res;<br>  <span class="hljs-keyword">if</span> (!config.<span class="hljs-property">hideLoading</span>) &#123;<br>    <span class="hljs-comment">// 隐藏loading</span><br>    wx.<span class="hljs-title function_">hideLoading</span>();<br>  &#125;<br><br>  <span class="hljs-keyword">const</span> returnData = &#123;<br>    <span class="hljs-attr">reqConfig</span>: &#123;<br>      ...<span class="hljs-title function_">configToCamelCase</span>(config),<br>    &#125;,<br>  &#125;;<br><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * 新规范返回值</span><br><span class="hljs-comment">   *  - 把接口中的对象key的大驼峰处理为小驼峰</span><br><span class="hljs-comment">   *  - 把接口中与分页相关的数值转换为整形（暂无需实现）</span><br><span class="hljs-comment">   *  - 处理完，再返回给前端</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-keyword">if</span> (data.<span class="hljs-property">Response</span>) &#123;<br>    <span class="hljs-keyword">if</span> (data.<span class="hljs-property">Response</span>.<span class="hljs-property">Data</span> !== <span class="hljs-literal">undefined</span>) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(<br>        <span class="hljs-title function_">loopAndFormat</span>(<span class="hljs-literal">null</span>, data.<span class="hljs-property">Response</span>.<span class="hljs-property">Data</span>, toCamelCase),<br>        returnData<br>      );<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 返回体中无Data，打印日志并直接把整个Response丢出去</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-title function_">errLog</span>(res);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<br>      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(<span class="hljs-title function_">loopAndFormat</span>(<span class="hljs-literal">null</span>, data.<span class="hljs-property">Response</span>, toCamelCase), returnData)<br>    );<br>  &#125;<br><br>  <span class="hljs-comment">// 所有情况都不符合，直接返回整个response结构</span><br>  <span class="hljs-comment">// return &#123; ...res &#125;;</span><br><br>  <span class="hljs-comment">// 返回res的data</span><br>  <span class="hljs-keyword">return</span> res.<span class="hljs-property">data</span>;<br>&#125;;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * response拦截器失败函数，以下情况会进入：</span><br><span class="hljs-comment"> * 1. 【直接进入】网络错误(httpCode !== 2xx)</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> <span class="hljs-variable">error</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span> &#123;<span class="hljs-type">Promise&lt;never&gt;</span>&#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">responseReject</span> = (<span class="hljs-params">error</span>) =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (error &amp;&amp; error.<span class="hljs-property">response</span>) &#123;<br>    <span class="hljs-keyword">const</span> &#123; config = &#123;&#125;, data = &#123;&#125; &#125; = error.<span class="hljs-property">response</span>;<br>    <span class="hljs-keyword">if</span> (!config.<span class="hljs-property">hideLoading</span>) &#123;<br>      <span class="hljs-comment">// 隐藏loading</span><br>      wx.<span class="hljs-title function_">hideLoading</span>();<br>    &#125;<br><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;=====&gt; statusCode no 2xx,Reject: &quot;</span>, error.<span class="hljs-property">response</span>);<br><br>    <span class="hljs-comment">// 定义一个返回对象，把config也给注入进去</span><br>    <span class="hljs-keyword">const</span> returnData = &#123;<br>      <span class="hljs-attr">reqConfig</span>: &#123;<br>        ...<span class="hljs-title function_">configToCamelCase</span>(config),<br>      &#125;,<br>    &#125;;<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">typeOf</span>(data) === <span class="hljs-string">&quot;object&quot;</span>) &#123;<br>      <span class="hljs-comment">/**</span><br><span class="hljs-comment">       * 新版接口规范把接口返回的错误信息转换后抛出去</span><br><span class="hljs-comment">       */</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<br>        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(<br>          <span class="hljs-title function_">loopAndFormat</span>(<span class="hljs-literal">null</span>, data.<span class="hljs-property">Response</span>, toCamelCase),<br>          returnData<br>        )<br>      );<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<br>      <span class="hljs-title function_">errorResult</span>(<br>        &#123;<br>          <span class="hljs-attr">data</span>: error.<span class="hljs-property">response</span>.<span class="hljs-property">data</span>,<br>          <span class="hljs-attr">status</span>: error.<span class="hljs-property">response</span>.<span class="hljs-property">status</span>,<br>          <span class="hljs-attr">statusText</span>: error.<span class="hljs-property">response</span>.<span class="hljs-property">statusText</span>,<br>          <span class="hljs-attr">headers</span>: error.<span class="hljs-property">response</span>.<span class="hljs-property">headers</span>,<br>        &#125;,<br>        returnData<br>      )<br>    );<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error || <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;Unknown Network Error&quot;</span>));<br>&#125;;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * request前置拦截处理</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> <span class="hljs-variable">config</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span> &#123;<span class="hljs-type">&#123;hideLoading</span>&#125;|*&#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">requestBefore</span> = (<span class="hljs-params">config</span>) =&gt; &#123;<br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   *  - 把接口请求中的data、params对象中的小驼峰转为大驼峰</span><br><span class="hljs-comment">   *  - 把接口中的几个与分页相关的值改为字符串</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-keyword">if</span> (config.<span class="hljs-property">data</span>) &#123;<br>    <span class="hljs-keyword">const</span> data = <span class="hljs-title function_">cloneDeep</span>(config.<span class="hljs-property">data</span>);<br>    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(config, &#123;<br>      <span class="hljs-attr">data</span>: <span class="hljs-title function_">loopAndFormat</span>(<span class="hljs-literal">null</span>, data, toPascal),<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-keyword">if</span> (config.<span class="hljs-property">params</span>) &#123;<br>    <span class="hljs-keyword">const</span> params = <span class="hljs-title function_">cloneDeep</span>(config.<span class="hljs-property">params</span>);<br>    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(config, &#123;<br>      <span class="hljs-attr">params</span>: <span class="hljs-title function_">loopAndFormat</span>(<span class="hljs-literal">null</span>, params, toPascal),<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-keyword">if</span> (!config.<span class="hljs-property">hideLoading</span>) &#123;<br>    <span class="hljs-comment">// loading</span><br>    wx.<span class="hljs-title function_">showLoading</span>(&#123;<br>      <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;加载中...&quot;</span>,<br>    &#125;);<br>  &#125;<br>  <span class="hljs-keyword">return</span> config;<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">requestError</span> = (<span class="hljs-params">error</span>) =&gt; <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  requestBefore,<br>  requestError,<br>  responseReject,<br>  responseResolve,<br>&#125;;<br></code></pre></td></tr></table></figure><ul><li>utils.js</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">loopAndFormat</span> = (<span class="hljs-params">key, obj, keyFormatter, valueFormatter</span>) =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> obj === <span class="hljs-string">&quot;object&quot;</span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(obj)) &#123;<br>      <span class="hljs-keyword">return</span> obj.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">v</span>) =&gt;</span><br>        <span class="hljs-title function_">loopAndFormat</span>(<span class="hljs-literal">null</span>, v, keyFormatter, valueFormatter)<br>      );<br>    &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> obj) &#123;<br>      <span class="hljs-keyword">const</span> val = obj[key];<br>      <span class="hljs-keyword">const</span> newKey =<br>        <span class="hljs-keyword">typeof</span> keyFormatter === <span class="hljs-string">&quot;function&quot;</span> ? <span class="hljs-title function_">keyFormatter</span>(key, val) : key;<br>      obj[newKey] = <span class="hljs-title function_">loopAndFormat</span>(key, val, keyFormatter, valueFormatter);<br>      <span class="hljs-keyword">if</span> (newKey !== key) &#123;<br>        <span class="hljs-keyword">delete</span> obj[key];<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> obj;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> valueFormatter === <span class="hljs-string">&quot;function&quot;</span> ? <span class="hljs-title function_">valueFormatter</span>(key, obj) : obj;<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">toPascal</span> = (<span class="hljs-params">str</span>) =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> str === <span class="hljs-string">&quot;string&quot;</span> &amp;&amp; str) &#123;<br>    <span class="hljs-keyword">return</span> str.<span class="hljs-title function_">replace</span>(str[<span class="hljs-number">0</span>], str[<span class="hljs-number">0</span>].<span class="hljs-title function_">toUpperCase</span>());<br>  &#125;<br>  <span class="hljs-keyword">return</span> str;<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">toCamelCase</span> = (<span class="hljs-params">str</span>) =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> str === <span class="hljs-string">&quot;string&quot;</span> &amp;&amp; str) &#123;<br>    <span class="hljs-keyword">return</span> str.<span class="hljs-title function_">replace</span>(str[<span class="hljs-number">0</span>], str[<span class="hljs-number">0</span>].<span class="hljs-title function_">toLowerCase</span>());<br>  &#125;<br>  <span class="hljs-keyword">return</span> str;<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">typeOf</span> = (<span class="hljs-params">obj</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> &#123; toString &#125; = <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>;<br>  <span class="hljs-keyword">const</span> map = &#123;<br>    <span class="hljs-string">&quot;[object Boolean]&quot;</span>: <span class="hljs-string">&quot;boolean&quot;</span>,<br>    <span class="hljs-string">&quot;[object Number]&quot;</span>: <span class="hljs-string">&quot;number&quot;</span>,<br>    <span class="hljs-string">&quot;[object String]&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,<br>    <span class="hljs-string">&quot;[object Function]&quot;</span>: <span class="hljs-string">&quot;function&quot;</span>,<br>    <span class="hljs-string">&quot;[object Array]&quot;</span>: <span class="hljs-string">&quot;array&quot;</span>,<br>    <span class="hljs-string">&quot;[object Date]&quot;</span>: <span class="hljs-string">&quot;date&quot;</span>,<br>    <span class="hljs-string">&quot;[object RegExp]&quot;</span>: <span class="hljs-string">&quot;regExp&quot;</span>,<br>    <span class="hljs-string">&quot;[object Undefined]&quot;</span>: <span class="hljs-string">&quot;undefined&quot;</span>,<br>    <span class="hljs-string">&quot;[object Null]&quot;</span>: <span class="hljs-string">&quot;null&quot;</span>,<br>    <span class="hljs-string">&quot;[object Event]&quot;</span>: <span class="hljs-string">&quot;event&quot;</span>,<br>    <span class="hljs-string">&quot;[object Object]&quot;</span>: <span class="hljs-string">&quot;object&quot;</span>,<br>    <span class="hljs-string">&quot;[object MouseEvent]&quot;</span>: <span class="hljs-string">&quot;mouseEvent&quot;</span>,<br>  &#125;;<br>  <span class="hljs-keyword">return</span> map[toString.<span class="hljs-title function_">call</span>(obj)];<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">cloneDeep</span> = (<span class="hljs-params">obj, hash = <span class="hljs-keyword">new</span> <span class="hljs-built_in">WeakMap</span>()</span>) =&gt; &#123;<br>  <span class="hljs-comment">// 如果obj为null或者不是对象和数组，那么直接返回</span><br>  <span class="hljs-keyword">if</span> (obj == <span class="hljs-literal">null</span> || <span class="hljs-keyword">typeof</span> obj !== <span class="hljs-string">&quot;object&quot;</span>) <span class="hljs-keyword">return</span> obj;<br><br>  <span class="hljs-comment">// 如果obj是循环引用的情况，那么直接返回</span><br>  <span class="hljs-keyword">if</span> (hash.<span class="hljs-title function_">has</span>(obj)) <span class="hljs-keyword">return</span> hash.<span class="hljs-title function_">get</span>(obj);<br><br>  <span class="hljs-keyword">const</span> isArray = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(obj);<br>  <span class="hljs-comment">// 创建新的对象或者数组</span><br>  <span class="hljs-keyword">const</span> t = isArray ? [] : &#123;&#125;;<br><br>  <span class="hljs-comment">// 在hash表中存入当前对象与克隆对象</span><br>  hash.<span class="hljs-title function_">set</span>(obj, t);<br><br>  <span class="hljs-keyword">if</span> (isArray) &#123;<br>    obj.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> &#123;<br>      <span class="hljs-comment">// 如果元素是引用数据类型，递归复制</span><br>      t[index] = <span class="hljs-title function_">cloneDeep</span>(item, hash);<br>    &#125;);<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(obj).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">key</span>) =&gt;</span> &#123;<br>      t[key] = <span class="hljs-title function_">cloneDeep</span>(obj[key], hash);<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> t;<br>&#125;;<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  loopAndFormat,<br>  toPascal,<br>  toCamelCase,<br>  typeOf,<br>  cloneDeep,<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="pdf-预览"><a href="#pdf-预览" class="headerlink" title="pdf 预览"></a>pdf 预览</h3><ul><li><ol><li>base64 预览</li></ol></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">previewPdf</span> = (<span class="hljs-params">base64Pdf, fileName = <span class="hljs-string">&quot;temp&quot;</span></span>) =&gt; &#123;<br>  <span class="hljs-comment">// 将 Base64 数据转换为 ArrayBuffer</span><br>  <span class="hljs-keyword">const</span> base64Data = base64Pdf;<br>  <span class="hljs-keyword">const</span> arrayBuffer = wx.<span class="hljs-title function_">base64ToArrayBuffer</span>(base64Data);<br><br>  <span class="hljs-comment">// 获取文件系统管理器</span><br>  <span class="hljs-keyword">const</span> fileSystemManager = wx.<span class="hljs-title function_">getFileSystemManager</span>();<br><br>  <span class="hljs-comment">// 创建临时文件并写入 ArrayBuffer 数据</span><br>  <span class="hljs-keyword">const</span> tempFilePath = <span class="hljs-string">`<span class="hljs-subst">$&#123;wx.env.USER_DATA_PATH&#125;</span>/<span class="hljs-subst">$&#123;fileName&#125;</span>.pdf`</span>;<br><br>  fileSystemManager.<span class="hljs-title function_">writeFile</span>(&#123;<br>    <span class="hljs-attr">filePath</span>: tempFilePath,<br>    <span class="hljs-attr">data</span>: arrayBuffer,<br>    <span class="hljs-attr">encoding</span>: <span class="hljs-string">&quot;binary&quot;</span>,<br>    <span class="hljs-attr">success</span>: <span class="hljs-function">() =&gt;</span> &#123;<br>      wx.<span class="hljs-title function_">openDocument</span>(&#123;<br>        <span class="hljs-attr">filePath</span>: tempFilePath,<br>        <span class="hljs-attr">fileType</span>: <span class="hljs-string">&quot;pdf&quot;</span>,<br>        <span class="hljs-attr">success</span>: <span class="hljs-function">() =&gt;</span> &#123;<br>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;预览成功&quot;</span>);<br>        &#125;,<br>        <span class="hljs-attr">fail</span>: <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;预览失败&quot;</span>, error);<br>        &#125;,<br>      &#125;);<br>    &#125;,<br>    <span class="hljs-attr">fail</span>: <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;写入失败&quot;</span>, error);<br>    &#125;,<br>  &#125;);<br>&#125;;<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  previewPdf,<br>&#125;;<br></code></pre></td></tr></table></figure><ul><li><ol start="2"><li>下载 url 预览</li></ol></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">previewPdf</span> = (<span class="hljs-params">url</span>) =&gt; &#123;<br>  util.<span class="hljs-title function_">showLoading</span>();<br>  <span class="hljs-comment">// 单次下载允许的最大文件为 200MB</span><br>  wx.<span class="hljs-title function_">downloadFile</span>(&#123;<br>    <span class="hljs-attr">url</span>: apiBaseUrl + url,<br>    <span class="hljs-attr">success</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) &#123;<br>      <span class="hljs-comment">// console.log(res, &#x27;wx.downloadFile success res&#x27;);</span><br>      <span class="hljs-keyword">if</span> (res.<span class="hljs-property">statusCode</span> != <span class="hljs-number">200</span>) &#123;<br>        util.<span class="hljs-title function_">hideLoadingWithErrorTips</span>();<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>      &#125;<br>      <span class="hljs-comment">// 返回的文件临时地址，用于后面打开本地预览所用</span><br>      <span class="hljs-keyword">const</span> <span class="hljs-title class_">Path</span> = res.<span class="hljs-property">tempFilePath</span>;<br>      wx.<span class="hljs-title function_">openDocument</span>(&#123;<br>        <span class="hljs-attr">filePath</span>: <span class="hljs-title class_">Path</span>,<br>        <span class="hljs-attr">showMenu</span>: <span class="hljs-literal">true</span>,<br>        <span class="hljs-attr">success</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>          <span class="hljs-comment">// console.log(&#x27;打开成功&#x27;);</span><br>          util.<span class="hljs-title function_">hideLoading</span>();<br>        &#125;,<br>      &#125;);<br>    &#125;,<br>    <span class="hljs-attr">fail</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err, <span class="hljs-string">&quot;wx.downloadFile fail err&quot;</span>);<br>      util.<span class="hljs-title function_">hideLoadingWithErrorTips</span>();<br>    &#125;,<br>  &#125;);<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="图片优化"><a href="#图片优化" class="headerlink" title="图片优化"></a>图片优化</h3><ul><li><ol><li>图片压缩</li></ol></li><li><ol start="2"><li>网络图片 webp</li></ol></li></ul><h3 id="手机号授权（免费体验-1000-次）"><a href="#手机号授权（免费体验-1000-次）" class="headerlink" title="手机号授权（免费体验 1000 次）"></a>手机号授权（免费体验 1000 次）</h3><h3 id="实名授权，（身份证、姓名匹配）"><a href="#实名授权，（身份证、姓名匹配）" class="headerlink" title="实名授权，（身份证、姓名匹配）"></a>实名授权，（身份证、姓名匹配）</h3><h3 id="身份证识别（）"><a href="#身份证识别（）" class="headerlink" title="身份证识别（）"></a>身份证识别（）</h3>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>脚手架SDK</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2024-05-06-【工程化】小程序监控</title>
    <link href="/2025/11/28/2024-05-06-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%9B%91%E6%8E%A7/"/>
    <url>/2025/11/28/2024-05-06-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%9B%91%E6%8E%A7/</url>
    
    <content type="html"><![CDATA[<h2 id="腾讯云监控"><a href="#腾讯云监控" class="headerlink" title="腾讯云监控"></a>腾讯云监控</h2><p><a href="https://cloud.tencent.com/document/product/1464">RUM 腾讯云前端性能监控</a><br><a href="https://cloud.tencent.com/document/product/1464/58134">RUM 快速入门</a><br><a href="https://cloud.tencent.com/document/product/1464/58566">小程序接入指引</a></p><h1 id="接入指引"><a href="#接入指引" class="headerlink" title="接入指引"></a>接入指引</h1><h2 id="一、腾讯云产品-RUM-开通并使用"><a href="#一、腾讯云产品-RUM-开通并使用" class="headerlink" title="一、腾讯云产品 RUM 开通并使用"></a>一、腾讯云产品 RUM 开通并使用</h2><ol><li><p>开通 RUM 产品<br><a href="https://console.cloud.tencent.com/monitor/rum?region=ap-guangzhou">https://console.cloud.tencent.com/monitor/rum?region=ap-guangzhou</a></p></li><li><p>添加应用<br><a href="https://console.cloud.tencent.com/monitor/rum/manage?region=ap-guangzhou">https://console.cloud.tencent.com/monitor/rum/manage?region=ap-guangzhou</a></p></li></ol><ul><li>2.1 创建业务系统</li></ul><blockquote><p>填写系统名称、计费模式、标签等信息</p></blockquote><ul><li>2.2 应用接入</li></ul><blockquote><ul><li>当前页，切换至 ”应用设置“ tab</li><li>点击”创建应用“，填写应用名称，应用类型选”小程序“，所属系统选择上一步填写的 业务系统</li><li>确定后，即可在 数据总览页中查看数据上报情况</li></ul></blockquote><h2 id="二、小程序控制台配置"><a href="#二、小程序控制台配置" class="headerlink" title="二、小程序控制台配置"></a>二、小程序控制台配置</h2><ul><li>打开小程序控制台，将<code>https://rumt-zh.com</code> 添加到安全域名中。</li></ul><h2 id="三、小程序项目引入监控插件"><a href="#三、小程序项目引入监控插件" class="headerlink" title="三、小程序项目引入监控插件"></a>三、小程序项目引入监控插件</h2><ol><li>npm 依赖安装</li></ol><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">$ npm install <span class="hljs-comment">--save aegis-mp-sdk</span><br></code></pre></td></tr></table></figure><ol start="2"><li>初始化<br>注：为了不遗漏数据，须尽早初始化。</li></ol><ul><li>app.js</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Aegis</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;aegis-mp-sdk&#x27;</span>;<br>...<br><br><span class="hljs-title class_">App</span>(&#123;<br>  <span class="hljs-attr">onLaunch</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> aegis = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Aegis</span>(&#123;<br>      <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;pGUVFTCZyewxxxxx&quot;</span>, <span class="hljs-comment">// RUM 上申请的上报 key</span><br>      <span class="hljs-attr">uin</span>: <span class="hljs-string">&#x27;xxx&#x27;</span>, <span class="hljs-comment">// 用户唯一 ID（可选）</span><br>      <span class="hljs-attr">reportApiSpeed</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 接口测速</span><br>      <span class="hljs-attr">reportAssetSpeed</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 静态资源测速</span><br>      <span class="hljs-attr">hostUrl</span>: <span class="hljs-string">&#x27;https://rumt-zh.com&#x27;</span>, <span class="hljs-comment">// 上报域名，中国大陆 rumt-zh.com</span><br>      <span class="hljs-attr">spa</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 页面切换的时候上报 pv</span><br>    &#125;);<br><br>  &#125;,<br>  ...<br>&#125;);<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>监控</category>
      
    </categories>
    
    
    <tags>
      
      <tag>腾讯云监控</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2024-05-24-【工程化】小程序代码规范</title>
    <link href="/2025/11/28/2024-05-24-%E3%80%90%E5%B0%8F%E7%A8%8B%E5%BA%8F%E3%80%91%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%88/"/>
    <url>/2025/11/28/2024-05-24-%E3%80%90%E5%B0%8F%E7%A8%8B%E5%BA%8F%E3%80%91%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%88/</url>
    
    <content type="html"><![CDATA[<p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/performance/">性能与体验</a><br>启动性能、运行性能</p><h2 id="性能分析"><a href="#性能分析" class="headerlink" title="性能分析"></a>性能分析</h2><p>性能扫描工具和代码优化</p><h2 id="加载时优化"><a href="#加载时优化" class="headerlink" title="加载时优化"></a>加载时优化</h2><ol><li>包体积优化： 首屏优化；<br>静态资源网络化：图片、视频、文件等网络化，利用 webp 技术降低图片体积<br>降低代码包大小：合理使用分包加载（降低代码包下载耗时、降低小程序代码注入耗时、降低页面渲染耗时、降低内存占用</li><li>优化启动耗时（分包合理性）<br>独立分包<br>分包预下载<br>分包异步化（页面粒度细化到组件甚至文件粒度）</li><li>避免非必要的全局自定义组件和插件</li><li>控制代码包内的资源文件</li><li>及时清理无用代码和资源</li></ol><h2 id="运行时优化"><a href="#运行时优化" class="headerlink" title="运行时优化"></a>运行时优化</h2><!-- 重绘、重排 --><ol><li>cr 代码评审，找出复杂逻辑优化点<br>生命周期，网络请求提前到 onLoad<br>合并 setData（通信的开销 + webview 更新的开销）<br>data 数据合理性分析</li></ol><h2 id="1-1-分包"><a href="#1-1-分包" class="headerlink" title="1.1 分包"></a>1.1 分包</h2><p>分包原则 单个包体积 &lt; 2MB，总包 &lt; 20MB</p><p>自然人、企业、交易历史、主包（首页、个人中心、宣传页）</p><p>「独立分包」<br>「分包预下载」</p><p><a href="https://developers.weixin.qq.com/community/develop/doc/000e44abb2c7e89c2287f84b956c09">https://developers.weixin.qq.com/community/develop/doc/000e44abb2c7e89c2287f84b956c09</a><br><a href="https://github.com/dujuncheng/blogs/blob/master/mini_program/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%88%E2%80%94%E2%80%94%E8%AE%A9%E4%BD%A0%E7%9A%84%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%A6%82%E6%AD%A4%E4%B8%9D%E6%BB%91.md">https://github.com/dujuncheng/blogs/blob/master/mini_program/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%88%E2%80%94%E2%80%94%E8%AE%A9%E4%BD%A0%E7%9A%84%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%A6%82%E6%AD%A4%E4%B8%9D%E6%BB%91.md</a><br><a href="https://juejin.cn/post/7117179043430006820">https://juejin.cn/post/7117179043430006820</a></p><h1 id="实施方案"><a href="#实施方案" class="headerlink" title="实施方案"></a>实施方案</h1><h2 id="图片很重要"><a href="#图片很重要" class="headerlink" title="图片很重要"></a>图片很重要</h2><p>如果使用图片不当（过多过大的图片），在加载时会消耗更多的系统资源，从而影响整个页面的性能，因此做好图片优化非常重要。</p><h3 id="如何进行图片优化"><a href="#如何进行图片优化" class="headerlink" title="如何进行图片优化"></a>如何进行图片优化</h3><ol><li>第一步：控制大小<br>（1）针对本地图片</li></ol><p>​ 由于放置在本地的图片会被直接打包到小程序包内，图片过大会导致包体积过大，加载时间变长。同时图片过大也会导致渲染时间变长，因此开发者需尽可能的压缩图片的大小。以下列出一些图片优化的思路：</p><p>对于不需要透明格式的图片，推荐采用 jpeg 格式来代替 png 格式。</p><p>安卓端可使用 webp 的图片格式。webp 图片格式在有损压缩的情况下，肉眼不易察觉出压缩前后的变化，但是体积却得到很明显的减小（注意： iOS 百度 App 版本 &lt; 11.22 时不支持 webp 格式）。</p><p>确保小程序包内无冗余和无用的图片资源。</p><p>请注意默认情况下会加载，但可能之后永远不会渲染的图片，例如“轮播图”，“手风琴”和“图片画廊”。</p><p>为了缩短渲染关键图片所需的时间，请延迟加载不太重要的图片，并在关键图片渲染完成后再加载后续内容。</p><p>使用工具对图片进行压缩。常见的压缩工具如下：</p><p>图片格式 压缩工具 压缩比例<br>png 格式 <a href="https://www.npmjs.com/package/pngquant-bin">https://www.npmjs.com/package/pngquant-bin</a> 50-70<br>jpeg 格式 <a href="https://www.npmjs.com/package/mozjpeg">https://www.npmjs.com/package/mozjpeg</a> 默认<br>（2）针对网络图片</p><p>在智能小程序项目中，除了小程序的 icon，基本都会部署到 CDN 上。对于这样的网络图片，也需要进行压缩。下面列出一些优化的思路：</p><p>通过 CDN 静态资源服务器获取图片资源，并添加图片压缩规则。<br>使用如上节提起的工具对图片进行压缩后，再上传至 CDN。 2. 第二步：开启图片懒加载<br>可以使用懒加载优化小程序。智能小程序的 image 组件提供了 lazy-load 属性，可以开启图片的懒加载功能：</p><image lazy-load="true"/>3. 第三步：谨慎使用耗费性能的属性image组件mode属性提供了 13 种模式，其中widthFix模式是其中一种，作用是保持图片宽度不变，高度自动变化，并保持宽高比不变。由于widthFix模式需要动态计算图片的宽度，导致页面的重绘，因此应谨慎使用mode属性的widthFix模式。<ol start="4"><li><p>第四步：使用渐进式 JPEG 来优化用户体验<br>使用 mozjpeg 不仅可以压缩 JPEG 图片的体积，还可以将图片转换为渐进式的 JPEG。 渐进式的 JPEG 图片在加载时会先展示整个图片的模糊轮廓，随着扫描次数的增加，图片变得越来越清晰。这种格式的主要优点是在网络较慢的情况下，可以预览到图片的轮廓，一定程度上可以提升用户体验。</p></li><li><p>第五步：减少页面抖动<br>当网络图片资源加载过慢时，页面可能会出现抖动现象，这是因为当 webview 无法获取到图像的 width, height 属性值，不能为图片预留空间，导致页面元素出现重排，在视觉上出现抖动现象。</p></li></ol><p>为了减少页面的抖动，可以设置一个和图片资源宽高一致的默认图片或者空元素，这样可以避免页面重排带来的性能损耗，同时也能优化用户的体验。</p><ol start="6"><li>第六步：利用体验评分工具检测图片问题<br>利用开发者工具提供的体验评分工具（Audits），开发者可以识别和检测影响智能小程序性能、体验的图片问题。<br>具体使用方法，详见体验评分工具说明。</li></ol>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>小程序开发规范</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2024-05-24-【小程序】小程序踩坑日记</title>
    <link href="/2025/11/28/2024-05-24-%E3%80%90%E5%B0%8F%E7%A8%8B%E5%BA%8F%E3%80%91%E5%B0%8F%E7%A8%8B%E5%BA%8F%E8%B8%A9%E5%9D%91%E6%97%A5%E8%AE%B0/"/>
    <url>/2025/11/28/2024-05-24-%E3%80%90%E5%B0%8F%E7%A8%8B%E5%BA%8F%E3%80%91%E5%B0%8F%E7%A8%8B%E5%BA%8F%E8%B8%A9%E5%9D%91%E6%97%A5%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<ol><li>小程序开发、体验、生产环境缓存数据共享问题<br>利用<code>wx.getAccountInfoSync()</code>区分环境，为<code>wx.setStorageSync()</code>添加版本前缀</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> envConf = &#123;<br>  <span class="hljs-comment">// 开发版-本地环境</span><br>  <span class="hljs-attr">develop</span>: &#123;<br>    <span class="hljs-attr">mode</span>: <span class="hljs-string">&quot;dev&quot;</span>,<br>    <span class="hljs-attr">staticUrl</span>: <span class="hljs-string">&quot;https://xxx&quot;</span>,<br>    <span class="hljs-attr">apiBaseUrl</span>: <span class="hljs-string">&quot;https://txxx&quot;</span>,<br>    <span class="hljs-attr">monitorId</span>: <span class="hljs-string">&quot;&quot;</span>,<br>  &#125;,<br>  <span class="hljs-comment">// 体验版-测试环境</span><br>  <span class="hljs-attr">trial</span>: &#123;<br>    <span class="hljs-attr">mode</span>: <span class="hljs-string">&quot;test&quot;</span>,<br>    <span class="hljs-attr">staticUrl</span>: <span class="hljs-string">&quot;https://xxx&quot;</span>,<br>    <span class="hljs-attr">apiBaseUrl</span>: <span class="hljs-string">&quot;https://txxx&quot;</span>,<br>    <span class="hljs-attr">monitorId</span>: <span class="hljs-string">&quot;xxx&quot;</span>,<br>  &#125;,<br>  <span class="hljs-comment">// 正式版-正式环境</span><br>  <span class="hljs-attr">release</span>: &#123;<br>    <span class="hljs-attr">mode</span>: <span class="hljs-string">&quot;prod&quot;</span>,<br>    <span class="hljs-attr">staticUrl</span>: <span class="hljs-string">&quot;https://xxx&quot;</span>,<br>    <span class="hljs-attr">apiBaseUrl</span>: <span class="hljs-string">&quot;https://xxx&quot;</span>,<br>    <span class="hljs-attr">monitorId</span>: <span class="hljs-string">&quot;xxx&quot;</span>,<br>  &#125;,<br>&#125;;<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">env</span>: envConf[wx.<span class="hljs-title function_">getAccountInfoSync</span>().<span class="hljs-property">miniProgram</span>.<span class="hljs-property">envVersion</span>],<br>&#125;;<br></code></pre></td></tr></table></figure><ol start="2"><li>IOS 屏幕适配（刘海屏、底部横条）</li></ol><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css">// 兼容IOS12以下<br><span class="hljs-attribute">margin-bottom</span>: <span class="hljs-built_in">constant</span>(safe-area-inset-bottom);<br>// 兼容IOS12以上<br><span class="hljs-attribute">margin-bottom</span>: <span class="hljs-built_in">env</span>(safe-area-inset-bottom);<br></code></pre></td></tr></table></figure><ol start="3"><li>10 层层级页面跳转</li></ol><ul><li>避免循环操作：小程序原生页面支持的最大层级不超过 10 层，正常业务流程或闭环容易造成 10 层问题，toast、弹窗等不受限于层级问题</li><li>层级页面跳转、兼容性、缓存</li></ul><ol start="4"><li><p>滚动穿透</p></li><li><p>缓存<br>微信给每个小程序提供了 10MB 的本地缓存，可以对一些数据和配置信息等进行相应的缓存来减少对服务器的请求，提升用户体验。</p></li></ol><p>测试时清理缓存的方法：简单粗暴地将小程序删掉，重新进入生效，或者在开发模式下清理</p><ol start="7"><li>兼容性测试<br>不同的手机系统（Android 和 IOS）、不同的微信版本、不同的分辨率</li></ol><p>注意：小程序支持 PC 端了，所以还要考虑 Windows 和 OS 系统上微信端的兼容性</p><ol start="8"><li>网络测试<br>网络切换测试：在 WIFI，2G&#x2F;3G&#x2F;4G&#x2F;5G，无网之间切换</li></ol><p>网速测试：自定义带宽后，进行测试</p><ol start="9"><li>性能测试<br>页面的白屏时间、首屏时间、资源占用、页面渲染时间</li></ol><p>小程序测试过程中经常遇到的坑：层级页面跳转、兼容性、缓存</p>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>小程序全局分享</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2024-05-24-【工程化】小程序代码规范</title>
    <link href="/2025/11/28/2024-05-24-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/"/>
    <url>/2025/11/28/2024-05-24-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/</url>
    
    <content type="html"><![CDATA[<h2 id="1-eslint、prettier-安装-配置"><a href="#1-eslint、prettier-安装-配置" class="headerlink" title="1. eslint、prettier 安装&amp;配置"></a>1. eslint、prettier 安装&amp;配置</h2><ol><li>插件安装 Prettier - Code formatter 安装</li></ol><figure class="highlight yml"><figcaption><span>.prettierrc.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># 一行最多 100 字符</span><br><span class="hljs-attr">printWidth:</span> <span class="hljs-number">120</span><br><span class="hljs-comment"># 使用 2 个空格缩进</span><br><span class="hljs-attr">tabWidth:</span> <span class="hljs-number">2</span><br><span class="hljs-comment"># 不使用缩进符，而使用空格</span><br><span class="hljs-attr">useTabs:</span> <span class="hljs-literal">false</span><br><span class="hljs-comment"># 行尾需要分号</span><br><span class="hljs-attr">semi:</span> <span class="hljs-literal">true</span><br><span class="hljs-comment"># 使用单引号</span><br><span class="hljs-attr">singleQuote:</span> <span class="hljs-literal">true</span><br><span class="hljs-comment"># 对象的 key 仅在必要时用引号</span><br><span class="hljs-attr">quoteProps:</span> <span class="hljs-string">as-needed</span><br><span class="hljs-comment"># jsx 不使用单引号，而使用双引号</span><br><span class="hljs-attr">jsxSingleQuote:</span> <span class="hljs-literal">false</span><br><span class="hljs-comment"># 末尾需要逗号</span><br><span class="hljs-attr">trailingComma:</span> <span class="hljs-string">all</span><br><span class="hljs-comment"># 大括号内的首尾需要空格</span><br><span class="hljs-attr">bracketSpacing:</span> <span class="hljs-literal">true</span><br><span class="hljs-comment"># jsx 标签的反尖括号需要换行</span><br><span class="hljs-attr">jsxBracketSameLine:</span> <span class="hljs-literal">false</span><br><span class="hljs-comment"># 箭头函数，只有一个参数的时候，不需要括号</span><br><span class="hljs-attr">arrowParens:</span> <span class="hljs-string">always</span><br><span class="hljs-comment"># 每个文件格式化的范围是文件的全部内容</span><br><span class="hljs-attr">rangeStart:</span> <span class="hljs-number">0</span><br><span class="hljs-comment"># 不需要写文件开头的 @prettier</span><br><span class="hljs-attr">requirePragma:</span> <span class="hljs-literal">false</span><br><span class="hljs-comment"># 不需要自动在文件开头插入 @prettier</span><br><span class="hljs-attr">insertPragma:</span> <span class="hljs-literal">false</span><br><span class="hljs-comment"># 使用默认的折行标准</span><br><span class="hljs-attr">proseWrap:</span> <span class="hljs-string">preserve</span><br><span class="hljs-comment"># 根据显示样式决定 html 要不要折行</span><br><span class="hljs-attr">htmlWhitespaceSensitivity:</span> <span class="hljs-string">css</span><br><span class="hljs-comment"># 换行符使用 lf</span><br><span class="hljs-attr">endOfLine:</span> <span class="hljs-string">lf</span><br><span class="hljs-comment"># 后缀文件名特有规则</span><br><span class="hljs-attr">overrides:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">files:</span> <span class="hljs-string">&quot;*.&#123;wxss,less&#125;&quot;</span><br>    <span class="hljs-attr">options:</span><br>      <span class="hljs-attr">parser:</span> <span class="hljs-string">less</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">files:</span> <span class="hljs-string">&quot;*.json,.*rc&quot;</span><br>    <span class="hljs-attr">options:</span><br>      <span class="hljs-attr">parser:</span> <span class="hljs-string">json</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">files:</span> <span class="hljs-string">&quot;*.&#123;wxml,html&#125;&quot;</span><br>    <span class="hljs-attr">options:</span><br>      <span class="hljs-attr">parser:</span> <span class="hljs-string">html</span><br>      <span class="hljs-attr">htmlWhitespaceSensitivity:</span> <span class="hljs-string">strict</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">files:</span> <span class="hljs-string">&quot;*.wxs&quot;</span><br>    <span class="hljs-attr">options:</span><br>      <span class="hljs-attr">parser:</span> <span class="hljs-string">babel</span><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs .prettierignore">miniprogram_npm<br>package.json<br>project.config.json<br>project.private.config.json<br>pnpm-lock.yaml<br>package-lock.json<br></code></pre></td></tr></table></figure><p>eslint.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">env</span>: &#123;<br>    <span class="hljs-attr">browser</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">commonjs</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">es6</span>: <span class="hljs-literal">true</span>,<br>  &#125;,<br>  <span class="hljs-attr">parserOptions</span>: &#123;<br>    <span class="hljs-attr">ecmaVersion</span>: <span class="hljs-number">2020</span>,<br>    <span class="hljs-comment">// ECMAScript modules 模式</span><br>    <span class="hljs-attr">sourceType</span>: <span class="hljs-string">&quot;module&quot;</span>,<br>  &#125;,<br>  <span class="hljs-attr">extends</span>: [<span class="hljs-string">&quot;plugin:prettier/recommended&quot;</span>, <span class="hljs-string">&quot;prettier&quot;</span>],<br>  <span class="hljs-attr">globals</span>: &#123;<br>    <span class="hljs-attr">wx</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-title class_">App</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-title class_">Page</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-title class_">Component</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">getApp</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">getCurrentPages</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-title class_">Behavior</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">global</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">__wxConfig</span>: <span class="hljs-literal">true</span>,<br>  &#125;,<br>  <span class="hljs-attr">ignorePatterns</span>: [<span class="hljs-string">&quot;*.wxs&quot;</span>],<br>  <span class="hljs-attr">rules</span>: &#123;<br>    <span class="hljs-string">&quot;prettier/prettier&quot;</span>: <span class="hljs-string">&quot;warn&quot;</span>,<br>    <span class="hljs-string">&quot;no-undef&quot;</span>: <span class="hljs-string">&quot;off&quot;</span>,<br>    <span class="hljs-attr">camelcase</span>: [<span class="hljs-string">&quot;error&quot;</span>, &#123; <span class="hljs-attr">ignoreDestructuring</span>: <span class="hljs-literal">true</span> &#125;],<br>    <span class="hljs-string">&quot;class-name-casing&quot;</span>: <span class="hljs-string">&quot;off&quot;</span>,<br>    <span class="hljs-string">&quot;no-console&quot;</span>: [<span class="hljs-string">&quot;warn&quot;</span>, &#123; <span class="hljs-attr">allow</span>: [<span class="hljs-string">&quot;warn&quot;</span>, <span class="hljs-string">&quot;error&quot;</span>] &#125;],<br>    <span class="hljs-string">&quot;no-debugger&quot;</span>: <span class="hljs-string">&quot;error&quot;</span>,<br>    <span class="hljs-string">&quot;no-unused-expressions&quot;</span>: [<br>      <span class="hljs-string">&quot;error&quot;</span>,<br>      &#123; <span class="hljs-attr">allowShortCircuit</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">allowTernary</span>: <span class="hljs-literal">true</span> &#125;,<br>    ],<br>    <span class="hljs-string">&quot;no-empty-interface&quot;</span>: <span class="hljs-string">&quot;off&quot;</span>,<br>    <span class="hljs-string">&quot;no-use-before-define&quot;</span>: [<span class="hljs-string">&quot;error&quot;</span>, &#123; <span class="hljs-attr">functions</span>: <span class="hljs-literal">false</span> &#125;],<br>    <span class="hljs-string">&quot;no-useless-constructor&quot;</span>: <span class="hljs-string">&quot;error&quot;</span>,<br>    <span class="hljs-string">&quot;prefer-const&quot;</span>: <span class="hljs-string">&quot;error&quot;</span>,<br>    <span class="hljs-string">&quot;prefer-destructuring&quot;</span>: [<br>      <span class="hljs-string">&quot;error&quot;</span>,<br>      &#123;<br>        <span class="hljs-title class_">AssignmentExpression</span>: &#123;<br>          <span class="hljs-attr">array</span>: <span class="hljs-literal">false</span>,<br>          <span class="hljs-attr">object</span>: <span class="hljs-literal">false</span>,<br>        &#125;,<br>        <span class="hljs-title class_">VariableDeclarator</span>: &#123;<br>          <span class="hljs-attr">array</span>: <span class="hljs-literal">false</span>,<br>          <span class="hljs-attr">object</span>: <span class="hljs-literal">true</span>,<br>        &#125;,<br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">enforceForRenamedProperties</span>: <span class="hljs-literal">false</span>,<br>      &#125;,<br>    ],<br>    <span class="hljs-string">&quot;no-const-assign&quot;</span>: <span class="hljs-string">&quot;error&quot;</span>,<br>    <span class="hljs-string">&quot;no-new-object&quot;</span>: <span class="hljs-string">&quot;error&quot;</span>,<br>    <span class="hljs-string">&quot;no-prototype-builtins&quot;</span>: <span class="hljs-string">&quot;error&quot;</span>,<br>    <span class="hljs-string">&quot;no-array-constructor&quot;</span>: <span class="hljs-string">&quot;error&quot;</span>,<br>    <span class="hljs-string">&quot;array-callback-return&quot;</span>: <span class="hljs-string">&quot;warn&quot;</span>,<br>    <span class="hljs-string">&quot;prefer-template&quot;</span>: <span class="hljs-string">&quot;error&quot;</span>,<br>    <span class="hljs-string">&quot;no-useless-escape&quot;</span>: <span class="hljs-string">&quot;error&quot;</span>,<br>    <span class="hljs-string">&quot;wrap-iife&quot;</span>: [<span class="hljs-string">&quot;error&quot;</span>, <span class="hljs-string">&quot;outside&quot;</span>],<br>    <span class="hljs-string">&quot;space-before-function-paren&quot;</span>: [<br>      <span class="hljs-string">&quot;warn&quot;</span>,<br>      &#123;<br>        <span class="hljs-attr">anonymous</span>: <span class="hljs-string">&quot;always&quot;</span>,<br>        <span class="hljs-attr">named</span>: <span class="hljs-string">&quot;never&quot;</span>,<br>        <span class="hljs-attr">asyncArrow</span>: <span class="hljs-string">&quot;always&quot;</span>,<br>      &#125;,<br>    ],<br>    <span class="hljs-string">&quot;no-param-reassign&quot;</span>: [<br>      <span class="hljs-string">&quot;warn&quot;</span>,<br>      &#123;<br>        <span class="hljs-attr">props</span>: <span class="hljs-literal">true</span>,<br>        <span class="hljs-attr">ignorePropertyModificationsFor</span>: [<br>          <span class="hljs-string">&quot;acc&quot;</span>, <span class="hljs-comment">// for reduce accumulators</span><br>          <span class="hljs-string">&quot;accumulator&quot;</span>, <span class="hljs-comment">// for reduce accumulators</span><br>          <span class="hljs-string">&quot;e&quot;</span>, <span class="hljs-comment">// for e.returnvalue</span><br>          <span class="hljs-string">&quot;ctx&quot;</span>, <span class="hljs-comment">// for Koa routing</span><br>          <span class="hljs-string">&quot;req&quot;</span>, <span class="hljs-comment">// for Express requests</span><br>          <span class="hljs-string">&quot;request&quot;</span>, <span class="hljs-comment">// for Express requests</span><br>          <span class="hljs-string">&quot;res&quot;</span>, <span class="hljs-comment">// for Express responses</span><br>          <span class="hljs-string">&quot;response&quot;</span>, <span class="hljs-comment">// for Express responses</span><br>          <span class="hljs-string">&quot;$scope&quot;</span>, <span class="hljs-comment">// for Angular 1 scopes</span><br>          <span class="hljs-string">&quot;staticContext&quot;</span>, <span class="hljs-comment">// for ReactRouter context</span><br>          <span class="hljs-string">&quot;state&quot;</span>, <span class="hljs-comment">// for Vuex</span><br>        ],<br>      &#125;,<br>    ],<br>    <span class="hljs-string">&quot;no-confusing-arrow&quot;</span>: <span class="hljs-string">&quot;warn&quot;</span>,<br>    <span class="hljs-string">&quot;no-dupe-class-members&quot;</span>: <span class="hljs-string">&quot;error&quot;</span>,<br>    <span class="hljs-string">&quot;no-iterator&quot;</span>: <span class="hljs-string">&quot;warn&quot;</span>,<br>    <span class="hljs-string">&quot;dot-notation&quot;</span>: <span class="hljs-string">&quot;warn&quot;</span>,<br>    <span class="hljs-string">&quot;one-var&quot;</span>: [<span class="hljs-string">&quot;warn&quot;</span>, <span class="hljs-string">&quot;never&quot;</span>],<br>    <span class="hljs-string">&quot;no-multi-assign&quot;</span>: <span class="hljs-string">&quot;error&quot;</span>,<br>    <span class="hljs-string">&quot;no-unused-vars&quot;</span>: [<br>      <span class="hljs-string">&quot;error&quot;</span>,<br>      &#123;<br>        <span class="hljs-attr">args</span>: <span class="hljs-string">&quot;after-used&quot;</span>,<br>        <span class="hljs-attr">ignoreRestSiblings</span>: <span class="hljs-literal">true</span>,<br>        <span class="hljs-attr">argsIgnorePattern</span>: <span class="hljs-string">&quot;^_.+&quot;</span>,<br>        <span class="hljs-attr">varsIgnorePattern</span>: <span class="hljs-string">&quot;^_.+&quot;</span>,<br>      &#125;,<br>    ],<br>    <span class="hljs-attr">eqeqeq</span>: [<span class="hljs-string">&quot;warn&quot;</span>, <span class="hljs-string">&quot;always&quot;</span>],<br>    <span class="hljs-string">&quot;no-case-declarations&quot;</span>: <span class="hljs-string">&quot;error&quot;</span>,<br>    <span class="hljs-string">&quot;no-nested-ternary&quot;</span>: <span class="hljs-string">&quot;warn&quot;</span>,<br>    <span class="hljs-string">&quot;no-unneeded-ternary&quot;</span>: <span class="hljs-string">&quot;warn&quot;</span>,<br>    <span class="hljs-string">&quot;no-mixed-operators&quot;</span>: [<br>      <span class="hljs-string">&quot;error&quot;</span>,<br>      &#123;<br>        <span class="hljs-attr">groups</span>: [<br>          [<span class="hljs-string">&quot;%&quot;</span>, <span class="hljs-string">&quot;**&quot;</span>],<br>          [<span class="hljs-string">&quot;%&quot;</span>, <span class="hljs-string">&quot;+&quot;</span>],<br>          [<span class="hljs-string">&quot;%&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>          [<span class="hljs-string">&quot;%&quot;</span>, <span class="hljs-string">&quot;*&quot;</span>],<br>          [<span class="hljs-string">&quot;%&quot;</span>, <span class="hljs-string">&quot;/&quot;</span>],<br>          [<span class="hljs-string">&quot;&amp;&quot;</span>, <span class="hljs-string">&quot;|&quot;</span>, <span class="hljs-string">&quot;&lt;&lt;&quot;</span>, <span class="hljs-string">&quot;&gt;&gt;&quot;</span>, <span class="hljs-string">&quot;&gt;&gt;&gt;&quot;</span>],<br>          [<span class="hljs-string">&quot;==&quot;</span>, <span class="hljs-string">&quot;!=&quot;</span>, <span class="hljs-string">&quot;===&quot;</span>, <span class="hljs-string">&quot;!==&quot;</span>],<br>          [<span class="hljs-string">&quot;&amp;&amp;&quot;</span>, <span class="hljs-string">&quot;||&quot;</span>],<br>        ],<br>        <span class="hljs-attr">allowSamePrecedence</span>: <span class="hljs-literal">false</span>,<br>      &#125;,<br>    ],<br>    <span class="hljs-string">&quot;no-else-return&quot;</span>: [<br>      <span class="hljs-string">&quot;warn&quot;</span>,<br>      &#123;<br>        <span class="hljs-attr">allowElseIf</span>: <span class="hljs-literal">false</span>,<br>      &#125;,<br>    ],<br>    <span class="hljs-string">&quot;no-new-wrappers&quot;</span>: <span class="hljs-string">&quot;warn&quot;</span>,<br>    <span class="hljs-attr">indent</span>: [<br>      <span class="hljs-string">&quot;warn&quot;</span>,<br>      <span class="hljs-number">2</span>,<br>      &#123;<br>        <span class="hljs-title class_">SwitchCase</span>: <span class="hljs-number">1</span>,<br>        <span class="hljs-title class_">VariableDeclarator</span>: <span class="hljs-number">1</span>,<br>        <span class="hljs-attr">outerIIFEBody</span>: <span class="hljs-number">1</span>,<br>        <span class="hljs-title class_">FunctionDeclaration</span>: &#123;<br>          <span class="hljs-attr">parameters</span>: <span class="hljs-number">1</span>,<br>          <span class="hljs-attr">body</span>: <span class="hljs-number">1</span>,<br>        &#125;,<br>        <span class="hljs-title class_">FunctionExpression</span>: &#123;<br>          <span class="hljs-attr">parameters</span>: <span class="hljs-number">1</span>,<br>          <span class="hljs-attr">body</span>: <span class="hljs-number">1</span>,<br>        &#125;,<br>        <span class="hljs-title class_">CallExpression</span>: &#123;<br>          <span class="hljs-attr">arguments</span>: <span class="hljs-number">1</span>,<br>        &#125;,<br>        <span class="hljs-title class_">ArrayExpression</span>: <span class="hljs-number">1</span>,<br>        <span class="hljs-title class_">ObjectExpression</span>: <span class="hljs-number">1</span>,<br>        <span class="hljs-title class_">ImportDeclaration</span>: <span class="hljs-number">1</span>,<br>        <span class="hljs-attr">flatTernaryExpressions</span>: <span class="hljs-literal">false</span>,<br>        <span class="hljs-attr">ignoreComments</span>: <span class="hljs-literal">false</span>,<br>      &#125;,<br>    ],<br>    <span class="hljs-string">&quot;linebreak-style&quot;</span>: [<span class="hljs-string">&quot;warn&quot;</span>, <span class="hljs-string">&quot;unix&quot;</span>],<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure><p>.eslintignore</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">miniprogram_npm/**<br></code></pre></td></tr></table></figure><h2 id="2-微信开发工具-自动格式化设置"><a href="#2-微信开发工具-自动格式化设置" class="headerlink" title="2. 微信开发工具 自动格式化设置"></a>2. 微信开发工具 自动格式化设置</h2><p>1、打开开发者工具——设置——编辑器设置<br>2、更多及工作区的编辑器设置<br>3、点击右上角文件图标，进入 setting.json 文件配置<br>4、添加如下代码 到文件中</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;files.associations&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>   <span class="hljs-attr">&quot;*.wxml&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;wxml&quot;</span><span class="hljs-punctuation">,</span><br>   <span class="hljs-attr">&quot;*.wxss&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;css&quot;</span><span class="hljs-punctuation">,</span><br>   <span class="hljs-attr">&quot;*.wxs&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;js&quot;</span><br> <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br> <span class="hljs-attr">&quot;editor.formatOnSave&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 保存文件自动格式化</span><br> <span class="hljs-attr">&quot;editor.defaultFormatter&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;esbenp.prettier-vscode&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 设置编辑默认的格式化工具为prettier</span><br></code></pre></td></tr></table></figure><h2 id="3-git-提交规范-commitlint-设置"><a href="#3-git-提交规范-commitlint-设置" class="headerlink" title="3. git 提交规范 commitlint 设置"></a>3. git 提交规范 commitlint 设置</h2><h2 id="4-husky-安装设置-eslint-校验"><a href="#4-husky-安装设置-eslint-校验" class="headerlink" title="4. husky 安装设置 eslint 校验"></a>4. husky 安装设置 eslint 校验</h2><ul><li>安装依赖 <code>npm install husky --save-dev</code></li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;husky&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^8.0.3&quot;</span><span class="hljs-punctuation">,</span><br></code></pre></td></tr></table></figure><ul><li><p>初始化<br>a. 在 package.json 中生成 prepare 指令<code>npm set-script prepare &quot;husky install&quot;</code><br>b. 执行 <code>npm run install</code></p></li><li><p>添加 commitlint 的 hook 到 husky 中，commit-msg 时进行校验<br><code>npx husky add .husky/commit-msg &#39;npx --no-install commitlint --edit &quot;$1&quot;&#39;</code><br>此时，不符合规范的 commit 将不会被允许提交。正确提交示例: <code>git commit -m &quot;feat: 规则提交&quot;</code></p></li><li><p>pre-commit 检验当前代码是否有 ESLint 错误<br>在代码被提交之前，可以执行 npx eslint –ext .js,.ts,.vue src 指令来检测代码是否规范</p></li><li><p>lint-staged 是一个在 git 暂存文件上运行 linters 的工具<br>优势：影响范围缩小到修改过的文件，不会对项目整体进行 eslint 操作执行。<br>依赖安装 <code>npm install lint-staged --save-dev </code></p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs prolog">  <span class="hljs-string">&quot;lint-staged&quot;</span>: &#123;<br>  <span class="hljs-string">&quot;*.&#123;js, ts&#125;&quot;</span>: <span class="hljs-string">&quot;eslint --cache --fix&quot;</span>,<br>  <span class="hljs-string">&quot;*.&#123;js,ts,wxml,wxss,html,json,css,less&#125;&quot;</span>: [<br>    <span class="hljs-string">&quot;prettier --write&quot;</span><br>  ]<br>&#125;,<br></code></pre></td></tr></table></figure></li><li><p><code>npx husky add .husky/pre-commit &#39;npx lint-staged&#39;</code></p></li></ul><!-- package.json --><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">&quot;<span class="hljs-keyword">prepare</span><span class="hljs-string">&quot;: &quot;</span>husky install &amp; chmod +x .husky/<span class="hljs-keyword">commit</span>-msg .husky/pre-<span class="hljs-keyword">commit</span><span class="hljs-string">&quot;,</span><br></code></pre></td></tr></table></figure><h3 id="commitlint-规范"><a href="#commitlint-规范" class="headerlink" title="commitlint 规范"></a>commitlint 规范</h3><p>注：commitlint 提交格式 <code>&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;</code></p><ul><li>正确的例子</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">git <span class="hljs-keyword">commit</span> <span class="hljs-operator">-</span>m <span class="hljs-string">&#x27;feat: 增加 xxx 功能&#x27;</span><br>git <span class="hljs-keyword">commit</span> <span class="hljs-operator">-</span>m <span class="hljs-string">&#x27;bug: 修复 xxx 功能&#x27;</span><br></code></pre></td></tr></table></figure><ul><li>commitlint 参数说明</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">scope</span>: 指 <span class="hljs-keyword">commit</span> 的范围（哪些模块进行了修改）<span class="hljs-operator">-</span> 非必须<br>subject: 指 <span class="hljs-keyword">commit</span> 的简短描述<br>body: 指 <span class="hljs-keyword">commit</span> 主体内容（长描述）<span class="hljs-operator">-</span> 非必须<br>footer: 指 <span class="hljs-keyword">commit</span> footer 信息 <span class="hljs-operator">-</span> 非必须<br>type: 指 当前 <span class="hljs-keyword">commit</span> 类型<br></code></pre></td></tr></table></figure><ul><li>type 一般有下面几种可选类型：</li></ul><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">build:</span> 主要目的是修改项目构建系统(例如 glup，webpack，rollup 的配置等)的提交<br><span class="hljs-symbol">ci:</span> 主要目的是修改项目继续集成流程(例如 Travis，Jenkins，GitLab CI，Circle等)的提交<br><span class="hljs-symbol">docs:</span> 文档更新<br><span class="hljs-symbol">feat:</span> 新增功能<br><span class="hljs-symbol">merge:</span> 分支合并 Merge branch ? of ?<br><span class="hljs-symbol">fix:</span> bug 修复<br><span class="hljs-symbol">perf:</span>  性能, 体验优化<br><span class="hljs-symbol">refactor:</span>  重构代码(既没有新增功能，也没有修复 bug)<br><span class="hljs-symbol">style:</span> 不影响程序逻辑的代码修改(修改空白字符，格式缩进，补全缺失的分号等，没有改变代码逻辑)<br><span class="hljs-symbol">test:</span>  新增测试用例或是更新现有测试<br><span class="hljs-symbol">revert:</span>  回滚某个更早之前的提交<br><span class="hljs-symbol">chore:</span> 不属于以上类型的其他类型<br></code></pre></td></tr></table></figure><h3 id="prepare-commit-msg"><a href="#prepare-commit-msg" class="headerlink" title="prepare-commit-msg"></a>prepare-commit-msg</h3>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>小程序开发规范</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2024-05-06-【工程化】代码走查Code review要点</title>
    <link href="/2025/11/28/2024-05-06-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91%E4%BB%A3%E7%A0%81%E8%B5%B0%E6%9F%A5Code%20review%E8%A6%81%E7%82%B9/"/>
    <url>/2025/11/28/2024-05-06-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91%E4%BB%A3%E7%A0%81%E8%B5%B0%E6%9F%A5Code%20review%E8%A6%81%E7%82%B9/</url>
    
    <content type="html"><![CDATA[<p><a href="https://jimmysong.io/eng-practices/docs/review/reviewer/looking-for/">来源-谷歌工程实践</a></p><h1 id="Code-Review-要点"><a href="#Code-Review-要点" class="headerlink" title="Code Review 要点"></a>Code Review 要点</h1><p>注意：在考虑这些要点时，请谨记 “<a href="https://jimmysong.io/eng-practices/docs/review/reviewer/standard">Code Review 标准</a>”。</p><h2 id="设计"><a href="#设计" class="headerlink" title="设计"></a>设计</h2><p>审查中最重要的是 CL 的整体设计。CL 中各种代码的交互是否有意义？此变更是属于您的代码库（codebase）还是属于库（library）？它是否与您系统的其他部分很好地集成？现在是添加此功能的好时机吗？</p><h2 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h2><p>这个 CL 是否符合开发者的意图？开发者的意图对代码的用户是否是好的？ “用户”通常都是最终用户（当他们受到变更影响时）和开发者（将来必须“使用”此代码）。</p><p>大多数情况下，我们希望开发者能够很好地测试 CL，以便在审查时代码能够正常工作。但是，作为审查者，仍然应该考虑边缘情况，寻找并发问题，尝试像用户一样思考，并确保您单纯透过阅读方式审查时，代码没有包含任何 bug。</p><p>当要检查 CL 的行为会对用户有重大影响时，验证 CL 的变化将变得十分重要。例如  <strong>UI 变更</strong>。当您只是阅读代码时，很难理解某些变更会如何影响用户。如果在 CL 中打 patch 或自行尝试这样的变更太不方便，您可以让开发人员为您提供功能演示。</p><p>另一个在代码审查期间特别需要考虑功能的时机，就是如果 CL 中存在某种<strong>并行编程</strong>，理论上可能导致死锁或竞争条件。通过运行代码很难检测到这些类型的问题，并且通常需要某人（开发者和审查者）仔细思考它们以确保不会引入问题。 （请注意，这也是在可能出现竞争条件或死锁的情况下，不使用并发模型的一个很好的理由——它会使代码审查或理解代码变得非常复杂。）</p><h2 id="复杂度"><a href="#复杂度" class="headerlink" title="复杂度"></a>复杂度</h2><p>CL 是否已经超过它原本所必须的复杂度？针对任何层级的 CL 请务必确认这点——每行程序是否过于复杂？ 功能太复杂了吗？类太复杂了吗？ “太复杂”通常意味着**“阅读代码的人无法快速理解**。”也可能意味着**“开发者在尝试调用或修改此代码时可能会引入错误。”**</p><p>其中一种复杂性就是<strong>过度工程（over-engineering）</strong>，如开发人员使代码过度通用，超过它原本所需的，或者添加系统当前不需要的功能。审查者应特别警惕过度工程。未来的问题应该在它实际到达后解决，且届时才能更清晰的看到其真实样貌及在现实环境里的需求，鼓励开发人员解决他们现在需要解决的问题，而不是开发人员推测<strong>可能</strong>需要在未来解决的问题。</p><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>将要求单元、集成或端到端测试视为应该做的适当变更。通常，除非 CL 处理<a href="https://jimmysong.io/eng-practices/docs/review/emergencies">紧急情况</a>，否则应在与生产代码相同的 CL 中添加测试。</p><p>确保 CL 中的测试正确，合理且有用。测试并非用来测试自己本身，且我们很少为测试编写测试——人类必须确保测试有效。</p><p>当代码被破坏时，测试是否真的会失败？ 如果代码发生变化时，它们会开始产生误报吗？ 每个测试都会做出简单而有用的断言吗？ 不同测试方法的测试是否适当分开？</p><p>请记住，测试也是必须维护的代码。不要仅仅因为它们不是主二进制文件的一部分而接受测试中的复杂性。</p><h2 id="命名"><a href="#命名" class="headerlink" title="命名"></a>命名</h2><p>开发人员是否为所有内容选择了好名字？ 一个好名字应该足够长，可以完全传达项目的内容或作用，但又不会太长，以至于难以阅读。</p><h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><p>开发者是否用可理解的英语撰写了清晰的注释？所有注释都是必要的吗？通常，注释<strong>解释为什么</strong>某些代码存在时很有用，且不应该用来解释某些代码正在做什么。如果代码无法清楚到去解释自己时，那么代码应该变得更简单。有一些例外（正则表达式和复杂算法通常会从解释他们正在做什么事情的注释中获益很多），但大多数注释都是针对代码本身可能无法包含的信息，例如决策背后的推理。</p><p>查看此 CL 之前的注释也很有帮助。 也许有一个 TODO 现在可以删除，一个注释建议不要进行这种改变，等等。</p><p>请注意，注释与类、模块或函数的<strong>文档</strong>不同，它们应该代表一段代码的目的，如何使用它，以及使用时它的行为方式。</p><h2 id="风格"><a href="#风格" class="headerlink" title="风格"></a>风格</h2><p>Google 提供了所有主要语言的<a href="http://google.github.io/styleguide/">风格指南</a>，甚至包括大多数小众语言。确保 CL 遵循适当的风格指南。</p><p>如果您想改进风格指南中没有的一些样式点，请在评论前加上“Nit：”，让开发人员知道这是您认为可改善代码的小瑕疵，但不是强制性的。不要仅根据个人风格偏好阻止提交 CL。</p><p>CL 的作者不应在主要风格变更中，包括与其他种类的变更。它会使得很难看到 CL 中的变更了什么，使合并和回滚更复杂，并导致其他问题。例如，如果作者想要重新格式化整个文件，让他们只将重新格式化变为一个 CL，其后再发送另一个包含功能变更的 CL。</p><h2 id="文档"><a href="#文档" class="headerlink" title="文档"></a>文档</h2><p>如果 CL 变更了用户构建、测试、交互或发布代码的方式，请检查相关文档是否有更新，包括 README、g3doc 页面和任何生成的参考文档。如果 CL 删除或弃用代码，请考虑是否也应删除文档。 如果缺少文档，请询问。</p><h2 id="每一行"><a href="#每一行" class="headerlink" title="每一行"></a>每一行</h2><p>查看分配给您审查的<strong>每行</strong>代码。有时如数据文件、生成的代码或大型数据结构等东西，您可以快速扫过。但不要快速扫过人类编写的类、函数或代码块，并假设其中的内容是 OK 的。显然，某些代码需要比其他代码更仔细的审查——这是您必须做出的判断——但您至少应该确定您<strong>理解</strong>所有代码正在做什么。</p><p>如果您觉得这些代码太难以阅读了并减慢您审查的速度，您应该在您尝试继续审核前要让开发者知道这件事，并等待他们为程序做出解释、澄清。在 Google，我们聘请了优秀的软件工程师，您就是其中之一。如果您无法理解代码，那么很可能其他开发人员也不会。因此，当您要求开发人员澄清此代码时，您也会帮助未来的开发人员理解这些代码。</p><p>如果您了解代码但觉得没有资格做某些部分的审查，请确保 CL 上有一个合格的审查人，特别是对于安全性、并发性、可访问性、国际化等复杂问题。</p><h2 id="上下文"><a href="#上下文" class="headerlink" title="上下文"></a>上下文</h2><p>在广泛的上下文下查看 CL 通常很有帮助。通常，代码审查工具只会显示变更的部分的周围的几行。有时您必须查看整个文件以确保变更确实有意义。例如，您可能只看到添加了四行新代码，但是当您查看整个文件时，您会看到这四行是添加在一个 50 行的方法里，现在确实需要将它们分解为更小的方法。</p><p>在整个系统的上下文中考虑 CL 也很有用。 这个 CL 是否改善了系统的代码健康状况，还是使整个系统更复杂，测试更少等等？<strong>不要接受降低系统代码运行状况的 CL</strong>。大多数系统通过许多小的变化而变得复杂，因此防止新变更引入即便很小的复杂性也非常重要。</p><h2 id="好的事情"><a href="#好的事情" class="headerlink" title="好的事情"></a>好的事情</h2><p>如果您在 CL 中看到一些不错的东西，请告诉开发者，特别是当他们以一种很好的方式解决了您的的一个评论时。代码审查通常只关注错误，但也应该为良好实践提供鼓励。在指导方面，比起告诉他们他们做错了什么，有时更有价值的是告诉开发人员他们做对了什么。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>在进行代码审查时，您应该确保：</p><ul><li>代码设计精良。</li><li>该功能对代码用户是有好处的。</li><li>任何 UI 变更都是合理的且看起来是好的。</li><li>其中任何并行编程都是安全的。</li><li>代码并不比它需要的复杂。</li><li>开发人员没有实现他们将来<strong>可能</strong>需要，但不知道他们现在是否需要的东西。</li><li>代码有适当的单元测试。</li><li>测试精心设计。</li><li>开发人员使用了清晰的名称。</li><li>注释清晰有用，且大多用来解释<strong>为什么</strong>而不是<strong>做什么</strong>。</li><li>代码有适当记录成文件（通常在 g3doc 中）。</li><li>代码符合我们的风格指南。</li></ul><p>确保查看您被要求查看的<strong>每一行</strong>代码，查看<strong>上下文</strong>，确保您<strong>提高代码健康状况</strong>，并赞扬开发人员所做的<strong>好事</strong>。</p>]]></content>
    
    
    <categories>
      
      <category>规范</category>
      
    </categories>
    
    
    <tags>
      
      <tag>code review</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-11-29【监控】前端性能监控</title>
    <link href="/2025/11/28/2022-11-29-%E3%80%90%E7%9B%91%E6%8E%A7%E3%80%91%E5%BC%82%E5%B8%B8%E4%B8%8A%E6%8A%A5%E5%8F%8A%E7%9B%91%E6%8E%A7/"/>
    <url>/2025/11/28/2022-11-29-%E3%80%90%E7%9B%91%E6%8E%A7%E3%80%91%E5%BC%82%E5%B8%B8%E4%B8%8A%E6%8A%A5%E5%8F%8A%E7%9B%91%E6%8E%A7/</url>
    
    <content type="html"><![CDATA[<h1 id="onerror"><a href="#onerror" class="headerlink" title="onerror"></a>onerror</h1><p>window.onerror 是一个全局变量，默认值为 null。当有 js 运行时错误触发时，window 会触发 error 事件，并执行 window.onerror()。onerror 可以接受多个参数。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">window</span>.<span class="hljs-property">onerror</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">message, source, lineno, colno, error</span>) &#123; ... &#125;<br><br>函数参数：<br><br>*   message：错误信息（字符串）。可用于<span class="hljs-variable constant_">HTML</span> onerror=<span class="hljs-string">&quot;&quot;</span>处理程序中的event。<br>*   source：发生错误的脚本<span class="hljs-variable constant_">URL</span>（字符串）<br>*   lineno：发生错误的行号（数字）<br>*   colno：发生错误的列号（数字）<br>*   error：<span class="hljs-title class_">Error</span>对象<br><br>若该函数返回<span class="hljs-literal">true</span>，则阻止执行默认事件处理函数，如异常信息不会在<span class="hljs-variable language_">console</span>中打印。没有返回值或者返回值为<span class="hljs-literal">false</span>的时候，异常信息会在<span class="hljs-variable language_">console</span>中打印<br></code></pre></td></tr></table></figure><h1 id="addEventListener-‘error’"><a href="#addEventListener-‘error’" class="headerlink" title="addEventListener(‘error’)"></a>addEventListener(‘error’)</h1><p>监听 js 运行时错误事件，会比 window.onerror 先触发，与 onerror 的功能大体类似，不过事件回调函数传参只有一个保存所有错误信息的参数，不能阻止默认事件处理函数的执行，但可以全局捕获资源加载异常的错误</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">window</span>.<span class="hljs-property">onerror</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">message, source, lineno, colno, error</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">&quot;onerror============ %s&quot;</span>, error);<br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;;<br><span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;error&quot;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">&quot;onerror============ %s&quot;</span>, event);<br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;);<br></code></pre></td></tr></table></figure><h1 id="vue-异常-钩子"><a href="#vue-异常-钩子" class="headerlink" title="vue 异常 钩子"></a>vue 异常 钩子</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">errorHandler</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">err, vm, info</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Error: <span class="hljs-subst">$&#123;err.toString()&#125;</span>\nInfo: <span class="hljs-subst">$&#123;info&#125;</span>`</span>);<br>  aegis.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Error: <span class="hljs-subst">$&#123;err.toString()&#125;</span>\nInfo: <span class="hljs-subst">$&#123;info&#125;</span>`</span>);<br>&#125;;<br></code></pre></td></tr></table></figure><h1 id="vue-路由-异常钩子"><a href="#vue-路由-异常钩子" class="headerlink" title="vue 路由 异常钩子"></a>vue 路由 异常钩子</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js">router.<span class="hljs-title function_">onError</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> jsPattern = <span class="hljs-regexp">/Loading chunk (\S)+ failed/g</span>;<br>  <span class="hljs-keyword">const</span> cssPattern = <span class="hljs-regexp">/Loading CSS chunk (\S)+ failed/g</span>;<br>  <span class="hljs-keyword">const</span> isChunkLoadFailed = error.<span class="hljs-property">message</span>.<span class="hljs-title function_">match</span>(jsPattern || cssPattern);<br>  <span class="hljs-keyword">const</span> targetPath = router.<span class="hljs-property">history</span>.<span class="hljs-property">pending</span>.<span class="hljs-property">fullPath</span>;<br>  <span class="hljs-keyword">if</span> (isChunkLoadFailed) &#123;<br>    <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&quot;targetPath&quot;</span>, targetPath);<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-title function_">reload</span>();<br>  &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><ul><li>如果想通过 onerror 函数收集不同域的 js 错误，我们需要做两件事：</li></ul><ol><li>相关的 js 文件上加上 Access-Control-Allow-Origin:*的 response header</li><li>引用相关的 js 文件时加上 crossorigin 属性</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;script type=<span class="hljs-string">&quot;text/javascript&quot;</span> src=<span class="hljs-string">&quot;http://b.com/b.js&quot;</span> crossorigin&gt;&lt;/script&gt;<br></code></pre></td></tr></table></figure><h1 id="异常上报工具"><a href="#异常上报工具" class="headerlink" title="异常上报工具"></a>异常上报工具</h1><!-- sentry --><!-- aegis --><h2 id="系统发版，用户跳转页面-404-问题"><a href="#系统发版，用户跳转页面-404-问题" class="headerlink" title="系统发版，用户跳转页面 404 问题"></a>系统发版，用户跳转页面 404 问题</h2><p>通过 window.addEventListener 监听资源加载报错</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// index.html head顶部</span><br><span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<br>  <span class="hljs-string">&quot;error&quot;</span>,<br>  <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// 防止刷新过后资源依然404导致页面无限刷新， 在router.afterEach里删除</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">sessionStorage</span>.<span class="hljs-property">staticReload</span>) &#123;<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">let</span> localName = e.<span class="hljs-property">target</span>.<span class="hljs-property">localName</span>;<br>    <span class="hljs-keyword">if</span> (localName === <span class="hljs-string">&quot;script&quot;</span> || localName === <span class="hljs-string">&quot;link&quot;</span>) &#123;<br>      <span class="hljs-comment">// 只刷新一次 用 staticReload 标记一下</span><br>      <span class="hljs-variable language_">window</span>.<span class="hljs-property">sessionStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&quot;staticReload&quot;</span>, <span class="hljs-string">&quot;1&quot;</span>);<br>      <span class="hljs-comment">// reload里一定要加 true</span><br>      <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-title function_">reload</span>(<span class="hljs-literal">true</span>);<br>    &#125;<br>    <span class="hljs-comment">// 这个true一定要加，否则监听不到</span><br>  &#125;,<br>  <span class="hljs-literal">true</span><br>);<br><br><span class="hljs-comment">// 或</span><br><span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<br>  <span class="hljs-string">&quot;error&quot;</span>,<br>  <span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-keyword">const</span> target = event.<span class="hljs-property">target</span> || event.<span class="hljs-property">srcElement</span>;<br>      <span class="hljs-keyword">if</span> (<br>        target <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">HTMLElement</span> &amp;&amp;<br>        [<span class="hljs-string">&quot;LINK&quot;</span>, <span class="hljs-string">&quot;SCRIPT&quot;</span>, <span class="hljs-string">&quot;IMG&quot;</span>].<span class="hljs-title function_">indexOf</span>(target.<span class="hljs-property">nodeName</span>) !== -<span class="hljs-number">1</span><br>      ) &#123;<br>        <span class="hljs-comment">// 下载资源失败</span><br>        <span class="hljs-comment">// @ts-ignore</span><br>        <span class="hljs-keyword">const</span> src = target.<span class="hljs-property">src</span> || target.<span class="hljs-property">href</span>;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>.<span class="hljs-title function_">indexOf</span>(src) !== <span class="hljs-number">0</span>) &#123;<br>          <span class="hljs-title function_">reportResourceFail</span>(&#123;<br>            <span class="hljs-attr">detail</span>: src,<br>          &#125;);<br>        &#125;<br>      &#125;<br>    &#125; <span class="hljs-keyword">catch</span> (err) &#123;&#125;<br>  &#125;,<br>  <span class="hljs-literal">true</span><br>);<br></code></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// router.js</span><br><span class="hljs-comment">// 跳转成功，说明css js资源加载成功，则去掉 staticReload 标记</span><br>router.<span class="hljs-title function_">afterEach</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">sessionStorage</span>.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">&quot;staticReload&quot;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><h3 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h3><ol><li>window.addEventListener 的第三个参数 一定要是 true，表示用事件捕获。</li><li>window.location.reload(true) 里一定要用 true, 表示直接从服务器取资源。</li><li>加一个标记，只刷新一次就够了，因为如果是因为某个资源本身不存在导致刷新完又 404，会让页面无限刷新。我们解决的只是能保证刷新页面就能获取到的正常打包资源。</li></ol><h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>这样一旦用户停留页面的时间正好跨越了发版时间，资源加载 404 的情况下，会直接在当前页面强行刷新一下，然后就能正常使用了。</p>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-11-29【监控】前端性能监控</title>
    <link href="/2025/11/28/2022-11-29-%E3%80%90%E7%9B%91%E6%8E%A7%E3%80%91%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7-%E9%83%A8%E5%88%86%E5%8E%9F%E7%90%86%E7%AF%87/"/>
    <url>/2025/11/28/2022-11-29-%E3%80%90%E7%9B%91%E6%8E%A7%E3%80%91%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7-%E9%83%A8%E5%88%86%E5%8E%9F%E7%90%86%E7%AF%87/</url>
    
    <content type="html"><![CDATA[<h1 id="5、监控原理"><a href="#5、监控原理" class="headerlink" title="5、监控原理"></a>5、监控原理</h1><h2 id="错误监控"><a href="#错误监控" class="headerlink" title="错误监控"></a>错误监控</h2><h3 id="1-JS-执行错误"><a href="#1-JS-执行错误" class="headerlink" title="1. JS 执行错误"></a>1. JS 执行错误</h3><p>要捕获 JS 的运行时错误，只需要监听 onerror 事件。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">window</span>.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">message, source, lineno, colno, error</span>) =&gt;</span> &#123;<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="2-promise-执行错误"><a href="#2-promise-执行错误" class="headerlink" title="2. promise 执行错误"></a>2. promise 执行错误</h3><p>要捕获没有被用户 catch 的 promise 错误，可以通过监听 unhandledrejection 事件实现。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;unhandledrejection&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">event: PromiseRejectionEvent</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> reason = event &amp;&amp; <span class="hljs-title function_">stringifyPlus</span>(event.<span class="hljs-property">reason</span>);<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">publishErrorLog</span>(&#123;<br>    <span class="hljs-attr">msg</span>: <span class="hljs-string">`PROMISE_ERROR: <span class="hljs-subst">$&#123;reason&#125;</span>`</span>,<br>    <span class="hljs-attr">level</span>: <span class="hljs-title class_">LogType</span>.<span class="hljs-property">PROMISE_ERROR</span>,<br>  &#125;);<br>&#125;;);<br></code></pre></td></tr></table></figure><h3 id="3-资源加载失败"><a href="#3-资源加载失败" class="headerlink" title="3. 资源加载失败"></a>3. 资源加载失败</h3><p>只要监听 error 事件就能获取到资源加载失败的信息。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">window</span>.<span class="hljs-property">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">event: Event</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> target = event?.<span class="hljs-property">target</span> || event?.<span class="hljs-property">srcElement</span>;<br>  <span class="hljs-keyword">const</span> url = target.<span class="hljs-property">src</span> || target.<span class="hljs-property">href</span>;<br>  <span class="hljs-keyword">const</span> &#123; tagName &#125; = target;<br>...<br>&#125;, <span class="hljs-literal">true</span>);<br></code></pre></td></tr></table></figure><h3 id="4-接口请求异常"><a href="#4-接口请求异常" class="headerlink" title="4. 接口请求异常"></a>4. 接口请求异常</h3><p>要获取接口请求的异常，需要劫持 XMLHttpRequest 和 fetch 这 2 个浏览器 API，在请求返回的时候判断是否有错误。</p><h2 id="性能监控"><a href="#性能监控" class="headerlink" title="性能监控"></a>性能监控</h2><h3 id="1-页面测速"><a href="#1-页面测速" class="headerlink" title="1. 页面测速"></a>1. 页面测速</h3><p>Performance API</p><h3 id="2-Web-Vitals"><a href="#2-Web-Vitals" class="headerlink" title="2. Web Vitals"></a>2. Web Vitals</h3><p>Web Vitals 的获取方式比较简单，直接使用 google 提供的 npm 包就能获取到，我们就简单归类为浏览器 API 的直接调用。</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs clean"><span class="hljs-keyword">import</span> &#123;getFCP, getLCP, getFID, getCLS&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;web-vitals/base&#x27;</span><br></code></pre></td></tr></table></figure><p>目前 Google 的 web-vitals 源码 中提供了5个指标，分别为</p><ol><li><p>CLS（Cumulative Layout Shift - 累积布局移位）: CLS 会衡量在网页的整个生命周期内发生的所有意外布局偏移的得分总和。得分是零到任意正数，其中 0 表示无偏移，且数字越大，网页的布局偏移越大。</p></li><li><p>FCP（First Contentful Paint - 首次内容绘制）：FCP 度量从页面开始加载到页面内容的任何部分呈现在屏幕上的时间，页面内容包括文本、图像（包括背景图像）、<svg>元素或非白色的<canvas>元素。</p></li><li><p>FID（First Input Delay - 首次输入延迟）：从用户首次与您的网页互动（点击链接、点按按钮，等等）到浏览器响应此次互动之间的用时。这种衡量方案的对象是被用户首次点击的任何互动式元素。</p></li><li><p>LCP（Largest Contentful Paint - 最大内容绘制）：LCP 度量从用户请求网址到在视口中渲染最大可见内容元素所需的时间。最大的元素通常是图片或视频，也可能是大型块级文本元素。</p></li><li><p>TTFB (Time To First Byte - 从服务器接收到第一个字节耗时) TTFB 是发出页面请求到接收到应答数据第一个字节的时间总和，它包含了 DNS 解析时间、 TCP 连接时间、发送 HTTP 请求时间和获得响应消息第一个字节的时间。</p></li></ol><p>目前 RUM &amp; TAM 采有了其中最重要的三个属性：LCP，FID，CLS。</p><h3 id="3-接口测速"><a href="#3-接口测速" class="headerlink" title="3. 接口测速"></a>3. 接口测速</h3><p>要对接口进行测速，同样需要劫持 XMLHttpRequest和 fetch这 2 个浏览器 API，记录接口发起调用和返回数据的时间差。</p><h3 id="4-资源测速"><a href="#4-资源测速" class="headerlink" title="4. 资源测速"></a>4. 资源测速</h3><p>资源测速是使用 PerformanceObserver 来实现的。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><br><span class="hljs-keyword">const</span> observer = <span class="hljs-keyword">new</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title class_">PerformanceObserver</span>(<span class="hljs-function">(<span class="hljs-params">list</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> entries = list.<span class="hljs-title function_">getEntries</span>();<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>, l = entries.<span class="hljs-property">length</span>; i &lt; l; i++) &#123;<br>    <span class="hljs-keyword">const</span> entry = entries[i];<br>    <span class="hljs-keyword">const</span> duration = entry.<span class="hljs-property">duration</span>.<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>);<br>    ...<br>  &#125;<br>&#125;);<br><br>observer.<span class="hljs-title function_">observe</span>(&#123; <span class="hljs-attr">entryTypes</span>: [<span class="hljs-string">&#x27;resource&#x27;</span>] &#125;);<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-11-29【监控】前端性能监控</title>
    <link href="/2025/11/28/2022-11-29-%E3%80%90%E7%9B%91%E6%8E%A7%E3%80%91%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7-%E4%BD%BF%E7%94%A8/"/>
    <url>/2025/11/28/2022-11-29-%E3%80%90%E7%9B%91%E6%8E%A7%E3%80%91%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7-%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="1、什么是前端监控"><a href="#1、什么是前端监控" class="headerlink" title="1、什么是前端监控"></a>1、什么是前端监控</h1><p>可以对应用运行状态监听、异常收集、性能监控、甚至对用户行为进行分析。</p><h1 id="2、前端监控能做什么"><a href="#2、前端监控能做什么" class="headerlink" title="2、前端监控能做什么"></a>2、前端监控能做什么</h1><ol><li>页面性能分析</li><li>项目质量（异常上报，技术债务治理）</li><li>用户行为分析（主动日志上报，埋点）</li></ol><h1 id="3、监控产品选择"><a href="#3、监控产品选择" class="headerlink" title="3、监控产品选择"></a>3、监控产品选择</h1><p>由于应用部署在腾讯云上，这里首选腾讯云产品”前端性能监控”作为前端监控工具；RUM</p><h2 id="具有的功能"><a href="#具有的功能" class="headerlink" title="具有的功能"></a>具有的功能</h2><ol><li>日志上报<br>前端性能监控支持开发者上报任意数据到前端监控平台，包括一般性日志、自定义事件、自定义测速等。用来满足前端开发者日志收集的诉求。</li><li>错误收集<br>前端性能监控针对浏览器执行 JS 代码报错、接口信息报错、资源加载异常、Promise 异常等报错都有 SDK 进行主动收集，开发者只需接入 SDK 就可以实现所有错误收集的功能。</li><li>性能数据<br>前端性能监控包括众多页面性能数据，其中包括首屏耗时、建立 TCP 连接耗时、TTFB 耗时和 SSL 耗时等。除此之外，最新的 webvitals（谷歌针对网页加载速度和体验所提出的一套指标） 标准已支持页面性能三大核心指标等数据，也可进行数据采集和上报。</li><li>页面访问<br>前端性能监控支持查看页面访问 PV（页面访问量）和 UV（页面独立访问量），通过运营商、访问来源和访问地域等维度，实时了解并分析用户访问情况。</li><li>资源测速<br>前端性能监控支持资源测速，包括图片加载耗时和 CDN 资源耗时等。开发者可以查看某个页面下具体使用了哪些资源，每个资源的耗时情况等信息。同时前端性能监控支持对地域信息统计，ISP 信息统计等功能。</li><li>接口测速<br>前端性能监控可通过接口测速统计页面上所有调用接口的信息，包括接口耗时和状态码统计等信息。同时前端性能监控支持对地域信息统计和 ISP 信息统计等功能。</li><li>智能告警<br>前端性能监控支持错误告警、页面耗时告警和性能数据告警等功能。</li></ol><h2 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h2><ul><li><p>多平台<br>前端性能监控目前支持 Web、Hippy、小程序（微信、QQ）和 React Native 等平台的数据上报，支持无打点首屏测速、资源测速、API 测速、白名单机制和离线日志等功能特性。</p></li><li><p>无侵入<br>前端性能监控 SDK 无需在业务代码中打点或者做任何其他操作，可以做到与业务代码充分解耦。 SDK 将会自动监控前端错误，在错误发生时上报错误的具体情况，帮助您快速定位问题。当您开启资源测速时，SDK 将会自动监听页面资源加载情况（耗费时长、成功率等），并在不影响前端性能的前提下收集前端的性能数据，帮助您快速定位性能短板，提升用户体验。</p></li><li><p>低成本<br>前端性能监控支持 Web 和小程序的前端真实体验监控服务，学习成本较低，只要您有过基础的前端知识，就可以放心的使用。</p></li></ul><h1 id="4、腾讯云前端性能监控接入"><a href="#4、腾讯云前端性能监控接入" class="headerlink" title="4、腾讯云前端性能监控接入"></a>4、腾讯云前端性能监控接入</h1><h2 id="步骤1：创建业务系统"><a href="#步骤1：创建业务系统" class="headerlink" title="步骤1：创建业务系统"></a>步骤1：创建业务系统</h2><ol><li>登录 前端性能监控控制台。</li><li>在左侧菜单栏点击 应用管理&gt;业务系统。</li><li>在业务系统管理页单击创建业务系统，在弹框中填写业务名称并勾选相关协议即可。<br><img src="/api/project/10918198/files/29766016/imagePreview" alt="图片"><br>注：每日可免费上报50万条数据</li></ol><h2 id="步骤2：接入应用"><a href="#步骤2：接入应用" class="headerlink" title="步骤2：接入应用"></a>步骤2：接入应用</h2><ol><li>登录 前端性能监控控制台。</li><li>在左侧菜单栏中单击数据总览。</li><li>在数据总览页单击应用接入，配置应用信息。<br><img src="/api/project/10918198/files/29766181/imagePreview" alt="图片"></li><li>配置完后单击下一步，参考下列说明选择一种方式安装 SDK 。<br>方式1 npm方式安装 SDK（所有应用类型均可使用该方式接入）。下列 Web 应用为例说明如何通过 npm 方式接入 SDK。<br>i. 在接入指引页面中复制提供的首行命令，引入 npm 包。<br><img src="/api/project/10918198/files/29766186/imagePreview" alt="图片"><br>ii. 在接入指引页面中复制提供的代码初始化 SDK。<br><img src="/api/project/10918198/files/29766187/imagePreview" alt="图片"><br>方式2 cdn引入</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span> 标签引入方式接入 SDK（仅支持 Web 接入类型）。<br></code></pre></td></tr></table></figure><p>i. 在接入指引页面复制提供的 <script> 标签 代码。<br>ii. 把**<script> 标签引入**类型下的代码引入到 <head></head> 标签中即可。<br><img src="/api/project/10918198/files/29766189/imagePreview" alt="图片"></p><h2 id="步骤3：查看监控数据"><a href="#步骤3：查看监控数据" class="headerlink" title="步骤3：查看监控数据"></a>步骤3：查看监控数据</h2><ol><li>完成配置、部署应用后，刷新界面、调用接口或触发自定义的日志上报功能后，将在network 中可以看到上报接口的调用。如下：<br><img src="/api/project/10918198/files/29766195/imagePreview" alt="图片"></li><li>通过一段时间的数据上报，可在腾讯云“前性能监控”页面中查看对应数据（日志、异常、页面访问）<br><img src="/api/project/10918198/files/29766233/imagePreview" alt="图片"></li></ol><h1 id="5、数据如何分析"><a href="#5、数据如何分析" class="headerlink" title="5、数据如何分析"></a>5、数据如何分析</h1><h1 id="RUM-与-TAM"><a href="#RUM-与-TAM" class="headerlink" title="RUM 与 TAM"></a>RUM 与 TAM</h1><ul><li>TAM上未绑定RUM业务系统id的项目，每个小时限流日志上报约5w条，超过后会对全量上报进行限流，下个小时自动解除限流。<a href="https://km.woa.com/group/42893/articles/show/512416">https://km.woa.com/group/42893/articles/show/512416</a><br>目前TAM成本计算公式为 上报量/10000*0.0238 成本优化持续进行中</li></ul><h1 id="Q-A"><a href="#Q-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h1>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-12-03-【优化】前端性能测试工具</title>
    <link href="/2025/11/28/2022-12-03-%E3%80%90%E4%BC%98%E5%8C%96%E3%80%91%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/"/>
    <url>/2025/11/28/2022-12-03-%E3%80%90%E4%BC%98%E5%8C%96%E3%80%91%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/</url>
    
    <content type="html"><![CDATA[<h2 id="工具：思考与总结"><a href="#工具：思考与总结" class="headerlink" title="工具：思考与总结"></a>工具：思考与总结</h2><p>我们该如何选择？如何使用好这些工具进行分析？</p><p>首先我们可以使用Lighthouse，在本地进行测量，根据报告给出的一些建议进行优化；<br>发布之后，我们可以使用PageSpeed Insights去看下线上的性能情况；<br>接着，我们可以使用Chrome User Experience Report API去捞取线上过去28天的数据；<br>发现数据有异常，我们可以使用DevTools工具进行具体代码定位分析；<br>使用Search Console’s Core Web Vitals report查看网站功能整体情况；<br>使用Web Vitals扩展方便的看页面核心指标情况；</p><p>三、Lighthouse 介绍<br>Lighthouse 是 Google 开源的自动化工具，用于改进网络应用的质量。它可以作为一个 Chrome 扩展程序运行，或从命令行运行。只需要为 Lighthouse 提供一个要审查的网址，它将针对此页面运行一连串的测试，然后生成一个有关页面性能的报告，从中看看可以采取哪些措施来改进应用。</p><p>Lighthouse 由这几部分组成</p><p>Driver（驱动）—— 通过 Chrome Debugging Protocol 和 Chrome 进行交互。</p><p>Gatherer（采集器）—— 决定在页面加载过程中采集哪些信息，将采集的信息输出为 Artifact。可自定义。</p><p>Audit（审查器）—— 将 Gatherer 采集的 Artifact 作为输入，审查器会对其测试，然后得出相应的测评结果。可自定义。</p><p>Reporte（报告）—— 将审查的结果通过指定的方式报告出来。</p><h2 id="测试报告包括"><a href="#测试报告包括" class="headerlink" title="测试报告包括"></a>测试报告包括</h2><p>性能（Performance），访问无障碍（Accessibility），最佳实践（Best Practice），搜索引擎优化（SEO），PWA（Progressive Web App）5 个部分</p><h3 id="性能"><a href="#性能" class="headerlink" title="性能"></a>性能</h3><p>Lighthouse 提供了 6 个性能指标：FCP、SI、LCP、TTI、TBT 和 CLS，权重分别是 10%，10%，25%，10%，30% 和 15%。Lighthouse 会根据权重计算得到一个分数值。详细指标含义可以参考链接：<a href="https://web.dev/lighthouse-performance/">https://web.dev/lighthouse-performance/</a></p><p><a href="https://pagespeed.web.dev/?utm_source=psi&utm_medium=redirect">https://pagespeed.web.dev/?utm_source=psi&amp;utm_medium=redirect</a></p><p>参考资料<br><a href="https://heapdump.cn/article/3469499">Puppeteer+Lighthouse</a></p>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-12-03-【压测】压测实践</title>
    <link href="/2025/11/28/2022-12-03-%E3%80%90%E5%8E%8B%E6%B5%8B%E3%80%91%E5%8E%8B%E6%B5%8B%E5%AE%9E%E8%B7%B5/"/>
    <url>/2025/11/28/2022-12-03-%E3%80%90%E5%8E%8B%E6%B5%8B%E3%80%91%E5%8E%8B%E6%B5%8B%E5%AE%9E%E8%B7%B5/</url>
    
    <content type="html"><![CDATA[<p>1、环境安装<br>2、启动 JEMTER<br>3、JMETER 参数配置<br>4、执行 <code>jmeter -n -t 登录页访问.jmx -l ./result.txt -e -o ./webreport</code></p><h2 id="jmeter-启动"><a href="#jmeter-启动" class="headerlink" title="jmeter 启动"></a>jmeter 启动</h2><h3 id="方式一："><a href="#方式一：" class="headerlink" title="方式一："></a>方式一：</h3><p>终端进入 jmeter 的 bin 文件路径后，执行 sh jmeter 即可启动，如下图<br>退出：输入 exit()</p><h3 id="方式二（推荐）："><a href="#方式二（推荐）：" class="headerlink" title="方式二（推荐）："></a>方式二（推荐）：</h3><p>终端直接输入 jmeter 启动（需先至 bash_profile 文件内进行配置，配置步骤如下）</p><p>1、终端输入 vim ~&#x2F;.bash_profile 进入到 vim 编辑器，输入 i 进入编辑模式，以下命令：</p><p>export JMETER_HOME&#x3D;&#x2F;Users&#x2F;u51zhang&#x2F;Downloads&#x2F;apache-jmeter-5.4<br>export PATH&#x3D;$JAVA_HOME&#x2F;bin:$PATH:.:$JMETER_HOME&#x2F;bin:$PATH<br>export CLASSPATH&#x3D;.:$JAVA_HOME&#x2F;lib&#x2F;dt.jar:$JAVA_HOME&#x2F;lib&#x2F;tools.jar:$JMETER_HOME&#x2F;lib&#x2F;ext&#x2F;ApacheJMeter_core.jar:$JMETER_HOME&#x2F;lib&#x2F;jorphan.jar:$JMETER_HOME&#x2F;lib&#x2F;logkit-2.0.jar<br>2、按下 esc 退出编辑模式，输入:wq 保存并退出<br>3、继续在终端中输入 source ~&#x2F;.bash_profile，使配置文件在修改后立即生效</p><h3 id="如果启动报错"><a href="#如果启动报错" class="headerlink" title="如果启动报错"></a>如果启动报错</h3><ul><li>VM option ‘UseG1Gc’ is experimental and must be enabled via -XX:+UnlockExperimentalVMOptions</li></ul><p>解决步骤如下：</p><ul><li>在 jmeter&#x2F;bin 目录下，用记事本或 vi 打开 jmeter ，注意不带任何扩展名。</li><li>将这一行: “${GC_ALGO:&#x3D;”-XX:+UseG1GC -XX:MaxGCPauseMillis&#x3D;100 -XX:G1ReservePercent&#x3D;20”}”这一行注释掉。</li><li>保存后重新运行 jmeter 命令，解决。</li></ul><h3 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h3><p>需要注意的是，上面的设置默认使用 bash，如果你在 Mac 上使用的是 zsh 等 shell 工具，需要再做如下配置，来达到环境变量设置的永久生效。</p><p>vim ~&#x2F;.zshrc<br>在开头添加<br>if [ -f ~&#x2F;.bash_profile ]; then<br>source ~&#x2F;.bash_profile<br>fi<br>使用下面的命令使之立即生效<br>source ~&#x2F;.zshrc</p><p>原因解释如下：<br>bash 的配置文件是.bashrc, zsh 的配置文件是.zshrc，当你使用 zsh 作为默认 shell 工具的时候，它启动时并不会加载 bash 的这两个配置文件.bashrc 和.bash_profile，而只会<br>加载自己的配置文件.zshrc，为了让我们的配置文件生效，只能在.zshrc 中添加上面的配置。</p><p><a href="https://cloud.tencent.com/developer/article/1635133">报告解读</a><br><a href="https://gitee.com/smooth00/jmeter-cn-report-template/tree/master/jmeter5.x-cn-report-template-master#https://gitee.com/smooth00/jmeter-cn-report-template/attach_files/270894/download">报告汉化处理</a></p><h1 id="性能测试、压测"><a href="#性能测试、压测" class="headerlink" title="性能测试、压测"></a>性能测试、压测</h1><p>首先我们需要借助测试工具模拟在高并发情况下的状态，这里我推荐两种压测工具。</p><p>ab 官方文档<br>webbench<br>autocannon</p><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>目前 JavaScript 开发的趋势是什么？<br>JavaScript 中 10 个最热门的趋势</p>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-12-22-【工程化】RPA方案架构设计</title>
    <link href="/2025/11/28/2022-12-22-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91RPA%E6%96%B9%E6%A1%88%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/"/>
    <url>/2025/11/28/2022-12-22-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91RPA%E6%96%B9%E6%A1%88%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/</url>
    
    <content type="html"><![CDATA[<h1 id="前端技术架构"><a href="#前端技术架构" class="headerlink" title="前端技术架构"></a>前端技术架构</h1><p>nodejs<br>egg、koa2、expres<br>pm2</p><p>爬虫工具<br>Puppeteer</p><h1 id="开发环境准备"><a href="#开发环境准备" class="headerlink" title="开发环境准备"></a>开发环境准备</h1><p>node &gt; 14<br>npm<br>egg 安装</p><p>安装 pm2(用于守护 node 服务)<br>【注意：安装 pm2 前必须安装 npm，如果只是非正式环境可以不用安装 pm2】</p><p>npm install pm2 -g</p><h1 id="容器化部署"><a href="#容器化部署" class="headerlink" title="容器化部署"></a>容器化部署</h1><p>Puppeteer</p><p><a href="https://yeasy.gitbook.io/docker_practice/install/mirror">docker 镜像加速</a></p><h1 id="node-框架选型"><a href="#node-框架选型" class="headerlink" title="node 框架选型"></a>node 框架选型</h1><p>egg 项目初始化<br>npm init egg –type&#x3D;simple</p><!-- 骨架类型说明simple简单 egg 应用程序骨架empty空的 egg 应用程序骨架pluginegg plugin 骨架frameworkegg framework 骨架 --><p>playwright</p><h3 id="惊天大坑"><a href="#惊天大坑" class="headerlink" title="惊天大坑"></a>惊天大坑</h3><p>playwright firefox 未释放，导致爬虫请求无法触达，处于等待队列</p>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>RPA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-12-03-【优化】前端性能优化</title>
    <link href="/2025/11/28/2022-12-03-%E3%80%90%E4%BC%98%E5%8C%96%E3%80%91%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    <url>/2025/11/28/2022-12-03-%E3%80%90%E4%BC%98%E5%8C%96%E3%80%91%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<h1 id="前端性能优化"><a href="#前端性能优化" class="headerlink" title="前端性能优化"></a>前端性能优化</h1><p>优化方式分类<br>1、免费</p><blockquote><p>包体积<br>ng配置<br>缓存<br>代码压缩 gzip，webpack、vite压缩<br>最小化HTTP请求、响应大小<br>JavaScript中的性能优化，1.避免JS动画 2.节流（滚动加载、提交按钮）和防抖（搜索、鼠标移动，窗口resize）<br>图片懒加载<br>使用CSS3 代替图片<br>提取公共代码</p></blockquote><p>2、花费</p><blockquote><p>cdn<br>带宽<br>cpu&#x2F;mem</p></blockquote><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>为满足不同企业对系统登录页个性化设计，且需要独立域名访问的要求，另外合同层面及部署层面强要求，将页面进行拆分部署，以达到合规目的。</p><p>遂将原有应用一分为二，将登录页独立部署（每新增一个企业使用，独立部署一套个性化UI的登录NG），所有访问请求需通过登录页ng进行代理。</p><p>考虑到每个企业的部署成本，需给出该部署架构下登录页节点的最优资源配置；为找到最合理的部署资源配置参数，我们将对系统进行压测以获取CPU、内存的部署资源参数。  </p><p><img src="/assets/images/%E7%99%BB%E5%BD%95%E9%A1%B5%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8B%86%E5%88%86/%E7%99%BB%E5%BD%95%E9%A1%B5%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8B%86%E5%88%86.png" alt="部署架构图"></p><h2 id="压测目的-体验目标"><a href="#压测目的-体验目标" class="headerlink" title="压测目的&amp;体验目标"></a>压测目的&amp;体验目标</h2><ul><li>为节省腾讯云部署资源，找出最优资源配置；</li></ul><blockquote><p>根据架构师按用户使用情况进行预估，给到的最大并发10，合理并发5，通过压测工具jmeter进行测试；<br>将资源不断减半压缩，以测试当前部署架构下，系统的抗压能力，最终找到最低的资源配置参数，以达到降低成本的目的。</p></blockquote><ul><li><a href="https://segmentfault.com/a/1190000041753539">体验目标</a></li></ul><blockquote><p>渲染目标 FP及FCP 在2秒内完成，体验优秀<br>LCP(Largest Contentful Paint)代表了页面的速度指标，小于 2.5秒<br>FID(First Input Delay)代表了页面的交互体验指标，100ms 以内<br>CLS(Cumulative Layout Shift)代表了页面的稳定指标，0.1或以下</p></blockquote><p>___ 初始部署资源 ___<br>request 1C1G, limit 2C2G<br>___ 目标部署资源 ___<br>request 0.5C512M，limit 1C1G  </p><h2 id="压测结果【优化前-优化后】"><a href="#压测结果【优化前-优化后】" class="headerlink" title="压测结果【优化前&amp;优化后】"></a>压测结果【优化前&amp;优化后】</h2><ol><li><p>并发测试<br>测试工具：jmeter<br>腾讯云环境：单节点测试（开放主机端口进行访问）<br>测试方法：</p><ul><li>利用大体积静态资源（JS&#x2F;CSS）的http请求，预估页面并发下资源加载时长</li><li>大文件http请求（动态GZIP压缩）JS文件 519K </li><li>大文件http请求（动态GZIP压缩）css文件 43.6K</li><li>普通http Get请求</li></ul><p> 腾讯云资源</p><p> <strong>优化前</strong></p><ul><li>[测试1] request:1C1G limit:2C2G<ul><li>10并发</li><li>5并发</li></ul></li><li>[测试2] request:0.5C512M limit:1C1G<ul><li>10并发<br><img src="/assets/images/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/0.5C512MB10T.old.jpg" alt="0.5C512MB10T.old.jpg"></li><li>5并发<br><img src="/assets/images/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/0.5C512MB5T.old.jpg" alt="0.5C512MB5T.old.jpg"></li></ul></li><li>[测试3] request:0.3C256M limit:0.5C512G<ul><li>10并发<br><img src="/assets/images/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/0.3C256MB10T.old.png" alt="0.3C256MB10T.old.jpg"> </li><li>5并发<br><img src="/assets/images/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/0.3C256MB5T.old.png" alt="0.3C256MB5T.old.jpg"></li></ul></li></ul></li><li><p>页面性能测试<br>测试工具：Lighthouse</p></li></ol><ul><li><strong>优化前</strong><br><img src="/assets/images/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/1C1G%E4%BC%98%E5%8C%96%E5%89%8Dlighthouse%E8%AF%84%E5%88%86.png" alt="0.3C256MB5T.old.jpg"></li></ul><h2 id="优化思路"><a href="#优化思路" class="headerlink" title="优化思路"></a>优化思路</h2><p>影响并发的主要因素有服务器端及客户端的网络、CPU、内存。而影响前端访问性能的因素分为两个部分，加载效率以及运行效率。</p><p>加载时优化<br>1、包体积优化<br>2、CDN加载<br>3、GZIP（动态+静态）<br>4、网络优化，合并请求、减少资源大小</p><p>运行时优化<br>1、减少重排 重绘（减少dom规模-content-visibility）<br>2、避免页面卡顿、<br>3、长列表（虚拟列表 滚动优化passive）、代码性能、防抖节流</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">&#x27;touchstart&#x27;</span>, onTouchStart, &#123; passive: <span class="hljs-keyword">true</span> &#125;);<br><span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">&#x27;touchmove&#x27;</span>, onTouchStart, &#123; passive: <span class="hljs-keyword">true</span> &#125;);<br><span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">&#x27;mousewheel&#x27;</span>, onTouchStart, &#123; passive: <span class="hljs-keyword">true</span> &#125;);<br></code></pre></td></tr></table></figure><p>由于项目中体积最大的依赖：UI组件库tdesign只有最新版本的CDN资源，不提供历史版本的CDN，仅优化其他小体积的，改造意义不大。</p><p>通过TOP指令监控腾讯云部署节点的CPU&#x2F;MEM使用情况，观察数据变化分析结果得出，影响低并发的最大因素为网络，而同等带宽下影响下载时长的最大因素为下载资源的体积，所以优化最大资源体积会取得最明显的优化效果。</p><h2 id="工程背景"><a href="#工程背景" class="headerlink" title="工程背景"></a>工程背景</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-string">&quot;vue&quot;</span>: <span class="hljs-string">&quot;2.6.11&quot;</span>,<br><span class="hljs-string">&quot;vite&quot;</span>: <span class="hljs-string">&quot;2.8.6&quot;</span>,<br></code></pre></td></tr></table></figure><h3 id="打包优化"><a href="#打包优化" class="headerlink" title="打包优化"></a>打包优化</h3><h4 id="依赖包体积检查"><a href="#依赖包体积检查" class="headerlink" title="依赖包体积检查"></a>依赖包体积检查</h4><p> <a href="https://bundlejs.com/">bundlejs.com</a> 这样的工具可以用来做快速的检查，但是根据实际的构建设置来评估总是最准确的。</p><p>原始打包后静态资源分析<br><img src="/assets/images/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E5%8E%9F%E5%A7%8B%E5%8C%85%E4%BD%93%E7%A7%AF.png" alt="原始包体积"></p><h4 id="1-关闭一些打包配置项"><a href="#1-关闭一些打包配置项" class="headerlink" title="1. 关闭一些打包配置项"></a>1. 关闭一些打包配置项</h4><ul><li>这个东西一般是在测试阶段调试使用的</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">build</span>: &#123; <br>      <span class="hljs-attr">terserOptions</span>: &#123;<br>        <span class="hljs-attr">compress</span>: &#123;<br>          <span class="hljs-comment">//生产环境时移除console</span><br>          <span class="hljs-attr">drop_console</span>: <span class="hljs-literal">true</span>,<br>          <span class="hljs-attr">drop_debugger</span>: <span class="hljs-literal">true</span>,<br>        &#125;,<br>      &#125;,<br>    <span class="hljs-comment">//   关闭文件计算</span><br>      <span class="hljs-attr">reportCompressedSize</span>: <span class="hljs-literal">false</span>,<br>    <span class="hljs-comment">//   关闭生成map文件 可以达到缩小打包体积</span><br>      <span class="hljs-attr">sourcemap</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 这个生产环境一定要关闭，不然打包的产物会很大</span><br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/assets/images/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E5%85%B3%E9%97%AD%E4%B8%80%E4%BA%9B%E6%89%93%E5%8C%85%E9%85%8D%E7%BD%AE%E9%A1%B9.png" alt="原始包体积"></p><h4 id="2-webpackChunkName-按路由配置moudle合并chunk"><a href="#2-webpackChunkName-按路由配置moudle合并chunk" class="headerlink" title="2. webpackChunkName 按路由配置moudle合并chunk"></a>2. webpackChunkName 按路由配置moudle合并chunk</h4><p>引入包<code>vite-plugin-webpackchunkname</code>，使vite 支持。</p><p>配合动态路由配置</p><p>优化前 82个文件<br>优化后 53个文件</p><ul><li>2.1 装包</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs s">yarn -D add vite-plugin-webpackchunkname<br></code></pre></td></tr></table></figure><ul><li>2.2 配置 vite.config.js</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// vite.config.js</span><br><span class="hljs-keyword">import</span> &#123; manualChunksPlugin &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vite-plugin-webpackchunkname&#x27;</span><br><span class="hljs-comment">// Other dependencies...</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(&#123;<br>  <span class="hljs-attr">plugins</span>: [<br>    <span class="hljs-title function_">manualChunksPlugin</span>(),<br>  ]<br>&#125;)<br></code></pre></td></tr></table></figure><ul><li>说明：Support for user defined manual chunks 支持用户自定义chunks *</li></ul><h4 id="3-拆分依赖包"><a href="#3-拆分依赖包" class="headerlink" title="3. 拆分依赖包"></a>3. 拆分依赖包</h4><ul><li>根据依赖包体积进行规划，均匀划分vendor大小，均匀拆分依赖；</li><li>通过gzip压缩降低2&#x2F;3 体积。</li></ul><h5 id="3-1-vite-相关配置"><a href="#3-1-vite-相关配置" class="headerlink" title="3.1 vite 相关配置"></a>3.1 vite 相关配置</h5><ul><li>包体积分析</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># 安装依赖</span><br>yarn -D <span class="hljs-built_in">add</span> rollup-plugin-visualizer<br></code></pre></td></tr></table></figure><ul><li>配置分析</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php">plugins: [<br>    <span class="hljs-title function_ invoke__">vue</span>(),<br>    <span class="hljs-title function_ invoke__">visualizer</span>(&#123;<br>        <span class="hljs-attr">open</span>:<span class="hljs-literal">true</span>,  //注意这里要设置为<span class="hljs-literal">true</span>，否则无效<br>        <span class="hljs-attr">gzipSize</span>:<span class="hljs-literal">true</span>,<br>        <span class="hljs-attr">brotliSize</span>:<span class="hljs-literal">true</span><br>    &#125;)<br>  ],<br></code></pre></td></tr></table></figure><ul><li>合理分包</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/* build.rollupOptions.output.manualChunks */</span><br><span class="hljs-attr">rollupOptions</span>: &#123;<br>  <span class="hljs-comment">// input: viteMultiPages,</span><br>  <span class="hljs-attr">output</span>: &#123;<br>    <span class="hljs-attr">manualChunks</span>: <span class="hljs-function">(<span class="hljs-params">id</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (<br>        id.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&#x27;node_modules/lodash/&#x27;</span>) !== -<span class="hljs-number">1</span> ||<br>        id.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&#x27;node_modules/tinycolor2/&#x27;</span>) !== -<span class="hljs-number">1</span> ||<br>        id.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&#x27;node_modules/aegis-web-sdk/&#x27;</span>) !== -<span class="hljs-number">1</span> ||<br>        id.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&#x27;node_modules/sortablejs/&#x27;</span>) !== -<span class="hljs-number">1</span> ||<br>        id.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&#x27;node_modules/@babel/&#x27;</span>) !== -<span class="hljs-number">1</span> ||<br>        id.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&#x27;node_modules/regenerator-runtime/&#x27;</span>) !== -<span class="hljs-number">1</span> ||<br>        id.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&#x27;node_modules/clipboard/&#x27;</span>) !== -<span class="hljs-number">1</span> ||<br>        id.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&#x27;node_modules/dayjs/&#x27;</span>) !== -<span class="hljs-number">1</span> ||<br>        id.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&#x27;node_modules/@popperjs/&#x27;</span>) !== -<span class="hljs-number">1</span><br>      ) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;vendor-utils&#x27;</span>;<br>      &#125;<br>      <span class="hljs-keyword">if</span> (<br>        id.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&#x27;node_modules/core-js/&#x27;</span>) !== -<span class="hljs-number">1</span> ||<br>        id.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&#x27;node_modules/@vue/&#x27;</span>) !== -<span class="hljs-number">1</span> ||<br>        id.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&#x27;node_modules/vue/&#x27;</span>) !== -<span class="hljs-number">1</span> ||<br>        id.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&#x27;node_modules/vue-router/&#x27;</span>) !== -<span class="hljs-number">1</span> ||<br>        id.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&#x27;node_modules/vuex/&#x27;</span>) !== -<span class="hljs-number">1</span> ||<br>        id.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&#x27;node_modules/axios/&#x27;</span>) !== -<span class="hljs-number">1</span><br>      ) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;vendor-core&#x27;</span>;<br>      &#125;<br>      <span class="hljs-keyword">if</span> (id.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&#x27;node_modules/@wecity/&#x27;</span>) !== -<span class="hljs-number">1</span> || id.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&#x27;node_modules/tdesign-icons-vue/&#x27;</span>) !== -<span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;vendor-tdgv&#x27;</span>;<br>      &#125;<br>      <span class="hljs-comment">// if (id.indexOf(&#x27;node_modules/tdesign-vue/es/&#x27;) !== -1) &#123;</span><br>      <span class="hljs-comment">//   return &#x27;vendor-td&#x27;;</span><br>      <span class="hljs-comment">// &#125;</span><br>    &#125;,<br>  &#125;,<br>&#125;,<br></code></pre></td></tr></table></figure><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs perl">// TODO 打包效果与上面有点差异，暂未分析原因<br>// <span class="hljs-keyword">if</span> (id.includes(<span class="hljs-string">&#x27;node_modules&#x27;</span>)) &#123;<br><span class="hljs-regexp">//</span>   const arr = id.toString().<span class="hljs-keyword">split</span>(<span class="hljs-string">&#x27;node_modules/&#x27;</span>)[<span class="hljs-number">1</span>].<span class="hljs-keyword">split</span>(<span class="hljs-string">&#x27;/&#x27;</span>);<br><br><span class="hljs-regexp">//</span>   switch (arr[<span class="hljs-number">0</span>]) &#123;<br><span class="hljs-regexp">//</span>     case <span class="hljs-string">&#x27;lodash&#x27;</span>:<br><span class="hljs-regexp">//</span>     case <span class="hljs-string">&#x27;lodash-es&#x27;</span>:<br><span class="hljs-regexp">//</span>     case <span class="hljs-string">&#x27;tinycolor2&#x27;</span>:<br><span class="hljs-regexp">//</span>     case <span class="hljs-string">&#x27;aegis-web-sdk&#x27;</span>:<br><span class="hljs-regexp">//</span>     case <span class="hljs-string">&#x27;sortablejs&#x27;</span>:<br><span class="hljs-regexp">//</span>     case <span class="hljs-string">&#x27;@popperjs&#x27;</span>:<br><span class="hljs-regexp">//</span>     case <span class="hljs-string">&#x27;@babel&#x27;</span>:<br><span class="hljs-regexp">//</span>     case <span class="hljs-string">&#x27;js-base64&#x27;</span>:<br><span class="hljs-regexp">//</span>       <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;vendor-utils&#x27;</span>;<br><span class="hljs-regexp">//</span>     case <span class="hljs-string">&#x27;core-js&#x27;</span>:<br><span class="hljs-regexp">//</span>     case <span class="hljs-string">&#x27;@vue&#x27;</span>:<br><span class="hljs-regexp">//</span>     case <span class="hljs-string">&#x27;vue&#x27;</span>:<br><span class="hljs-regexp">//</span>     case <span class="hljs-string">&#x27;vue-router&#x27;</span>:<br><span class="hljs-regexp">//</span>     case <span class="hljs-string">&#x27;vuex&#x27;</span>:<br><span class="hljs-regexp">//</span>     case <span class="hljs-string">&#x27;axios&#x27;</span>:<br><span class="hljs-regexp">//</span>       <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;vendor-core&#x27;</span>;<br><span class="hljs-regexp">//</span>     case <span class="hljs-string">&#x27;@wecity&#x27;</span>:<br><span class="hljs-regexp">//</span>     case <span class="hljs-string">&#x27;tdesign-icons-vue&#x27;</span>:<br><span class="hljs-regexp">//</span>       <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;vendor-tdgv&#x27;</span>;<br><span class="hljs-regexp">//</span>     default:<br><span class="hljs-regexp">//</span>       <span class="hljs-keyword">return</span> null;<br><span class="hljs-regexp">//</span>   &#125;<br>// &#125;<br></code></pre></td></tr></table></figure><p><img src="/assets/images/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E4%BC%98%E5%8C%96%E5%90%8E%E5%8C%85%E4%BD%93%E7%A7%AF.png" alt="优化后包体积"></p><h5 id="3-2-webpack4-拆包相关配置-SplitChunksPlugin"><a href="#3-2-webpack4-拆包相关配置-SplitChunksPlugin" class="headerlink" title="3.2 webpack4 拆包相关配置 SplitChunksPlugin"></a>3.2 webpack4 拆包相关配置 SplitChunksPlugin</h5><ol><li>包文件分析</li></ol><ul><li>yarn -D add webpack-bundle-analyzer</li><li>添加配置</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// vue.config.js </span><br><span class="hljs-attr">chainWebpack</span>: <span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&#x27;production&#x27;</span>) &#123;<br>    config.<span class="hljs-title function_">plugin</span>(<span class="hljs-string">&#x27;webpack-bundle-analyzer&#x27;</span>).<span class="hljs-title function_">use</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;webpack-bundle-analyzer&#x27;</span>).<span class="hljs-property">BundleAnalyzerPlugin</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="2"><li>合理拆分module、chunck，配置如下</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">pages</span>: &#123;<br>    <span class="hljs-attr">index</span>: &#123;<br>      .....<br>      .....<br>      <span class="hljs-comment">// 1、引入新拆分的chunk</span><br>      <span class="hljs-attr">chunks</span>: [<span class="hljs-string">&#x27;chunk-vendors&#x27;</span>, <span class="hljs-string">&#x27;vendors-utils&#x27;</span>, <span class="hljs-string">&#x27;vendors-tdgv&#x27;</span>, <span class="hljs-string">&#x27;vendors-core&#x27;</span>, <span class="hljs-string">&#x27;index&#x27;</span>]<br>    &#125;,<br>  &#125;,<br>  <span class="hljs-comment">// 2、webpack4 拆分chunk</span><br><span class="hljs-attr">optimization</span>: &#123;<br>  <span class="hljs-attr">splitChunks</span>: &#123;<br>    <span class="hljs-attr">cacheGroups</span>: &#123;<br>      <span class="hljs-string">&#x27;vendors-core&#x27;</span>: &#123;<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;vendors-core&#x27;</span>,<br>        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/[\\/]node_modules[\\/](vue|vue-router|axios|@vue|vuex)/</span>,<br>        <span class="hljs-attr">chunks</span>: <span class="hljs-string">&#x27;all&#x27;</span>,<br>        <span class="hljs-attr">priority</span>: <span class="hljs-number">10</span>,<br>        <span class="hljs-attr">enforce</span>: <span class="hljs-literal">true</span>,<br>      &#125;,<br>      <span class="hljs-string">&#x27;vendors-tdgv&#x27;</span>: &#123;<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;vendors-tdgv&#x27;</span>,<br>        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/[\\/]node_modules[\\/](@wecity|tdesign-icons-vue)/</span>,<br>        <span class="hljs-attr">chunks</span>: <span class="hljs-string">&#x27;all&#x27;</span>,<br>        <span class="hljs-attr">priority</span>: <span class="hljs-number">8</span>,<br>        <span class="hljs-attr">enforce</span>: <span class="hljs-literal">true</span>,<br>      &#125;,<br>      <span class="hljs-string">&#x27;vendors-utils&#x27;</span>: &#123;<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;vendors-utils&#x27;</span>,<br>        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/[\\/]node_modules[\\/](lodash|tinycolor2|aegis-web-sdk|clipboard|core-js)/</span>,<br>        <span class="hljs-attr">chunks</span>: <span class="hljs-string">&#x27;all&#x27;</span>,<br>        <span class="hljs-attr">priority</span>: <span class="hljs-number">8</span>,<br>        <span class="hljs-attr">enforce</span>: <span class="hljs-literal">true</span>,<br>      &#125;,<br>      <span class="hljs-string">&#x27;chunk-vendors&#x27;</span>: &#123;<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;chunk-vendors&#x27;</span>,<br>        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/[\\/]node_modules[\\/]/</span>,<br>        <span class="hljs-attr">chunks</span>: <span class="hljs-string">&#x27;all&#x27;</span>,<br>        <span class="hljs-attr">priority</span>: <span class="hljs-number">1</span>,<br>        <span class="hljs-attr">enforce</span>: <span class="hljs-literal">true</span>,<br>      &#125;,<br>    &#125;,<br>  &#125;,<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="4-静态GZIP"><a href="#4-静态GZIP" class="headerlink" title="4. 静态GZIP"></a>4. 静态GZIP</h4><ul><li>4.1 安装依赖</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">yarn -D add vite-plugin-compression<br></code></pre></td></tr></table></figure><ul><li>4.2 配置vite.config.js</li></ul><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs lasso"><span class="hljs-keyword">import</span> compress from <span class="hljs-string">&#x27;vite-plugin-compression&#x27;</span>;<br><span class="hljs-params">...</span><br>defineConfig(&#123;<br>  plugins: <span class="hljs-meta">[</span><br>    <span class="hljs-comment">// 压缩10kb以上的文件</span><br>    compress(&#123; threshold: <span class="hljs-number">10240</span> &#125;),<br>    <span class="hljs-params">...</span><br>  <span class="hljs-meta">]</span><br>&#125;)<br></code></pre></td></tr></table></figure><h4 id="命名chunkFileNames"><a href="#命名chunkFileNames" class="headerlink" title="命名chunkFileNames"></a>命名chunkFileNames</h4><p>命名chunkFileNames，会额外生成文件，未研究明白。。。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/* build.output.chunkFileNames */</span><br><span class="hljs-comment">/* 添加一下配置，将按组件文件名 生成chunk 文件 */</span><br><span class="hljs-attr">output</span>: &#123;<br>  <span class="hljs-attr">chunkFileNames</span>: <span class="hljs-function">(<span class="hljs-params">chunkInfo</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`===========<span class="hljs-subst">$&#123;chunkInfo.facadeModuleId&#125;</span>`</span>);<br>    <span class="hljs-keyword">const</span> facadeModuleId = chunkInfo.<span class="hljs-property">facadeModuleId</span> ? chunkInfo.<span class="hljs-property">facadeModuleId</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;/&#x27;</span>) : [];<br>    <span class="hljs-keyword">const</span> fileName = facadeModuleId[facadeModuleId.<span class="hljs-property">length</span> - <span class="hljs-number">2</span>] || <span class="hljs-string">&#x27;[name]&#x27;</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">$&#123;fileName&#125;</span>.[hash].js`</span>;<br>  &#125;,<br>&#125;,<br></code></pre></td></tr></table></figure><h2 id="优化结果"><a href="#优化结果" class="headerlink" title="优化结果"></a>优化结果</h2><p>通过前端包体积优化及静态GZIP，最大资源大小由519kb 降低到 199kb；0.3核256MB服务器，10并发下的耗时从7.7s降低到2.6s左右，能够满足低并发下正常使用；瓶颈在依赖包Tdesign的大小无法在做更细粒度拆分。</p><p><strong>优化后</strong></p><ul><li><p>request:0.3C256M limit:0.5C512G</p><ul><li>10并发<br> <img src="/assets/images/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/0.3C256MB10T.new.png" alt="0.3C256MB10T.old.jpg"> </li><li>5并发<br> <img src="/assets/images/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/0.3C256MB5T.new.jpg" alt="0.3C256MB5T.old.jpg"></li></ul></li><li><p>lighthouse 结果<br><img src="/assets/images/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/0.3C256MB%E4%BC%98%E5%8C%96%E5%90%8Elighthouse%E8%AF%84%E5%88%86.png" alt="0.3C256MB5T.old.jpg"></p></li></ul><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><p><a href="https://cn.vuejs.org/guide/best-practices/performance.html">vue官方性能优化</a><br><a href="https://heapdump.cn/article/3469499">Puppeteer+Lighthouse</a><br><a href="https://segmentfault.com/a/1190000041753539">2022 前端性能优化最佳实践</a><br><a href="https://www.cnblogs.com/stulzq/p/8971531.html">JMETER压力测试</a><br><a href="https://godbasin.github.io/front-end-playground/front-end-basic/performance/front-end-performance-optimization.html">常见的性能优化方案</a></p><h2 id="参考指标"><a href="#参考指标" class="headerlink" title="参考指标"></a>参考指标</h2><h3 id="页面渲染"><a href="#页面渲染" class="headerlink" title="页面渲染"></a>页面渲染</h3><p>DOMContentLoaded &lt; 2s</p><h3 id="用户体验三大核心指标"><a href="#用户体验三大核心指标" class="headerlink" title="用户体验三大核心指标"></a>用户体验三大核心指标</h3><p>Google 在20年五月提出了网站用户体验的三大核心指标</p><ol><li>Largest Contentful Paint (LCP)<br>LCP 代表了页面的速度指标，虽然还存在其他的一些体现速度的指标，但是上文也说过 LCP 能体现的东西更多一些。一是指标实时更新，数据更精确，二是代表着页面最大元素的渲染时间，通常来说页面中最大元素的快速载入能让用户感觉性能还挺好。</li></ol><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css">&lt;<span class="hljs-selector-tag">img</span>&gt; 标签<br>&lt;<span class="hljs-selector-tag">image</span>&gt; 在<span class="hljs-selector-tag">svg</span>中的<span class="hljs-selector-tag">image</span>标签<br>&lt;<span class="hljs-selector-tag">video</span>&gt; <span class="hljs-selector-tag">video</span>标签<br></code></pre></td></tr></table></figure><ol start="2"><li>First Input Delay (FID)<br>FID 代表了页面的交互体验指标，毕竟没有一个用户希望触发交互以后页面的反馈很迟缓，交互响应的快会让用户觉得网页挺流畅。</li><li>Cumulative Layout Shift (CLS)<br>CLS 代表了页面的稳定指标，它能衡量页面是否排版稳定。尤其在手机上这个指标更为重要，因为手机屏幕挺小，CLS值一大的话会让用户觉得页面体验做的很差。CLS的分数在0.1或以下，则为Good。</li></ol><h3 id="WEBPACK4-参考文档SplitChunksPlugin"><a href="#WEBPACK4-参考文档SplitChunksPlugin" class="headerlink" title="WEBPACK4 参考文档SplitChunksPlugin"></a>WEBPACK4 参考文档<a href="https://webpack.docschina.org/plugins/split-chunks-plugin/">SplitChunksPlugin</a></h3><p>知识点：拆分依据主要有以下三种：</p><ol><li>项目入口（entry）<br> 入口会拆成一个chunk，多个项目入口会拆分成多个不同的chunk</li><li>通过import()动态引入的代码<br> 例如路由里组件的动态载入，导致每个路由界面都会拆成一个chunk</li><li>通过splitChunks拆分代码<br> 看下面”通过splitChunks拆分代码”的具体介绍</li></ol>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-12-22-【工程化】前端标准</title>
    <link href="/2025/11/28/2022-12-22-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91%E5%89%8D%E7%AB%AF%E6%A0%87%E5%87%86/"/>
    <url>/2025/11/28/2022-12-22-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91%E5%89%8D%E7%AB%AF%E6%A0%87%E5%87%86/</url>
    
    <content type="html"><![CDATA[<p>JavaScript的是一门动态弱类型、基于原型的一种解释性计算机脚本语言。</p><p>JavaScript 1.6（05年）<br>2005年发布。逐步增加了数组的扩展方法、增加了Array和String泛型、支持XML扩展（E4X）。开始支持Safari 3.0。同年，Ajax技术发布。</p><p>2010年发布 1.8.5，并遵循ECMAScript 5 （2009年发布）规范<br>一次大的更新，将之前JS各个版本的方法进行统一汇总整理，并新加入一批API，一起写入规范，使得ES和JS的贴合程度更深。</p><p>ECMAScript 6 （2015年）<br>2015年发布ES6，又是一次重大更新：</p><h1 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h1><p><a href="https://juejin.cn/post/7109378925964296223">一篇文章读懂ECMAScript历代版本新特性</a><br><a href="https://www.ecma-international.org/publications-and-standards/standards/ecma-262/">ECMA</a></p><p><a href="https://juejin.cn/post/6996595779037036580">前端模块化-一篇就够了</a></p>]]></content>
    
    
    <categories>
      
      <category>ECMA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ECMA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-12-22-【工程化】RPA方案</title>
    <link href="/2025/11/28/2022-12-22-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91RPA%E6%96%B9%E6%A1%88/"/>
    <url>/2025/11/28/2022-12-22-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91RPA%E6%96%B9%E6%A1%88/</url>
    
    <content type="html"><![CDATA[<h1 id="项目-RPA-方案"><a href="#项目-RPA-方案" class="headerlink" title="项目 RPA 方案"></a>项目 RPA 方案</h1><h2 id="一、-RPA-技术"><a href="#一、-RPA-技术" class="headerlink" title="一、 RPA 技术"></a>一、 RPA 技术</h2><blockquote><p>RPA（Robotic Process Automation）是指在各行业中使用软件自动化来实现原本由人类操作的计算机完成的操作。它允许软件机器人自动处理大量重复的、基于规则的工作流程任务。</p></blockquote><p>流行 RPA 产品和技术有 Uipath、阿里云 RPA、Robot Framework、RPA For Python、Selenuim、Puppeteer、Playwright 等。不同产品技术各自发力点有所不同，其中 Uipath、阿里云 RPA 和 Robot Framework 着重于 web 自动化、移动端自动化、windows 自动化等办公、测试场景，而这类 RPA 产品技术覆盖场景范围较广，在 web 自动化场景做的没有太深入。RPA For Python、Selenuim、Puppeteer、Playwright 这类技术工具专注于 web 自动化场景，因此技术选型重点考虑这类技术工具。</p><h3 id="（1）技术选型"><a href="#（1）技术选型" class="headerlink" title="（1）技术选型"></a>（1）技术选型</h3><table><thead><tr><th>技术工具</th><th>RPA For Python</th><th>Selenuim</th><th>Puppeteer</th><th>Playwright</th></tr></thead><tbody><tr><td>浏览器适配</td><td>Chrome</td><td>Chrome&#x2F;FireFox&#x2F;Safari 等</td><td>Chrome</td><td>Chrome&#x2F;FireFox&#x2F;Safari 等</td></tr><tr><td>开发语言</td><td>Python</td><td>Python、Java、JS 等</td><td>JS</td><td>Python、Java、JS 等</td></tr><tr><td>运行性能</td><td>较优</td><td>一般</td><td>较优</td><td>较优</td></tr><tr><td>消耗资源</td><td>一般</td><td>一般</td><td>较优</td><td>较优</td></tr><tr><td>headless 支持</td><td>不支持</td><td>支持（新版本）</td><td>支持</td><td>支持</td></tr><tr><td>安装配置</td><td>复杂</td><td>复杂</td><td>较简单</td><td>较简单</td></tr><tr><td>跨平台支持</td><td>不涉及</td><td>不支持</td><td>不涉及</td><td>支持</td></tr><tr><td>文档</td><td>健全</td><td>健全</td><td>健全</td><td>健全</td></tr><tr><td>上下文功能</td><td>没有</td><td>没有</td><td>支持</td><td>支持，增强上下文隔离能力</td></tr><tr><td>代码自动生成</td><td>不支持</td><td>支持</td><td>支持</td><td>支持</td></tr><tr><td>自动等待</td><td>支持</td><td>支持</td><td>支持</td><td>支持</td></tr><tr><td>事件订阅</td><td>不支持</td><td>不支持</td><td>支持</td><td>支持</td></tr><tr><td>上传下载</td><td>支持</td><td>不支持</td><td>不支持</td><td>支持</td></tr></tbody></table><ul><li>说明：从浏览器适配、开发语言、跨平台支持、上下文功能等指标对比来，技术选型更加偏向 Playwright。</li></ul><h3 id="（2）实现原理"><a href="#（2）实现原理" class="headerlink" title="（2）实现原理"></a>（2）实现原理</h3><p><img src="/assets/images/rpa/rpa1.png" alt="实现原理"></p><ul><li>说明：<br>1、Chrome DevTools Protocol（CDP）允许三方程序对基于 Chrome 等浏览器的 web 应用进行检测、检查、调试和分析等，通过 WebSocket 建立连接 DevTools 和浏览器内核的快速数据通道。而 webdriver 方式是通过各类浏览器 driver 提供基于 CDP 一套封装方法来完成浏览器操作。<br>2、DevTools Protocol 直接连接浏览器方式由于少了一层 driver 调用，因此相对于 Webdriver 性能更优。<br>3、本质仍需要启动浏览器实例来加载页面，而一个页面涉及多个 css、js 和图片等静态资源和后台接口，因此对比单个业务接口，通过浏览器完成一个完整业务流程明显大大增加执行耗时和错误率。</li></ul><p><img src="/assets/images/rpa/puppeteer.png" alt="puppeteer"></p><ul><li>说明：<br>1、Puppeteer 和 Playwright 类技术可以创建多个 Browser 实例，其中 BrowerContext 是类似无痕浏览器窗口。<br>2、Playwright 增强了上下文隔离能力，支持清除 cookies 和本地存储操作，可进一步重复利用 BrowerContext，提升执行效率。</li></ul><h3 id="（3）Playwright-技术验证"><a href="#（3）Playwright-技术验证" class="headerlink" title="（3）Playwright 技术验证"></a>（3）Playwright 技术验证</h3><p>依据管理业务和后续优化思路进行的关键事项验证，已完成如下事项验证：<br>1、登录自动化（包括拖拽条，短信验证）<br>2、页面表单提交自动化（项目信息维护）<br>3、代码生成辅助工具（可生成大部分代码，但需要再调试）<br>4、弹窗处理自动化（解决不稳定、不确定的弹窗问题）<br>5、页面元素获取（认证二维码获取）<br>6、Chrome headless 模式（不需要界面 gui 渲染，性能更优）<br>7、事件订阅（授权完成后接口正常响应）<br>8、浏览器上下会会话信息存储和加载、隔离<br>9、容器部署<br>进一步验证：<br>1、验证单个容器实例（如 2 核 4g）能够同时加载多少个浏览器实例，计算出需投入部署资源。<br>macbook 验证效果：在 headless 模式下，一个 browser 大约消耗 200M 内存，一个 browserContext 大约消耗 100M 内存，因此基于一个 browser 和 N 个 browserContext 启动模式，那么 1g 内存大约可以打开 8 个无痕窗口。</p><h2 id="二、RPA-方案设计"><a href="#二、RPA-方案设计" class="headerlink" title="二、RPA 方案设计"></a>二、RPA 方案设计</h2><h3 id="2-1-接口异步响应"><a href="#2-1-接口异步响应" class="headerlink" title="2.1 接口异步响应"></a>2.1 接口异步响应</h3><p><img src="/assets/images/rpa/rpa2.png" alt="接口异步响应"></p><ul><li>说明：<br>1、管理平台登录需要短信验证码，因此建议提供可视化交互。<br>2、登录会话定期续期有可能失败，因此建议提供微乐站内信、短信等通知方式。<br>3、项目业务异步执行，规避耗时长问题，但有几率执行失败（登录会话续期失败、页面资源加载等原因），因此业务任务需要支持重试、不重复消费。<br>4、建议提供业务任务管理功能，供用户查看和手动重启任务。并且若出现业务自动化过程需要用户进行二维码扫码等操作也可以在页面提供用户操作。<br>5、基于 Playwright 的上下会管理能力，管理平台的会话信息可以离线存储，不需要浏览器页面进程长驻，并且可支持 RPA 服务多实例部署。</li></ul><blockquote><p>主要解决问题：<br>1、RPA 耗时长、接口超时问题；<br>2、浏览器资源瓶颈问题；<br>3、会话过期问题；</p></blockquote><h3 id="2-2-资源池化"><a href="#2-2-资源池化" class="headerlink" title="2.2 资源池化"></a>2.2 资源池化</h3><p><img src="/assets/images/rpa/rpa3.png" alt="资源池化"></p><ul><li>说明：<br>1、池化是指预先准备部分资源，在需要时可以重复利用这部分资源，提高 RPA 执行效率，减低系统资源消耗，并且控制资源对象数量，保证程序稳定正常运行。<br>2、缩短 RPA 执行流程，提升自动化效率。<br>2.3 插件化</li></ul><p><img src="/assets/images/rpa/rpa4.png" alt="插件化"></p><ul><li>说明：<br>1、由于多实例服务和容器部署的原因，服务需要定期调用数据库来更新实例信息，用于标记已运行实例。例如每 10 秒更新一次实例记录的更新时间，若 10 秒内没有更新时间则认为该实例为下线实例。<br>2、插件安装也采用同上逻辑，定期获取插件信息来更新实例的插件安装情况，若完成安装，则更新实例插件记录（多个插件更新操作可考虑逐个更新，更新失败重试）。</li></ul><h2 id="三、其他"><a href="#三、其他" class="headerlink" title="三、其他"></a>三、其他</h2><h3 id="3-1-工作量评估"><a href="#3-1-工作量评估" class="headerlink" title="3.1 工作量评估"></a>3.1 工作量评估</h3><p>预估工作量如下：<br>1、RPA 业务和流程产品侧梳理–产品 2 人天<br>2、开发(pf4j 类似 java 插件化技术)—-开发 2 人<br>3、接口异步响应和资源池化的深化技术设计–开发 3 人天<br>4、资源池化开发–开发 3 人天<br>5、接口异步响应（不包含项目业务的 RPA 流程）开发–开发 5 人天<br>6、接口和功能测试–测试 5 人天</p><h3 id="3-2-风险和问题"><a href="#3-2-风险和问题" class="headerlink" title="3.2 风险和问题"></a>3.2 风险和问题</h3><p>1、暂时没有考虑防范 RPA 手段，但目前也没有找到能够 CDP 技术的手段。</p>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>RPA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-12-28-chatGPT注册</title>
    <link href="/2025/11/28/2022-12-28-chatGPT%E6%B3%A8%E5%86%8C/"/>
    <url>/2025/11/28/2022-12-28-chatGPT%E6%B3%A8%E5%86%8C/</url>
    
    <content type="html"><![CDATA[<h1 id="账号注册"><a href="#账号注册" class="headerlink" title="账号注册"></a>账号注册</h1><ul><li>1、官网 Log up<br><a href="https://chat.openai.com/chat">https://chat.openai.com/chat</a><br><a href="https://platform.openai.com/docs/quickstart">https://platform.openai.com/docs/quickstart</a></li></ul><p>注意：建议使用谷歌邮箱@gmail.com 进行注册</p><ul><li>2、需要一个境外短信验证<br><a href="https://sms-activate.org/getNumber">https://sms-activate.org/getNumber</a></li></ul><p>左侧输入 openai &#x3D;&gt; 选择印度账号</p><p>注意：去除 91 开头的国家号码，如果一分钟未收到验证码，则换一个号码重试。</p>]]></content>
    
    
    <categories>
      
      <category>chatGPT</category>
      
    </categories>
    
    
    <tags>
      
      <tag>chatGPT</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-12-28-科学上网</title>
    <link href="/2025/11/28/2022-12-28-%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/"/>
    <url>/2025/11/28/2022-12-28-%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/</url>
    
    <content type="html"><![CDATA[<h1 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h1><h2 id="一、代理服务器"><a href="#一、代理服务器" class="headerlink" title="一、代理服务器"></a>一、代理服务器</h2><p>1、代理服务器搭建<br>2、域名创建<br>3、ssl 脚本执行</p><h2 id="二、IOS-代理-VPN-软件安装"><a href="#二、IOS-代理-VPN-软件安装" class="headerlink" title="二、IOS 代理 VPN 软件安装"></a>二、IOS 代理 VPN 软件安装</h2><p>1、境外 appId 申请<br>2、美金充值<br>3、下载 shadowrocket<br>4、配置代理服务器</p><h1 id="详细步骤："><a href="#详细步骤：" class="headerlink" title="详细步骤："></a>详细步骤：</h1><h2 id="一、代理服务器-1"><a href="#一、代理服务器-1" class="headerlink" title="一、代理服务器"></a>一、代理服务器</h2><p>1、代理服务器购买<br>可选择腾讯云轻量级服务器，香港 24 元&#x2F;月（1C1G - 25G SSD，流量包 1T）</p><p>2、域名创建<br>腾讯云域名购买尽量选长一点时间，足够便宜，性价比高</p><p>3、ssl 脚本执行<br><a href="https://tizi.blog/301.html">https://tizi.blog/301.html</a></p><h2 id="二、IOS-代理-VPN-软件安装-1"><a href="#二、IOS-代理-VPN-软件安装-1" class="headerlink" title="二、IOS 代理 VPN 软件安装"></a>二、IOS 代理 VPN 软件安装</h2><p>1、境外 appId 申请</p><ul><li>准备一个能收验证码的邮箱、手机号（国内即可）</li><li>国家选美国</li><li>境外地址生成器；<a href="https://www.haoweichi.com/">https://www.haoweichi.com/</a></li></ul><p>2、美金充值<br>淘宝下单 -》 IOS 礼卡（appstore 兑换码-姚姚礼品卡）</p><p>3、下载 shadowrocket（IOS）；安卓或 windows 参考 <a href="https://tizi.blog/298.html">https://tizi.blog/298.html</a></p><p>4、配置代理服务器</p><ul><li>打开 shadowrocket</li></ul><h2 id="三、MAC-电脑-VPN-安装"><a href="#三、MAC-电脑-VPN-安装" class="headerlink" title="三、MAC 电脑 VPN 安装"></a>三、MAC 电脑 VPN 安装</h2><p><a href="https://itlanyan.com/v2ray-clients-download/">https://itlanyan.com/v2ray-clients-download/</a></p><ol><li>Qv2ray 客户端安装</li><li>V2ray 官方内核下载（必选）</li></ol><p>Qv2ray 自身相当于一个外壳，并不包含 V2ray 内核。在作为 V2ray 客户端使用时，需要另外下载 V2ray 官方内核搭配使用。</p><p>V2ray 内核请到官网根据自己的系统选择下载最新版（建议挂代理）：<a href="https://github.com/v2ray/v2ray-core/releases">https://github.com/v2ray/v2ray-core/releases</a></p><ol start="3"><li>Qv2ray 代理配置</li><li>谷歌浏览器 SwitchyOmega 插件安装及配置</li></ol><ul><li>默认代理 ip 127.0.0.1 端口 8889</li></ul><h2 id="四、安卓"><a href="#四、安卓" class="headerlink" title="四、安卓"></a>四、安卓</h2><p>安卓</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs dts">SS：<br><span class="hljs-symbol">https:</span><span class="hljs-comment">//github.com/shadowsocks/shadowsocks-android/releases</span><br>SSR：<br><span class="hljs-symbol">https:</span><span class="hljs-comment">//github.com/HMBSbige/ShadowsocksR-Android/releases</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">V2RayNG:</span><br><span class="hljs-symbol">https:</span><span class="hljs-comment">//github.com/2dust/v2rayNG/releases</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">Clash:</span><br><span class="hljs-symbol">https:</span><span class="hljs-comment">//github.com/Kr328/ClashForAndroid/releases</span><br>Kitsunebi：<br><span class="hljs-symbol">https:</span><span class="hljs-comment">//github.com/eycorsican/kitsunebi-android/releases</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">Surfboard:</span><br><span class="hljs-symbol">https:</span><span class="hljs-comment">//manual.getsurfboard.com/</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">igniter:</span><br><span class="hljs-symbol">https:</span><span class="hljs-comment">//github.com/trojan-gfw/igniter/releases</span><br><br>Pharos Pro:<br><span class="hljs-symbol">https:</span><span class="hljs-comment">//github.com/PharosVip/Pharos-Android-Test/releases</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">BifrostV:</span><br><span class="hljs-symbol">https:</span><span class="hljs-comment">//github.com/v2raym/bifrostv/blob/master/BifrostV_v0.6.8.apk</span><br><br>SSRRAY：<br><span class="hljs-symbol">https:</span><span class="hljs-comment">//github.com/xxf098/shadowsocksr-v2ray-android/releases</span><br><br><span class="hljs-meta">######Windows版######</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nuxt3</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-12-22-【工程化】nuxt3</title>
    <link href="/2025/11/28/2023-02-22-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91nuxt3/"/>
    <url>/2025/11/28/2023-02-22-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91nuxt3/</url>
    
    <content type="html"><![CDATA[<!-- 参考文档 --><p><a href="https://blog.csdn.net/snowball_li/article/details/128013833">https://blog.csdn.net/snowball_li/article/details/128013833</a></p><h2 id="运行环境"><a href="#运行环境" class="headerlink" title="运行环境"></a>运行环境</h2><blockquote><p>nodejs &gt; 16.x.x</p></blockquote><h2 id="nuxt3项目初始化"><a href="#nuxt3项目初始化" class="headerlink" title="nuxt3项目初始化"></a>nuxt3项目初始化</h2><ul><li>创建项目</li></ul><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp">pnpm dlx nuxi <span class="hljs-keyword">init</span> nuxt-app<br></code></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp">npx nuxi <span class="hljs-keyword">init</span> nuxt3-app<br></code></pre></td></tr></table></figure><ul><li>别名设置<blockquote><ol><li>配置 nuxt.config.ts</li></ol></blockquote></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">alias</span>: &#123;<br>  <span class="hljs-string">&quot;@&quot;</span>: <span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;./&quot;</span>),<br>  <span class="hljs-string">&quot;@pages&quot;</span>: <span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;./pages&quot;</span>),<br>  <span class="hljs-string">&quot;@server&quot;</span>: <span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;./server&quot;</span>),<br>  <span class="hljs-string">&#x27;images&#x27;</span>: <span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;./assets/images&#x27;</span>),<br>  <span class="hljs-string">&#x27;style&#x27;</span>: <span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;./assets/style&#x27;</span>),<br>&#125;,<br></code></pre></td></tr></table></figure><blockquote><ol start="2"><li>配置 tsconfig.json</li></ol></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br>  <span class="hljs-comment">// https://nuxt.com/docs/guide/concepts/typescript</span><br>  <span class="hljs-string">&quot;extends&quot;</span>: <span class="hljs-string">&quot;./.nuxt/tsconfig.json&quot;</span>,<br>  <span class="hljs-string">&quot;compilerOptions&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;baseUrl&quot;</span>: <span class="hljs-string">&quot;.&quot;</span>, <span class="hljs-comment">// 跟路劲</span><br>    <span class="hljs-string">&quot;paths&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;@/*&quot;</span>: [<span class="hljs-string">&quot;./*&quot;</span>],<br>      <span class="hljs-string">&quot;@pages/*&quot;</span>: [<span class="hljs-string">&quot;./pages/*&quot;</span>],<br>      <span class="hljs-string">&quot;@server/*&quot;</span>: [<span class="hljs-string">&quot;./server/*&quot;</span>]<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>代理设置<blockquote><p>nuxt.config.ts 配置</p></blockquote></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs js"><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineNuxtConfig</span>(&#123;<br>  <span class="hljs-comment">//vite代理方式，nitro 代理都可以成功；二选一即可</span><br>  , <span class="hljs-attr">vite</span>: &#123;<br>    <span class="hljs-attr">server</span>: &#123;<br>      <span class="hljs-attr">proxy</span>: &#123;<br>        <span class="hljs-string">&#x27;/api&#x27;</span>: &#123;<br>          <span class="hljs-attr">target</span>: <span class="hljs-string">&#x27;http://127.0.0.1:3000/&#x27;</span>,<br>          <span class="hljs-comment">// rewrite: (path) =&gt; path.replace(/^\/api/, &#x27;&#x27;),</span><br>        &#125;<br>      &#125;,<br>    &#125;<br>  &#125;<br>  , <span class="hljs-attr">nitro</span>: &#123;<br>    <span class="hljs-attr">devProxy</span>: &#123;<br>      <span class="hljs-string">&quot;/api&quot;</span>: &#123;<br>        <span class="hljs-attr">target</span>: <span class="hljs-string">&#x27;http://127.0.0.1:3000/&#x27;</span>,<br>        <span class="hljs-attr">prependPath</span>: <span class="hljs-literal">true</span>,<br>        <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure><ul><li>element-plus 组件库安装<blockquote><p>依赖安装</p></blockquote></li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">pnpm install element-plus <br>pnpm <span class="hljs-built_in">add</span>  sass sass-loader -D<br>pnpm <span class="hljs-built_in">add</span> unplugin-auto-import unplugin-icons unplugin-vue-components -D<br><br></code></pre></td></tr></table></figure><blockquote><p>assets&#x2F;scss&#x2F;index.scss</p></blockquote><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@use</span> <span class="hljs-string">&quot;element-plus/dist/index.css&quot;</span>;<br></code></pre></td></tr></table></figure><blockquote><p>tsconfig.json</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br>  <span class="hljs-comment">// https://nuxt.com/docs/guide/concepts/typescript</span><br>  <span class="hljs-string">&quot;extends&quot;</span>: <span class="hljs-string">&quot;./.nuxt/tsconfig.json&quot;</span>,<br>  <span class="hljs-string">&quot;compilerOptions&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;types&quot;</span>: [<span class="hljs-string">&quot;element-plus/global&quot;</span>]<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>nuxt.config.ts</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">AutoImport</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;unplugin-auto-import/vite&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Components</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;unplugin-vue-components/vite&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ElementPlusResolver</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;unplugin-vue-components/resolvers&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">IconsResolver</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;unplugin-icons/resolver&quot;</span>;<br><span class="hljs-keyword">const</span> lifecycle = process.<span class="hljs-property">env</span>.<span class="hljs-property">npm_lifecycle_event</span>;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineNuxtConfig</span>(&#123;<br>    <span class="hljs-attr">vite</span>: &#123;<br>        <span class="hljs-attr">plugins</span>: [<br>            <span class="hljs-title class_">AutoImport</span>(&#123;<br>                <span class="hljs-attr">resolvers</span>: [<br>                    <span class="hljs-title class_">ElementPlusResolver</span>(<br>                    ),<br>                    <span class="hljs-title class_">IconsResolver</span>()]<br>            &#125;),<br>            <span class="hljs-title class_">Components</span>(&#123;<br>                <span class="hljs-attr">dts</span>: <span class="hljs-literal">true</span>,<br>                <span class="hljs-attr">resolvers</span>: [<span class="hljs-title class_">ElementPlusResolver</span>(<br>                    &#123;<br>                        <span class="hljs-attr">importStyle</span>: <span class="hljs-literal">false</span><br>                    &#125;<br>                )]<br>            &#125;),<br>        ],<br>    &#125;,<br>    <span class="hljs-attr">components</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">css</span>: [<span class="hljs-string">&quot;~/assets/scss/index.scss&quot;</span>],<br>    <span class="hljs-attr">transpile</span>: [<span class="hljs-string">&quot;element-plus&quot;</span>],<br>    <span class="hljs-attr">build</span>: &#123;<br>        <span class="hljs-attr">transpile</span>: lifecycle === <span class="hljs-string">&quot;build&quot;</span> ? [<span class="hljs-string">&quot;element-plus&quot;</span>] : [],<br>    &#125;,<br>&#125;)<br></code></pre></td></tr></table></figure><blockquote><p>plugins&#x2F;element-plus.ts</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; <span class="hljs-variable constant_">ID_INJECTION_KEY</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;element-plus&#x27;</span>;<br> <br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineNuxtPlugin</span>(<span class="hljs-function"><span class="hljs-params">nuxtApp</span> =&gt;</span> &#123;<br>    <span class="hljs-comment">// Doing something with nuxtApp</span><br>    nuxtApp.<span class="hljs-property">vueApp</span>.<span class="hljs-title function_">provide</span>(<span class="hljs-variable constant_">ID_INJECTION_KEY</span>,&#123;<br>        <span class="hljs-attr">prefix</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">10000</span>),<br>        <span class="hljs-attr">current</span>: <span class="hljs-number">0</span>,<br>    &#125;)<br>  &#125;)<br></code></pre></td></tr></table></figure><blockquote><p>pages&#x2F;index.vue</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;el-button&gt; <span class="hljs-title class_">ElButton</span> &lt;/el-button&gt;<br></code></pre></td></tr></table></figure><ul><li>ecahrt 加入</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineNuxtConfig</span>(&#123;<br>  <span class="hljs-attr">build</span>: &#123; <span class="hljs-attr">transpile</span>: [<span class="hljs-string">&quot;echarts&quot;</span>] &#125;,<br>&#125;)<br></code></pre></td></tr></table></figure><ul><li>less、sass支持</li></ul><p>直接安装 less 或 sass包即可支持。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install --save less less-loader<br></code></pre></td></tr></table></figure><p>vite配置，nuxt.config.ts配置vite。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineNuxtConfig</span>(&#123;<br>    <span class="hljs-comment">// css</span><br>    <span class="hljs-attr">css</span>: [<span class="hljs-string">&#x27;@/assets/css/index.css&#x27;</span>],<br>    <span class="hljs-comment">// vite</span><br>    <span class="hljs-attr">vite</span>: &#123;<br>        <span class="hljs-attr">css</span>: &#123;<br>            <span class="hljs-attr">preprocessorOptions</span>: &#123;<br>                <span class="hljs-attr">scss</span>: &#123;<br>                    <span class="hljs-attr">additionalData</span>: <span class="hljs-string">&#x27;@use &quot;@/assets/css/index.scss&quot; as *;&#x27;</span><br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;)<br></code></pre></td></tr></table></figure><ul><li>normalize.css 消除默认样式</li></ul><ol><li>安装依赖</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">pnpm install normalize.<span class="hljs-property">css</span><br></code></pre></td></tr></table></figure><ol><li>app.vue 进入</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;script setup&gt;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;normalize.css/normalize.css&quot;</span>;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>/&gt;</span></span><br></code></pre></td></tr></table></figure><h3 id="常见用法"><a href="#常见用法" class="headerlink" title="常见用法"></a>常见用法</h3><ul><li>title设置，使用useHead()方法</li></ul><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-function"><span class="hljs-title">useHead</span>(&#123;</span><br><span class="hljs-function">    <span class="hljs-variable">title</span>: <span class="hljs-string">&#x27;snow-title-2&#x27;</span></span><br><span class="hljs-function">&#125;)</span><br></code></pre></td></tr></table></figure><ul><li>加载静态资源</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;div&gt;<br>  &lt;img src=&quot;~/assets/nginx.jpg&quot; alt=&quot;nginx&quot;&gt;<br>  &lt;img src=&quot;~/public/nginx.jpg&quot; alt=&quot;nginx&quot;&gt;<br>&lt;/div&gt;<br></code></pre></td></tr></table></figure><ul><li>指定布局layout</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nuxt">definePageMeta(&#123;<br>    layout: &#x27;layout-snow&#x27;<br>&#125;)<br></code></pre></td></tr></table></figure><ul><li>middleware 中间件，鉴权<blockquote><p>&#x2F;middleware&#x2F;auth.ts</p></blockquote></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineNuxtRouteMiddleware</span>(<span class="hljs-function">(<span class="hljs-params">to, <span class="hljs-keyword">from</span></span>)=&gt;</span>&#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;auth&quot;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure><blockquote><p>使用 &#x2F;pages&#x2F;plugin.vue</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;script setup lang=<span class="hljs-string">&quot;ts&quot;</span>&gt;<br> <br><span class="hljs-title function_">definePageMeta</span>(&#123;<br>    <span class="hljs-attr">middleware</span>: [<span class="hljs-string">&quot;auth&quot;</span>, <span class="hljs-string">&quot;snow&quot;</span>]<br>&#125;)<br> <br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><ul><li>server 服务开发<blockquote><p>server&#x2F;api&#x2F;test.get.ts</p></blockquote></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineEventHandler</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">`test get ts`</span><br>&#125;)<br></code></pre></td></tr></table></figure><ul><li>部署</li></ul><ol><li>ssr 服务端渲染部署</li></ol><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">pnpm <span class="hljs-built_in">run</span> build<br></code></pre></td></tr></table></figure><blockquote><p>node 启动</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">node ./.<span class="hljs-property">output</span>/server/index.<span class="hljs-property">mjs</span><br></code></pre></td></tr></table></figure><blockquote><p>pm2 启动 pm2.js<br>安装pm2 pnpm add -g pm2（如果提示setup，则执行pnpm setup，并更新配置 <code>source ~/.zshrc</code></p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">apps</span>: [<br>    &#123;<br>      <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;NuxtAppName&quot;</span>,<br>      <span class="hljs-attr">exec_mode</span>: <span class="hljs-string">&quot;cluster&quot;</span>,<br>      <span class="hljs-attr">instances</span>: <span class="hljs-string">&quot;max&quot;</span>,<br>      <span class="hljs-attr">script</span>: <span class="hljs-string">&quot;./.output/server/index.mjs&quot;</span>,<br>    &#125;,<br>  ],<br>&#125;;<br></code></pre></td></tr></table></figure><blockquote><p>pm2 常用指令</p></blockquote><figure class="highlight gml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs gml">pm2 start xxx.js<br>pm2 stop <span class="hljs-variable language_">id</span><br>pm2 stop <span class="hljs-symbol">all</span><br>pm2 list<br>pm2 logs <span class="hljs-comment">// 运行情况</span><br>pm2 reload <span class="hljs-symbol">all</span> <span class="hljs-comment">//重启所有进程</span><br>pm2 <span class="hljs-keyword">delete</span> <span class="hljs-symbol">all</span> <span class="hljs-comment">//删除所有进程</span><br></code></pre></td></tr></table></figure><ol start="2"><li>静态页面部署</li></ol><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs verilog">pnpm run <span class="hljs-keyword">generate</span><br></code></pre></td></tr></table></figure><blockquote></blockquote>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nuxt3</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2023-03-12-【工程化】脚手架搭建手册</title>
    <link href="/2025/11/28/2023-03-12-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91%E8%84%9A%E6%89%8B%E6%9E%B6%E6%90%AD%E5%BB%BA%E6%89%8B%E5%86%8C/"/>
    <url>/2025/11/28/2023-03-12-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91%E8%84%9A%E6%89%8B%E6%9E%B6%E6%90%AD%E5%BB%BA%E6%89%8B%E5%86%8C/</url>
    
    <content type="html"><![CDATA[<h2 id="项目初始化"><a href="#项目初始化" class="headerlink" title="项目初始化"></a>项目初始化</h2><ul><li>初始化 package.json <code>npm init</code><br>字段说明</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sun-arms&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1.0.0&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;lint &amp; tools&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-comment">// main 字段的值是入口文件,即使不包括在 files 字段里，也会被打包。</span><br>  <span class="hljs-attr">&quot;main&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;index.js&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-comment">// files 字段值的类型是字符串数组,数组里面的字符串填写需要发布到 NPM 的文件名。当然也可以在根目录下创建 .npmignore 文件，把不需要上传到 NPM 的文件名填进去。不过有些文件或者目录比如, README.md 或者 LICENSE.md 是默认就会被打包。也有默认不会被打包的目录或者文件，比如, node_modules 或者 .git。</span><br>  <span class="hljs-attr">&quot;files&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-string">&quot;dist&quot;</span><span class="hljs-punctuation">,</span><br>    ...<br>  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;scripts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span> <br>    <span class="hljs-attr">&quot;test&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;repository&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;git&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;git+https://github.com/zhangyingxuan/sun-arms.git&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;author&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;zhangyingxuan&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;license&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ISC&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;bugs&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://github.com/zhangyingxuan/sun-arms/issues&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;homepage&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://github.com/zhangyingxuan/sun-arms#readme&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;publishConfig&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;access&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;public&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;registry&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://registry.npmjs.org/&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-comment">// browser 当需要打包多个版本时，设置 browser 字段，可以根据浏览器的不同环境变量，使用不同的版本</span><br>  <span class="hljs-comment">// unpkg 提供一个给 UNPKG, 用于支持 CDN 服务，有点类似 browser</span><br>  <span class="hljs-comment">// module 若项目中有封装模块，可以设置 module, 也就是设置一个模块的入口, 该字段目前比较前卫</span><br>  <span class="hljs-comment">// typings/types TypeScript 解析文件的入口, 该文件会被发布到 NPM, 并且可以被下载，为用户提供更加好的 IDE 支持。</span><br>  <span class="hljs-comment">// bin 若项目中包含一些可执行文件，可以把文件名在 bin 字段下, 当只有一个 Node.js 文件入口时, 可以是 string 值，当有多个的时候,可以用键值对的形式写。不过要执行这些文件，需要在文件头部加上 #!/usr/bin/env node</span><br>  <span class="hljs-comment">// man 若需要提供命令行输出文档，可以用 man 字段指明,当只有一个文件时, 可以是一个字符串值, 当有多个文件时, 可以是一个字符串数组。</span><br>  <span class="hljs-comment">// peerDependencies NPM v3开始，peerDependencies 字段需要自己配置，用于指定一个兼容项目的依赖，该字段的值是一个对象，对象的 key 是兼容包的名称，对象的值是该包的指定版本。</span><br>  <span class="hljs-comment">// optionalDependencies 字段用于设置一些项目中的可选包，这些包不一定要下载，但是却很有用，设置在该字段下后，对应的包只会在需要的时候被下载，比如 fsevents 模块，尽在 mac 下有效。</span><br>  <span class="hljs-comment">// bundledDependencies 字段是一个字符串数组，数组元素是需要跟最终包一起打包出去的依赖名称。</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h1 id="添加-gitignore"><a href="#添加-gitignore" class="headerlink" title="添加 .gitignore"></a>添加 .gitignore</h1><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-string">.DS_Store</span><br>node_modules<br>**/*<span class="hljs-string">/dist</span><br>**/*<span class="hljs-string">/es</span><br>**/*<span class="hljs-string">/lib</span><br>!**<span class="hljs-string">/sites/</span>**<span class="hljs-string">/site/lib</span><br><span class="hljs-comment"># local env files</span><br><span class="hljs-string">.env.local</span><br><span class="hljs-string">.env.</span>*<span class="hljs-string">.local</span><br><span class="hljs-string">.idea</span><br>temp<br><br><span class="hljs-comment"># Log files</span><br>npm-debug.log*<br>yarn-debug.log*<br>yarn-error.log*<br>lerna-debug.log*<br><br><span class="hljs-comment"># Editor directories and files</span><br><span class="hljs-string">.vscode</span><br>*<span class="hljs-string">.suo</span><br>*<span class="hljs-string">.ntvs</span>*<br>*<span class="hljs-string">.njsproj</span><br>*<span class="hljs-string">.sln</span><br>*<span class="hljs-string">.sw</span>?<br><br><span class="hljs-comment"># release packages</span><br>*<span class="hljs-string">.zip</span><br>*<span class="hljs-string">.gz</span><br>*<span class="hljs-string">.tar</span><br></code></pre></td></tr></table></figure><h1 id="初始化-lint"><a href="#初始化-lint" class="headerlink" title="初始化 lint"></a>初始化 lint</h1><p><a href="./2022-04-17-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91vue3-vite4-ts%E9%85%8D%E7%BD%AEeslint%E3%80%81stylelint%E3%80%81prettier.md">参考 2022-04-17-【工程化】vue3-vite4-ts配置eslint、stylelint、prettier</a></p><h1 id="初始化-husky、commitlint"><a href="#初始化-husky、commitlint" class="headerlink" title="初始化 husky、commitlint"></a>初始化 husky、commitlint</h1><p><a href="./2022-04-17-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91vue3-vite4-ts%E9%85%8D%E7%BD%AEhusky%E3%80%81pre-commit.md">参考 2022-04-17-【工程化】vue3-vite4-ts配置husky、pre-commit</a></p><h1 id="rollup-模块打包"><a href="#rollup-模块打包" class="headerlink" title="rollup 模块打包"></a>rollup 模块打包</h1><p><a href="https://cloud.tencent.com/developer/article/1875920">参考文献</a></p><ul><li>安装依赖</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">pnpm install <span class="hljs-keyword">rollup</span> <span class="hljs-comment">--save-dev</span><br>pnpm install <span class="hljs-variable">@rollup</span><span class="hljs-operator">/</span>plugin<span class="hljs-operator">-</span>commonjs  <span class="hljs-comment">--save-dev</span><br>pnpm install <span class="hljs-keyword">rollup</span> <span class="hljs-comment">--save-dev</span><br></code></pre></td></tr></table></figure><ul><li><p>说明：@rollup&#x2F;plugin-commonjs 支持依赖包转换为es模块化标准。 convert node_modules library to an ES module</p></li><li><p>配置打包指令</p></li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;dev&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rollup -i src/main.js -o dist/bundle.js -f es&quot;</span><br></code></pre></td></tr></table></figure><blockquote><p>-i指定要打包的文件，-i是–input的缩写。<br>src&#x2F;index.js是-i的参数，即打包入口文件。<br>-o指定输出的文件，是–output.file或–file的缩写。(如果没有这个参数，则直接输出到控制台)<br>dist&#x2F;bundle.js是-o的参数，即输出文件。<br>-f指定打包文件的格式，-f是–format的缩写。<br>es是-f的参数，表示打包文件使用ES6模块规范。<br>rollup支持的打包文件的格式有amd, cjs, es\esm, iife, umd。其中，amd为AMD标准，cjs为CommonJS标准，esm\es为ES模块标准，iife 为立即调用函数， umd同时支持amd、cjs和iife。</p></blockquote><h1 id="多指令执行"><a href="#多指令执行" class="headerlink" title="多指令执行"></a>多指令执行</h1><p><code>pnpm install npm-run-all -D</code></p>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>脚手架SDK</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2023-05-23-【工程化】nestjs的JWT身份认证</title>
    <link href="/2025/11/28/2023-05-11-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91nestjs%E7%9A%84JWT%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81/"/>
    <url>/2025/11/28/2023-05-11-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91nestjs%E7%9A%84JWT%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81/</url>
    
    <content type="html"><![CDATA[<p><a href="https://juejin.cn/post/7148331455323013127">https://juejin.cn/post/7148331455323013127</a></p>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>脚手架SDK</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2023-05-22-【研发】nestjs安全</title>
    <link href="/2025/11/28/2023-05-22-%E3%80%90%E7%A0%94%E5%8F%91%E3%80%91nestjs%E5%AE%89%E5%85%A8/"/>
    <url>/2025/11/28/2023-05-22-%E3%80%90%E7%A0%94%E5%8F%91%E3%80%91nestjs%E5%AE%89%E5%85%A8/</url>
    
    <content type="html"><![CDATA[<p><a href="2023-05-11-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91%E5%88%9D%E5%A7%8Bnestjs%E5%85%A5%E9%97%A8%E5%BC%80%E5%8F%91&%E9%83%A8%E7%BD%B2.md">text</a></p><blockquote><p>前言<br>在后端服务中，我们总是会遇到一些不安全的情况，毕竟 web 本身也不是一点漏洞都没有，好在有一些便捷的插件拱我们使用。</p></blockquote><p>helmet，通过设置 HTTP 响应标头来帮助保护 Express 应用程序；<br>express-rate-limit，用于限制对公共 API 和&#x2F;或终结点（例如密码重置）的重复请求，防止暴力攻击；</p><h2 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h2><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">pnpm i helmet <span class="hljs-built_in">express</span>-rate-<span class="hljs-built_in">limit</span><br></code></pre></td></tr></table></figure><h2 id="main-ts-修改"><a href="#main-ts-修改" class="headerlink" title="main.ts 修改"></a>main.ts 修改</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">NestFactory</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@nestjs/core&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">AppModule</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./app.module&quot;</span>;<br><span class="hljs-keyword">import</span> helmet <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;helmet&quot;</span>;<br><span class="hljs-keyword">import</span> rateLimit <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;express-rate-limit&quot;</span>;<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">bootstrap</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> app = <span class="hljs-keyword">await</span> <span class="hljs-title class_">NestFactory</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">AppModule</span>);<br><br>    <span class="hljs-comment">// 头信息安全处理</span><br>    app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">helmet</span>());<br>    <span class="hljs-comment">// 限制请求频率</span><br>    app.<span class="hljs-title function_">use</span>(<br>        <span class="hljs-title function_">rateLimit</span>(&#123;<br>            <span class="hljs-attr">windowMs</span>: <span class="hljs-number">15</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>, <span class="hljs-comment">// 15 分钟</span><br>            <span class="hljs-attr">max</span>: <span class="hljs-number">100</span>, <span class="hljs-comment">// 15分钟中最大 100 个请求</span><br>            <span class="hljs-attr">standardHeaders</span>: <span class="hljs-string">&quot;draft-7&quot;</span>,<br>            <span class="hljs-attr">legacyHeaders</span>: <span class="hljs-literal">false</span><br>        &#125;)<br>    );<br><br><br>    <span class="hljs-keyword">await</span> app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>);<br>&#125;<br><span class="hljs-title function_">bootstrap</span>();<br></code></pre></td></tr></table></figure><h2 id="真实-ip-获取"><a href="#真实-ip-获取" class="headerlink" title="真实 ip 获取"></a>真实 ip 获取</h2><blockquote><p>由于 express-rate-limit 是通过 ip 判断唯一性，所以应确保 ip 的真实性</p></blockquote><ol><li>nginx 配置</li></ol><ul><li>排查访问链路所有转发地址，均需要对 nginx 配置进行修改，</li><li>配置如下：</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">proxy_redirect</span> <span class="hljs-literal">off</span>;<br><span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$host</span>;<br><span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br><span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br><span class="hljs-attribute">proxy_set_header</span> X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;<br><span class="hljs-attribute">proxy_pass</span> http://localhost:3000;<br></code></pre></td></tr></table></figure><blockquote><p>注：X-Forwarded-For 变量的值有$proxy_add_x_forwarded_for和$remote_addr，在只有一个代理服务器的转发的情况下，两者的效果貌似差不多，都可以真实的显示出客户端原始 ip。多台 nginx 转发时，$remote_addr为第一台nginx的ip，$proxy_add_x_forwarded_for 的值为 第 n 台 nginx 的 ip, …第一台 nginx 的 ip；$scheme 为当前协议 http 或 https</p></blockquote><ol start="2"><li>nestjs 设置</li></ol><blockquote><p>创建 nestjs 服务需显示设置创建类型 NestExpressApplication，否则仅 x-forwarded-for 能获取真实 iP</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">NestExpressApplication</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@nestjs/platform-express&quot;</span>;<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">bootstrap</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">// const app = await NestFactory.create(AppModule);</span><br>  <span class="hljs-keyword">const</span> <span class="hljs-attr">app</span>: <span class="hljs-title class_">NestExpressApplication</span> =<br>    (<span class="hljs-keyword">await</span> <span class="hljs-title class_">NestFactory</span>.<span class="hljs-property">create</span>) &lt; <span class="hljs-title class_">NestExpressApplication</span> &gt; <span class="hljs-title class_">AppModule</span>;<br>  <span class="hljs-comment">//此接口NestExpressApplication才有</span><br>  app.<span class="hljs-title function_">set</span>(<span class="hljs-string">&quot;trust proxy&quot;</span>, <span class="hljs-literal">true</span>);<br>  <span class="hljs-keyword">await</span> app.<span class="hljs-title function_">listen</span>(port);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>@Request 与@Req 区别，理论上 Request 包含信息更全，Req 适用于 auth 认证头部信息获取</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs js">@<span class="hljs-title class_">Public</span>()<br>  @<span class="hljs-title class_">Get</span>(<span class="hljs-string">&#x27;getCode&#x27;</span>)<br>  <span class="hljs-title function_">getCode</span>(<span class="hljs-params">@Res() res, @Req() req</span>) &#123;<br>    <span class="hljs-keyword">const</span> captcha = svgCaptcha.<span class="hljs-title function_">create</span>(&#123;<br>      <span class="hljs-attr">size</span>: <span class="hljs-number">4</span>,<br>      <span class="hljs-attr">noise</span>: <span class="hljs-number">2</span>,<br>      <span class="hljs-attr">color</span>: <span class="hljs-literal">true</span>,<br>      <span class="hljs-attr">fontSize</span>: <span class="hljs-number">60</span>,<br>      <span class="hljs-attr">inverse</span>: <span class="hljs-literal">false</span>,<br>      <span class="hljs-attr">background</span>: <span class="hljs-string">&#x27;#F5F7FA&#x27;</span>,<br>    &#125;);<br>    req.<span class="hljs-property">session</span>.<span class="hljs-property">captcha</span> = captcha.<span class="hljs-property">text</span>;<br><br>    <span class="hljs-keyword">const</span> ip = req.<span class="hljs-property">ip</span>;<br>    <span class="hljs-keyword">const</span> host = req.<span class="hljs-property">headers</span>?.<span class="hljs-property">host</span>;<br>    <span class="hljs-keyword">const</span> <span class="hljs-attr">headerRealIP</span>: string = req?.<span class="hljs-property">headers</span>[<span class="hljs-string">&#x27;x-real-ip&#x27;</span>];<br>    <span class="hljs-keyword">const</span> <span class="hljs-title class_">XForwardedFor</span>: string = req?.<span class="hljs-property">headers</span>[<span class="hljs-string">&#x27;x-forwarded-for&#x27;</span>];<br>    <span class="hljs-comment">// this.logger.log(&#x27;生产 验证码：&#x27; + req.session.captcha);</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">logger</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`生产 验证码：1234; <span class="hljs-subst">$&#123;ip&#125;</span> - <span class="hljs-subst">$&#123;host&#125;</span>; - <span class="hljs-subst">$&#123;headerRealIP&#125;</span>; - <span class="hljs-subst">$&#123;XForwardedFor&#125;</span>`</span>);<br>    res.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;Content-Type&#x27;</span>, <span class="hljs-string">&#x27;image/svg+xml&#x27;</span>);<br>    res.<span class="hljs-title function_">send</span>(captcha.<span class="hljs-property">data</span>);<br>  &#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nestjs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2023-05-11-【工程化】初始nestjs入门开发&amp;部署</title>
    <link href="/2025/11/28/2023-05-11-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91%E5%88%9D%E5%A7%8Bnestjs%E5%85%A5%E9%97%A8%E5%BC%80%E5%8F%91&amp;%E9%83%A8%E7%BD%B2/"/>
    <url>/2025/11/28/2023-05-11-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91%E5%88%9D%E5%A7%8Bnestjs%E5%85%A5%E9%97%A8%E5%BC%80%E5%8F%91&amp;%E9%83%A8%E7%BD%B2/</url>
    
    <content type="html"><![CDATA[<h1 id="一、前言背景"><a href="#一、前言背景" class="headerlink" title="一、前言背景"></a>一、前言背景</h1><h2 id="1-1-什么是-nestjs"><a href="#1-1-什么是-nestjs" class="headerlink" title="1.1 什么是 nestjs"></a>1.1 什么是 nestjs</h2><p>NestJS 是一个用于构建高效、可扩展的 Node.js 服务器端应用程序的开发框架。它利用 JavaScript 的渐进增强的能力，结合了 OOP（面向对象编程）、FP（函数式编程）和 FRP（函数响应式编程）等编程范式。NestJS 建立在强大的 HTTP 服务器框架上，例如 Express，并提供了更高层次的抽象，同时仍然向开发者直接暴露了底层框架的 API。</p><h2 id="1-2-什么是-nodejs"><a href="#1-2-什么是-nodejs" class="headerlink" title="1.2 什么是 nodejs"></a>1.2 什么是 nodejs</h2><p>Node.js 是一个基于 Chrome V8 引擎的 JavaScript 运行环境。它使得开发者能够高效地在服务器端运行 JavaScript 代码。Node.js 提供了一个非阻塞 I&#x2F;O 模型，使得开发者能够轻松地编写服务器端应用程序。Node.js 还提供了一系列丰富的模块，使得开发者能够轻松地扩展应用程序的功能。</p><h2 id="1-3-javascript-运行环境"><a href="#1-3-javascript-运行环境" class="headerlink" title="1.3 javascript 运行环境"></a>1.3 javascript 运行环境</h2><p><img src="/assets/images/nestjs/javascript%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83.png" alt="安装yapi"></p><h2 id="1-4-前端框架比较"><a href="#1-4-前端框架比较" class="headerlink" title="1.4 前端框架比较"></a>1.4 前端框架比较</h2><table><thead><tr><th>框架</th><th>特点</th><th>缺点</th><th>适用场景</th></tr></thead><tbody><tr><td>NestJS</td><td>高效；轻量级；基于装饰器；依赖注入；管道；中间件；拦截器等机制</td><td>学习成本较高；对开发者编程素养和面向对象开发思想的要求较高</td><td>中大型企业级 Web 应用；需要高效、可扩展的框架</td></tr><tr><td>Next.js</td><td>基于 React 和 React Router；服务器端渲染；生态圈繁荣</td><td>性能相对较低；需要使用 React 的知识</td><td>中大型企业级 Web 应用；需要高效、可扩展的框架</td></tr><tr><td>Nuxt.js</td><td>基于 Vue.js 的轻量级应用框架；服务器端渲染；生态圈繁荣</td><td>性能相对较低；需要使用 Vue 的知识</td><td>中大型企业级 Web 应用；需要高效、可扩展的框架</td></tr><tr><td>Egg.js</td><td>Egg.js 的企业级规范和强大的功能；多线程支持；类型检查良好；基于 Koa2 开发</td><td>学习成本较高；对开发者编程素养和面向对象开发思想的要求较高</td><td>中大型企业级 Web 应用；需要高效、可扩展的框架</td></tr><tr><td>Koa2</td><td>轻量级；异步中间件模型；生成器；上下文对象</td><td>学习曲线较陡峭；对异步编程的认知要求较高</td><td>中小型企业级 Web 应用；需要高效、可扩展的框架</td></tr><tr><td>Express</td><td>广泛的使用和生态圈；中间件模型；简单易学；主要用于构建 RESTful API 服务器</td><td>大而全，不够轻量级；性能相对较低</td><td>小型企业和个人项目；对性能要求不高的应用场景</td></tr></tbody></table><h2 id="1-5-nestjs-与-spring-boot-对比"><a href="#1-5-nestjs-与-spring-boot-对比" class="headerlink" title="1.5 nestjs 与 spring boot 对比"></a>1.5 nestjs 与 spring boot 对比</h2><table><thead><tr><th></th><th>nestjs</th><th>spring boot</th></tr></thead><tbody><tr><td>开发语言</td><td>TypeScript 或 JavaScript</td><td>Java 或 Kotlin</td></tr><tr><td>发布时间</td><td>2017</td><td>2014</td></tr><tr><td>学习曲线</td><td>易上手</td><td>成本高</td></tr><tr><td>扩展性</td><td>高</td><td>高</td></tr><tr><td>文档和社区</td><td>较新，不全面</td><td>完善且丰富</td></tr><tr><td>维护成本</td><td>人力成本高</td><td>适中</td></tr><tr><td>轻量级</td><td>是</td><td>否</td></tr><tr><td>处理 I&#x2F;O 任务</td><td>高效</td><td>一般</td></tr><tr><td>单线程</td><td>是</td><td>否</td></tr><tr><td>内存使用率</td><td>低</td><td>一般</td></tr><tr><td>多线程支持</td><td>否</td><td>是</td></tr><tr><td>执行计算量大的任务</td><td>一般</td><td>高效</td></tr><tr><td>严格的类型检测</td><td>一般</td><td>是</td></tr><tr><td>测试工具</td><td>jest</td><td>Junit</td></tr><tr><td>应用场景</td><td>轻量级高性能中大型应用</td><td>大型复杂应用</td></tr></tbody></table><h1 id="二、nestjs-基本概念及用法"><a href="#二、nestjs-基本概念及用法" class="headerlink" title="二、nestjs 基本概念及用法"></a>二、nestjs 基本概念及用法</h1><p>Nest 的目标是成为一个与平台无关的框架，目前支持两个框架：Express 和 Fastify，默认使用 Express。NestJS 对于这两个框架进行了一定的封装，也支持直接使用它们的 API，因此给开发者带来了很大的自由度。</p><p>NestJS 提供了一个开箱即用的框架，能够创建可测试、可扩展、低耦合和易于维护的应用程序。它的设计思想受到 Angular 的启发，同时也借鉴了其他 MVC 框架的概念和最佳实践。可使用 nest-cli 脚手架创建新的 NestJS 项目。</p><h2 id="2-1-主要组件"><a href="#2-1-主要组件" class="headerlink" title="2.1 主要组件"></a>2.1 主要组件</h2><h2 id="2-1-1-控制器-Controller"><a href="#2-1-1-控制器-Controller" class="headerlink" title="2.1.1 控制器 Controller"></a>2.1.1 控制器 Controller</h2><ul><li>处理传入的请求并向客户端返回响应</li><li>被 @Controller 装饰的类 就是 一个 Controller</li><li>参数获取 @Body(), @Query(), @Res()； 返回 @Res()</li><li><code>nest g resource test</code></li></ul><p><img src="/assets/images/nestjs/Controllers.png" alt="Controllers"></p><h2 id="2-1-2-提供者-Providers"><a href="#2-1-2-提供者-Providers" class="headerlink" title="2.1.2 提供者 Providers"></a>2.1.2 提供者 Providers</h2><ul><li>提供者是 Nest 中的一个基本概念。许多基本的 Nest 类都可以被视为提供者——服务、存储库、工厂、助手等。提供者的主要思想是它可以注入依赖项；这意味着对象之间可以创建各种关系，并且“连接”对象实例的功能可以在很大程度上委托给 Nest 运行时系统。</li><li>被 @Injectable 装饰的类 都是 Providers</li><li>创建服务 <code>nest g service cats</code><br><img src="/assets/images/nestjs/Components.png" alt="Controllers"></li></ul><h2 id="2-1-3-模块-Modules"><a href="#2-1-3-模块-Modules" class="headerlink" title="2.1.3 模块 Modules"></a>2.1.3 模块 Modules</h2><ul><li>模块是用@Module()装饰器注释的类。装饰@Module()器提供 Nest 用来组织应用程序结构的元数据。</li><li>每个应用程序至少有一个模块 - 根模块。根模块是 Nest 用来构建应用程序图的起点。</li></ul><p><img src="/assets/images/nestjs/Modules.png" alt="Controllers"></p><h2 id="2-1-4-中间件-Middleware"><a href="#2-1-4-中间件-Middleware" class="headerlink" title="2.1.4 中间件 Middleware"></a>2.1.4 中间件 Middleware</h2><ul><li>中间件是在路由处理程序之前调用的函数，可以访问请求和响应对象。</li><li>在函数中或在带有@Injectable()装饰器的类中实现自定义 Nest 中间件。类应该实现 NestMiddleware 接口，而函数没有任何特殊要求</li></ul><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs perl"><span class="hljs-variable">@Injectable</span>()<br>export <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoggerMiddleware</span> <span class="hljs-title">implements</span> <span class="hljs-title">NestMiddleware</span> </span>&#123;<br></code></pre></td></tr></table></figure><p><img src="/assets/images/nestjs/Middlewares.png" alt="Controllers"></p><h2 id="2-1-5-管道-Pipes"><a href="#2-1-5-管道-Pipes" class="headerlink" title="2.1.5 管道 Pipes"></a>2.1.5 管道 Pipes</h2><ul><li>管道是用@Injectable()装饰器注释的类。管道应该实现 PipeTransform 接口。</li><li>用途：1. 转换：将输入数据转换为所需的形式；2. 校验：评估输入数据，如果有效，则简单地通过它；否则，当数据不正确时抛出异常</li><li>管道都在 arguments 由控制器路由处理程序处理的对象上运行。</li><li>示例</li></ul><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Get</span>(<span class="hljs-string">&#x27;:id&#x27;</span>)<br>async <span class="hljs-built_in">findOne</span>(<span class="hljs-variable">@Param</span>(<span class="hljs-string">&#x27;id&#x27;</span>, ParseIntPipe) <span class="hljs-attribute">id</span>: number) &#123;<br>  <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.catsService</span><span class="hljs-selector-class">.findOne</span>(id);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-1-6-守卫-Guards"><a href="#2-1-6-守卫-Guards" class="headerlink" title="2.1.6 守卫 Guards"></a>2.1.6 守卫 Guards</h2><ul><li>守卫是用@Injectable()装饰器注释的类。实现 CanActivate 接口。<br>用途：单一职责授权操作。使用@UseGuards() 绑定。</li><li>与管道和异常过滤器一样，守卫可以是控制器范围的、方法范围的或全局范围的。</li></ul><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs perl"><span class="hljs-variable">@Injectable</span>()<br>export <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AuthGuard</span> <span class="hljs-title">implements</span> <span class="hljs-title">CanActivate</span> </span>&#123;<br></code></pre></td></tr></table></figure><p><img src="/assets/images/nestjs/Guards.png" alt="Controllers"></p><h2 id="2-1-7-拦截器"><a href="#2-1-7-拦截器" class="headerlink" title="2.1.7 拦截器"></a>2.1.7 拦截器</h2><ul><li>使用@Injectable()装饰器注解的类，实现 NestInterceptor 接口，位于请求和响应之间的一段代码。</li><li>用途：在函数执行前&#x2F;后绑定额外的逻辑，如：权限验证，日志记录，性能监控。</li><li>拦截器获取请求信息并仅在发送响应时执行阻塞操作。这样一来，传入的请求就不会因 Node.js 进程繁忙而受到限制，并且应用程序可以在后台进行异步处理（与 i&#x2F;o 相关）。</li></ul><p><img src="/assets/images/nestjs/Interceptors.png" alt="Controllers"></p><h2 id="2-2-请求生命周期"><a href="#2-2-请求生命周期" class="headerlink" title="2.2 请求生命周期"></a>2.2 请求生命周期</h2><ul><li><p>收到请求</p></li><li><p>中间件</p></li><li><ol><li>全局绑定的中间件</li></ol></li><li><ol start="2"><li>路径中指定的 Module 绑定的中间件</li></ol></li><li><p>守卫</p></li><li><ol><li>全局守卫</li></ol></li><li><ol start="2"><li>Controller 守卫</li></ol></li><li><ol start="3"><li>Route 守卫</li></ol></li><li><p>拦截器（Controller 之前）</p></li><li><ol><li>全局</li></ol></li><li><ol start="2"><li>Controller 拦截器</li></ol></li><li><ol start="3"><li>Route 拦截器</li></ol></li><li><p>管道</p></li><li><ol><li>全局管道</li></ol></li><li><ol start="2"><li>Controller 管道</li></ol></li><li><ol start="3"><li>Route 管道</li></ol></li><li><ol start="4"><li>Route 参数管道</li></ol></li><li><p>Controller（方法处理器）</p></li><li><p>服务</p></li><li><p>拦截器（Controller 之后）</p></li><li><ol><li>Route 拦截器</li></ol></li><li><ol start="2"><li>Controller 拦截器</li></ol></li><li><ol start="3"><li>全局拦截器</li></ol></li><li><p>异常过滤器</p></li><li><ol><li>Route</li></ol></li><li><ol start="2"><li>控制器</li></ol></li><li><ol start="3"><li>全局</li></ol></li><li><p>服务器响应</p></li><li><p>注： Route 代表 Controller 下的 method。</p></li></ul><h1 id="2-3-项目搭建"><a href="#2-3-项目搭建" class="headerlink" title="2.3 项目搭建"></a>2.3 项目搭建</h1><ul><li>参考官网 <a href="https://nestjs.bootcss.com/first-steps">项目创建</a></li></ul><h1 id="2-4-数据库操作-typeorm"><a href="#2-4-数据库操作-typeorm" class="headerlink" title="2.4 数据库操作 typeorm"></a>2.4 数据库操作 typeorm</h1><p>TypeORM 是一个对象关系映射（ORM）库，可用于 Node.js 和各种浏览器中的不同数据库，如 MySQL、PostgreSQL、Oracle、MSSQL 和 SQLite。它支持 Active Record 和 Data Mapper 模式，具有类型安全、易于使用和可扩展的优点。TypeORM 旨在支持最新的 JavaScript 特性，并提供额外的功能以帮助开发人员快速构建健壮的数据库应用程序。</p><ol><li>安装依赖</li></ol><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript"><span class="hljs-built_in">npm</span> install @nestjs/typeorm typeorm mysql<br></code></pre></td></tr></table></figure><ol start="2"><li>配置</li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php">import &#123; TypeOrmModule, TypeOrmModuleOptions &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@nestjs/typeorm&#x27;</span>;<br>...<br><br>@<span class="hljs-title function_ invoke__">Module</span>(&#123;<br>  <span class="hljs-attr">imports</span>: [<br>    TypeOrmModule.<span class="hljs-title function_ invoke__">forRoot</span>(&#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;mysql&#x27;</span>,<br>      <span class="hljs-attr">host</span>: <span class="hljs-string">&#x27;x.x.x.x&#x27;</span>,<br>      <span class="hljs-attr">port</span>: <span class="hljs-number">3306</span>,<br>      <span class="hljs-attr">username</span>: <span class="hljs-string">&#x27;root&#x27;</span>,<br>      <span class="hljs-attr">password</span>: <span class="hljs-string">&#x27;xxxx&#x27;</span>,<br>      <span class="hljs-attr">database</span>: <span class="hljs-string">&#x27;xxxx&#x27;</span>,<br>      <span class="hljs-attr">entities</span>: [__dirname + <span class="hljs-string">&#x27;/**/*.entity&#123;.ts,.js&#125;&#x27;</span>],<br>      <span class="hljs-attr">synchronize</span>: <span class="hljs-literal">true</span>,<br>    &#125;),<br>  ],<br>  <span class="hljs-attr">controllers</span>: [AppController],<br>  <span class="hljs-attr">providers</span>: [AppService],<br>&#125;)<br>export <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppModule</span> </span>&#123; &#125;<br></code></pre></td></tr></table></figure><h1 id="2-5-构建，区分环境"><a href="#2-5-构建，区分环境" class="headerlink" title="2.5 构建，区分环境"></a>2.5 构建，区分环境</h1><ol><li>安装依赖包</li></ol><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel">npm install @nestjs/config <span class="hljs-keyword">cross</span>-<span class="hljs-keyword">env</span><br></code></pre></td></tr></table></figure><ol start="2"><li>根目录创建 .env.dev 及 .env.prod 文件</li><li>配置</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> &#123; Module &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@nestjs/common&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; AppController &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./app.controller&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; AppService &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./app.service&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; TypeOrmModule, TypeOrmModuleOptions &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@nestjs/typeorm&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; ScheduleModule &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@nestjs/schedule&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; ConfigModule, ConfigService &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@nestjs/config&#x27;</span>;<br><br>const envFilePath = `.env.$&#123;process.env.NODE_ENV || <span class="hljs-string">&#x27;dev&#x27;</span>&#125;`;<br><br><span class="hljs-meta">@Module(<span class="hljs-params">&#123;</span></span><br><span class="hljs-params"><span class="hljs-meta">  imports: [</span></span><br><span class="hljs-params"><span class="hljs-meta">    ConfigModule.forRoot(<span class="hljs-params">&#123;</span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">      isGlobal: true,</span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">      envFilePath,</span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">    &#125;</span>),</span></span><br><span class="hljs-params"><span class="hljs-meta">    //配置数据库链接</span></span><br><span class="hljs-params"><span class="hljs-meta">    TypeOrmModule.forRootAsync(<span class="hljs-params">&#123;</span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">      imports: [ConfigModule],</span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">      inject: [ConfigService],</span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">      useFactory: (<span class="hljs-params">config: ConfigService</span>) =&gt; &#123;</span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">        <span class="hljs-keyword">return</span> &#123;</span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">          <span class="hljs-built_in">type</span>: <span class="hljs-string">&#x27;mysql&#x27;</span>,</span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">          host: config.get(<span class="hljs-params"><span class="hljs-string">&#x27;DATABASE_HOST&#x27;</span></span>),</span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">          port: config.get(<span class="hljs-params"><span class="hljs-string">&#x27;DATABASE_PORT&#x27;</span></span>),</span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">          username: config.get(<span class="hljs-params"><span class="hljs-string">&#x27;DATABASE_USER&#x27;</span></span>),</span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">          password: config.get(<span class="hljs-params"><span class="hljs-string">&#x27;DATABASE_PASSWORD&#x27;</span></span>),</span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">          database: config.get(<span class="hljs-params"><span class="hljs-string">&#x27;DATABASE_DATABASE&#x27;</span></span>),</span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">          entities: [__dirname + <span class="hljs-string">&#x27;/**/*.entity&#123;.ts,.js&#125;&#x27;</span>],</span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">          synchronize: true,</span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">        &#125; <span class="hljs-keyword">as</span> TypeOrmModuleOptions;</span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">      &#125;,</span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">    &#125;</span>),</span></span><br><span class="hljs-params"><span class="hljs-meta">    ScheduleModule.forRoot(<span class="hljs-params"></span>)</span></span><br><span class="hljs-params"><span class="hljs-meta">  ],</span></span><br><span class="hljs-params"><span class="hljs-meta">  controllers: [AppController],</span></span><br><span class="hljs-params"><span class="hljs-meta">  providers: [AppService],</span></span><br><span class="hljs-params"><span class="hljs-meta">&#125;</span>)</span><br>export <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppModule</span> &#123; &#125;<br><br></code></pre></td></tr></table></figure><ol start="4"><li>修改 package.json 启动及打包指令</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">&quot;start&quot;: <span class="hljs-keyword">cross</span><span class="hljs-operator">-</span>env NODE_ENV<span class="hljs-operator">=</span>dev nest <span class="hljs-keyword">start</span> <span class="hljs-comment">--watch</span><br></code></pre></td></tr></table></figure><h1 id="2-6-定时任务"><a href="#2-6-定时任务" class="headerlink" title="2.6 定时任务"></a>2.6 定时任务</h1><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs clean"><span class="hljs-keyword">import</span> &#123; ScheduleModule &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@nestjs/schedule&#x27;</span>;<br></code></pre></td></tr></table></figure><p><a href="https://juejin.cn/post/7131724757019394079">Nestjs 开发环境和生产环境的配置</a></p><h1 id="断点调试"><a href="#断点调试" class="headerlink" title="断点调试"></a>断点调试</h1><p><a href="https://juejin.cn/post/7035954397012033566">https://juejin.cn/post/7035954397012033566</a></p><h2 id="VScode-调试"><a href="#VScode-调试" class="headerlink" title="VScode 调试"></a>VScode 调试</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs verilog">其中 <span class="hljs-keyword">program</span> 字段是关键，开启调试器的时候会从这个入口启动应用。<br><br>自动生成的 lanuch<span class="hljs-variable">.json</span> 配置文件的 <span class="hljs-keyword">program</span> 已经默认有值了，那是因为VSCode 在初始化这个配置文件的时候，会解析项目的 <span class="hljs-keyword">package</span><span class="hljs-variable">.json</span> 文件里的 script<span class="hljs-variable">.start</span> 脚本，并把解析内容填充到 lanuch<span class="hljs-variable">.json</span> 的 <span class="hljs-keyword">program</span> 字段。<br><br>&#123;<br>  <span class="hljs-comment">// 使用 IntelliSense 了解相关属性。</span><br>  <span class="hljs-comment">// 悬停以查看现有属性的描述。</span><br>  <span class="hljs-comment">// 欲了解更多信息，请访问: https://go.microsoft.com/fwlink/?linkid=830387</span><br>  <span class="hljs-string">&quot;version&quot;</span>: <span class="hljs-string">&quot;0.2.0&quot;</span>,<br>  <span class="hljs-string">&quot;configurations&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;node&quot;</span>,<br>      <span class="hljs-string">&quot;request&quot;</span>: <span class="hljs-string">&quot;launch&quot;</span>,<br>      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;启动程序&quot;</span>,<br>      <span class="hljs-string">&quot;skipFiles&quot;</span>: [<br>        <span class="hljs-string">&quot;&lt;node_internals&gt;/**&quot;</span><br>      ],<br>      <span class="hljs-comment">// 启动调试器之前运行任务进行编译TS项目</span><br>      <span class="hljs-string">&quot;program&quot;</span>: <span class="hljs-string">&quot;$&#123;workspaceFolder&#125;&quot;</span>,<br>      <span class="hljs-string">&quot;outFiles&quot;</span>: [<br>        <span class="hljs-string">&quot;$&#123;workspaceFolder&#125;/pay-back/packages/server/dist/**/*.js&quot;</span><br>      ]<br>    &#125;<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="三、部署"><a href="#三、部署" class="headerlink" title="三、部署"></a>三、部署</h1><h3 id="3-1-PM2-介绍"><a href="#3-1-PM2-介绍" class="headerlink" title="3.1 PM2 介绍"></a>3.1 PM2 介绍</h3><ol><li>pm2 是开源的基于 Nodejs 的进程管理器，包括守护进程、监控、日志的一整套完整的功能；</li><li>pm2 带有负载均衡功能(使用 Node cluster 集群模块)，可以保持 node 应用进程永远运行在后台</li><li>0 秒停机重载，维护升级时不需要停机；</li><li>安装 pm2 <code>pnpm install pm2 -g</code></li></ol><h3 id="3-2-PM2-部署-nestjs-项目"><a href="#3-2-PM2-部署-nestjs-项目" class="headerlink" title="3.2 PM2 部署 nestjs 项目"></a>3.2 PM2 部署 nestjs 项目</h3><ol><li>在项目根目录下创建一个 ecosystem.config.js 文件，配置 PM2：</li></ol><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs nix">m<span class="hljs-attr">odule.exports</span> <span class="hljs-operator">=</span> &#123;<br>  <span class="hljs-params">apps:</span> [<br>    &#123;<br>      <span class="hljs-params">name:</span> <span class="hljs-string">&quot;my-nestjs-project&quot;</span>,<br>      <span class="hljs-params">script:</span> <span class="hljs-string">&quot;dist/main.js&quot;</span>,<br>      <span class="hljs-params">env:</span> &#123;<br>        <span class="hljs-params">NODE_ENV:</span> <span class="hljs-string">&quot;development&quot;</span>,<br>      &#125;,<br>      <span class="hljs-params">env_production:</span> &#123;<br>        <span class="hljs-params">NODE_ENV:</span> <span class="hljs-string">&quot;production&quot;</span>,<br>      &#125;,<br>    &#125;,<br>  ],<br>&#125;;<br></code></pre></td></tr></table></figure><ol start="2"><li>使用 PM2 启动项目</li></ol><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-comment"># 生产环境使用以下命令启动项目：</span><br><br>pm2 <span class="hljs-built_in">start</span> ecosystem.config.js <span class="hljs-comment">--env production</span><br></code></pre></td></tr></table></figure><blockquote><p>该命令会根据 ecosystem.config.js 中的配置，以生产环境启动 NestJS 项目。</p></blockquote><ul><li>PM2 命令</li></ul><ol><li>pm2 start app.js：启动 nodeJs 应用，进程的默认名称为文件名 app</li><li>pm2 start app.js –name mynode：启动 node，并指定进程名称为 mynode</li><li>pm2 start app.js -i max：根据有效 CPU 数目启动最大进程数目</li><li>pm2 start app.js –watch：实时监控的方式启动，app.js 文件有变动时，pm2 会自动 reload</li></ol><ul><li>查看与监视进程</li></ul><ol><li>pm2 list：显示所有进程；</li><li>pm2 show 0，pm2 info 0：查看进程 id 为 0 的详细信息；</li><li>pm2 monit：进入监视页面，监视每个 node 进程的 CPU 和内存的使用情况。</li></ol><ul><li>停止、删除进程</li></ul><ol><li>pm2 stop&#x2F;delete 0：停止&#x2F;删除 id 为 0 的进程；</li><li>pm2 stop&#x2F;delete all：停止&#x2F;删除所有进程。</li></ol><ul><li>重启、重载</li></ul><ol><li>pm2 restart 0：重启 id 为 0 的进程；</li><li>pm2 restart all：重启所有进程；</li><li>pm2 reload 0：0 秒停机重载 id 为 0 进程(用于 NETWORKED 进程)；</li><li>pm2 reload all：重载所有进程。</li></ol><ul><li>日志操作</li></ul><ol><li>pm2 logs：显示所有进程的日志；</li><li>pm2 logs 0：显示进程 id 为 0 的日志；</li><li>pm2 flush：清空所有日志文件；</li><li>pm2 reloadLogs：重载所有日志。</li><li>pm2 startup：产生 init 脚本，保持进程活着。</li></ol><h2 id="2-docker-容器化部署"><a href="#2-docker-容器化部署" class="headerlink" title="2. docker 容器化部署"></a>2. docker 容器化部署</h2><h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p>mysql 自动备份<br><a href="https://blog.51cto.com/u_15906694/6007052">https://blog.51cto.com/u_15906694/6007052</a></p><ol><li>宿主机创建 backUp 文件夹</li><li>执行备份指令</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">exec</span> -it mysql（容器名）  /bin/bash -c <span class="hljs-string">&#x27;mysqldump -uroot -pjueduianquan996 --databases 需要备份的数据库&#x27;</span> &gt; /usr/local/mysql/backup/user_`<span class="hljs-built_in">date</span> +%F`.sql（宿主机的文件路径）;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 示例">docker exec -i mysql /bin/bash -c &#x27;mysqldump -uroot -pjueduianquan996 --databases blowsysun&#x27; &gt; /usr/local/mysql/backup/funds_data_`date +\%F`.sql<br></code></pre></td></tr></table></figure><ol start="3"><li>创建定时任务</li></ol><ul><li>linux 上最常用的计划任务软件叫 crontab，该软件的命令同时也叫 crontab。</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># 常用指令</span><br><span class="hljs-attribute">crontab</span> -l：查看当前定时任务<br><span class="hljs-attribute">crontab</span> -e：编辑、新建定时任务<br><span class="hljs-attribute">0</span> <span class="hljs-number">0</span> <span class="hljs-number">19</span> * * <span class="hljs-number">1</span>-<span class="hljs-number">5</span> /usr/local/mysql/backup/timerTask.sh<br></code></pre></td></tr></table></figure><ol start="4"><li>恢复数据</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs 进入MySQL容器">恢复数据库前，同样需要进入MySQL容器的shell环境，命令与备份时相同：<br><br>docker exec -it mysql-container bash<br>使用mysql命令恢复数据库<br>在容器内部，我们可以使用mysql命令恢复数据库。例如，从/backup/mydatabase.sql文件恢复名为mydatabase的数据库，可以执行以下命令：<br><br>mysql -u root -p mydatabase &lt; /backup/mydatabase.sql<br>注意：上述命令中的root为用户名，执行该命令时会提示输入密码。<br></code></pre></td></tr></table></figure><ol start="5"><li>从服务器下载文件</li></ol><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir">scp root<span class="hljs-variable">@43</span>.<span class="hljs-number">154.209</span>.<span class="hljs-number">141</span><span class="hljs-symbol">:/usr/local/mysql/backup/funds_data_2024-</span><span class="hljs-number">11</span><span class="hljs-number">-08</span>.sql /<span class="hljs-title class_">Users</span>/sunny/<span class="hljs-title class_">Desktop</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nestjs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2023-10-11-【唐诗300首】唐诗300首全集（一）</title>
    <link href="/2025/11/28/2023-10-11-%E3%80%90%E5%94%90%E8%AF%97300%E9%A6%96%E3%80%91%E5%94%90%E8%AF%97300%E9%A6%96%E5%85%A8%E9%9B%86%EF%BC%88%E4%B8%80%EF%BC%89/"/>
    <url>/2025/11/28/2023-10-11-%E3%80%90%E5%94%90%E8%AF%97300%E9%A6%96%E3%80%91%E5%94%90%E8%AF%97300%E9%A6%96%E5%85%A8%E9%9B%86%EF%BC%88%E4%B8%80%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<p>《唐诗三百首》是一部流传很广的唐诗选集。唐朝（618 年~907 年）二百九十年间，是中国诗歌发展的黄金时代，云蒸霞蔚，名家辈出，唐诗数量多达五万余首。孙琴安《唐诗选本六百种提要·自序》指出，“唐诗选本经大量散佚，至今尚存三百余种。当中最流行而家传户晓的，要算《唐诗三百首》。”《唐诗三百首》选诗范围相当广泛，收录了 77 家诗，共 311 首，在数量以杜甫诗数多，有 38 首、王维诗 29 首、李白诗 27 首、李商隐诗 22 首。它是中小学生接触中国古典诗歌最好的入门书籍。<br>　　《唐诗三百首》分为十一卷，其分别为：五言古诗、五言乐府、七言古诗、七言乐府、五言律诗、七言律诗、七言乐府、五言绝句、五言乐府、七言绝句、 七言乐府。<br>　　第一卷：五言古诗<br>　　《感遇十二首其一》作者为唐朝文学家张九龄。其古诗全文如下：<br>　　兰叶春葳蕤，桂华秋皎洁。<br>　　欣欣此生意，自尔为佳节。<br>　　谁知林栖者，闻风坐相悦。<br>　　草木有本心，何求美人折。<br>　　【翻译】<br>　　兰草到了春天长得分外繁盛，桂花到了秋天开得十分皎洁。这一派欣欣向荣的蓬勃生机，自然成为美好的季节。谁知道那居住在山林中的隐士，闻到了芬芳更加喜悦。草木自有本性，何求美人赏识采折呢。</p><p>《感遇十二首其七》作者为唐朝文学家张九龄。其古诗全文如下：<br>　　江南有丹桔，经冬犹绿林。<br>　　岂伊地气暖，自有岁寒心。<br>　　可以荐佳客，奈何阻重深。<br>　　徒言树桃李，此木岂无阴。<br>　　运命唯所遇，循环不可寻？<br>　　【翻译】<br>　　江南丹桔叶茂枝繁，经冬不凋四季常青。岂止南国地气和暖，而是具有松柏品性。荐之嘉宾必受称赞，山重水阻如何进献？命运遭遇往往不一，因果循环奥秘难寻。只说桃李有果有林，难道丹桔就不成阴。</p><p>《感遇·其一》作者为唐朝文学家张九龄 。其古诗全文如下：<br>　　孤鸿海上来，池潢不敢顾。<br>　　侧见双翠鸟，巢在三珠树。<br>　　矫矫珍木颠，得无金丸惧。<br>　　美服患人指，高明逼神恶。<br>　　今我游冥冥，弋者何所慕。<br>　　【翻译】<br>　　这首诗讲述了一个寓言故事：一只来自大海上的鸿雁，独自飞临一座城池边。城中高高的神树之上，两只翠鸟正得意洋洋地站在那儿。鸿雁预料他们终将自取祸患，于是自己展翅高飞，离开了这险恶之地。</p><p>《下终南山过斛斯山人宿置酒》作者为唐朝文学家李白。其古诗全文如下：<br>　　暮从碧山下，山月随人归。<br>　　却顾所来径，苍苍横翠微。<br>　　相携及田家，童稚开荆扉。<br>　　绿竹入幽径，青萝拂行衣。<br>　　欢言得所憩，美酒聊共挥。<br>　　长歌吟松风，曲尽河星稀。<br>　　我醉君复乐，陶然共忘机。<br>　　【翻译】<br>　　傍晚时从终南山上走下来，山月一路跟着我归来。回头望望刚才走过的山间小路，苍苍茫茫笼罩在一片青翠中。与斛斯山人携手到他的田家，孩童出来打开柴门。走进绿竹掩映的幽静小路，青萝的枝叶时时拂着我们的衣裳。欢言笑谈中得到了真正放松休息，畅饮着美酒，宾主频频举杯。放声高歌松风曲，歌罢银河的星星已经稀少。我喝醉了但主人非常高兴，欢乐得忘了人间的奸诈心机。</p><p>《月下独酌》作者为唐朝文学家李白。古诗全文如下：<br>　　花间一壶酒，独酌无相亲。<br>　　举杯邀明月，对影成三人。<br>　　月既不解饮，影徒随我身。<br>　　暂伴月将影，行乐须及春。<br>　　我歌月徘徊，我舞影零乱。<br>　　醒时同交欢，醉后各分散。<br>　　永结无情游，相期邈云汉。<br>　　【翻译】<br>　　提一壶美酒摆在花丛间，自斟自酌无友无亲。举杯邀请明月，对着身影成为三人。明月当然不会喝酒，身影也只是随着我身。我只好和他们暂时结成酒伴，要行乐就必须把美好的春光抓紧。我唱歌明月徘徊，我起舞身影零乱。醒时一起欢乐，醉后各自分散。我愿与他们永远结下忘掉伤情的友谊，相约在缥缈的银河边。</p><p>《春思二首其一》作者为唐朝文学家李白。古诗全文如下：<br>　　燕草如碧丝，秦桑低绿枝。<br>　　当君怀归日，是妾断肠时。<br>　　春风不相识，何事入罗帏。<br>　　【翻译】<br>　　燕草刚如碧丝之时，秦地的桑树已绿树成阴了。当君才开始想家的时候，妾已相思得肝肠欲断了。春风啊春风，我与你并不相识，你为何闯入了我的罗帏。</p><p>《望岳》作者是唐代文学家杜甫。其全文古诗如下：<br>　　岱宗夫如何？齐鲁青未了。<br>　　造化钟神秀，阴阳割昏晓。<br>　　荡胸生曾云，决眦入归鸟。<br>　　会当凌绝顶，一览众山小。<br>　　【翻译】<br>　　五岳之首泰山的景象怎么样？在齐鲁大地上,那青翠的山色没有尽头。大自然把神奇和秀美都赋予了泰山，泰山是天地间神秀之气的集中所在。泰山巍峨高大，山南和山北被分割成一明一暗 WwW.SLkj.org，判若早晨和黄昏。层层云霭雾气升腾，使我心胸激荡，凝神远望，目送山中的飞鸟归林。定要登上泰山的顶峰，俯瞰群山，在眼中是多么渺小。</p><p>《赠卫八处士》作者为唐朝文学家杜甫。古诗全文如下：<br>　　人生不相见，动如参与商。今夕复何夕，共此灯烛光。<br>　　少壮能几时，鬓发各已苍。访旧半为鬼，惊呼热中肠。<br>　　焉知二十载，重上君子堂。昔别君未婚，儿女忽成行。<br>　　怡然敬父执，问我来何方。问答乃未已，驱儿罗酒浆。<br>　　夜雨剪春韭，新炊间黄粱。主称会面难，一举累十觞。<br>　　十觞亦不醉，感子故意长。明日隔山岳，世事两茫茫。<br>　　【翻译】<br>　　世间上的挚友真难得相见，好比此起彼落的参星与商星这两个星宿。今晚是什么日子如此幸运，竟然能与你挑灯共叙衷情？青春壮年实在是没有几时，不觉得你我各巳鬓发苍苍。打听故友大半都已逝去了，听到你惊呼胸中热流回荡。真没想到阔别二十年之后，能有机会再次来登门拜访。当年握别时你还没有成亲，今日见到你儿女已经成行。他们和顺地敬重父亲挚友，热情地问我来自哪个地方？三两句问答话还没有说完，你便叫他们张罗家常酒筵。雨夜割来的春韭嫩嫩长长，刚烧好黄梁掺米饭喷喷香。你说难得有这个机会见面，一举杯就接连地喝了十杯。十几杯酒我也难得一醉呵，谢谢你对故友的情深意长。明朝你我又要被山岳阻隔，人情世事竟然都如此渺茫。</p><p>《佳人》作者为唐朝文学家杜甫。古诗全文如下：<br>　　绝代有佳人，幽居在空谷。<br>　　自云良家女，零落依草木。<br>　　关中昔丧乱，兄弟遭杀戮。<br>　　官高何足论，不得收骨肉。<br>　　世情恶衰歇，万事随转烛。<br>　　夫婿轻薄儿，新人美如玉。<br>　　合昏尚知时，鸳鸯不独宿。<br>　　但见新人笑，那闻旧人哭。<br>　　在山泉水清，出山泉水浊。<br>　　侍婢卖珠回，牵萝补茅屋。<br>　　摘花不插发，采柏动盈掬。<br>　　天寒翠袖薄，日暮倚修竹。<br>　　【翻译】<br>　　有一个美艳绝代的佳人，隐居在僻静的深山野谷。她说：“我是良家的女子，零落漂泊才与草木依附。想当年长安丧乱的时候，兄弟遭到了残酷的杀戮。官高显赫又有什么用呢，不得收养我这至亲骨肉。世情本来就是厌恶衰落，万事象随风抖动的蜡烛。没想到夫婿是个轻薄儿，又娶了美颜如玉的新妇。合欢花朝舒昏合有时节，鸳鸯鸟雌雄交颈不独宿。朝朝暮暮只与新人调笑，哪还管我这个旧人悲哭？”在山的泉水清澈又透明，出山的泉水就要浑浊浊。变卖首饰的侍女刚回来，牵拉萝藤修补着破茅屋。摘来野花不爱插头打扮，采来的柏子满满一大掬。天气寒冷美人衣衫单薄，夕阳下她倚着长长青竹。</p><p>《梦李白二首其一》作者为唐朝文学家杜甫。古诗全文如下：<br>　　死别已吞声，生别常恻恻。<br>　　江南瘴疠地，逐客无消息。<br>　　故人入我梦，明我常相忆。<br>　　君今在罗网，何以有羽翼？<br>　　恐非平生魂，路远不可测。<br>　　魂来枫林青，魂返关塞黑。<br>　　落月满屋梁，犹疑照颜色。<br>　　水深波浪阔，无使蛟龙得。</p><p>《梦李白二首其一》作者为唐朝文学家杜甫。古诗全文如下：<br>　　死别已吞声，生别常恻恻。<br>　　江南瘴疠地，逐客无消息。<br>　　故人入我梦，明我常相忆。<br>　　君今在罗网，何以有羽翼？<br>　　恐非平生魂，路远不可测。<br>　　魂来枫林青，魂返关塞黑。<br>　　落月满屋梁，犹疑照颜色。<br>　　水深波浪阔，无使蛟龙得。</p><p>《梦李白·其二》作者为唐朝文学家杜甫。古诗全文如下：<br>　　浮云终日行，游子久不至。<br>　　三夜频梦君，情亲见君意。<br>　　告归常局促，苦道来不易。<br>　　江湖多风波，舟楫恐失坠。<br>　　出门搔白首，若负平生志。<br>　　冠盖满京华，斯人独憔悴。<br>　　孰云网恢恢，将老身反累。<br>　　千秋万岁名，寂寞身后事。<br>　　【翻译】<br>　　天上的浮云终日飞来飘去，远方的游子为何久久不至。一连三夜都梦见与你相会，情亲意切足见你对我厚谊。告别时你总显得局促不安，愁苦地诉说来路艰险不易。你说江湖上风波多么险恶，总是担心船只失事会翻毁。你出门时还搔着满头白发，好像辜负了平生凌云壮志。京都中达官贵人冠盖相续，高洁如你却落得这样憔悴。谁能说天网恢恢疏而不漏，为何你到老反被牵连受罪？你的声名将千秋万代流传，可是生前却这般悲凉孤寂。</p><p>《送别》作者为唐朝文学家王维。其古诗词全文如下：<br>　　下马饮君酒，问君何所之。<br>　　君言不得意，归卧南山陲。<br>　　但去莫复问，白云无尽时。<br>　　【翻译】<br>　　请你下马来喝一杯酒，敢问你要到哪里去？你说因为不甚得志，要到终南山那边隐居。只管去吧，我不再多问，那白云没有穷尽的时候。</p><p>《送綦毋潜落第还乡》作者为唐朝文学家王维。古诗全文如下：<br>　　圣代无隐者，英灵尽来归。<br>　　遂令东山客，不得顾采薇。<br>　　既至金门远，孰云吾道非。<br>　　江淮度寒食，京洛缝春衣。<br>　　置酒长安道，同心与我违。<br>　　行当浮桂桌，未几拂荆扉。<br>　　远树带行客，孤城当落晖。<br>　　吾谋适不用，勿谓知音稀。<br>　　【翻译】<br>　　政治清明时代绝无隐者存在，为朝政服务有才者纷纷出来。就连你这个隐居东山的隐者，也不再效法伯夷叔齐去采薇。你应试到京城君门遥远难叩，那是命运不济谁说吾道不对？你将经过江淮去度过寒食节，到东京洛阳时滞留缝制春衣。我们又在长安城外设酒饯别，知心朋友如今又要与我分离。你行将驾驶着小船南下归去，不几天就可把自家柴门扣开。远山的树木把你的身影遮盖，夕阳余辉映得孤城艳丽多彩。你暂不被录用纯属偶然的事，别以为知音稀少而徒自感慨。</p><p>《青溪》作者为唐朝文学家王维。古诗全文如下：<br>　　言入黄花川，每逐青溪水。<br>　　随山将万转，趣途无百里。<br>　　声喧乱石中，色静深松里。<br>　　漾漾泛菱荇，澄澄映葭苇。<br>　　我心素已闲，清川澹如此。<br>　　请留盘石上，垂钓将已矣。<br>　　【翻译】<br>　　走进黄花川，我每每追随青溪的流水。旅程还不到百里之遥，溪水随着山路万转千回。它流过山间的乱石，发出喧响轰鸣，流经幽深的松林，又带着林间青色的宁静。菱角和荇菜荡漾在水上，澄净中央岸的芦苇倒映。我的心向来淡泊闲静，何况面对着淡泊如我的青溪。从此留在这巨石之上吧，我将以垂钓来度我的余生。</p><p>《渭川田家》作者为唐朝文学家王维。古诗全文如下：<br>　　斜光照墟落，穷巷牛羊归。<br>　　野老念牧童，倚杖候荆扉。<br>　　雉雊麦苗秀，蚕眠桑叶稀。<br>　　田夫荷锄至，相见语依依。<br>　　即此羡闲逸，怅然吟式微。<br>　　【翻译】<br>　　村庄处处披满夕阳余辉，牛羊沿着深巷纷纷回归。老叟惦念着放牧的孙儿，柱杖等候在自家的柴扉。雉鸡鸣叫麦儿即将抽穗，蚕儿成眠桑叶已经薄稀。农夫们荷锄回到了村里，相见欢声笑语恋恋依依。如此安逸怎不叫我羡慕？我不禁怅然地吟起《式微》。</p><p>《西施咏》作者为唐朝文学家王维。古诗全文如下：<br>　　艳色天下重，西施宁久微。<br>　　朝为越溪女，暮作吴宫妃。<br>　　贱日岂殊众，贵来方悟稀。<br>　　邀人傅粉粉，不自着罗衣。<br>　　君宠益娇态，君怜无是非。<br>　　当时浣纱伴，莫得同车归。<br>　　持谢邻家子，效颦安可希。<br>　　【翻译】<br>　　艳丽的姿色向来为天下器重，美丽的西施怎么能久处低微？原先她是越溪的一个浣纱女，后来却成了吴王宫里的爱妃。贫贱时难道有什么与众不同？显贵了才惊悟她丽质天下稀。曾有多少宫女为她搽脂敷粉，她从来也不用自己穿着罗衣。君王宠幸她的姿态更加娇媚，君王怜爱从不计较她的是非。昔日一起在越溪浣纱的女伴，再不能与她同车去来同车归。奉告那盲目效颦的邻人东施，光学皱眉而想取宠并非容易。</p><p>《秋登兰山寄张五》作者为唐朝文学家孟浩然。古诗全文如下：<br>　　北山白云里，隐者自怡悦。<br>　　相望始登高，心随雁飞灭。<br>　　愁因薄暮起，兴是清秋发。<br>　　时见归村人，沙行渡头歇。<br>　　天边树若荠，江畔洲如月。<br>　　何当载酒来，共醉重阳节。<br>　　【翻译】<br>　　面对北山岭上白云起伏霏霏，我这隐者自己能把欢欣品味。我试着登上高山是为了遥望，心情早就随着鸿雁远去高飞。忧愁每每是薄暮引发的情绪，兴致往往是清秋招致的氛围。在山上时时望见回村的人们，走过沙滩坐在渡口憩息歇累。远看天边的树林活象是荠菜，俯视江畔的沙洲好比是弯月。什么时候你能载酒到这里来，重阳佳节咱们开怀畅饮共醉。</p><p>《夏日南亭怀辛大》作者为唐朝文学家孟浩然。古诗全文如下：<br>　　山光忽西落，池月渐东上。<br>　　散发乘夕凉，开轩卧闲敞。<br>　　荷风送香气，竹露滴清响。<br>　　欲取鸣琴弹，恨无知音赏。<br>　　感此怀故人，中宵劳梦想。<br>　　【翻译】<br>　　傍山的日影忽然西落了，池塘上的月亮从东面慢慢升起。披散着头发在夜晚乘凉，打开窗户躺卧在幽静宽敞的地方。一阵阵的晚风送来荷花的香气，露水从竹叶上滴下发出清脆的响声。正想拿琴来弹奏，可惜没有知音来欣赏。感慨良宵，怀念起老朋友来，整夜在梦中也苦苦地想念。</p><p>《宿业师山房待丁大不至》作者为唐朝文学家孟浩然。古诗全文如下：<br>　　夕阳度西岭，群壑倏已暝。<br>　　松月生夜凉，风泉满清听。<br>　　樵人归尽欲，烟鸟栖初定。<br>　　之子期宿来，孤琴候萝径。<br>　　【翻译】<br>　　夕阳慢慢地隐没在西面的山脉后，连绵起伏的群山变得昏暗。月光穿过横斜的松枝，为夜晚添了几分凉意，泉水声和着风声，听起来别有一番风味。打柴的樵夫们快要全部归去，暮烟中的鸟儿们刚刚栖定。我期望你能够像我们约定的那样来此住宿，现在只有我独自一人抱着琴在小路边。</p><p>《同从弟南斋玩月忆山阴崔少府》作者为唐朝文学家王昌龄。古诗全文如下：<br>　　高卧南斋时，开帷月初吐。<br>　　清辉淡水木，演漾在窗户。<br>　　苒苒几盈虚，澄澄变今古。<br>　　美人清江畔，是夜越吟苦。<br>　　千里其如何，微风吹兰杜。<br>　　【翻译】<br>　　悠闲地躺卧南斋，拉开帷帘见明月初上。在它清辉的沐浴下，树影随着水波轻轻摇晃，水月的清光映照在窗户上，不住地徘徊荡漾。岁月流逝，月亮圆缺不知经过了多少反复；世间几度苍桑巨变，它仍然像原来那样清亮澄莹。日夜思念的人啊，你远在清江河畔，当此月圆良宵，一定伤感地吟诵思乡之曲。两地相隔千山万水，我们却共享一个明月的光辉。你远播的名声，如同兰花若吐露的清香，千里之外也会随风吹来。</p><p>《寻西山隐者不遇》作者为唐朝文学家邱为。古诗全文如下：<br>　　绝顶一茅茨，直上三十里。<br>　　叩关无僮仆，窥室惟案几。<br>　　若非巾柴车，应是钓秋水。<br>　　差池不相见，黾勉空仰止。<br>　　草色新雨中，松声晚窗里。<br>　　及兹契幽绝，自足荡心耳。<br>　　虽无宾主意，颇得清净理。<br>　　兴尽方下山，何必待之子。<br>　　【翻译】<br>　　高高的山顶上有一座茅屋，从山下走上去足有三十里。轻扣柴门竟无童仆回问声，窥看室内只有桌案和茶几。主人不是驾着巾柴车外出，一定是到秋水碧潭去钓鱼。错过了时机不能与他见面，空负了殷勤仰慕一片心意。新雨中草色多么青翠葱绿，晚风将松涛声送进窗户里。这清幽境地很合我的雅兴，足可以把身心和耳目荡涤。我虽然还没有和主人交谈，却已经领悟到清净的道理。玩到兴尽就满意地下山去，何必非要和这位隐者相聚。</p><p>《春泛若耶溪》作者为唐朝文学家綦毋潜。古诗全文如下：<br>　　幽意无断绝，此去随所偶。<br>　　晚风吹行舟，花路入溪口。<br>　　际夜转西壑，隔山望南斗。<br>　　潭烟飞溶溶，林月低向后。<br>　　生事且弥漫，愿为持竿叟。<br>　　【翻译】<br>　　归隐之心长期以来不曾中断，此次泛舟随遇而安任其自然。阵阵晚风吹着小舟轻轻荡漾，一路春花撒到了溪口的两边。傍晚时分船儿转出西山幽谷，隔山望见了南斗明亮的闪光。水潭烟雾升腾一片白白茫茫，岸树明月往后与船行走逆向。人间世情多么繁复多么茫然，愿作渔翁持竿垂钓在此溪旁。</p><p>《宿王昌龄隐居》作者是唐代文学家常建。其古诗全文如下：<br>　　清溪深不测，隐处唯孤云。<br>　　松际露微月，清光犹为君。<br>　　茅亭宿花影，药院滋苔纹。<br>　　余亦谢时去，西山鸾鹤群。<br>　　【翻译】<br>　　清溪的水深不可测，隐居的地方只见一片白云。松林间露出微微的月光，清亮的光辉好像是为了你而发出。茅亭外，夜静悄悄的，花影像睡着了一样，种药的院子里滋生出苔恨。我也要离开尘世隐居，到西山与鸾鹤作伴。</p><p>《与高适薛据登慈恩寺浮图》作者为唐朝文学家岑参。古诗全文如下：<br>　　塔势如涌出，孤高耸天宫。<br>　　登临出世界，蹬道盘虚空。<br>　　突兀压神州，峥嵘如鬼工。<br>　　四角碍白日，七层摩苍穹。<br>　　下窥指高鸟，俯听闻惊风。<br>　　连山若波涛，奔凑如朝东。<br>　　青槐夹驰道，宫馆何玲珑。<br>　　秋色从西来，苍然满关中。<br>　　五陵北原上，万古青蒙蒙。<br>　　净理了可悟，胜因夙所宗。<br>　　誓将挂冠去，觉道资无穷。<br>　　【翻译】<br>　　宝塔宛如平地涌出，孤高巍峨耸入天宫。登上去像走出人间，蹬踏梯道盘旋空中。高峻突出镇定神州，峥嵘胜过鬼斧神工。四角伸展挡住白日，七层紧紧连着苍穹。下看飞鸟屈指可数，俯听山风呼啸迅猛。山连山如波涛起伏，汹涌澎湃奔流向东。青槐夹着笔直驰道，楼台宫殿何等玲珑。秋天秀色从西而来，苍苍茫茫弥漫关中。长安城北汉代五陵，万古千秋一派青葱。清净佛理完全领悟。善因素来为人信从。立誓归隐辞官而去，信奉佛道其乐无穷。</p><p>《贼退示官吏·并序》作者为唐朝文学家元结。古诗全文如下：<br>　　昔岁逢太平，山林二十年。<br>　　泉源在庭户，洞壑当门前。<br>　　井税有常期，日晏犹得眠。<br>　　忽然遭世变，数岁亲戎旃。<br>　　今来典斯郡，山夷又纷然。<br>　　城小贼不屠，人贫伤可怜。<br>　　是以陷邻境，此州独见全。<br>　　使臣将王命，岂不如贼焉。<br>　　令彼征敛者，迫之如火煎。<br>　　谁能绝人命，以作时世贤。<br>　　思欲委符节，引竿自刺船。<br>　　将家就鱼麦，归老江湖边。<br>　　【翻译】<br>　　早年正逢太平盛世，我在山林中住了二十年。井泉就在院内，山洞山沟就在门前。那时收取赋税有一定的期限，一到夜晚就能安闲地睡眠。忽然间遭逢战乱，几年来我亲临前线作战。如今来此掌管这个州郡，山中的蛮族又作乱。城小盗贼不来屠掠，因为百姓贫穷实在可怜。相邻的州郡相继陷落，唯独这个州郡得以保全。使臣奉行皇上之命，难道还不如盗贼心善?那些皇上派来收税的使臣，逼迫百姓如用火煎。谁忍心断绝百姓生路，去做个能干的官员。我真想交还官印，拿起竹竿自己撑船。带领全家去打鱼种麦，到老都住在江河湖边。</p><p>《郡斋雨中与诸文士燕集》作者为唐朝文学家韦应物。古诗全文如下：<br>　　兵卫森画戟，燕寝凝清香。<br>　　海上风雨至，逍遥池阁凉。<br>　　烦疴近消散，嘉宾复满堂。<br>　　自惭居处崇，未睹斯民康。<br>　　理会是非遣，性达形迹忘。<br>　　鲜肥属时禁，蔬果幸见尝。<br>　　俯饮一杯酒，仰聆金玉章。<br>　　神欢体自轻，意欲凌风翔。<br>　　吴中盛文史，群彦今汪洋。<br>　　方知大藩地，岂曰财赋强。<br>　　【翻译】<br>　　官邸门前画戟林立兵卫森严，休息室内凝聚着焚檀的清香。东南近海层层风雨吹进住所，逍遥自在池阁之间阵阵风凉。心里头的烦躁苦闷将要消散，嘉宾贵客重新聚集济济一堂。自己惭愧所处地位太过高贵，未能顾及平民百姓有无安康。如能领悟事理是非自然消释，性情达观世俗礼节就可淡忘。鲜鱼肥肉是夏令禁食的荤腥，蔬菜水果希望大家尽管品尝。大家躬身饮下一杯醇清美酒，抬头聆听各人吟诵金玉诗章。精神愉快身体自然轻松舒畅，心里真想临风飘举奋力翱翔。吴中不愧为文史鼎盛的所在，文人学士简直多如大海汪洋。现在才知道大州大郡的地方，哪里是仅以财物丰阜而称强。</p><p>《初发扬子寄元大校书》作者为唐朝文学家韦应物。古诗全文如下：<br>　　凄凄去亲爱，泛泛入烟雾。<br>　　归桌洛阳人，残钟广陵树。<br>　　今朝为此别，何处还相遇。<br>　　世事波上舟，沿洄安得住。<br>　　【翻译】<br>　　悲伤地离开了亲爱的朋友，飘荡的小船进入了烟雾之中。归舟上是洛阳的游子，回头望去，看到广陵城的树，耳边响起残余的钟声。今天在这里和你分别，何处还能再相遇。世事就像波浪中的船，不论顺流逆流又怎么能停得住呢。</p><p>《寄全椒山中道士》作者为唐朝文学家韦应物。古诗全文如下：<br>　　今朝郡斋冷，忽念山中客。<br>　　涧底束荆薪，归来煮白石。<br>　　欲恃一瓢酒，远慰风雨夕。<br>　　落叶满空山，何处寻行迹。<br>　　【翻译】<br>　　今天郡斋里很冷，忽然想起山中隐居的人。你一定在涧底打柴，回来以后煮些清苦的饭菜。想带着一瓢酒去看你，让你在风雨夜里得到些安慰。可是秋叶落满空山，什么地方能找到你的行迹。</p><p>《长安遇冯着》作者为唐朝文学家韦应物。其古诗全文如下：<br>　　客从东方来，衣上灞陵雨。<br>　　问客何为来？采山因买斧。<br>　　冥冥花正开，飏飏燕新乳。<br>　　昨别今已春，鬓丝生几缕？<br>　　【翻译】<br>　　客人从东方过来，衣服上还带着灞陵的雨。问客人为什么来，客人说为了上山砍伐树木来买斧头。百花正在悄悄地盛开，轻盈的燕子正在哺乳新雏。去年一别如今又是春天，两鬓的头发不知又生出多少。</p><p>《夕次盱眙县》作者为唐朝文学家韦应物。古诗全文如下：<br>　　落帆逗淮镇，停舫临孤驿。<br>　　浩浩风起波，冥冥日沉夕。<br>　　人归山郭暗，雁下芦洲白。<br>　　独夜忆秦关，听钟未眠客。<br>　　【翻译】<br>　　卸帆留宿淮水岸边的小镇，小舫停靠着孤零零的旅驿。大风突起江上的波浪浩荡，太阳沉落大地的夜色苍黑。山昏城暗人们都回家安憩，月照芦洲雁群也落下栖息。夜晚孤独我不禁想起长安，听到岸上钟声我怎能入睡。</p><p>《东郊》作者为唐朝文学家韦应物。古诗全文如下：<br>　　吏舍局终年，出郊旷清曙。<br>　　杨柳散和风，青山澹吾虑。<br>　　依丛适自憩，缘涧还复去。<br>　　微雨霭芳原，春鸠鸣何处。<br>　　乐幽心屡止，遵事迹犹遽。<br>　　终罢斯结庐，慕陶真可庶。<br>　　【翻译】<br>　　整年拘束官署之中实在烦闷，清晨出去郊游顿觉精神欢愉。嫩绿的杨柳伴随着春风荡漾，苍翠的山峰淡化了我的思虑。靠着灌木丛自由自在地憩息，沿着涧流旁任凭意愿地徘徊。芳香的原野落着迷蒙的细雨，宁静的大地到处是春鸠鸣啼。本爱长处清幽屡次不得如愿，只因公务缠身行迹十分匆促。终有一日罢官归隐在此结庐，羡慕陶潜差不多能得到乐趣。</p><p>《送杨氏女》作者为唐朝文学家韦应物。其古诗全文如下：<br>　　永日方戚戚，出行复悠悠。<br>　　女子今有行，大江溯轻舟。<br>　　尔辈苦无恃，抚念益慈柔。<br>　　幼为长所育，两别泣不休。<br>　　对此结中肠，义往难复留。<br>　　自小阙内训，事姑贻我忧。<br>　　赖兹托令门，任恤庶无尤。<br>　　贫俭诚所尚，资从岂待周。<br>　　孝恭遵妇道，容止顺其猷。<br>　　别离在今晨，见尔当何秋。<br>　　居闲始自遣，临感忽难收。<br>　　归来视幼女，零泪缘缨流。<br>　　【翻译】<br>　　我整日忧郁而悲悲戚戚，女儿就要出嫁遥远地方。今天她要远行去做新娘，乘坐轻舟沿江逆流而上。你姐妹自幼尝尽失母苦，念此我就加倍慈柔抚养。妹妹从小全靠姐姐养育，今日两人作别泪泣成行。面对此情景我内心郁结，女大当嫁你也难得再留。你自小缺少慈母的教训，侍奉婆婆的事令我担忧。幸好依仗你夫家好门第，信任怜恤不挑剔你过失。安贫乐俭是我一贯崇尚，嫁妆岂能做到周全丰厚。望你孝敬长辈遵守妇道，仪容举止都要符合潮流。今晨我们父女就要离别，再见到你不知什么时候。闲居时忧伤能自我排遣，临别感伤情绪一发难收。回到家中看到孤单小女，悲哀泪水沿着帽带滚流。</p><p>《晨诣超师院读禅经》作者为唐朝文学家柳宗元。古诗全文如下：<br>　　汲井漱寒齿，清心拂尘服。<br>　　闲持贝叶书，步出东斋读。<br>　　真源了无取，妄迹世所逐。<br>　　遗言冀可冥，缮性何由熟。<br>　　道人庭宇静，苔色连深竹。<br>　　日出雾露余，青松如膏沐。<br>　　澹然离言说，悟悦心自足。<br>　　【翻译】<br>　　汲来清凉井水漱口刷牙，心清了再拂去衣上尘土。悠闲地捧起佛门贝叶经，信步走出东斋吟咏朗读。佛经真谛世人并无领悟，荒诞之事却为人们追逐。佛儒精义原也可望暗合，但修养本性我何以精熟。道人禅院多么幽雅清静，绿色鲜苔连接竹林深处。太阳出来照着晨雾余露，苍翠松树宛若沐后涂脂。清静使我恬淡难以言说，悟出佛理内心畅快满足。</p><p>《溪居》作者为唐朝文学家柳宗元。其全文古诗如下：<br>　　久为簪组累，幸此南夷谪。<br>　　闲依农圃邻，偶似山林客。<br>　　晓耕翻露草，夜榜响溪石。<br>　　来往不逢人，长歌楚天碧。<br>　　【翻译】<br>　　长久以来受着官职羁绊，幸亏这次贬谪来到南荒。空闲时与邻居农户作伴，偶而也像山林隐士一样。清晨耕地翻动含露小草，夜间划船拍击溪石作响。来来往往不见一个人影，独自在碧蓝楚天下高唱。</p><p>第二卷：五言乐府<br>　　《塞上曲》作者为唐朝文学家王昌龄。古诗词全文如下：<br>　　蝉鸣空桑林，八月萧关道。<br>　　出塞入塞寒，处处黄芦草。<br>　　从来幽并客，皆共尘沙老。<br>　　莫学游侠儿，矜夸紫骝好。<br>　　【翻译】<br>　　知了在枯秃的桑林鸣叫，八月的萧关道气爽秋高。出塞后再入塞气候变冷，关内关外尽是黄黄芦草。自古来河北山西的豪杰，都与尘土黄沙伴随到老。莫学那自恃勇武游侠儿，自鸣不凡地把骏马夸耀。</p><p>《塞下曲》作者为唐朝文学家王昌龄。其古诗全文如下：<br>　　其一<br>　　蝉鸣空桑林，八月萧关道。<br>　　出塞入塞寒，处处黄芦草。<br>　　从来幽并客，皆向沙场老。<br>　　莫学游侠儿，矜夸紫骝好。<br>　　其二<br>　　饮马渡秋水，水寒风似刀。<br>　　平沙日未没，黯黯见临洮。<br>　　昔日长城战，咸言意气高。<br>　　黄尘足今古，白骨乱蓬蒿。<br>　　【翻译】<br>　　其一<br>　　知了在枯秃的桑林鸣叫，八月的萧关道气爽秋高。出塞后再入塞气候变冷，关内关外尽是黄黄芦草。自古来河北山西的豪杰，都与尘土黄沙伴随到老。莫学那自恃勇武游侠儿，自鸣不凡地把骏马夸耀。<br>　　其二<br>　　牵马饮水渡过了那大河，水寒刺骨秋风如剑如刀。沙场广袤夕阳尚未下落，昏暗中看见遥远的临洮。当年长城曾经一次鏖战，都说戍边战士的意气高。自古以来这里黄尘迷漫，遍地白骨零乱夹着野草。</p><p>《关山月》作者为唐朝文学家李白。古诗全文如下：<br>　　明月出天山，苍茫云海间。<br>　　长风几万里，吹度玉门关。<br>　　汉下白登道，胡窥青海湾。<br>　　由来征战地，不见有人还。<br>　　戍客望边色，思归多苦颜。<br>　　高楼当此夜，叹息未应闲。<br>　　【翻译】<br>　　巍巍天山，苍茫云海，一轮明月倾泻银光一片。浩荡长风，掠过几万里关山，来到戍边将士驻守的边关。汉高祖出兵白登山征战匈奴，吐蕃觊觎青海大片河山。这些历代征战之地，很少看见有人庆幸生还。戍边兵士仰望边城，思归家乡愁眉苦颜。当此皓月之夜，高楼上望月怀夫的妻子，同样也在频频哀叹，远方的亲人啊，你几时能卸甲洗尘归来。</p><p>《子夜秋歌》作者为唐朝文学家李白。古诗全文如下：<br>　　长安一片月，万户捣衣声。<br>　　秋风吹不尽，总是玉关情。<br>　　何日平胡虏，良人罢远征。<br>　　【翻译】<br>　　秋月皎洁长安城一片光明，家家户户传来捣衣的声音。砧声任凭秋风吹也吹不尽，声声总是牵系玉关的情人。什么时候才能把胡虏平定，丈夫就可以不再当兵远征。</p><p>《子夜吴歌·夏歌》作者为唐朝文学家李白。其古诗全文如下：<br>　　镜湖三百里，菡萏发荷花。<br>　　素手青条上，红妆白日鲜。<br>　　回舟不待月，归去越王家。</p><p>《子夜吴歌·秋歌》作者为唐朝文学家李白。其古诗全文如下：<br>　　长安一片月，万户捣衣声。<br>　　秋风吹不尽，总是玉关情。<br>　　何日平胡虏，良人罢远征。<br>　　【翻译】<br>　　秋月皎洁长安城一片光明，家家户户传来捣衣的声音。砧声任凭秋风吹也吹不尽，声声总是牵系玉关的亲人。什么时候才能把敌人平定，丈夫就可以结束漫长征途。</p><p>《子夜吴歌·春歌》作者为唐朝文学家李白。其古诗全文如下：<br>　　秦地罗敷女，采桑绿水边。<br>　　素手青条上，红妆白日鲜。<br>　　蚕饥妾欲去，五马莫留连。</p><p>《长干行》作者是唐代文学家李白。其全文古诗如下：<br>　　妾发初覆额，折花门前剧。<br>　　郎骑竹马来，绕床弄青梅。<br>　　同居长干里，两小无嫌猜。<br>　　十四为君妇，羞颜未尝开。<br>　　低头向暗壁，千唤不一回。<br>　　十五始展眉，愿同尘与灰。<br>　　常存抱柱信，岂上望夫台。<br>　　十六君远行，瞿塘滟滪堆。<br>　　五月不可触，猿鸣天上哀。<br>　　门前迟行迹，一一生绿苔。<br>　　苔深不能扫，落叶秋风早。<br>　　八月蝴蝶黄，双飞西园草。<br>　　感此伤妾心，坐愁红颜老。<br>　　早晚下三巴，预将书报家。<br>　　相迎不道远，直至长风沙。<br>　　【翻译】<br>　　我的头发刚刚盖过额头，便同你一起在门前做折花的游戏。你骑着竹马过来，我们一起绕着井栏，互掷青梅为戏。我们同在长干里居住，两个人从小都没什么猜忌。十四岁时嫁给你作妻子，害羞得没有露出过笑脸。低着头对着墙壁的暗处，一再呼唤也不敢回头。十五岁才舒展眉头，愿意永远和你在一起。常抱着至死不渝的信念，怎么能想到会走上望夫台？十六岁时你离家远行，要去瞿塘峡滟滪堆。五月水涨时，滟滪堆不可相触，两岸猿猴的啼叫声传到天上。门前是你离家时徘徊的足迹，渐渐地长满了绿苔。绿苔太厚，不好清扫，树叶飘落，秋天早早来到。八月里，黄色的蝴碟飞舞，双双飞到西园草地上。看到这种情景我很伤心，因而忧愁容颜衰老。无论什么时候你想下三巴回家，请预先把家书捎给我。迎接你不怕道路遥远，一直走到长风沙。</p><p>《列女操》作者为唐朝文学家孟郊。古诗全文如下：<br>　　梧桐相待老，鸳鸯会双死。<br>　　贞妇贵殉夫，舍生亦如此。<br>　　波澜誓不起，妾心井中水。<br>　　【翻译】<br>　　雄梧雌桐枝叶覆盖相守终老，鸳鸯水鸟成双成对至死相随。贞洁的妇女贵在为丈夫殉节，为此舍生才称得上至善至美。对天发誓我心永远忠贞不渝，就像清净不起波澜的古井水。</p><p>《游子吟》作者为唐朝文学家孟郊。其全文古诗如下：<br>　　慈母手中线，游子身上衣。<br>　　临行密密缝，意恐迟迟归。<br>　　谁言寸草心，报得三春晖。<br>　　【翻译】<br>　　慈母用手中的针线，为远行的儿子赶制身上的衣衫。临行前一针针密密地缝缀，怕的是儿子回来得晚衣服破损。有谁敢说，子女像小草那样微弱的孝心，能够报答得了像春晖普泽的慈母恩情呢。</p><p>《登幽州台歌》作者是唐代文学家陈子昂。其古诗全文如下：<br>　　前不见古人，后不见来者。<br>　　念天地之悠悠，独怆然而涕下。<br>　　【翻译】<br>　　往前不见古代招贤的圣君，向后不见后世求才的明君。只有那苍茫天地悠悠无限，止不住满怀悲伤热泪纷纷。</p><p>第三卷：七言古诗<br>　　《古意》作者为唐朝文学家李颀。古诗全文如下：<br>　　男儿事长征，少小幽燕客。<br>　　赌胜马蹄下，由来轻七尺。<br>　　杀人莫敢前，须如猬毛磔。<br>　　黄云陇底白云飞，未得报恩不能归。<br>　　辽东小妇年十五，惯弹琵琶解歌舞。<br>　　今为羌笛出塞声，使我三军泪如雨。<br>　　【翻译】<br>　　男子汉当以国事为重，从军远征，从小就在幽燕纵横驰骋。经常与人在马上比试胜负，从不珍惜七尺身躯。奋勇搏杀，没人敢上前招应；气宇轩昂，脸上的胡子像刺猬的毛丛生。陇下黄沙弥漫，上面白云飘飞，未报朝廷恩情怎能轻易言归。辽东少妇年方十五，她弹熟了琵琶能歌善舞。今日用羌笛吹一支出塞乐曲，感动得全军将士泪下如雨。</p><p>《送陈章甫》作者为唐朝文学家李颀。古诗全文如下：<br>　　四月南风大麦黄，枣花未落桐叶长。<br>　　青山朝别暮还见，嘶马出门思旧乡。<br>　　陈侯立身何坦荡，虬须虎眉仍大颡。<br>　　腹中贮书一万卷，不肯低头在草莽。<br>　　东门沽酒饮我曹，心轻万事皆鸿毛。<br>　　醉卧不知白日暮，有时空望孤云高。<br>　　长河浪头连天黑，津口停舟渡不得。<br>　　郑国游人未及家，洛阳行子空叹息。<br>　　闻道故林相识多，罢官昨日今如何。<br>　　【翻译】<br>　　四月南风吹大麦一片金黄，枣花未落梧桐叶子已抽长。早晨辞别青山晚上又相见，出门闻马鸣令我想念故乡。陈侯的立身处世襟怀坦荡，虬须虎眉前额宽仪表堂堂。你胸藏诗书万卷学问深广，怎么能够低头埋没在草莽。在城东门买酒同我们畅饮，心宽看万事都如鸿毛一样。喝醉酒酣睡不知天已黄昏，有时独自将天上孤云眺望。今日黄河波浪汹涌连天黑，行船在渡口停驻不敢过江。你这郑国的游人不能返家，我这洛阳的行子空自叹息。听说你在家乡旧相识很多，罢官回去他们如何看待你。</p><p>《琴歌》作者为唐朝文学家李颀。古诗全文如下：<br>　　主人有酒欢今夕，请奏鸣琴广陵客。<br>　　月照城头乌半飞，霜凄万树风入衣。<br>　　铜炉华烛烛增辉，初弹渌水后楚妃。<br>　　一声已动物皆静，四座无言星欲稀。<br>　　清淮奉使千余里，敢告云山从此始。<br>　　【翻译】<br>　　主人安排好了酒宴，请大家欢度今宵的时光。那位擅长琴艺的人，就要把鸣弦拨响。明月高照城头，栖息的乌鸦半被惊飞。寒露凄冷草木凋零，秋风吹来寒沁人衣。堂上的铜炉生起融融炭火，华烛高烧增添了宴会的欢欣。那客人弹完著名的《渌水》，又弹了一曲美妙的《楚妃》。琴声一响万簌立刻归于寂静，大家屏息凝神，直听到夜半星稀。我离乡千里来到这淮北之地，琴声引动我的乡情，真想从此辞官归去。</p><p>《听董大弹胡笳声兼寄语弄房给事》作者为唐朝文学家李颀。古诗全文如下：<br>　　蔡女昔造胡笳声，一弹一十有八拍。<br>　　胡人落泪沾边草，汉使断肠对归客。<br>　　古戍苍苍烽火寒，大荒沉沉飞雪白。<br>　　先拂商弦后角羽，四郊秋叶惊摵摵。<br>　　董夫子，通神明，深山窃听来妖精。<br>　　言迟更速皆应手，将往复旋如有情。<br>　　空山百鸟散还合，万里浮云阴且晴。<br>　　嘶酸雏雁失群夜，断绝胡儿恋母声。<br>　　川为静其波，鸟亦罢其鸣。<br>　　乌孙部落家乡远，逻娑沙尘哀怨生。<br>　　幽音变调忽飘洒，长风吹林雨堕瓦。<br>　　迸泉飒飒飞木末，野鹿呦呦走堂下。<br>　　长安城连东掖垣，凤凰池对青琐门。<br>　　高才脱略名与利，日夕望君抱琴至。<br>　　【翻译】<br>　　当年蔡琰曾作胡笳琴曲，弹奏此曲总共有十八节。胡人听了泪落沾湿边草，汉使对着归客肝肠欲绝。边城苍苍茫茫烽火无烟，草原阴阴沉沉白雪飘落。先弹轻快曲后奏低沉调，四周秋叶受惊瑟瑟凋零。董先生通神明琴技高妙，深林鬼神也都出来偷听。慢揉快拨十分得心应手，往复回旋仿佛声中寓情。声如山中百鸟散了又集，曲似万里浮云暗了又明。像失群的雏雁夜里嘶叫，象胡儿恋母痛绝的哭声。江河听曲而平息了波澜，百鸟闻声也停止了啼鸣。仿佛乌孙公主远怀故乡，宛如文成公主之怨吐蕃。幽咽琴声忽转轻松潇洒，象大风吹林如大雨落瓦。有如迸泉飒飒射向树梢，有如野鹿呦呦鸣叫堂下。长安城比邻给事中庭院，皇宫门正对中书省第宅。房琯才高不为名利约束， 昼夜盼望董大抱琴来奏。</p><p>《听安万善吹筚篥歌》作者为唐朝文学家李颀。古诗全文如下：<br>　　南山截竹为?篥，此乐本自龟兹出。<br>　　流传汉地曲转奇，凉州胡人为我吹。<br>　　傍邻闻者多叹息，远客思乡皆泪垂。<br>　　世人解听不解赏，长飚风中自来往。<br>　　枯桑老柏寒飕遛，九雏鸣凤乱啾啾。<br>　　龙吟虎啸一时发，万籁百泉相与秋。<br>　　忽然更作渔阳掺，黄云萧条白日暗。<br>　　变调如闻杨柳春，上林繁花照眼新。<br>　　岁夜高堂列明烛，美酒一杯声一曲。<br>　　【翻译】<br>　　从南山截段竹筒做成觱篥，这种乐器本来是出自龟兹。流传到汉地曲调变得新奇，凉州胡人安万善为我奏吹。座旁的听者个个感慨叹息，思乡的游客人人悲伤落泪。世人只晓听曲不懂得欣赏，乐人就像独行于暴风之中。又像风吹枯桑老柏沙沙响，还像九只雏凤鸣叫啾啾啼。好似龙吟虎啸同时都爆发，又如万籁齐响秋天百泉汇。忽然变作渔阳掺低沉悲壮，顿使白日转昏暗乌云翻飞。再变如同杨柳枝热闹欢快，仿佛看到上林苑繁花似锦。除夕夜高堂上明烛放光芒，喝杯美酒再欣赏一曲觱篥。</p><p>《夜归鹿门山歌》作者为唐朝文学家孟浩然。古诗全文如下：<br>　　山寺钟鸣昼已昏，渔梁渡头争渡喧。<br>　　人随沙岸向江村，余亦乘舟归鹿门。<br>　　鹿门月照开烟树，忽到庞公栖隐处。<br>　　岩扉松径长寂寥，惟有幽人自来去。<br>　　【翻译】<br>　　山寺钟声鸣响，天色已近黄昏，渔梁渡头，一片争渡的喧哗声。人们沿着沙岸，向着江村走去，我也乘着小船，摇橹回到鹿门。鹿门月光照亮轻烟缭绕的树木，我忽然来到了庞公隐居的住处。岩壁当门对着松林长径多寂寥，只有我这个幽人在此自来自去。</p><p>《庐山谣寄卢侍御虚舟》作者为唐朝文学家李白。古诗全文如下：<br>　　我本楚狂人，凤歌笑孔丘。<br>　　手持绿玉杖，朝别黄鹤楼。<br>　　五岳寻仙不辞远，一生好入名山游。<br>　　庐山秀出南斗傍，屏风九叠云锦张，<br>　　影落明湖青黛光，金阙前开二峰长，<br>　　银河倒挂三石梁，香炉瀑布遥相望，<br>　　回崖沓嶂凌苍苍。翠影红霞映朝日，<br>　　鸟飞不到吴天长。登高壮观天地间，<br>　　大江茫茫去不还。黄云万里动风色，<br>　　白波九道流雪山。好为庐山谣，兴因庐山发。<br>　　闲窥石镜清我心，谢公行处苍苔没。<br>　　早服还丹无世情，琴心三叠道初成。<br>　　遥见仙人彩云里，手把芙蓉朝玉京。<br>　　先期汗漫九垓上，愿接卢敖游太清。<br>　　【翻译】<br>　　我本是像那个接舆楚狂人，高声唱着凤歌去嘲笑孔丘。手里拿一根镶绿玉的棍杖，大清早辞别著名的黄鹤楼。攀登五岳寻仙道不畏路远，这一生就喜欢踏上名山游。秀美的庐山挺拔在南斗旁，九叠云屏像锦绣云霞铺张，湖光山影相互映照泛青光。金阙岩前双峰矗立入云端，三叠泉如银河倒挂三石梁。香炉峰瀑布与它遥遥相望，重崖叠嶂耸云霄莽莽苍苍。翠云红霞与朝阳相互辉映，鸟儿也飞不过吴天广又长。登高远望天地间壮观景象，大江悠悠东流去永不回还。天上万里黄云变动着风色，江流波涛九道如雪山奔淌。我喜欢为雄伟的庐山歌唱，这兴致因庐山风光而滋长。闲时观看石镜使心神清净，谢灵运足迹早被青苔掩藏。我要早服仙丹去掉尘世情，修炼三丹和积学道已初成。远远望见仙人正在彩云里，手里捧着芙蓉花朝拜玉京。早已约好神仙在九天会面，希望迎接你一同邀游太清。</p><p>《梦游天姥吟留别》作者为唐朝文学家李白。古诗全文如下：<br>　　海客谈瀛洲，烟涛微茫信难求。<br>　　越人语天姥，云霓明灭或可睹。<br>　　天姥连天向天横，势拔五岳掩赤城。<br>　　天台四万八千丈，对此欲倒东南倾。<br>　　我欲因之梦吴越，一夜飞度镜湖月。<br>　　湖月照我影，送我至剡溪。<br>　　谢公宿处今尚在，绿水荡漾清猿啼，<br>　　脚着谢公屐，身登青云梯。<br>　　半壁见海日，空中闻天鸡。<br>　　千岩万转路不定，迷花倚石忽已暝。<br>　　熊咆龙吟殷岩泉，深林兮惊层巅。<br>　　云青青兮欲雨，水澹澹兮生烟。<br>　　列缺霹雳，丘峦崩摧。<br>　　洞天石扇，訇然中开。<br>　　青冥浩荡不见底，日月照耀金银台。<br>　　霓为衣兮风为马，云之君兮纷纷而来下。<br>　　虎鼓瑟兮鸾回车，仙之人兮列如麻。<br>　　忽魂悸以魄动，恍惊起而长嗟。<br>　　惟觉时之枕席，失向来之烟霞。<br>　　世间行乐亦如此，古来万事东流水。<br>　　别君去兮何时还？且放白鹿青崖间，须行即骑访名山。<br>　　安能摧眉折腰事权贵，使我不得开心颜！<br>　　【翻译】<br>　　海外来的客人谈起瀛洲，（大海）烟波渺茫，（瀛洲）实在难以寻求。吴越一带的人谈起天姥山，在云雾忽明忽暗有时还能看见。天姥山仿佛连接着天遮断了天空。山势高峻超过五岳，遮掩过赤城山。天台山虽高一万（一万为正确版本，四万经考证为误传）八千丈，对着天姥山，（却矮小得）好像要向东南倾斜拜倒一样。<br>　　我根据越人说的话梦游到吴越，一天夜晚飞渡过明月映照下的镜湖。镜湖上的月光照着我的影子，一直伴随我到了剡溪。谢灵运住的地方如今还在，清澈的湖水荡漾，猿猴清啼。我脚上穿着谢公当年特制的木鞋，攀登直上云霄的山路。（上到）半山腰就看见了从海上升起的太阳，在半空中传来天鸡报晓的叫声。无数山岩重叠，道路盘旋弯曲，方向不定，迷恋着花，依倚着石头，不觉天色已经晚了。熊在怒吼，龙在长鸣，岩中的泉水在震响，使森林战栗，使山峰惊颤。云层黑沉沉的，像是要下雨，水波动荡生起了烟雾。电光闪闪，雷声轰鸣，山峰好像要被崩塌似的。仙府的石门，訇的一声从中间打开。洞中蔚蓝的天空广阔无际，看不到尽头，日月照耀着金银做的宫阙。用彩虹做衣裳，将风作为马来乘，云中的神仙们纷纷下来。老虎弹奏着琴瑟，鸾鸟驾着车。仙人们成群结队密密如麻。忽然（我）魂魄惊动，猛然惊醒，不禁长声叹息。醒来时只有身边的枕席，刚才梦中所见的烟雾云霞全都消失了。<br>　　人世间的欢乐也是像梦中的幻境这样，自古以来万事都像东流的水一样一去不复返。告别诸位朋友远去（东鲁）啊，什么时候才能回来？暂且把白鹿放牧在青崖间，等到要远行时就骑上它访名山。岂能卑躬屈膝，去侍奉权贵，使我不能舒心畅意，笑逐颜开。</p><p>《金陵酒肆留别》作者为唐朝文学家李白。古诗全文如下：<br>　　风吹柳花满店香，吴姬压酒唤客尝。<br>　　金陵子弟来相送，欲行不行各尽觞。<br>　　请君试问东流水，别意与之谁短长。<br>　　【翻译】<br>　　风吹柳絮满店都是香味，吴地的女子压好了酒请客人品尝。金陵的年轻朋友们都来为我送行，送与被送的人都频频举杯尽觞。请你们问问这东流的水，离情别意与它相比究竟谁短谁长。</p><p>《宣州谢朓楼饯别校书叔云》作者是唐代文学家李白。其全文古诗如下：<br>　　弃我去者，昨日之日不可留；<br>　　乱我心者，今日之日多烦忧。<br>　　长风万里送秋雁，对此可以酣高楼。<br>　　蓬莱文章建安骨，中间小谢又清发。<br>　　俱怀逸兴壮思飞，欲上青天揽明月。<br>　　抽刀断水水更流，举杯销愁愁更愁。<br>　　人生在世不称意，明朝散发弄扁舟。<br>　　【翻译】<br>　　弃我而去的昨天已不可挽留，扰乱我心绪的今天使我极为烦忧。万里长风吹送南归的鸿雁，面对此景，正可以登上高楼开怀畅饮。你的文章就像蓬莱宫中储藏的仙文一样高深渊博，同时还兼具建安文学的风骨。而我的诗风，也像谢朓那样清新秀丽、飘逸豪放。我们都满怀豪情逸兴，飞跃的神思像要腾空而上高高的青天，去摘取那皎洁的明月。然而每当想起人生的际遇，就忧从中来，好像抽出宝刀去砍流水一样，水不但没有被斩断，反而流得更猛了。我举起酒杯痛饮，本想借酒排遣烦忧，结果反倒愁上加愁。啊！人生在世竟然如此不称心如意，还不如明天就披散了头发，乘一只小舟在江湖之上自在地漂流。</p><p>《走马川行奉送封大夫出师西征》作者为唐朝文学家岑参。古诗全文如下：<br>　　君不见， 走马川行雪海边，平沙莽莽黄入天。<br>　　轮台九月风夜吼，一川碎石大如斗，随风满地石乱走。<br>　　匈奴草黄马正肥，金山西见烟尘飞，汉家大将西出师。<br>　　将军金甲夜不脱，半夜军行戈相拨，风头如刀面如割。<br>　　马毛带雪汗气蒸，五花连钱旋作冰，幕中草檄砚水凝。<br>　　虏骑闻之应胆慑，料知短兵不敢接，军师西门伫献捷。<br>　　【翻译】<br>　　您难道不曾看见吗？那辽阔的走马川紧靠着雪海边缘，茫茫无边的黄沙连接云天。轮台九月整夜里狂风怒号，走马川的碎石块块大如斗，狂风吹得斗大乱石满地走。这时匈奴牧草繁茂军马肥，侵入金山西面烟尘滚滚飞，汉家的大将率兵开始征西。将军身着铠甲夜里也不脱，半夜行军戈矛彼此相碰撞，凛冽寒风吹到脸上如刀割。马毛挂着雪花还汗气蒸腾，五花马的身上转眼结成冰，营幕中写檄文砚墨也冻凝。敌军听到大军出征应胆惊，料他不敢与我们短兵相接，我就在车师西门等待报捷。</p><p>《轮台歌奉送封大夫出师西征》作者为唐朝文学家岑参。古诗全文如下：<br>　　轮台城头夜吹角，轮台城北旄头落。<br>　　羽书昨夜过渠黎，单于已在金山西。<br>　　戍楼西望烟尘黑，汉兵屯在轮台北。<br>　　上将拥旄西出征，平明吹笛大军行。<br>　　四边伐鼓雪海涌，三军大呼阴山动。<br>　　虏塞兵气连云屯，战场白骨缠草根。<br>　　剑河风急云片阔，沙口石冻马蹄脱。<br>　　亚相勤王甘苦辛，誓将报主静边尘。<br>　　古来青史谁不见，今见功名胜古人。<br>　　【翻译】<br>　　轮台城头夜里吹起号角，轮台城北旄头星正降落。军书昨夜连夜送过渠黎，单于已在金山以西入侵。从哨楼向西望烟尘滚滚，汉军就屯扎在轮台北境。上将手持符节率兵西征，黎明笛声响起大军起程。战鼓四起犹如雪海浪涌，三军呐喊阴山发出共鸣。敌营阴沉杀气直冲云霄，战场上白骨还缠着草根。剑河寒风猛烈大雪鹅毛，沙口石头寒冷马蹄冻脱。亚相勤于王政甘冒辛苦，立誓报效国家平定边境。古来青垂史名屡见不鲜，如今将军功名胜过古人。</p><p>《白雪歌送武判官归京》作者是唐代文学家岑参。其古诗全文如下：<br>　　北风卷地白草折，胡天八月即飞雪。<br>　　忽如一夜春风来，千树万树梨花开。<br>　　散入珠帘湿罗幕，狐裘不暖锦衾薄。<br>　　将军角弓不得控，都护铁衣冷犹着。<br>　　瀚海阑干百丈冰，愁云黪淡万里凝。<br>　　中军置酒饮归客，胡琴琵琶与羌笛。<br>　　纷纷暮雪下辕门，风掣红旗冻不翻。<br>　　轮台东门送君去，去时雪满天山路。<br>　　山回路转不见君，雪上空留马行处。<br>　　【翻译】<br>　　北风呼啸着卷过大地，刮断了早已枯干的荒草；尽管是八月份，这里的天空已飘起了雪花。 一夜之间，所有树枝上挂满了雪，就像春天里千万朵绽放的梨花。 雪花透过珠帘，沾湿了罗幕，穿上狐裘衣服也不觉得暖和，丝绸锦缎做的被子都让人觉得有些单薄了。 将士们都冻拉不开弓弩，盔甲也很难穿在身上。 沙漠里都结了厚厚的冰层，将士们的脸上布满愁云，想着这寒冷的天气快点过去。 中军大厅里摆好了酒宴，欢送返京的客人，胡琴琵琶与羌笛奏出了美妙的乐曲。 傍晚在辕门外，纷纷大雪飘落，红旗被冰雪冻硬，强劲的北风也不能让它飘动。 在轮台东门外送您离去，离去的时候大雪铺满了天山的道路。 山岭迂回，道路曲折，看不见您的身影，雪地上只留下马蹄印。</p><p>《韦讽录事宅观曹将军画马图》作者为唐朝文学家杜甫。古诗全文如下：<br>　　国初已来画鞍马，神妙独数江都王。<br>　　将军得名三十载，人间又见真乘黄。<br>　　曾貌先帝照夜白，龙池十日飞霹雳。<br>　　内府殷红玛瑙盘，婕妤传诏才人索。<br>　　盘赐将军拜舞归，轻纨细绮相追飞。<br>　　贵戚权门得笔迹，始觉屏障生光辉。<br>　　昔日太宗拳毛騧，近时郭家狮子花。<br>　　今之新图有二马，复令识者久叹嗟。<br>　　此皆骑战一敌万，缟素漠漠开风沙。<br>　　其余七匹亦殊绝，迥若寒空动烟雪。<br>　　霜蹄蹴踏长揪间，马官厮养森成列。<br>　　可怜九马争神骏，顾视清高气深稳。<br>　　借问苦心爱者谁，后有韦讽前支遁。<br>　　忆昔巡幸新丰宫，翠华拂天来向东。<br>　　腾骧磊落三万匹，皆与此图筋骨同。<br>　　自从献宝朝河宗，无复射蛟江水中。<br>　　君不见金粟堆前松柏里，龙媒去尽鸟呼风。<br>　　【翻译】<br>　　开国以来善画鞍马的画家中，画技最精妙传神只数江都王。曹将军画马出名已有三十载，人间又见古代真正神马“乘黄”。他曾描绘玄宗先帝的“照夜白”，画得象池龙腾飞十日声如雷。皇宫内库珍藏的殷红玛瑙盘，婕妤传下御旨才人将它取来。将军接受赐盘叩拜皇恩回归，轻纨细绮相继赐来快速如飞。贵戚们谁得到曹将军亲笔迹，谁就觉得府第屏障增加光辉。当年唐太宗著名宝马“拳毛”，近代郭子仪家中好驹“狮子花”。而今新画之中就有这两匹马，使得识马的人久久感慨赞夸。其余七匹也都是特殊而奇绝，远远看去象寒空中飘动烟雪。霜蹄骏马蹴踏在长楸大道间，专职马倌和役卒肃立排成列。可爱的九匹马神姿争俊竞雄，昂首阔视显得高雅深沉稳重。请问有谁真心喜爱神姿骏马？后世韦讽前代支遁名传天下。想当年玄宗皇上巡幸新丰宫，车驾上羽旗拂天浩荡朝向东。腾飞跳跃精良好马有三万匹，匹匹与画图中马的筋骨雷同。譬如河宗献宝之后穆王归天，唐玄宗再也不能去射蛟江中。你没看见金粟堆前松柏林里，良马去尽徒见林鸟啼雨呼风。</p><p>《丹青引赠曹霸将军》作者为唐朝文学家杜甫。古诗全文如下：<br>　　将军魏武之子孙，于今为庶为清门。<br>　　英雄割据虽已矣，文彩风流今尚存。<br>　　学书初学卫夫人，但恨无过王右军。<br>　　丹青不知老将至，富贵于我如浮云。<br>　　开元之中常引见，承恩数上南薰殿。<br>　　凌烟功臣少颜色，将军下笔开生面。<br>　　良相头上进贤冠，猛将腰间大羽箭。<br>　　褒公鄂公毛发动，英姿飒爽犹酣战。<br>　　先帝玉马玉花骢，画工如山貌不同。<br>　　是日牵来赤墀下，迥立阊阖生长风。<br>　　诏谓将军拂绢素，意匠惨淡经营中。<br>　　斯须九重真龙出，一洗万古凡马空。<br>　　玉花却在御榻上，榻上庭前屹相向。<br>　　至尊含笑催赐金，圉人太仆皆惆怅。<br>　　弟子韩干早入室，亦能画马穷殊相。<br>　　干惟画肉不画骨，忍使骅骝气凋丧。<br>　　将军画善盖有神，偶逢佳士亦写真。<br>　　即今漂泊干戈际，屡貌寻常行路人。<br>　　途穷反遭俗眼白，世上未有如公贫。<br>　　但看古来盛名下，终日坎[土禀]缠其身。<br>　　【翻译】<br>　　曹将军是魏武帝曹操后代子孙，而今却沦为平民百姓成为寒门。英雄割据的时代一去不复返了，曹家文章丰采却在你身上留存。当年为学书法你先拜师卫夫人，只恨得没有超过王羲之右将军。你毕生专攻绘画不知老之将至，荣华富贵对于你却如空中浮云。<br>　　开元年间你常常被唐玄宗召见，承恩载德你曾多次登上南薰殿。凌烟阁的功臣画象年久褪颜色，曹将军你挥笔重画又别开生面。良相们的头顶都戴上了进贤冠，猛将们的腰间皆佩带着大羽箭。褒公鄂公的毛发似乎都在抖动，他们英姿飒爽好象是正在酣战。<br>　　开元时先帝的天马名叫玉花骢，多少画家画出的都与原貌不同。当天玉花骢被牵到殿中红阶下，昂首屹立宫门更增添它的威风。皇上命令你展开丝绢准备作画，你匠心独运惨淡经营刻苦用功。片刻间九天龙马就在绢上显现，一下比得万代凡马皆成了平庸。<br>　　玉花骢图如真马倒在皇帝榻上，榻上马图和阶前屹立真马相同。皇上含笑催促左右赏赐你黄金，太仆和马倌们个个都迷惘发怔。将军的门生韩干画技早学上手，他也能画马且有许多不凡形象。韩干只画外表画不出内在精神，常使骅骝好马的生气凋敝失丧。<br>　　将军的画精美美在画中有神韵，偶逢真名士才肯为他动笔写真。而今你漂泊沦落在战乱的社会，平常所画的却是普通的行路人。你到晚年反而遭受世俗的白眼，人世间还未有人象你这般赤贫。只要看看历来那些负盛名的人，有谁不终日坎坷穷愁纠缠其身。</p><p>《寄韩谏议》作者为唐朝文学家杜甫。古诗全文如下：<br>　　今我不乐思岳阳，身欲奋飞病在床。<br>　　美人娟娟隔秋水，濯足洞庭望八荒。<br>　　鸿飞冥冥日月白，青枫叶赤天雨霜。<br>　　玉京群帝集北斗，或骑麒麟翳凤凰。<br>　　芙蓉旌旗烟雾落，影动倒景摇潇湘。<br>　　星宫之君醉琼浆，羽人稀少不在旁。<br>　　似闻昨者赤松子，恐是汉代韩张良。<br>　　昔随刘氏定长安，帷幄未改神惨伤。<br>　　国家成败吾岂敢，色难腥腐餐枫香。<br>　　周南留滞古所惜，南极老人应寿昌。<br>　　美人胡为隔秋水，焉得置之贡玉堂。<br>　　【翻译】<br>　　我的心情恺郁思念着岳阳，想要鼓翼奋飞却辗转在病床。远隔秋水的伊人是多么美好，你在洞庭湖边洗脚，一面向四方遥望。鸿雁飞向邀远的高天，皓洁的日月放射光芒。秋风染红青枫的绿叶，秋空中降下寒霜。玉京的天帝们聚集在北斗星宫，有的乘驾麒麟，有的骑着凤凰。芙蓉装饰的旌旗招展，如烟雾漫天，旗影摇动那映着丽日的潇湘。星宫的帝君在那里畅饮美酒，可惜飞仙稀少，远在他方。听说你已经归隐，跟从仙人赤松子，像汉代的张良一样。你曾经安邦定国，建立功绩，运筹决策的政务使你烦倦，神情惨伤。你说你不能左右国家的命运，想去求仙访道，不愿留在污浊的尘世上。太史公怅恨滞留洛阳，你又为什么隐居潇湘？当天空出现老人星，世上就会太平、安康。你为什么同我远隔秋水不得相见？几时你才肯重新出山来辅佐朝堂。</p><p>《古柏行》作者为唐朝文学家杜甫。古诗全文如下：<br>　　孔明庙前有老柏，柯如青铜根如石。<br>　　霜皮溜雨四十围，黛色参天二千尺。<br>　　君臣已与时际会，树木犹为人爱惜。<br>　　云来气接巫峡长，月出寒通雪山白。<br>　　忆昨路绕锦亭东，先主武侯同閟宫。<br>　　崔嵬枝干郊原古，窈窕丹青户牖空。<br>　　落落盘踞虽得地，冥冥孤高多烈风。<br>　　扶持自是神明力，正直原因造化功。<br>　　大厦如倾要梁栋，万年回首丘山重。<br>　　不露文章世已惊，未辞剪伐谁能送。<br>　　苦心岂免容蝼蚁，香叶终经宿鸾凤。<br>　　志士幽人草怨嗟，古来材大难为用。<br>　　【翻译】<br>　　孔明庙前有一株古老的柏树，枝干色如青铜根柢固如盘石。树皮洁白润滑树干有四十围，青黑色朝天耸立足有二千尺。刘备孔明君臣遇合与时既往，至今树木犹在仍被人们爱惜。柏树高耸云雾飘来气接巫峡，月出寒光高照寒气直通岷山。想昔日小路环绕我的草堂东，先生庙与武侯祠在一个閟宫。柏树枝干崔嵬郊原增生古致，庙宇深邃漆绘连绵门窗宽空。古柏独立高耸虽然盘踞得地，但是位高孤傲必定多招烈风。它得到扶持自然是神明伟力，它正直伟岸原于造物者之功。大厦如若倾倒要有梁栋支撑，古柏重如丘山万年也难拉动。它不露花纹彩理使世人震惊，它不辞砍伐又有谁能够采送？它虽有苦心也难免蝼蚁侵蚀，树叶芳香曾经招来往宿鸾凤。天下志士幽人请你不要怨叹，自古以来大材一贯难得重用。</p><p>《石鱼湖上醉歌·并序》作者为唐朝文学家元结。古诗全文如下：<br>　　漫叟以公田米酿酒，因休暇则载酒于湖上，时取一醉。 欢醉中，据湖岸引臂向鱼取酒，使舫载之，遍饮坐者。 意疑倚巴丘酌于君山之上，诸子环洞庭而坐，酒舫泛 泛然触波涛而往来者，乃作歌以长之。<br>　　石渔湖，似洞庭，夏水欲满君山青。<br>　　山为樽，水为沼，酒徒历历坐洲岛。<br>　　长风连日作大浪，不能废人运酒舫。<br>　　我持长瓢坐巴丘，酌饮四座以散愁。</p><p>《山石》作者为唐朝文学家韩愈。古诗全文如下：<br>　　山石荦确行径微，黄昏到寺蝙蝠飞。<br>　　升堂坐阶新雨足，芭蕉叶大栀子肥。<br>　　僧言古壁佛画好，以火来照所见稀。<br>　　铺床拂席置羹饭，疏粝亦足饱我饥。<br>　　夜深静卧百虫绝，清月出岭光入扉。<br>　　天明独去无道路，出入高下穷烟霏。<br>　　山红涧碧纷烂漫，时见松枥皆十围。<br>　　当流赤足踏涧石，水声激激风吹衣。<br>　　人生如此自可乐，岂必局束为人靰。<br>　　嗟哉吾党二三子，安得至老不更归。<br>　　【翻译】<br>　　山石峥嵘险峭，山路狭窄像羊肠，蝙蝠穿飞的黄昏，来到这座庙堂。登上庙堂坐台阶，刚下透雨一场，经雨芭蕉枝粗叶大，山栀更肥壮。僧人告诉我说，古壁佛画真堂皇，用火把照看，迷迷糊糊看不清爽。为我铺好床席，又准备米饭菜汤，饭菜虽粗糙，却够填饱我的饥肠。夜深清静好睡觉，百虫停止吵嚷，明月爬上了山头，清辉泻入门窗。天明我独自离去，无法辨清路向，出入雾霭之中，我上下摸索踉跄。山花鲜红涧水碧绿，光泽又艳繁，时见松栎粗大十围，郁郁又苍苍。遇到涧流当道，光着脚板踏石淌，水声激激风飘飘，掀起我的衣裳。人生在世能如此，也应自得其乐，何必受到约束，宛若被套上马缰？唉呀，我那几个情投意合的伙伴，怎么能到年老，还不再返回故乡。</p><p>《八月十五夜赠张功曹》作者为唐朝文学家韩愈。古诗全文如下：<br>　　纤云四卷天无河，清风吹空月舒波。<br>　　沙平水息声影绝，一杯相属君当歌。<br>　　君歌声酸辞且苦，不能听终泪如雨。<br>　　洞庭连天九疑高，蛟龙出没猩鼯号。<br>　　十生九死到官所，幽居默默如藏逃。<br>　　下床畏蛇食畏药，海气湿蛰熏腥臊。<br>　　昨者州前捶大鼓，嗣皇继圣登夔皋。<br>　　赦书一日行万里，罪从大辟皆除死。<br>　　迁者追回流者还，涤瑕荡垢清朝班。<br>　　州家申名使家抑，坎轲只得移荆蛮。<br>　　判司卑官不堪说，未免捶楚尘埃间。<br>　　同时辈流多上道，天路幽险难追攀。<br>　　君歌且休听我歌，我歌今与君殊科：<br>　　一年明月今宵多，人生由命非由他，<br>　　有酒不饮奈明何？<br>　　【翻译】<br>　　薄云四处飘散还不见银河，清风吹开云雾月光放清波。沙滩里水平波息声影消失，斟杯美酒相劝请你唱支歌。你的歌声酸楚歌辞也悲苦，没有听完热泪就纷纷下落。洞庭湖水连天九疑山高峻，湖中的蛟龙出没猩鼯哀号。九死一生到达这被贬官所，默默地幽居远地好像潜逃。下床怕蛇咬吃饭又怕毒药，潮气与毒气相杂到处腥臊。昨日州衙前忽然擂动大鼓，新皇继位要举用夔和皋陶。大赦文书一日万里传四方，犯有死罪的一概免除死刑。被贬谪的召回放逐的回朝，革除弊政要剪除朝中奸佞。刺史提名赦免观察使扣压，命运坎坷只能够迁调荒漠。判司原本是小官不堪一提，未免跪地挨打有苦向谁说。一起被贬谪的大都已回京，进身朝廷之路比登天难攀。你的歌声暂且停止听我唱，我的歌声和你绝不是同科。一年的明月今夜月色最好，人生由命又何必归怨其他，有酒不饮怎对得天上明月。</p><p>《谒衡岳庙遂宿岳寺题门楼》作者为唐朝文学家韩愈。古诗全文如下：<br>　　五岳祭秩皆三公，四方环镇嵩当中。<br>　　火维地荒足妖怪，天假神柄专其雄。<br>　　喷云泄雾藏半腹，虽有绝顶谁能穷。<br>　　我来正逢秋雨节，阴气晦味无清风。<br>　　潜心默祷若有应，岂非正直能感通。<br>　　须臾静扫众峰出，仰见突兀撑青空。<br>　　紫盖连延接天柱，石廪腾掷堆祝融。<br>　　森然魄动下马拜，松柏一径趋灵宫。<br>　　粉墙丹柱动光彩，鬼物图画填青红。<br>　　升阶伛偻荐脯酒，欲以菲薄明其衷。<br>　　庙内老人识神意，睢盱侦伺能鞠躬。<br>　　手持杯蛟导我掷，云此最吉余难同。<br>　　窜逐蛮荒幸不死，衣食才足甘长终。<br>　　侯王将相望久绝，神纵欲福难为功。<br>　　夜投佛寺上高阁，星月掩映云曈昽。<br>　　猿鸣钟动不知曙，杲杲寒日生于东。<br>　　【翻译】<br>　　祭五岳典礼如同祭祀三公，五岳中四山环绕嵩山居中。衡山地处荒远多妖魔鬼怪，上天授权南岳神赫赫称雄。半山腰喷泄云雾迷迷茫茫，虽然有绝顶谁能登上顶峰。我来这里正逢秋雨绵绵时，天气阴暗没有半点儿清风。心里默默祈祷仿佛有应验，岂非为人正直能感应灵通？片刻云雾扫去显出众峰峦，抬头仰望山峰突兀插云空。紫盖峰绵延连接着天柱峰，石廪山起伏不平连着祝融。严森险峻惊心动魄下马拜，沿着松柏小径直奔神灵宫。粉色墙映衬红柱光彩夺目，壁柱上鬼怪图画或青或红。登上台阶弯腰奉献上酒肉，想借菲薄祭品表示心虔衷。主管神庙老人能领会神意，凝视窥察连连地为我鞠躬。手持杯蛟教导我掷占方法，说此卜兆最吉他人难相同。我被放逐蛮荒能侥幸不死，衣食足甘愿在此至死而终。做侯王将相的欲望早断绝，神纵使赐福于我也难成功。此夜投宿佛寺住在高阁上，星月交辉掩映山间雾朦胧。猿猴啼时钟响不觉到天亮，东方一轮寒日冉冉升高空。</p><p>《石鼓歌》作者为唐朝文学家韩愈。古诗全文如下：<br>　　张生手持石鼓文，劝我试作石鼓歌。<br>　　少陵无人谪仙死，才薄将奈石鼓何。<br>　　周纲凌迟四海沸，宣王愤起挥天戈。<br>　　大开明堂受朝贺，诸侯剑佩鸣相磨。<br>　　搜于岐阳骋雄俊，万里禽兽皆遮罗。<br>　　镌功勒成告万世，凿石作鼓隳嵯峨。<br>　　从臣才艺咸第一，拣选撰刻留山阿。<br>　　雨淋日炙野火燎，鬼物守护烦撝呵。<br>　　公从何处得纸本，毫发尽备无差讹。<br>　　辞严义密读难晓，字体不类隶与蝌。<br>　　年深岂免有缺画，快剑砍断生蛟鼍。<br>　　鸾翔凤翥众仙下，珊瑚碧树交枝柯。<br>　　金绳铁索锁钮壮，古鼎跃水龙腾梭。<br>　　陋儒编诗不收入，二雅褊迫无委蛇。<br>　　孔子西行不到秦，掎摭星宿遗羲娥。<br>　　嗟余好古生苦晚，对此涕泪双滂沱。<br>　　忆昔初蒙博士征，其年始改称元和。<br>　　古人从军在右辅，为我度量掘臼科。<br>　　濯冠沐浴告祭酒，如此至宝存岂多。<br>　　毡包席裹可立致，十鼓只载数骆驼。<br>　　荐诸太庙比郜鼎，光价岂止百倍过。<br>　　圣恩若许留太学，诸生讲解得切磋。<br>　　观经鸿都尚填咽，坐见举国来奔波。<br>　　剜苔剔藓露节角，安置妥帖平不颇。<br>　　大厦深檐与覆盖，经历久远期无陀。<br>　　中朝大官老于事，讵肯感激徒媕婀。<br>　　牧童敲火牛砺角，谁复着手为摩挲。<br>　　日销月铄就埋没，六年西顾空吟哦。<br>　　羲之俗书趁姿媚，数纸尚可博白鹅。<br>　　继周八代争战罢，无人收拾理则那。<br>　　方今太平日无事，柄任儒术崇丘轲。<br>　　安能以此上论列，愿借辩口如悬河。<br>　　石鼓之歌止于此，呜呼吾意其蹉跎。<br>　　【翻译】<br>　　张生手拿周朝石鼓文的拓本，劝我写一首咏赞它的石鼓歌。杜甫李白才华盖世但都作古，薄才之人面对石鼓无可奈何。周朝政治衰败全国动荡不安，周宣王发愤起兵挥起了天戈。庆功之时大开明堂接受朝贺，诸侯接踵而至剑佩叮当撞磨。宣王田猎驰骋岐阳多么英俊，四方禽兽无处躲藏都被网罗。为把英雄功业刻石扬名万世，凿山石雕石鼓毁坏高山嵯峨。随从之臣才艺都是世上第一，挑选优秀撰写刻石放在山坡。任凭长年雨打日晒野火焚烧，仗着鬼神守护石鼓永不湮没。你从哪里得来这拓本的底稿？丝毫都很完备一点也无差错。言辞严谨内容奥密难于理解，字体不像隶书蝌文自成一格。年代久远难免受损笔画残缺，仍像得剑斩断活生生的蛟鼍。字迹有如鸾凤翔飞众仙飘逸，笔画恰似珊瑚碧树枝柯交错。苍劲钩连像金绳铁索穿锁钮，浑然又像织梭化龙九鼎沦没。浅见儒士编纂诗经却不收入，大雅小雅内容狭窄并不壮阔。孙子周游未到秦地无知难怪，采诗不全像取星宿却漏羲娥。啊我虽好古却苦于生得太晚，对着石鼓文我哭得涕泪滂沱。想当年我蒙召做国子监博士，那年正改纪元年号称着元和。我的朋友在凤翔府任职从事，曾经为我设计挖掘石鼓坑窝。我刷帽沐浴禀告国子监祭酒：“如此至宝文物世上能存几多？只要包毡裹席就能立即运到，十个石鼓运载只需几匹骆驼。进献太庙把它比作文物郜鼎，那声价百倍于郜鼎岂是太过？皇恩浩荡如果准许留在太学，诸生就能钻研解说一起切蹉。汉朝时鸿都门观经尚且拥塞，将会看见全国上下为此奔波。剜剔藓苔泥尘露出文字棱角，把它放得平平稳稳不偏不颇。高楼大厦深檐厚瓦把它覆盖，经历久远不受意外损坏伤挫。朝中的大官个个都老于世故，他们空无主见岂肯感奋奔波？牧童在鼓上敲火牛用它磨角，谁能再用手把这个宝物抚摸？长年累月风化销铄将被埋没。六年来向西遥望我空叹吟哦！王羲之书法时俗趁机显秀媚，书写数张还可换回一群白鹅。继周之后八代争战已经结束，至今无人收拾整理又可奈何？如今正是天下太平国泰民安，皇上重视儒术推崇孔丘孟轲。怎么才能把此事向皇帝建议，愿借善辩之人发挥口若悬河。石鼓歌写到这里就算结束吧，哎呀我的意愿大概是白说说。</p><p>《渔翁》作者为唐朝文学家柳宗元。其全文古诗如下：<br>　　渔翁夜傍西岩宿，晓汲清湘燃楚竹。<br>　　烟销日出不见人，欸乃一声山水绿。<br>　　回看天际下中流，岩上无心云相逐。<br>　　【翻译】<br>　　渔翁夜晚靠着西山岩石歇息，天亮后他汲取湘水燃起楚竹。日出烟消忽然不见他的人影，只听得摇橹歌声从绿水飞出。回看渔舟已在天边顺流直下，山上白云漫无目的飘游追逐。</p>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>脚手架SDK</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-04-17-【工程化】vue3-vite4-ts代码生成器</title>
    <link href="/2025/11/28/2022-04-17-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91vue3-vite4-ts%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E5%99%A8/"/>
    <url>/2025/11/28/2022-04-17-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91vue3-vite4-ts%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="属于你的生成器"><a href="#属于你的生成器" class="headerlink" title="属于你的生成器"></a>属于你的生成器</h2><p>假设你现在想开发一个叫 cook 的代码生成器工具，你只需按照以下步骤即可快速完成开发</p><h3 id="第一步：创建代码生成器项目"><a href="#第一步：创建代码生成器项目" class="headerlink" title="第一步：创建代码生成器项目"></a>第一步：创建代码生成器项目</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-variable">$ </span>npm init <span class="hljs-variable">@ncgen</span>/app <span class="hljs-comment"># yarn create <span class="hljs-doctag">@ncgen</span>/app</span><br></code></pre></td></tr></table></figure><h3 id="第二步：按照你代码生成器的逻辑修改-ncgen-config-js"><a href="#第二步：按照你代码生成器的逻辑修改-ncgen-config-js" class="headerlink" title="第二步：按照你代码生成器的逻辑修改 ncgen-config.js"></a>第二步：按照你代码生成器的逻辑修改 ncgen-config.js</h3><p>子命令可不创建，但需去除index.js中 ncgenConfig.sub 相关代码，否则发包会报错。</p><p>创建子命令可用以下命令完成，以省去你复制粘贴的操作</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs smali">cd cook<br>$ npm init @ncgen/app<span class="hljs-built_in"> add-sub </span><span class="hljs-comment"># yarn create @ncgen/app add-sub</span><br></code></pre></td></tr></table></figure><h3 id="第三步：发布你的代码生成器"><a href="#第三步：发布你的代码生成器" class="headerlink" title="第三步：发布你的代码生成器"></a>第三步：发布你的代码生成器</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$</span> <span class="hljs-built_in">cd</span> cook<br><span class="hljs-variable">$</span> npm run release<br></code></pre></td></tr></table></figure><ul><li>注：npm run release前需登录npm，通过npm adduser添加用户。想将包发布至npm，源需修改如下：</li></ul><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">npm config set https:<span class="hljs-comment">//registry.npmjs.org/</span><br></code></pre></td></tr></table></figure><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><p><a href="https://daniel-dx.github.io/ncgen/zh/guide.html">ncgen官网</a></p>]]></content>
    
    
    <categories>
      
      <category>规范</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ncgen</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-04-17-【工程化】vue2-js项目eslint配置参考</title>
    <link href="/2025/11/28/2022-04-17-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91vue2-js%E9%A1%B9%E7%9B%AEeslint%E9%85%8D%E7%BD%AE%E5%8F%82%E8%80%83/"/>
    <url>/2025/11/28/2022-04-17-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91vue2-js%E9%A1%B9%E7%9B%AEeslint%E9%85%8D%E7%BD%AE%E5%8F%82%E8%80%83/</url>
    
    <content type="html"><![CDATA[<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">root</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-attr">env</span>: &#123;<br>    <span class="hljs-attr">node</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">browser</span>: <span class="hljs-literal">true</span>,<br>  &#125;,<br>  <span class="hljs-attr">extends</span>: [<span class="hljs-string">&#x27;plugin:vue/essential&#x27;</span>, <span class="hljs-string">&#x27;airbnb-base&#x27;</span>, <span class="hljs-string">&#x27;plugin:prettier/recommended&#x27;</span>],<br>  <span class="hljs-attr">parserOptions</span>: &#123;<br>    <span class="hljs-attr">parser</span>: <span class="hljs-string">&#x27;babel-eslint&#x27;</span>,<br>    <span class="hljs-attr">ecmaFeatures</span>: &#123;<br>      <span class="hljs-attr">jsx</span>: <span class="hljs-literal">true</span>,<br>    &#125;,<br>  &#125;,<br>  <span class="hljs-attr">plugins</span>: [<span class="hljs-string">&#x27;import&#x27;</span>],<br>  <span class="hljs-attr">settings</span>: &#123;<br>    <span class="hljs-comment">// 别名</span><br>    <span class="hljs-string">&#x27;import/resolver&#x27;</span>: &#123;<br>      <span class="hljs-attr">alias</span>: &#123;<br>        <span class="hljs-attr">map</span>: [[<span class="hljs-string">&#x27;@&#x27;</span>, <span class="hljs-string">&#x27;./src/&#x27;</span>]],<br>        <span class="hljs-attr">extensions</span>: [<span class="hljs-string">&#x27;.js&#x27;</span>, <span class="hljs-string">&#x27;.vue&#x27;</span>],<br>      &#125;,<br>    &#125;,<br>  &#125;,<br>  <span class="hljs-attr">rules</span>: &#123;<br>    <span class="hljs-string">&#x27;func-names&#x27;</span>: <span class="hljs-number">0</span>,<br>    <span class="hljs-string">&#x27;import/extensions&#x27;</span>: <span class="hljs-number">0</span>,<br>    <span class="hljs-string">&#x27;no-unused-expressions&#x27;</span>: <span class="hljs-number">0</span>,<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 导入语句前不允许有任何非导入语句</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-string">&#x27;import/first&#x27;</span>: <span class="hljs-string">&#x27;error&#x27;</span>,<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 禁止重复导入模块</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-string">&#x27;import/no-duplicates&#x27;</span>: <span class="hljs-string">&#x27;error&#x27;</span>,<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 禁止使用 let 导出</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-string">&#x27;import/no-mutable-exports&#x27;</span>: <span class="hljs-string">&#x27;warn&#x27;</span>,<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 禁用导入的模块时使用 webpack 特有的语法（感叹号）</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-string">&#x27;import/no-webpack-loader-syntax&#x27;</span>: <span class="hljs-string">&#x27;warn&#x27;</span>,<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 当只有一个导出时，必须使用 export default 来导出</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-string">&#x27;import/prefer-default-export&#x27;</span>: <span class="hljs-string">&#x27;off&#x27;</span>,<br>    <span class="hljs-string">&#x27;import/no-extraneous-dependencies&#x27;</span>: [<br>      <span class="hljs-string">&#x27;error&#x27;</span>,<br>      &#123;<br>        <span class="hljs-attr">devDependencies</span>: <span class="hljs-literal">true</span>,<br>      &#125;,<br>    ],<br>    <span class="hljs-string">&#x27;no-plusplus&#x27;</span>: [<br>      <span class="hljs-string">&#x27;error&#x27;</span>,<br>      &#123;<br>        <span class="hljs-attr">allowForLoopAfterthoughts</span>: <span class="hljs-literal">true</span>,<br>      &#125;,<br>    ],<br>    <span class="hljs-string">&#x27;import/no-dynamic-require&#x27;</span>: <span class="hljs-number">0</span>,<br>    <span class="hljs-string">&#x27;global-require&#x27;</span>: <span class="hljs-number">0</span>,<br>    <span class="hljs-string">&#x27;no-console&#x27;</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&#x27;production&#x27;</span> ? <span class="hljs-string">&#x27;warn&#x27;</span> : <span class="hljs-string">&#x27;off&#x27;</span>,<br>    <span class="hljs-string">&#x27;no-debugger&#x27;</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&#x27;production&#x27;</span> ? <span class="hljs-string">&#x27;warn&#x27;</span> : <span class="hljs-string">&#x27;off&#x27;</span>,<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>规范</category>
      
    </categories>
    
    
    <tags>
      
      <tag>eslint</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-04-17-【工程化】vue3-vite4-ts配置TS</title>
    <link href="/2025/11/28/2022-04-17-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91vue3-vite4-ts%E9%85%8D%E7%BD%AETS/"/>
    <url>/2025/11/28/2022-04-17-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91vue3-vite4-ts%E9%85%8D%E7%BD%AETS/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    <categories>
      
      <category>规范</category>
      
    </categories>
    
    
    <tags>
      
      <tag>TypeScript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-04-17-【工程化】vue3-vite4-ts配置commitlint</title>
    <link href="/2025/11/28/2022-04-17-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91vue3-vite4-ts%E9%85%8D%E7%BD%AEcommitlint/"/>
    <url>/2025/11/28/2022-04-17-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91vue3-vite4-ts%E9%85%8D%E7%BD%AEcommitlint/</url>
    
    <content type="html"><![CDATA[<blockquote></blockquote><h2 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h2><ul><li>规范——遵从 AngularJS’s commit message convention</li><li>简单——通过命令行可视化步骤提示填写对应描述，防止遗漏</li><li>扩展——支持团队自定义提交模板（cz-customizable）</li><li>分析——支持生成 commit 日志（standard-version），利于版本迭代</li></ul><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><ol><li>项目级别安装（可保证团队成员版本一致）</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">npm install --save-dev commitizen<br></code></pre></td></tr></table></figure><ol start="2"><li>初始化 Commitizen 配套的适配器，如果你的 npm 版本在 5.2 以上，那么你可以使用 npx 来初始化.</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">npx commitizen init cz-conventional-changelog --save-dev --save-exact<br></code></pre></td></tr></table></figure><p>该初始化命令主要完成以下 3 步：</p><ol><li>安装 cz-conventional-changelog 包（提供日志标准）</li><li>将 cz-conventional-changelog 加入 package.json 的 devDependencies 依赖中</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-string">&quot;devDependencies&quot;</span>: &#123;<br>  <span class="hljs-string">&quot;cz-conventional-changelog&quot;</span>: <span class="hljs-string">&quot;^3.3.0&quot;</span><br><span class="hljs-string">&quot;cz-customizable&quot;</span>: <span class="hljs-string">&quot;^6.3.0&quot;</span>,<br>&#125;,<br></code></pre></td></tr></table></figure><ol start="3"><li>在 package.json 根路径新增 npm 执行命令 config.commit 及 config.commitizen 配置项</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-string">&quot;scripts&quot;</span>: &#123;<br><span class="hljs-string">&quot;commit&quot;</span>: <span class="hljs-string">&quot;cz&quot;</span><br>&#125;,<br><span class="hljs-string">&quot;config&quot;</span>: &#123;<br><span class="hljs-string">&quot;commitizen&quot;</span>: &#123;<br><span class="hljs-string">&quot;path&quot;</span>: <span class="hljs-string">&quot;./node_modules/cz-conventional-changelog&quot;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="husky"><a href="#husky" class="headerlink" title="husky"></a>husky</h2><ol><li>初始化 husky 配置</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript">cd $&#123;项目根目录&#125;<br>npx husky install<br></code></pre></td></tr></table></figure><ol start="2"><li>添加 pre-commit 以及 commit-msg hook</li></ol><blockquote><p>commitlint 规范具体请查看 git 规范-提交与合并</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript">npx husky add .<span class="hljs-property">husky</span>/pre-commit <span class="hljs-string">&quot;npm run lint &amp;&amp; npm run styleLint &amp;&amp; git add .&quot;</span><br>npx husky add .<span class="hljs-property">husky</span>/commit-msg <span class="hljs-string">&quot;npx --no-install commitlint --edit \$1&quot;</span><br><span class="hljs-comment">// yarn commitlint --config .commitlintrc.js --edit $1</span><br></code></pre></td></tr></table></figure><ol start="3"><li>添加 package scripts</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"># 往 package.<span class="hljs-property">json</span> scripts 字段中添加下面的内容<br><span class="hljs-string">&quot;lint&quot;</span>: <span class="hljs-string">&quot;eslint --ext .vue,.js,.ts,.tsx ./ --max-warnings 0 --fix&quot;</span>,<br><span class="hljs-string">&quot;styleLint&quot;</span>: <span class="hljs-string">&quot;stylelint **/*.&#123;css,scss,sass,less,vue&#125; --fix&quot;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>规范</category>
      
    </categories>
    
    
    <tags>
      
      <tag>commitizen</tag>
      
      <tag>git</tag>
      
      <tag>husky</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-04-17-【工程化】vue3-vite4-ts配置husky、pre-commit、commitizen、linet-staged</title>
    <link href="/2025/11/28/2022-04-17-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91vue3-vite4-ts%E9%85%8D%E7%BD%AEhusky%E3%80%81pre-commit/"/>
    <url>/2025/11/28/2022-04-17-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91vue3-vite4-ts%E9%85%8D%E7%BD%AEhusky%E3%80%81pre-commit/</url>
    
    <content type="html"><![CDATA[<h2 id="！！！快捷方式-初始化"><a href="#！！！快捷方式-初始化" class="headerlink" title="！！！快捷方式 初始化"></a>！！！快捷方式 初始化</h2><ul><li>以下指令郎阔之后所有操作，墙裂推荐</li></ul><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-comment">// 同时安装husky 和 lint-staged 并初始化配置</span><br>npx mrm lint<span class="hljs-punctuation">-</span>staged<br></code></pre></td></tr></table></figure><h1 id="什么是-Husky？"><a href="#什么是-Husky？" class="headerlink" title="什么是 Husky？"></a>什么是 Husky？</h1><p>Husky是一个工具，它允许我们轻松地处理Git Hooks 并在提交代码时运行我们想要的脚本。</p><h2 id="第1步：将-Husky-安装到一个项目上"><a href="#第1步：将-Husky-安装到一个项目上" class="headerlink" title="第1步：将 Husky 安装到一个项目上"></a>第1步：将 Husky 安装到一个项目上</h2><p>要安装Husky，我们可以使用 yarn 或 npm。</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cmake">或<br>npm <span class="hljs-keyword">install</span> husky<br></code></pre></td></tr></table></figure><ul><li>注：&#x2F;&#x2F; prettier-ignore 注释会忽略下一行代码的格式化</li></ul><h2 id="第2步：配置Husky以运行Git钩子"><a href="#第2步：配置Husky以运行Git钩子" class="headerlink" title="第2步：配置Husky以运行Git钩子"></a>第2步：配置Husky以运行Git钩子</h2><p>为git仓库添加一个pre-commit钩子</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">npx husky <span class="hljs-keyword">add</span><span class="language-bash"> .husky/pre-commit <span class="hljs-string">&quot;npx --no-install lint-staged&quot;</span></span><br></code></pre></td></tr></table></figure><p>或者执行</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">npx husky <span class="hljs-keyword">add</span><span class="language-bash"> .husky/pre-commit <span class="hljs-string">&quot;yarn lint &amp;&amp; yarn format &amp;&amp; yarn lint:style&quot;</span></span><br></code></pre></td></tr></table></figure><h2 id=""><a href="#" class="headerlink" title=""></a></h2><p>现在当我们执行git commit的时候就会执行pnpm lint与pnpm format，当这两条命令出现报错，就不会提交成功。以此来保证提交代码的质量和格式。</p><h1 id="lint-staged"><a href="#lint-staged" class="headerlink" title="lint-staged"></a>lint-staged</h1><p>lint-staged的作用，只对更改过的文件运行格式化。</p><h2 id="1-安装依赖"><a href="#1-安装依赖" class="headerlink" title="1. 安装依赖"></a>1. 安装依赖</h2><p><code>yarn add lint-staged -D</code></p><h2 id="2-添加prepare脚本"><a href="#2-添加prepare脚本" class="headerlink" title="2. 添加prepare脚本"></a>2. 添加prepare脚本</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;script&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;prepare&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;husky install&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>prepare脚本会在 yarn install 之后自动运行，这样依赖你的小伙伴clone了你的项目之后会自动安装husky,这里由于我们已经运行过 yarn install 了，所以我们需要手动运行一次yarn run prepare,然后我们就会得到一个目录.husky。</p><h3 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h3><ol><li><a href="https://juejin.cn/post/7118294114734440455">https://juejin.cn/post/7118294114734440455</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>规范</category>
      
    </categories>
    
    
    <tags>
      
      <tag>git</tag>
      
      <tag>Husky</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-04-17-【工程化】vue3-vite4-ts配置husky、pre-commit、commitizen、linet-staged</title>
    <link href="/2025/11/28/2022-04-17-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91vue3-vite4-ts%E9%85%8D%E7%BD%AEmock/"/>
    <url>/2025/11/28/2022-04-17-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91vue3-vite4-ts%E9%85%8D%E7%BD%AEmock/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    <categories>
      
      <category>规范</category>
      
    </categories>
    
    
    <tags>
      
      <tag>git</tag>
      
      <tag>Husky</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-04-17-【工程化】包管理工具npm、cnpm、yarn、pnpm</title>
    <link href="/2025/11/28/2022-04-17-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91%E5%8C%85%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7npm%E3%80%81cnpm%E3%80%81yarn%E3%80%81pnpm/"/>
    <url>/2025/11/28/2022-04-17-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91%E5%8C%85%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7npm%E3%80%81cnpm%E3%80%81yarn%E3%80%81pnpm/</url>
    
    <content type="html"><![CDATA[<h1 id="npm"><a href="#npm" class="headerlink" title="npm"></a>npm</h1><h1 id="cnpm"><a href="#cnpm" class="headerlink" title="cnpm"></a>cnpm</h1><h1 id="yarn"><a href="#yarn" class="headerlink" title="yarn"></a>yarn</h1><p>常用指令</p><h1 id="pnpm"><a href="#pnpm" class="headerlink" title="pnpm"></a>pnpm</h1><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">npm <span class="hljs-keyword">install</span> pnpm -g<br></code></pre></td></tr></table></figure><h1 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h1>]]></content>
    
    
    <categories>
      
      <category>规范</category>
      
    </categories>
    
    
    <tags>
      
      <tag>TypeScript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-04-16-【工程化】vue3-vite4-ts配置eslint、stylelint、prettier</title>
    <link href="/2025/11/28/2022-04-17-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91vue3-vite4-ts%E9%85%8D%E7%BD%AEeslint%E3%80%81stylelint%E3%80%81prettier/"/>
    <url>/2025/11/28/2022-04-17-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91vue3-vite4-ts%E9%85%8D%E7%BD%AEeslint%E3%80%81stylelint%E3%80%81prettier/</url>
    
    <content type="html"><![CDATA[<h1 id="一、初始化eslint"><a href="#一、初始化eslint" class="headerlink" title="一、初始化eslint"></a>一、初始化eslint</h1><ol><li>安装eslint依赖，工程内安装或全局安装</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js">yarn -D add eslint <span class="hljs-comment">// 本地安装</span><br>yarn -G add eslint <span class="hljs-comment">// 全局安装</span><br></code></pre></td></tr></table></figure><ol start="2"><li>初始化eslint规则</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">npx eslint --init<br></code></pre></td></tr></table></figure><ul><li>按照提示依次选择</li></ul><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs smali">How would you like to use ESLint? (Use arrow keys)<br>  To<span class="hljs-built_in"> check </span>syntax only //只检查语法<br>&gt; To<span class="hljs-built_in"> check </span>syntax<span class="hljs-built_in"> and </span>find problems//检查语法、发现问题<br>  To<span class="hljs-built_in"> check </span>syntax, find problems,<span class="hljs-built_in"> and </span>enforce code style//检查语法、发现问题并执行代码样式<br></code></pre></td></tr></table></figure><ul><li><p>选择完毕后，将安装相关依赖，并生成 <code>.eslintrc.js</code> 或 json格式的配置文件</p></li><li><p>手动安装，依赖扩展 devDependencies</p></li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;eslint-plugin-import&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^2.24.2&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;eslint-plugin-prettier&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^4.0.0&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;eslint-import-resolver-alias&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^1.1.2&quot;</span><span class="hljs-punctuation">,</span><br></code></pre></td></tr></table></figure><ol><li>配置lint 命令</li></ol><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;scripts&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-comment">// lint当前项目中的文件并且开启自动修复</span><br>        <span class="hljs-attr">&quot;lint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;eslint . --ext .vue,.js,.ts,.jsx,.tsx --fix&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><ol><li>添加 .eslintignore 忽略配置</li></ol><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs stylus">public<br>dist<br>*<span class="hljs-selector-class">.d</span><span class="hljs-selector-class">.ts</span><br>/<span class="hljs-attribute">src</span>/assets<br>package<span class="hljs-selector-class">.json</span><br><span class="hljs-selector-class">.eslintrc</span><span class="hljs-selector-class">.js</span><br><span class="hljs-selector-class">.prettierrc</span><span class="hljs-selector-class">.js</span><br>commitlint<span class="hljs-selector-class">.config</span><span class="hljs-selector-class">.js</span><br>stylelint<span class="hljs-selector-class">.config</span>.js<br></code></pre></td></tr></table></figure><ol start="5"><li>执行 yarn lint<br>会提示非常多的下列错误，原因是.vue 文件解析出错。默认eslint不会解析vue文件，所以我们需要一个额外的解析器来帮我们解析vue文件。</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-number">2</span>:<span class="hljs-number">6</span>  <span class="hljs-type">error</span>  Parsing <span class="hljs-type">error</span>: <span class="hljs-string">&#x27;&gt;&#x27;</span> expected<br></code></pre></td></tr></table></figure><ol><li>修改eslint.js</li></ol><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;extends&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-string">&quot;plugin:@typescript-eslint/recommended&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;eslint-config-airbnb-base&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;plugin:vue/vue3-recommended&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;plugin:prettier/recommended&quot;</span><br>  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;env&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;browser&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;node&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;jest&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;es6&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;plugins&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-string">&quot;vue&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;@typescript-eslint&quot;</span><br>  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;globals&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;cy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;readonly&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;clipboardData&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;readonly&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;PKG_VERSION&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;defineProps&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;readonly&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;defineEmits&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;readonly&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;parserOptions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;parser&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;@typescript-eslint/parser&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;sourceType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;module&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;allowImportExportEverywhere&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;ecmaFeatures&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;jsx&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;import/extensions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>      <span class="hljs-string">&quot;.js&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-string">&quot;.jsx&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-string">&quot;.ts&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-string">&quot;.tsx&quot;</span><br>    <span class="hljs-punctuation">]</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;rules&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;no-console&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>      <span class="hljs-string">&quot;error&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;allow&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;info&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;warn&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;error&quot;</span><span class="hljs-punctuation">]</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-comment">// code style config</span><br>    <span class="hljs-attr">&quot;no-continue&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;off&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;no-restricted-syntax&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;off&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;no-plusplus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;off&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;no-param-reassign&quot;</span><span class="hljs-punctuation">:</span>  <span class="hljs-string">&quot;off&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;no-shadow&quot;</span><span class="hljs-punctuation">:</span>  <span class="hljs-string">&quot;off&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;no-underscore-dangle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;off&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;no-unused-vars&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;off&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;no-unused-expressions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;off&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;no-return-assign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;off&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;no-use-before-define&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;off&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;func-names&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;off&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;guard-for-in&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;off&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;consistent-return&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;off&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;no-restricted-globals&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;off&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;default-param-last&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;off&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;default-case&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;off&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;prefer-spread&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;off&quot;</span><span class="hljs-punctuation">,</span><br><br>    <span class="hljs-comment">// import config</span><br>    <span class="hljs-attr">&quot;import/extensions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;off&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;import/no-unresolved&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;off&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;import/no-extraneous-dependencies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;off&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;import/prefer-default-export&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;off&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;import/no-relative-packages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;off&quot;</span><span class="hljs-punctuation">,</span><br>    <br>    <span class="hljs-comment">// typescript config</span><br>    <span class="hljs-attr">&quot;@typescript-eslint/no-explicit-any&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;off&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;@typescript-eslint/explicit-module-boundary-types&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;off&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;@typescript-eslint/no-require-imports&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;@typescript-eslint/no-var-requires&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;@typescript-eslint/prefer-for-of&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;@typescript-eslint/ban-types&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;@typescript-eslint/no-unused-vars&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;@typescript-eslint/no-empty-function&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;@typescript-eslint/ban-ts-comment&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;vue/require-default-prop&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;vue/multi-word-component-names&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;vue/no-deprecated-slot-attribute&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;overrides&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;files&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;*.vue&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;rules&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;vue/component-name-in-template-casing&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;kebab-case&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;vue/require-default-prop&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;files&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-string">&quot;**/_example/*&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;script/**/*&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;script/*&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;*.js&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;site/**/*&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;site/*&quot;</span><br>      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;rules&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;no-var-requires&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;no-console&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;no-unused-expressions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;no-alert&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;files&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-string">&quot;*.ts&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;*.tsx&quot;</span><br>      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;rules&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;@typescript-eslint/explicit-function-return-type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;files&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-string">&quot;*.test.js&quot;</span><br>      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;rules&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;import/no-dynamic-require&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;off&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;global-require&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;off&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;files&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;*&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br><span class="hljs-comment">// 两个parser的区别在于，外面的parser用来解析vue文件，使得eslint能解析&lt;template&gt;标签中的内容，而parserOptions中的parser，即@typescript-eslint/parser用来解析vue文件中&lt;script&gt;标签中的代码。</span><br></code></pre></td></tr></table></figure><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript">配置说明<br>env<br>Environments，指定代码的运行环境。不同的运行环境，全局变量不一样，指明运行环境这样ESLint就能识别特定的全局变量。同时也会开启对应环境的语法支持，例如：es6。<br><br>parser<br>ESLint 默认使用Espree作为其解析器，但它并不能很好的适应 React 环境，你可以安装 babel-eslint 用来代替默认的解析器，在配置里这么写<span class="hljs-string">&quot;parser&quot;</span>: “babel-eslint”。<br><br>plugins<br>顾名思义就是插件，插件是单独的<span class="hljs-built_in">npm</span>包，命名一般以eslint-plugin开头，写的时候用字符串数组的形式，可以省略eslint-plugin开头。plugins一般包含一个或多个规则配置，可以在<span class="hljs-keyword">extends</span>中引入。<br>例如：eslint:recommended就是 ESLint 的推荐规则配置，包含了ESLint的规则 里前面有✔︎的部分，recommended 规则只在ESLint升级大版本的才有可能改变。<br><br><span class="hljs-keyword">extends</span><br>ESLint 不需要自行定义大量的规则，因为很多规则已被分组作为一个规则配置。<br>例如：eslint:recommended就是 ESLint 的推荐规则配置，包含了ESLint的规则 里前面有✔︎的部分，recommended 规则只在ESLint升级大版本的才有可能改变。<br><br>相对的 eslint:all 是应用所有的规则，但并不推荐这么做。另外，all 规则是根据版本随时变化的。<br><span class="hljs-keyword">extends</span> 还可以以字符串数组的形式定义。<br><br><span class="hljs-string">&quot;extends&quot;</span>: [<span class="hljs-string">&quot;eslint:recommended&quot;</span>, <span class="hljs-string">&quot;plugin:react/recommended&quot;</span>],<br><br>plugin:react/recommended 即为 eslint-plugin-react 插件中的提供的推荐规则配置。<br>另外还有一点，<span class="hljs-keyword">extends</span>定义的规则如果有重复的，后面的规则会覆盖前面的。<br><br>rules<br>这里可以对规则进行细致的定义了，覆盖之前前面说的<span class="hljs-keyword">extends</span>中定义的规则。例如indent就是对缩进的修改。<span class="hljs-string">&quot;indent&quot;</span>: [<span class="hljs-string">&quot;error&quot;</span>,<span class="hljs-number">4</span>] 前面一项代表错误等级，第二项是具体配置，有些规则有第三项选项，例如 indent 就有 &#123; <span class="hljs-string">&quot;SwitchCase&quot;</span>: <span class="hljs-number">1</span> &#125;，代表对<span class="hljs-keyword">switch</span>语句采取什么样的缩进策略，如果不设默认是<span class="hljs-number">0</span>。具体可以定义什么 rules，可以 参考这里<br><br>错误等级有三级 <span class="hljs-number">0</span>，<span class="hljs-number">1</span>，<span class="hljs-number">2</span>，分别代表<span class="hljs-literal">off</span>，warning，error。error错误会终止 lint-staged 执行。<br><br><span class="hljs-number">0</span>或’<span class="hljs-literal">off</span>’：关闭规则。<br><span class="hljs-number">1</span>或’warn’：打开规则，并且作为一个警告（并不会导致检查不通过）。<br><span class="hljs-number">2</span>或’error’：打开规则，并且作为一个错误 (退出码为<span class="hljs-number">1</span>，检查不通过)。<br>参数说明：<br>参数<span class="hljs-number">1</span> ： 错误等级<br>参数<span class="hljs-number">2</span> ： 处理方式<br><br>globals<br>全局变量，如果你的项目用到其他一些自定义的全局变量，<span class="hljs-string">&quot;__DEV__&quot;</span>: <span class="hljs-literal">false</span>这样配置，<span class="hljs-literal">true</span><br>和 <span class="hljs-literal">false</span> 代表可不可以被修改。<br></code></pre></td></tr></table></figure><ol><li>配置代码注释方式</li></ol><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">忽略 <span class="hljs-keyword">no</span>-undef 检查<br><span class="hljs-comment">/* eslint-disable no-undef */</span><br><br>忽略 <span class="hljs-keyword">no</span>-<span class="hljs-built_in">new</span> 检查<br><span class="hljs-comment">/* eslint-disable no-new */</span><br><br>设置检查<br><span class="hljs-comment">/*eslint eqeqeq: off*/</span> <span class="hljs-comment">/*eslint eqeqeq: 0*/</span><br><br>eslint 检查指令<br>检查且修复<br>eslint * <span class="hljs-comment">--fix</span><br><br>检查指定文件<br>eslint app.js <span class="hljs-comment">--fix</span><br></code></pre></td></tr></table></figure><h1 id="二、初始化styelint"><a href="#二、初始化styelint" class="headerlink" title="二、初始化styelint"></a>二、初始化styelint</h1><ul><li>postcss</li><li>less</li><li>sass</li></ul><h2 id="2-1-什么是Stylelint"><a href="#2-1-什么是Stylelint" class="headerlink" title="2.1 什么是Stylelint"></a>2.1 什么是Stylelint</h2><pre><code class="hljs">Stylelint是一个强大的，现代的代码检查工具，与ESLint类似，Stylelint能够通过定义一系列的编码风格规则帮助我们避免在样式表中出现错误。目前在开源社区上，关于CSS Lint的解决方案主要包括了csslint、SCSS-Lint和Stylelint等几种。而由于Stylelint在技术架构上基于AST 的方式扩展CSS，除原生CSS 语法，其也支持 SCSS、Less 这类预处理器，并且也有非常多的第三方插件，因此我们团队选择了Stylelint作为CSS Lint工具。官方文档：https://stylelint.io/</code></pre><h2 id="2-2-安装Stylelint"><a href="#2-2-安装Stylelint" class="headerlink" title="2.2 安装Stylelint"></a>2.2 安装Stylelint</h2><p>   可以选采用npm安装Stylelint。其中，stylelint-config-standard是Stylelint的标准配置。如果想使用airbnb或prettier的规范，也可以将stylelint-config-standard改为stylelint-config-airbnb或stylelint-config-prettier。</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua">npm install stylelint stylelint-<span class="hljs-built_in">config</span>-standard <span class="hljs-comment">--save-dev</span><br></code></pre></td></tr></table></figure><ul><li>问题： stylelint-config-tencent、stylelint-config-prettier、stylelint-config-airbnb区别</li></ul><h2 id="2-3-安装适配预处理语法的插件"><a href="#2-3-安装适配预处理语法的插件" class="headerlink" title="2.3 安装适配预处理语法的插件"></a>2.3 安装适配预处理语法的插件</h2><pre><code class="hljs">如果我们项目中采用了如sass或less等css预处理器，那么可以安装适配预处理语法的插件。以sass为例，需要安装stylelint-scss插件。</code></pre><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">npm <span class="hljs-keyword">install </span>stylelint-<span class="hljs-keyword">scss </span>--save-dev<br></code></pre></td></tr></table></figure><h2 id="2-4-安装CSS属性排序插件"><a href="#2-4-安装CSS属性排序插件" class="headerlink" title="2.4 安装CSS属性排序插件"></a>2.4 安装CSS属性排序插件</h2><pre><code class="hljs">我们也可以选择安装stylelint-order插件。该插件能够强制我们按照某个顺序编写css，比如先写定位，再写盒模型，再写内容区样式，最后写CSS3相关属性，这样可以更好的保证我们代码的可读性。</code></pre><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">npm install stylelint-<span class="hljs-keyword">order</span> <span class="hljs-title">--save-dev</span><br></code></pre></td></tr></table></figure><h2 id="2-Stylelint配置"><a href="#2-Stylelint配置" class="headerlink" title="2. Stylelint配置"></a>2. Stylelint配置</h2><p>2.1 Stylelint配置方式<br>    安装好Stylelint之后，就需要对Stylelint进行配置。Stylelint的配置方式包括了以下几种：</p><p>在package.json中添加stylelint属性并添加规则<br>在.stylelintrc文件中指定，.stylelintrc文件支持添加一个文件扩展名来区分 JSON，YAML 或 JS 格式，如创建.stylelintrc.json、.stylelintrc.yaml、.stylelintrc.yml或.stylelintrc.js文件<br>在stylelint.config.js文件中指定，该文件将会exports一个配置对象<br>    在这里，我们选择了在项目根目录创建.stylelintrc.js来配置Stylelint。</p><h1 id="三、初始化prettier"><a href="#三、初始化prettier" class="headerlink" title="三、初始化prettier"></a>三、初始化prettier</h1><ol><li>安装依赖</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js">npm install --save-dev --save-exact prettier<br><span class="hljs-comment">// --save-exact 锁版本，去除^ ~</span><br></code></pre></td></tr></table></figure><ol start="2"><li>配置规则（JS及TS项目均适用），prettier.config.js 参考配置如下</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-comment">// 一行最多 120 字符</span><br>  <span class="hljs-attr">printWidth</span>: <span class="hljs-number">120</span>,<br>  <span class="hljs-comment">// 使用 2 个空格缩进</span><br>  <span class="hljs-attr">tabWidth</span>: <span class="hljs-number">2</span>,<br>  <span class="hljs-comment">// 不使用缩进符，而使用空格</span><br>  <span class="hljs-attr">useTabs</span>: <span class="hljs-literal">false</span>,<br>  <span class="hljs-comment">// 行尾需要有分号</span><br>  <span class="hljs-attr">semi</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-comment">// 使用单引号</span><br>  <span class="hljs-attr">singleQuote</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-comment">// 对象的 key 仅在必要时用引号</span><br>  <span class="hljs-attr">quoteProps</span>: <span class="hljs-string">&#x27;as-needed&#x27;</span>,<br>  <span class="hljs-comment">// jsx 不使用单引号，而使用双引号</span><br>  <span class="hljs-attr">jsxSingleQuote</span>: <span class="hljs-literal">false</span>,<br>  <span class="hljs-comment">// 末尾需要有逗号</span><br>  <span class="hljs-attr">trailingComma</span>: <span class="hljs-string">&#x27;all&#x27;</span>,<br>  <span class="hljs-comment">// 大括号内的首尾需要空格</span><br>  <span class="hljs-attr">bracketSpacing</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-comment">// jsx 标签的反尖括号需要换行，注意：tsx 不生效</span><br>  <span class="hljs-attr">jsxBracketSameLine</span>: <span class="hljs-literal">false</span>,<br>  <span class="hljs-comment">// 箭头函数，只有一个参数的时候，也需要括号</span><br>  <span class="hljs-attr">arrowParens</span>: <span class="hljs-string">&#x27;always&#x27;</span>,<br>  <span class="hljs-comment">// 每个文件格式化的范围是文件的全部内容</span><br>  <span class="hljs-attr">rangeStart</span>: <span class="hljs-number">0</span>,<br>  <span class="hljs-attr">rangeEnd</span>: <span class="hljs-title class_">Infinity</span>,<br>  <span class="hljs-comment">// 不需要写文件开头的 @prettier</span><br>  <span class="hljs-attr">requirePragma</span>: <span class="hljs-literal">false</span>,<br>  <span class="hljs-comment">// 不需要自动在文件开头插入 @prettier</span><br>  <span class="hljs-attr">insertPragma</span>: <span class="hljs-literal">false</span>,<br>  <span class="hljs-comment">// 使用默认的折行标准</span><br>  <span class="hljs-attr">proseWrap</span>: <span class="hljs-string">&#x27;preserve&#x27;</span>,<br>  <span class="hljs-comment">// 根据显示样式决定 html 要不要折行</span><br>  <span class="hljs-attr">htmlWhitespaceSensitivity</span>: <span class="hljs-string">&#x27;css&#x27;</span>,<br>  <span class="hljs-comment">// vue 文件中的 script 和 style 内不用缩进</span><br>  <span class="hljs-attr">vueIndentScriptAndStyle</span>: <span class="hljs-literal">false</span>,<br>  <span class="hljs-comment">// 换行符使用 lf</span><br>  <span class="hljs-attr">endOfLine</span>: <span class="hljs-string">&#x27;lf&#x27;</span>,<br>&#125;;<br><br></code></pre></td></tr></table></figure><ol start="3"><li>配置忽略文件.prettierignore (如果有的话)</li></ol><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">```<br><br><span class="hljs-number">4</span>. 解决eslint冲突<br><br>- 安装 ```pnpm install eslint-config-prettier eslint-plugin-prettier -D```<br>- 添加配置到 eslint.js 文件<br></code></pre></td></tr></table></figure><p>module.exports &#x3D; {<br>  extends: [<br>    ‘plugin:@typescript-eslint&#x2F;recommended’,<br>    ‘plugin:vue&#x2F;vue3-recommended’,<br>    ‘plugin:prettier&#x2F;recommended’<br>    ],<br>}</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><br><br><span class="hljs-strong">**Prettier 和各种 Linters 是什么关系？如何配合使用？**</span><br><br>规则分为两类<br><span class="hljs-bullet">-</span> Formatting rules<br><span class="hljs-bullet">-</span> Code-quality rules<br><br>prettier的作用是对<span class="hljs-code">```Formatting rules```</span>这类规则自动化处理，自动格式化代码，但是不会帮你挑出潜在的错误。<br><br><br><br><span class="hljs-section">### Prettier 和 Linters 的整合需要做两件事：</span><br><br><span class="hljs-bullet">-</span> 禁用 Linters 自己的 Formatting rules，让 Prettier 接管这些职责。这些配置有现成的 Config，Linters 的配置继承这个 Config 就可以了。<br><span class="hljs-bullet">-</span> 让 Linters 执行时首先能够调用 Prettier 格式化带啊，然后再检查 Code-quality 类规则。这是 由 Linters 的 Plugin 实现的。<br><br><span class="hljs-section"># VSCODE 安装eslint、prettier、vetur、volar插件及配置</span><br><span class="hljs-bullet">1.</span> 安装插件<br><span class="hljs-bullet">2.</span> 配置eslint<br><span class="hljs-bullet">3.</span> 配置prettier<br>一般而言，我们还需要集成 vscode-prettier这个插件来完成自动保存格式化，在插件市场安装好了以后，在我们的.vscode/settings.json中添加如下规则<br></code></pre></td></tr></table></figure><p>{<br>   “editor.formatOnSave”: true, &#x2F;&#x2F; 开启自动保存<br>   “editor.defaultFormatter”: “esbenp.prettier-vscode”, &#x2F;&#x2F; 默认格式化工具选择prettier<br>}</p><p>  “editor.tabSize”: 2, &#x2F;&#x2F;制表符符号eslint<br>  “editor.formatOnSave”: true, &#x2F;&#x2F;保存时自动格式化<br>  &#x2F;&#x2F;保存时自动将代码按ESLint格式进行修复<br>  “editor.codeActionsOnSave”: {<br>    “source.fixAll.eslint”: true<br>  },<br>  “prettier.eslintIntegration”: true, &#x2F;&#x2F;让prettier使用eslint的代码格式进行校验<br>  “prettier.semi”: true, &#x2F;&#x2F;补齐代码结尾的分号<br>  “prettier.singleQuote”: true, &#x2F;&#x2F;使用单引号替代双引号<br>  “prettier.trailingComma”: “all”, &#x2F;&#x2F; 对象补齐最后一个逗号</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs clean"><br>### 配置 vue 文件 自动eslint，否则.vue文件不会自动格式化<br></code></pre></td></tr></table></figure><p>  “[vue]”: {<br>    “editor.defaultFormatter”: “esbenp.prettier-vscode”<br>  },</p><pre><code class="hljs"># 参考文献[styelint](https://www.cnblogs.com/Yellow-ice/p/15346883.html)[eslint + prettier + lint-staged 项目规范](https://juejin.cn/post/7043702363156119565)https://blog.csdn.net/sinat_36728518/article/details/124932438</code></pre>]]></content>
    
    
    <categories>
      
      <category>规范</category>
      
    </categories>
    
    
    <tags>
      
      <tag>git flow</tag>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-10-10-linux指令</title>
    <link href="/2025/11/28/2022-07-06-%E3%80%90%E6%8C%87%E4%BB%A4%E3%80%91linux%E6%8C%87%E4%BB%A4/"/>
    <url>/2025/11/28/2022-07-06-%E3%80%90%E6%8C%87%E4%BB%A4%E3%80%91linux%E6%8C%87%E4%BB%A4/</url>
    
    <content type="html"><![CDATA[<h2 id="1-批量杀死多个进程的命令"><a href="#1-批量杀死多个进程的命令" class="headerlink" title="1. 批量杀死多个进程的命令"></a>1. 批量杀死多个进程的命令</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">$ ps -ef | grep python | cut -c <span class="hljs-number">6</span>-<span class="hljs-number">11</span> | xargs kill -<span class="hljs-number">9</span><br></code></pre></td></tr></table></figure><p>Linux 中的管道符“|”用来隔开两个命令，管道符左边的输出会作为管道符右边命令的输入</p><p>ps -ef 是查看所有进程的命令。ps 是 process status 的缩写</p><p>grep 是过滤符号，grep name 含义是所有包含”python”的进程</p><p>cut -c 6-11 是截取输入行的第 6 个字符到第 11 个字符，正好是进程号 PID</p><p>xargs kill -9 其中 xagrs 的命令是用来把前面命令的输出结果（PID）作为“kill -9”命令的参数，kill -9”会强行杀掉指定进程</p><h2 id="2-cat-和-vi-vim-和-nano-区别"><a href="#2-cat-和-vi-vim-和-nano-区别" class="headerlink" title="2. cat 和 vi&#x2F;vim 和 nano 区别"></a>2. cat 和 vi&#x2F;vim 和 nano 区别</h2><p>cat 命令是 linux 系统下一个文本打印的命令，用于输出一个文本的信息到控制台上，该命令的输入类似于使用 word 打开一个文档，但是该文档不能编辑。</p><p>vi&#x2F;vim 命令是 linux 系统下用于文本查看、编辑的命令，不仅仅可以查看，还可以编辑。</p><p>nano 命令类似于 vim 命令的功能，命令语句为：nano p（打开 p 文件）</p><ul><li><p>vi 和 vim 区别<br>vi 不需要安装，打开代码，颜色一样（黑色）<br>vim 需要额外安装，打开代码，用颜色区分代码</p></li><li><p>cat 用法 <code>cat [option] [path/to/file]...</code>；option：-n（空行也已编号） –b （空行无编号）<br>（1）cat 和 EOF 简介<br>cat 用于显示文本文件内容，全部输出<br>EOF “end of file”，表示文本结束符<br>（2）使用<br>用法 1.多行导入文件（新建文件或者覆盖文件内容）<br>在 cat &lt;<EOF >abcd.txt 命令 与下一个输入的 EOF 行之间的所有文本行都会被当做是 stdin 数据。</p></li></ul><p>用法 2.文件追加<br>cat &lt;&lt; EOF &gt;&gt; test.sh</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">cat</span> <span class="hljs-built_in">log</span>.txt | <span class="hljs-keyword">grep</span> <span class="hljs-string">&#x27;ERROR&#x27;</span> -B <span class="hljs-number">5</span>  //前<span class="hljs-number">5</span>行<br><span class="hljs-keyword">cat</span> <span class="hljs-built_in">log</span>.txt | <span class="hljs-keyword">grep</span> <span class="hljs-string">&#x27;ERROR&#x27;</span> -C <span class="hljs-number">5</span>  //前后<span class="hljs-number">5</span>行<br><span class="hljs-keyword">cat</span> <span class="hljs-built_in">log</span>.txt | <span class="hljs-keyword">grep</span> -v <span class="hljs-string">&#x27;ERROR&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="3-解压指令"><a href="#3-解压指令" class="headerlink" title="3. 解压指令"></a>3. 解压指令</h2><p><strong>1、.tar</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript">解包：tar xvf <span class="hljs-title class_">FileName</span>.<span class="hljs-property">tar</span><br>打包：tar cvf <span class="hljs-title class_">FileName</span>.<span class="hljs-property">tar</span> <span class="hljs-title class_">DirName</span><br>（注：tar是打包，不是压缩！）<br></code></pre></td></tr></table></figure><p><strong>2、.gz</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript">解压<span class="hljs-number">1</span>：gunzip <span class="hljs-title class_">FileName</span>.<span class="hljs-property">gz</span><br>解压<span class="hljs-number">2</span>：gzip -d <span class="hljs-title class_">FileName</span>.<span class="hljs-property">gz</span><br>压缩：gzip <span class="hljs-title class_">FileName</span><br></code></pre></td></tr></table></figure><p><strong>3、.tar.gz 和 .tgz</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript">解压：tar zxvf <span class="hljs-title class_">FileName</span>.<span class="hljs-property">tar</span>.<span class="hljs-property">gz</span><br>压缩：tar zcvf <span class="hljs-title class_">FileName</span>.<span class="hljs-property">tar</span>.<span class="hljs-property">gz</span> <span class="hljs-title class_">DirName</span><br></code></pre></td></tr></table></figure><h5 id="4-、-zip"><a href="#4-、-zip" class="headerlink" title="4**、.zip**"></a>4**、.zip**</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript">解压：unzip <span class="hljs-title class_">FileName</span>.<span class="hljs-property">zip</span><br>压缩：zip <span class="hljs-title class_">FileName</span>.<span class="hljs-property">zip</span> <span class="hljs-title class_">DirName</span><br></code></pre></td></tr></table></figure><h4 id="5-scp-远程拷贝"><a href="#5-scp-远程拷贝" class="headerlink" title="5. scp 远程拷贝"></a>5. scp 远程拷贝</h4><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-comment"># 拷贝整个文件夹 到本地 -r参数</span><br>scp -r root@服务器地址<span class="hljs-symbol">:/root/</span>.pm2/logs ./<br></code></pre></td></tr></table></figure><ul><li>如果执行报错，如下</li></ul><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lsl">Host <span class="hljs-type">key</span> for 服务器ip has <span class="hljs-section">changed</span> and you have requested strict checking.<br>Host <span class="hljs-type">key</span> verification failed.<br></code></pre></td></tr></table></figure><ul><li>则执行以下指令</li></ul><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">ssh</span>-keygen -R 服务器<span class="hljs-built_in">ip</span><br></code></pre></td></tr></table></figure><ul><li>下载单个文件到本地<br>scp -p user@ServerIp:source_dictionary_file target_dictionary<br>scp <a href="mailto:&#x72;&#x6f;&#x6f;&#116;&#64;&#x31;&#x39;&#50;&#x2e;&#x31;&#54;&#56;&#46;&#48;&#46;&#x32;">root@192.168.0.2</a>:&#x2F;home&#x2F;hellowood&#x2F;wechat.jpg &#x2F;User&#x2F;hellowood&#x2F;wechat.jpg</li><li>下载文件夹到本地<br>scp <a href="mailto:&#x72;&#x6f;&#111;&#x74;&#x40;&#x34;&#x33;&#46;&#49;&#53;&#52;&#x2e;&#50;&#x30;&#x39;&#x2e;&#49;&#x34;&#x31;">root@43.154.209.141</a>:&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;backup&#x2F;funds_data_2023-08-04.sql &#x2F;Users&#x2F;sunny&#x2F;Desktop</li></ul><p>上传<br>上传单个文件<br>scp -p port source_dictionary_file user@ServerIp:target_dictionary_file<br>prot 默认是 22，如果使用默认可以不写</p><p>scp &#x2F;User&#x2F;hellowood&#x2F;wechat.jpg <a href="mailto:&#x72;&#x6f;&#x6f;&#x74;&#64;&#49;&#57;&#50;&#x2e;&#x31;&#54;&#56;&#46;&#x30;&#46;&#x32;">root@192.168.0.2</a>:&#x2F;home&#x2F;hellowood&#x2F;wechat.jpg<br>上传整个文件夹<br>scp -p port -r source_dictionary user@ServerIp:target_dictionary<br>scp -r &#x2F;Users&#x2F;sunny&#x2F;Downloads&#x2F;blowsysun.top_nginx <a href="mailto:&#114;&#111;&#111;&#x74;&#x40;&#52;&#51;&#x2e;&#49;&#x35;&#52;&#46;&#x32;&#48;&#57;&#x2e;&#49;&#x34;&#x31;">root@43.154.209.141</a>:&#x2F;usr&#x2F;local&#x2F;etc</p><h2 id="关于-shell"><a href="#关于-shell" class="headerlink" title="关于 shell"></a>关于 shell</h2><p>牛程序员看到不爽的 Shell，就会自己重新写一套，慢慢形成了一些标准，常用的 Shell 有这么几种，sh、bash、csh 等，想知道你的系统有几种 shell，可以通过以下命令查看：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat /etc/shells<br></code></pre></td></tr></table></figure><h2 id="查看日志"><a href="#查看日志" class="headerlink" title="查看日志"></a>查看日志</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># 查看最后300行日志</span><br><span class="hljs-built_in">tail</span> -n 300 XX.<span class="hljs-built_in">log</span><br><br><span class="hljs-built_in">cat</span><br></code></pre></td></tr></table></figure><h2 id="获取-mac-内网地址"><a href="#获取-mac-内网地址" class="headerlink" title="获取 mac 内网地址"></a>获取 mac 内网地址</h2><p><code>ifconfig | grep &quot;inet &quot; | grep -v 127.0.0.1</code></p><h2 id="linux-根目录下-子目录"><a href="#linux-根目录下-子目录" class="headerlink" title="linux 根目录下 子目录"></a>linux 根目录下 子目录</h2><p>在 Linux 系统中，根目录（<code>/</code>）是文件系统层次结构的起始点。根目录下包含多个子目录，每个子目录都有特定的用途。以下是一些常见的根目录下的文件夹及其基本介绍：</p><ol><li><p><strong>&#x2F;bin</strong> - 存放基本的二进制文件（即系统命令），如 <code>ls</code>、<code>cp</code>、<code>mv</code> 等，这些是系统启动和运行所必需的。</p></li><li><p><strong>&#x2F;boot</strong> - 包含 Linux 内核和引导加载程序所需的文件，比如 <code>vmlinuz</code> 和 <code>initrd</code>。</p></li><li><p><strong>&#x2F;dev</strong> - 包含设备文件，这些文件作为系统硬件设备和软件接口。</p></li><li><p><strong>&#x2F;etc</strong> - 存放系统配置文件，大多数没有二进制文件，如 <code>fstab</code>、<code>passwd</code>、<code>resolv.conf</code> 等。</p></li><li><p><strong>&#x2F;home</strong> - 用户的主目录，每个用户在该目录下有自己的子目录，例如 <code>/home/username</code>。</p></li><li><p><strong>&#x2F;lib</strong> - 包含系统使用的库文件，这些是程序运行时需要的共享代码。</p></li><li><p><strong>&#x2F;media</strong> - 用于挂载可移动设备，如 USB 驱动器、CD-ROMs 等。</p></li><li><p><strong>&#x2F;mnt</strong> - 传统上用于临时挂载文件系统，尽管这个用途已经逐渐被 <code>/media</code> 取代。</p></li><li><p><strong>&#x2F;opt</strong> - 用于存放可选的第三方软件包。</p></li><li><p><strong>&#x2F;proc</strong> - 虚拟文件系统，提供关于运行中的进程和内核的信息。</p></li><li><p><strong>&#x2F;root</strong> - 系统管理员的用户主目录。</p></li><li><p><strong>&#x2F;sbin</strong> - 存放系统二进制文件，通常是系统管理员使用的命令，如 <code>fdisk</code>、<code>ifconfig</code> 等。</p></li><li><p><strong>&#x2F;srv</strong> - 存放服务相关的数据，比如一些服务器软件的数据。</p></li><li><p><strong>&#x2F;tmp</strong> - 存放临时文件，通常在系统启动时被清空。</p></li><li><p><strong>&#x2F;usr</strong> - 用户相关的应用程序和文件，通常分为 <code>/usr/bin</code>、<code>/usr/lib</code>、<code>/usr/share</code> 等子目录。</p></li><li><p><strong>&#x2F;var</strong> - 包含经常变化的文件，如日志文件、数据库文件等，通常分为 <code>/var/log</code>、<code>/var/mail</code> 等子目录。</p></li><li><p><strong>&#x2F;sys</strong> - 另一个虚拟文件系统，提供对内核数据结构的访问。</p></li><li><p><strong>&#x2F;selinux</strong> - 安全相关的文件，特别是与 SELinux 安全模块相关的配置和状态信息。</p></li><li><p><strong>&#x2F;lost+found</strong> - 文件系统检查工具（如 <code>fsck</code>）使用的一个特殊目录，用于存放损坏的文件片段。</p></li><li><p><strong>&#x2F;run</strong> - 包含系统运行时的数据，与 <code>/tmp</code> 类似，但用于存放系统级的运行时数据。</p></li></ol><p>这些目录是大多数 Linux 发行版中的标准组成部分，但具体内容可能会根据不同的发行版和配置有所不同。</p><h5 id="一、查看-Linux-系统发行版本"><a href="#一、查看-Linux-系统发行版本" class="headerlink" title="一、查看 Linux 系统发行版本"></a>一、查看 Linux 系统发行版本</h5><p>命令 1：lsb_release -a</p><p>该命令适用于所有 Linux 系统，会显示出完整的版本信息，包括 Linux 系统的名称，如 Debian、Ubuntu、CentOS 等，和对应的版本号，以及该版本的代号，例如在 Debian 8 中将会显示代号 jessie。</p><p>$ lsb_release -a<code>No LSB modules are available. </code>Distributor ID: Debian <code>Description: Debian GNU</code>&#x2F;Linux<code>8.0 (jessie) </code>Release: 8.0 &#96;&#96;Codename: jessie<br>命令 2： cat &#x2F;etc&#x2F;issue</p><p>该命令适用于所有 Linux 系统，显示的版本信息较为简略，只有系统名称和对应版本号。</p><p>$ <code>cat` `/etc/issue</code>Debian GNU&#96;&#96;&#x2F;Linux<code> </code>8 \n \1<br>命令 3： cat &#x2F;etc&#x2F;redhat-release</p><p>该命令仅适用于 Redhat 系列的 Linux 系统，显示的版本信息也较为简略。</p><p>$ <code>cat` `/etc/redhat-release</code>CentOS release 6.0 (Final)<br>**二、查看 Linux 内核版本<br>**</p><p>命令 1： uname -a</p><p>$ <code>uname` `-a</code>Linux CodeBelief 3.16.0-4-amd64 &#96;&#96;#1 SMP Debian 3.16.7-ckt9-3~deb8ul (2015-04-24) x86_64 GNU&#x2F;Linux<br>命令 2： cat &#x2F;proc&#x2F;version</p><p>$ <code>cat` `/proc/version</code>Linux version 3.16.0-4-amd64 (<a href="mailto:&#x64;&#101;&#98;&#x69;&#x61;&#x6e;&#x2d;&#107;&#x65;&#114;&#x6e;&#101;&#x6c;&#x40;&#x6c;&#x69;&#115;&#116;&#x73;&#x2e;&#100;&#101;&#x62;&#x69;&#97;&#110;&#x2e;&#x6f;&#114;&#x67;">debian-kernel@lists.debian.org</a>) (gcc version 4.8.4 (Debian 4.8.4-1) ) &#96;&#96;#1 SMP Debian 3.16.7-ckt9-3~deb8ul (2.15-04-24)<br>以上就是用于查询 Linux 系统版本的常见命令，希望对大家有所帮助。</p>]]></content>
    
    
    <categories>
      
      <category>指令</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-10-10-npx与npm</title>
    <link href="/2025/11/28/2022-08-10-npx%E4%B8%8Enpm/"/>
    <url>/2025/11/28/2022-08-10-npx%E4%B8%8Enpm/</url>
    
    <content type="html"><![CDATA[<h3 id="NPM-管理Node包的工具"><a href="#NPM-管理Node包的工具" class="headerlink" title="NPM - 管理Node包的工具"></a>NPM - 管理Node包的工具</h3><h3 id="NPX-执行Node包的工具"><a href="#NPX-执行Node包的工具" class="headerlink" title="NPX - 执行Node包的工具"></a>NPX - 执行Node包的工具</h3><p>npm5.2+支持NPX</p><p>NPM本身实际上不能运行任何包，如果你想去执行某个包，必须在package.json文件中去定义。</p><p>当通过NPM安装Node包，NPM会在node_modules下的.bin里创建一个软连接。</p><p>本地安装链接会放到.&#x2F;node_modules&#x2F;.bin目录</p><p>全局安装会连接到全局的文件，linux&#x2F;macos在&#x2F;usr&#x2F;local&#x2F;bin里，windows则在&#x2F;AppData&#x2F;npm</p><h3 id="NPM"><a href="#NPM" class="headerlink" title="NPM:"></a>NPM:</h3><h4 id="包管理"><a href="#包管理" class="headerlink" title="包管理"></a>包管理</h4><p>安装到特定项目下的Node包，执行:</p><p>npm install some-package</p><p>现在如果像下面这样去执行some-package会失败的。只有全局安装的包才可以只用包名去执行。</p><p>$ some-package</p><p>为了解决这个问题，必须像下面这样，将本地包的相对项目的路径填写全。</p><p>$ .&#x2F;node_modules&#x2F;.bin&#x2F;some-package</p><p>当然如果你非要通过命令去执行的话，也不是不可以的。通过编辑package.json文件，将以下脚本添加到script属性下</p><p>{ </p><p>   “name”: “whatever”, </p><p>  “version”: “1.0.0”, </p><p>  “scripts”: {  </p><p>​          “some-package”: “some-package” </p><p>   }</p><p>}</p><p>然后通过npm run some-package调用。</p><h3 id="NPX"><a href="#NPX" class="headerlink" title="NPX:"></a>NPX:</h3><h4 id="免安装执行包命令"><a href="#免安装执行包命令" class="headerlink" title="免安装执行包命令"></a>免安装执行包命令</h4><p>npx会检查命令（<some-package>）是否出现在$PATH,或本地项目中，然后去执行。</p><p>所以，对于上面的例子，如果想通过在本地执行，可以通过npx some-package执行。</p><p>npx some-package</p><p>npx另一个重要的优势是，可以执行未安装的包的命令，例如：</p><p>$ npx create-react-app my-app</p><p>上面的例子将会创建一个名为my-app的React的工程，创建的位置就在输入命令的当前文件夹，并且保证永远使用最新的构建工具，而不用担心升级的问题。而如果不用npx的话，你需要首先通过npm安装create-react-app包才可以create-react-app my-app，并且一旦create-react-app升级了你都需要执行create-react-app的升级。</p><p><code>npm</code> 由三个独立的部分组成：</p><ul><li>网站<br>网站 是开发者查找包（<code>package</code>）、设置参数以及管理 <code>npm</code> 使用体验的主要途径。</li><li>注册表（<code>registry</code>）<br>注册表 是一个巨大的数据库，保存了每个包（<code>package</code>）的信息。</li><li>命令行工具 (<code>CLI</code>)<br><code>CLI</code> 通过命令行或终端运行。开发者通过 CLI 与 npm 打交道。</li></ul>]]></content>
    
    
    <categories>
      
      <category>npm</category>
      
    </categories>
    
    
    <tags>
      
      <tag>npx与npm</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-10-10-git常用操作</title>
    <link href="/2025/11/28/2022-05-12-%E3%80%90%E6%8C%87%E4%BB%A4%E3%80%91git%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/"/>
    <url>/2025/11/28/2022-05-12-%E3%80%90%E6%8C%87%E4%BB%A4%E3%80%91git%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/</url>
    
    <content type="html"><![CDATA[<h1 id="git-常用操作指令"><a href="#git-常用操作指令" class="headerlink" title="git 常用操作指令"></a>git 常用操作指令</h1><h3 id="1-Tag-管理"><a href="#1-Tag-管理" class="headerlink" title="1. Tag 管理"></a>1. Tag 管理</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">git tag // 查看本地tag</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git ls-remote --tag // 查看远程所有标签</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git tag v1.1.0 // 给当前分支打标签</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git tag v1.0.0 039bf8b -m <span class="hljs-string">&quot;add tags information&quot;</span> // 给特定的某个commit版本打标签，-m 可选</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git tag -d v1.0.0 // 删除本地某个标签</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git push origin -d v1.0.0 // 删除远程的某个标签</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git push --tag // 将本地标签一次性推送到远程</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git push origin v1.0.0 // 将本地某个特定标签推送到远程</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git show v1.0.0 // 查看某一个标签的提交信息</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git checkout 12345678 -b newBranch // 根据某个commit创建本地分支</span><br></code></pre></td></tr></table></figure><h3 id="2-git-flow"><a href="#2-git-flow" class="headerlink" title="2. git flow"></a>2. git flow</h3><p><a href="https://blog.csdn.net/lzxlfly/article/details/92413220">git flow代码管理及分支创建合并</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">## https://www.atlassian.com/git/tutorials/comparing-workflows/gitflow-workflow</span></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git flow init</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git flow feature start feature_branch === git checkout develop &amp;&amp; git checkout -b feature_branch</span><br>// 可用类型如下：feature / release / hotfix / support<br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git flow feature finish feature_branch === git checkout develop &amp;&amp; git merge feature_branch</span><br></code></pre></td></tr></table></figure><h3 id="3-GIT-远程代码合并"><a href="#3-GIT-远程代码合并" class="headerlink" title="3. GIT 远程代码合并"></a>3. GIT 远程代码合并</h3><h4 id="3-1-下载需要合并的分支"><a href="#3-1-下载需要合并的分支" class="headerlink" title="3.1 下载需要合并的分支"></a>3.1 下载需要合并的分支</h4><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">$ git <span class="hljs-keyword">clone</span> <span class="hljs-title">https</span>://gitee.com/alingfly/ASF_Test.git<br></code></pre></td></tr></table></figure><h4 id="3-2-添加需要合并远程仓库"><a href="#3-2-添加需要合并远程仓库" class="headerlink" title="3.2 添加需要合并远程仓库"></a>3.2 添加需要合并远程仓库</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp">$ git remote <span class="hljs-keyword">add</span> <span class="hljs-keyword">base</span> https:<span class="hljs-comment">//github.com/AClumsy/ASF.git</span><br></code></pre></td></tr></table></figure><p>将 <code>base</code>作为远程仓库，添加到 <code>本地仓库(origin)</code>中，设置别名为 <code>base</code>(自定义，这里我是为了方便区分仓库名)</p><h4 id="3-3-把base远程仓库中数据抓取到本仓库"><a href="#3-3-把base远程仓库中数据抓取到本仓库" class="headerlink" title="3.3 把base远程仓库中数据抓取到本仓库"></a>3.3 把<code>base</code>远程仓库中数据抓取到本仓库</h4><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">$ git fetch base  From https://github.com/AClumsy/ASF    * [new branch]      <span class="hljs-keyword">master</span>     <span class="hljs-title">-&gt; base</span>/<span class="hljs-literal">master</span><br></code></pre></td></tr></table></figure><h4 id="3-4-checkout切换到base分支上，命名为-asf"><a href="#3-4-checkout切换到base分支上，命名为-asf" class="headerlink" title="3.4 checkout切换到base分支上，命名为 asf"></a>3.4 <code>checkout</code>切换到<code>base</code>分支上，命名为 <code>asf</code></h4><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">$ git checkout -b asf base/master  Switched <span class="hljs-built_in">to</span> <span class="hljs-keyword">a</span> <span class="hljs-built_in">new</span> branch <span class="hljs-string">&#x27;asf&#x27;</span>  Branch <span class="hljs-string">&#x27;asf&#x27;</span> <span class="hljs-built_in">set</span> up <span class="hljs-built_in">to</span> track remote branch <span class="hljs-string">&#x27;master&#x27;</span> <span class="hljs-built_in">from</span> <span class="hljs-string">&#x27;base&#x27;</span>. <span class="hljs-comment"> //查看一下所有分支$ git branch * asf  asf_test</span><br></code></pre></td></tr></table></figure><p>由于我们需要把<code>asf</code>分支合并到<code>asf_test</code>分支中去，我们在切换到<code>asf_test</code>分支。</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crystal"><span class="hljs-variable">$ </span>git checkout asf_test<br></code></pre></td></tr></table></figure><h4 id="3-5-合并"><a href="#3-5-合并" class="headerlink" title="3.5 合并"></a>3.5 合并</h4><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cos">$ git <span class="hljs-keyword">merge</span> asf<br></code></pre></td></tr></table></figure><p>合并完成之后会出现很多冲突，需要在本地代码中解决冲突，然后在提交到<code>ASF_Test</code>中去。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">git push origin asf_test // 上传asf_test 分支到远程库</span><br></code></pre></td></tr></table></figure><h4 id="完整-分支同步过程"><a href="#完整-分支同步过程" class="headerlink" title="完整 分支同步过程"></a>完整 分支同步过程</h4><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">git <span class="hljs-keyword">clone </span>本地仓库（合并源）<br>git remote <span class="hljs-keyword">add </span><span class="hljs-keyword">base </span>期望被合并仓库<br>git fetch <span class="hljs-keyword">base</span><br><span class="hljs-keyword"></span>git push <span class="hljs-keyword">base </span><span class="hljs-built_in">v1</span>.<span class="hljs-number">6</span><br>git remote rm <span class="hljs-keyword">origin</span><br></code></pre></td></tr></table></figure><h3 id="4-不同分支-commit-同步"><a href="#4-不同分支-commit-同步" class="headerlink" title="4. 不同分支 commit 同步"></a>4. 不同分支 commit 同步</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">1. 切换到需要 合入 commit 的分支<br>2. cherry-pick 提交，并解决冲突后，push<br>$ git cherry-pick commitID<br></code></pre></td></tr></table></figure><h3 id="5-常用代码指令"><a href="#5-常用代码指令" class="headerlink" title="5. 常用代码指令"></a>5. 常用代码指令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">git log<br>git status<br>git add . <br>git commit -m &quot;&quot;<br>// 设置别名<br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git config --global alias.co checkout</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git config --global alias.ci commit</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git config --global alias.br branch</span><br></code></pre></td></tr></table></figure><h3 id="更新-gitignore-文件配置"><a href="#更新-gitignore-文件配置" class="headerlink" title=". 更新 .gitignore 文件配置"></a>. 更新 <strong>.gitignore</strong> 文件配置</h3><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-comment"># 删除git 缓存</span><br>git rm -r <span class="hljs-params">--cached</span> .<br>git add .<br>git commit -m &#x27;update <span class="hljs-string">.gitignore</span>&#x27;<br><br>配置语法：<br>　　以斜杠“/”开头表示目录；<br>　　以星号“*”通配多个字符；<br>　　以问号“?”通配单个字符<br>　　以方括号“[]”包含单个字符的匹配列表；<br>　　以叹号“!”表示不忽略<span class="hljs-params">(跟踪)</span>匹配到的文件或目录；<br>　　此外，git 对于 <span class="hljs-string">.ignore</span> 配置文件是按行从上到下进行规则匹配的，意味着如果前面的规则匹配的范围更大，则后面的规则将不会生效；<br></code></pre></td></tr></table></figure><h3 id="7-分支合并"><a href="#7-分支合并" class="headerlink" title="7. 分支合并"></a>7. 分支合并</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">git merge fixes enhancements // 合并分支`fixes`和`enhancements`在当前分支的顶部</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git merge -s ours obsolete // 合并`obsolete`分支到当前分支，使用`ours`合并策略</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git merge --no-commit maint // 将分支`maint`合并到当前分支中，但不要自动进行新的提交</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git merge dev // 将分支`dev`合并到当前分支中，自动进行新的提交</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">定期合并 dev分支到 当前分支</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git checkout feature/31124-190618 <span class="hljs-comment">#切换到feature/31124-190618分支</span></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git merge --no-ff develop <span class="hljs-comment">#把dev代码合并大feature</span></span><br></code></pre></td></tr></table></figure><h3 id="8-Git-分支管理"><a href="#8-Git-分支管理" class="headerlink" title="8. Git 分支管理"></a>8. Git 分支管理</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">查看本地分支</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git branch</span><br>* master<br><span class="hljs-meta prompt_"># </span><span class="language-bash">创建分支</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git branch testing</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git branch</span><br>* master<br>  testing<br><span class="hljs-meta prompt_"># </span><span class="language-bash">分支切换，使用 git checkout -b (branchname) 命令来创建新分支并立即切换到该分支下</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git checkout -b newtest</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git checkout master</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">删除分支</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git branch -d (branchname)</span><br></code></pre></td></tr></table></figure><h3 id="9-子模块"><a href="#9-子模块" class="headerlink" title="9. 子模块"></a>9. 子模块</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs shell">git submodule update --init  //初始化版本<br><span class="hljs-meta prompt_"># </span><span class="language-bash">下载子项目</span><br>git submodule add https://e.coding.net/govindustry/hrss/hrss-web-comm.git src/hrss-web-comm<br><span class="hljs-meta prompt_"># </span><span class="language-bash">克隆项目后，默认子模块目录下无任何内容。需要在项目根目录执行如下命令完成子模块的下载：</span><br>git submodule init<br>git submodule update<br><span class="hljs-meta prompt_"># </span><span class="language-bash">或者</span><br>git submodule update --init --recursive<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">如果给 git <span class="hljs-built_in">clone</span> 命令传递 --recurse-submodules 选项，它就会自动初始化并更新仓库中的每一个子模块， 包括可能存在的嵌套子模块。</span><br>git clone --recurse-submodules https://e.coding.net/govindustry/hrss/hrss-web-comm.git src/hrss-web-comm<br>git submodule update --remote  //更新到最新版本<br><span class="hljs-meta prompt_">#</span><span class="language-bash">查看修改内容可以看到增加了子模块，并且新文件下为子模块的提交<span class="hljs-built_in">hash</span>摘要</span><br>git diff --cached <br><br>子模块的更新<br>子模块的维护者提交了更新后，使用子模块的项目必须手动更新才能包含最新的提交。<br><br>在项目中，进入到子模块目录下，执行 git pull更新，查看git log查看相应提交。<br><br>完成后返回到项目目录，可以看到子模块有待提交的更新，使用git add，提交即可。<br><br>删除子模块<br>有时子模块的项目维护地址发生了变化，或者需要替换子模块，就需要删除原有的子模块。<br><br>删除子模块较复杂，步骤如下：<br><br>rm -rf 子模块目录 删除子模块目录及源码<br>vi .gitmodules 删除项目目录下.gitmodules文件中子模块相关条目<br>vi .git/config 删除配置项中子模块相关条目<br>rm .git/module/* 删除模块下的子模块目录，每个子模块对应一个目录，注意只删除对应的子模块目录即可<br><br></code></pre></td></tr></table></figure><h3 id="10-查看配置"><a href="#10-查看配置" class="headerlink" title="10. 查看配置"></a>10. 查看配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">查看用户名 ：git config user.name<br>查看密码： git config user.password<br>查看邮箱：git config user.email<br>查看配置信息： $ git config --list  <br><span class="hljs-meta prompt_"># </span><span class="language-bash">修改所有的 name 和 email</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git config --global --replace-all user.name <span class="hljs-string">&quot;你的 git 的名称&quot;</span></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git config --global --replace-all uesr.email <span class="hljs-string">&quot;你的 git 的邮箱&quot;</span></span><br></code></pre></td></tr></table></figure><p>注意： coding每一个团队下都需要配置一次 ssh公钥</p><p>![image-20210827105306454](&#x2F;Users&#x2F;sunny&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20210827105306454.png)</p><h3 id="11-无痕删除commit"><a href="#11-无痕删除commit" class="headerlink" title="11. 无痕删除commit"></a>11. 无痕删除commit</h3><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs gauss"><span class="hljs-meta"># 1、查看提交日志</span><br>git <span class="hljs-built_in">log</span><br><span class="hljs-meta"># 2、然后执行如下的命令：</span><br>git rebase -i commit号<br><span class="hljs-meta"># 3.然后将要删除的 commit号 的前缀 `pick` 改为 `drop`。(最顶部)</span><br>pick xxx =》 <span class="hljs-built_in">drop</span> xxx<br><span class="hljs-meta"># 4.然后可以通过如下命令再次查看是否已经删除：</span><br>git <span class="hljs-built_in">log</span><br><span class="hljs-meta"># 5.最后通过如下命令将现在的状态推送到远程仓库即可：</span><br>git <span class="hljs-keyword">push</span> origin HEAD --force<br></code></pre></td></tr></table></figure><p><a href="https://cloud.tencent.com/developer/article/1511875">https://cloud.tencent.com/developer/article/1511875</a></p><ul><li><p>删除最后一条提交</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs aspectj">git reset --<span class="hljs-keyword">soft</span> HEAD~<span class="hljs-number">1</span><br><span class="hljs-comment">// HEAD^的意思是上一个版本，也可以写成HEAD~1</span><br><span class="hljs-comment">//如果你进行了2次commit，想都撤回，可以使用HEAD~2</span><br></code></pre></td></tr></table></figure></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js">--mixed <br>意思是：不删除工作空间改动代码，撤销commit，并且撤销git add . 操作<br>这个为默认参数,git reset --mixed <span class="hljs-variable constant_">HEAD</span>^ 和 git reset <span class="hljs-variable constant_">HEAD</span>^ 效果是一样的。<br><br><br>--soft  <br>不删除工作空间改动代码，撤销commit，不撤销git add . <br><br>--hard<br>删除工作空间改动代码，撤销commit，撤销git add . <br><br>注意完成这个操作后，就恢复到了上一次的commit状态。<br><br>顺便说一下，如果commit注释写错了，只是想改一下注释，只需要：<br>git commit --amend<br><br>此时会进入默认vim编辑器，修改注释完毕后保存就好了。<br></code></pre></td></tr></table></figure><h3 id="12-还原本地分支"><a href="#12-还原本地分支" class="headerlink" title="12.还原本地分支"></a>12.还原本地分支</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">git <span class="hljs-keyword">fetch</span> <span class="hljs-comment">--all</span><br>origin/master为想恢复的分支名称，这里是github默认主分支<br>git <span class="hljs-keyword">reset</span> <span class="hljs-comment">--hard origin/master</span><br>git最新改版变成下面，弃用master改为main<br>git <span class="hljs-keyword">reset</span> <span class="hljs-comment">--hard origin/main</span><br>git pull<br></code></pre></td></tr></table></figure><h3 id="13-删除分支"><a href="#13-删除分支" class="headerlink" title="13. 删除分支"></a>13. 删除分支</h3><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs clean"># 删除本地分支大写的 D<br>git branch -D 要删除的分支名<br>### 批量清理本地分支<br>git branch | grep <span class="hljs-string">&#x27;qa&#x27;</span> | xargs git branch -d<br><br># 删除远程分支<br>git push origin --delete 要删除的分支名<br>### 批量删除远程分支<br>cd .git/refs/remotes/ 删除origin文件夹<br></code></pre></td></tr></table></figure><h3 id="删除变基操作"><a href="#删除变基操作" class="headerlink" title="删除变基操作"></a>删除变基操作</h3><p>rm -fr “.git&#x2F;rebase-merge”</p><h3 id="Q-A"><a href="#Q-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h3><p>1、错误 Error: spawn git ENOENT</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">// 设置 git 报错<br>I also <span class="hljs-built_in">get</span> <span class="hljs-keyword">the</span> error.<br>In <span class="hljs-keyword">the</span> settings.json <span class="hljs-keyword">of</span> vscode:<br><br><span class="hljs-string">&quot;git.path&quot;</span>: <span class="hljs-string">&quot;/user/bin/git&quot;</span><br></code></pre></td></tr></table></figure><h3 id="忽略文件提交-更改后，需清除本地缓存"><a href="#忽略文件提交-更改后，需清除本地缓存" class="headerlink" title="忽略文件提交 更改后，需清除本地缓存"></a>忽略文件提交 更改后，需清除本地缓存</h3><p>如下：</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">git rm --cache ./<span class="hljs-keyword">public</span>/env.config.js<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>指令</category>
      
    </categories>
    
    
    <tags>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-10-24-接口环境搭建yapi</title>
    <link href="/2025/11/28/2022-10-24-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91%E6%8E%A5%E5%8F%A3%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BAyapi/"/>
    <url>/2025/11/28/2022-10-24-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91%E6%8E%A5%E5%8F%A3%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BAyapi/</url>
    
    <content type="html"><![CDATA[<p><a href="https://blog.csdn.net/ChiChengIT/article/details/97560583">yapi 环境搭建</a></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Yapi是去哪儿网开源的一款接口管理工具。旨在为开发、产品、测试人员提供更优雅的接口管理服务。可以帮助开发者轻松创建、发布、维护 API。以及自动化生成接口文档。</p><h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><blockquote><p>操作系统：centos 7 环境要求：(若已有一下环境则可跳过)<br>nodejs&gt;7.6<br>mongodb&gt;2.6<br>git</p></blockquote><h2 id="1-安装nodejs-（建议安装低版本node-8-9-4）"><a href="#1-安装nodejs-（建议安装低版本node-8-9-4）" class="headerlink" title="1. 安装nodejs （建议安装低版本node 8.9.4）"></a>1. 安装nodejs （建议安装低版本node 8.9.4）</h2><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">yum <span class="hljs-keyword">install</span> nodejs<br></code></pre></td></tr></table></figure><p><strong>建议安装nvm</strong><br>命令方式安装nvm</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">curl -o- https:<span class="hljs-regexp">//</span>raw.githubusercontent.com<span class="hljs-regexp">/nvm-sh/</span>nvm<span class="hljs-regexp">/v0.35.2/i</span>nstall.sh | bash<br>或<br><br>wget -qO- https:<span class="hljs-regexp">//</span>raw.githubusercontent.com<span class="hljs-regexp">/nvm-sh/</span>nvm<span class="hljs-regexp">/v0.35.2/i</span>nstall.sh | bash<br>其中版本v0.<span class="hljs-number">35.2</span>可以在https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/nvm-sh/</span>nvm/releases中选择自己需要版本<br></code></pre></td></tr></table></figure><p>安装完成后在~&#x2F;.bashrc等配置文件中会出现一下配置(如果没有请自己新增)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> NVM_DIR=<span class="hljs-string">&quot;<span class="hljs-subst">$([ -z <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;XDG_CONFIG_HOME-&#125;</span>&quot;</span> ] &amp;&amp; printf %s <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;HOME&#125;</span>/.nvm&quot;</span> || printf %s <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;XDG_CONFIG_HOME&#125;</span>/nvm&quot;</span>)</span>&quot;</span><br>[ -s <span class="hljs-string">&quot;<span class="hljs-variable">$NVM_DIR</span>/nvm.sh&quot;</span> ] &amp;&amp; \. <span class="hljs-string">&quot;<span class="hljs-variable">$NVM_DIR</span>/nvm.sh&quot;</span> <span class="hljs-comment"># This loads nvm</span><br></code></pre></td></tr></table></figure><p>执行source ~&#x2F;.bashrc使配置生效</p><p>使用command -v nvm验证是否安装成功</p><p>使用nvm安装node，安装最新版本node</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">nvm install <span class="hljs-keyword">node</span> <br><span class="hljs-title">nvm</span> install v16.<span class="hljs-number">18.1</span> <br></code></pre></td></tr></table></figure><h2 id="2-安装mangodb"><a href="#2-安装mangodb" class="headerlink" title="2. 安装mangodb"></a>2. 安装mangodb</h2><p>安装5.0 <a href="https://www.cnblogs.com/hahaha111122222/p/15868006.html">https://www.cnblogs.com/hahaha111122222/p/15868006.html</a><br>卸载 <a href="https://www.yisu.com/ask/7617.html">https://www.yisu.com/ask/7617.html</a></p><ul><li>1、更新yum源，非必须但是更新一下无害</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">yum -<span class="hljs-attribute">y</span> update<br></code></pre></td></tr></table></figure><ul><li>2、添加mongodb源文件，在&#x2F;etc&#x2F;yum.repos.d 创建一个 mongodb-org.repo 文件</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">touch</span> /etc/yum.repos.d/mongodb-org.repo<br></code></pre></td></tr></table></figure><ul><li>3、编辑mongodb-org.repo文件</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">vim <span class="hljs-regexp">/etc/yum</span>.repos.d/mongodb-org.repo<br></code></pre></td></tr></table></figure><ul><li>4、添加文件内容</li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[mongodb-org]</span><br><span class="hljs-attr">name</span>=MongoDB Repository<br><span class="hljs-attr">baseurl</span>=http://mirrors.aliyun.com/mongodb/yum/redhat/<span class="hljs-number">7</span>Server/mongodb-org/<span class="hljs-number">6.0</span>/x<span class="hljs-number">86_64</span>/<br><span class="hljs-attr">gpgcheck</span>=<span class="hljs-number">0</span><br><span class="hljs-attr">enabled</span>=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><ul><li>5、安装mongodb</li></ul><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">yum <span class="hljs-keyword">install</span> -y mongodb-org<br></code></pre></td></tr></table></figure><ul><li>6、启动mongodb</li></ul><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">service mongod <span class="hljs-literal">start</span><br></code></pre></td></tr></table></figure><ul><li>7、设置开机启动</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">chkconfig</span> mongod <span class="hljs-literal">on</span><br></code></pre></td></tr></table></figure><ul><li>8、打开moMongoDB（可忽略）</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/bin/m</span>ongo<br></code></pre></td></tr></table></figure><ul><li>9、配置远程访问，修改mongod.conf配置文件</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">vim</span> /etc/mongod.conf<br><br>将 bindIp: <span class="hljs-number">127.0.0.1</span>  改为 bindIp: <span class="hljs-number">0.0.0.0</span><br><br>重启mongod执行 ：service mongod restart<br></code></pre></td></tr></table></figure><h2 id="3-安装git"><a href="#3-安装git" class="headerlink" title="3. 安装git"></a>3. 安装git</h2><p>官方推荐，在内网部署的时候安装git，可以根据自己所需安装</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">yum -y <span class="hljs-keyword">install</span> git<br></code></pre></td></tr></table></figure><h2 id="4-搭建yapi环境"><a href="#4-搭建yapi环境" class="headerlink" title="4. 搭建yapi环境"></a>4. 搭建yapi环境</h2><ul><li>1、准备环境搭建完成后，开始搭建Yapi，安装命令</li></ul><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-keyword">cd</span> <span class="hljs-string">/usr/local</span><br>npm install -g yapi-cli <span class="hljs-params">--registry</span> https:<span class="hljs-string">//registry.npm.taobao.org</span><br>yapi server<br></code></pre></td></tr></table></figure><p><img src="/assets/images/yapi/yapi1.png" alt="安装yapi"></p><ul><li>2、执行 yapi server 启动可视化部署程序，浏览器打开提示窗口上的地址9090端口，非本地服务器，将0.0.0.0替换指定的域名或IP，进入部署页面。<br><img src="/assets/images/yapi/yapi2.png" alt="启动yapi部署配置"></li><li>3、根据项目实际需要可以修改部署信息，点击【开始部署】，完成部署任务，部署成功截图<br>可能会出错，报错信息如下：<br><img src="/assets/images/yapi/yapi3.png" alt="部署报错提示"></li><li>原因：yapi.demo.qunar.com 这个域名服务器挂了</li><li>修改方式：选择新部署版本重新部署，默认1.4.1 改为1.10.2即可</li><li>4、根据部署日志截图上的提示信息<br><strong>启动服务</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> usr/local/my-yapi <span class="hljs-comment"># 进入到自己的 yapi 里的当前目录</span><br>node vendors/server/app.js<br><br>账号<span class="hljs-string">&quot;827516789@qq.com&quot;</span>，密码：<span class="hljs-string">&quot;ymfe.org&quot;</span><br></code></pre></td></tr></table></figure><p><strong>启动服务（以守护进程启动）</strong></p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-keyword">node</span> <span class="hljs-title">vendors</span>/server/app.js &amp;<br></code></pre></td></tr></table></figure><p>浏览器打开部署日志上的访问地址<a href="http://127.0.0.1:3000就可以访问搭建的YApi工具了（非本地服务器，将127.0.0.1替换指定的域名或IP），此时YApi环境搭建完。">http://127.0.0.1:3000就可以访问搭建的YApi工具了（非本地服务器，将127.0.0.1替换指定的域名或IP），此时YApi环境搭建完。</a></p><ul><li>5、pm2方式管理进程（避免终端断开，杀死进程）</li></ul><p>要保证后台保持进程，需要安装pm2。</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">全局安装：<br>npm install -g pm2<br><br>启动：<br>cd /usr/<span class="hljs-keyword">local</span>/my-yapi/vendors<br>pm2 <span class="hljs-keyword">start</span> <span class="hljs-keyword">server</span>/app.js <span class="hljs-comment">--watch</span><br><br>重启：<br><br>pm2 <span class="hljs-keyword">restart</span> <span class="hljs-keyword">server</span>/app.js<br><br>停止：<br><br>可以先通过pm2 list获取应用的名字（<span class="hljs-comment">--name指定的）或者进程id。</span><br><br>pm2 stop app_name|app_id<br></code></pre></td></tr></table></figure><p>pm2使用参考文档：<br><a href="http://imweb.io/topic/57c8cbb27f226f687b365636">http://imweb.io/topic/57c8cbb27f226f687b365636</a></p><p>6.升级</p><p>升级项目版本是非常容易的，并且不会影响已有的项目数据，只会同步 vendors 目录下的源码文件。</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stata"><span class="hljs-keyword">cd</span>  &#123;项目目录&#125;<br>yapi <span class="hljs-keyword">ls</span> <span class="hljs-comment">//查看版本号列表</span><br>yapi <span class="hljs-keyword">update</span> <span class="hljs-comment">//更新到最新版本</span><br>yapi <span class="hljs-keyword">update</span> -v &#123;<span class="hljs-keyword">Version</span>&#125; <span class="hljs-comment">//更新到指定版本</span><br></code></pre></td></tr></table></figure><p>9.nginx代理</p><p>如果您是将服务器代理到 nginx 服务器，请配置 nginx 支持 websocket。</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">在<span class="hljs-keyword">location</span> <span class="hljs-title">/添加</span><br><span class="hljs-title">proxy_http_version</span> <span class="hljs-number">1.1</span>;<br>proxy_set_header Upgrade $http_upgrade;<br>proxy_set_header Connection <span class="hljs-string">&quot;upgrade&quot;</span>;<br></code></pre></td></tr></table></figure><p>10.禁止注册</p><p>在 config.json 添加 closeRegister:true 配置项,就可以禁止用户注册 yapi 平台，修改完成后，请重启 yapi 服务器。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;*****&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;closeRegister&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p><a href="http://wcmc.csu.edu.cn/doc/wcmc-GitLab%20User%20Guide.pdf">gitlab私服搭建</a></p>]]></content>
    
    
    <categories>
      
      <category>前端工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>yapi</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-10-10-git常用操作</title>
    <link href="/2025/11/28/2022-10-10-git%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/"/>
    <url>/2025/11/28/2022-10-10-git%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/</url>
    
    <content type="html"><![CDATA[<h1 id="git-常用操作指令"><a href="#git-常用操作指令" class="headerlink" title="git 常用操作指令"></a>git 常用操作指令</h1><h3 id="1-Tag-管理"><a href="#1-Tag-管理" class="headerlink" title="1. Tag 管理"></a>1. Tag 管理</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">git tag // 查看本地tag</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git ls-remote --tag // 查看远程所有标签</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git tag v1.1.0 // 给当前分支打标签</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git tag v1.0.0 039bf8b -m <span class="hljs-string">&quot;add tags information&quot;</span> // 给特定的某个commit版本打标签，-m 可选</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git tag -d v1.0.0 // 删除本地某个标签</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git push origin -d v1.0.0 // 删除远程的某个标签</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git push --tag // 将本地标签一次性推送到远程</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git push origin v1.0.0 // 将本地某个特定标签推送到远程</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git show v1.0.0 // 查看某一个标签的提交信息</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git checkout 12345678 -b newBranch // 根据某个commit创建本地分支</span><br></code></pre></td></tr></table></figure><h3 id="2-git-flow"><a href="#2-git-flow" class="headerlink" title="2. git flow"></a>2. git flow</h3><p><a href="https://blog.csdn.net/lzxlfly/article/details/92413220">git flow 代码管理及分支创建合并</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">## https://www.atlassian.com/git/tutorials/comparing-workflows/gitflow-workflow</span></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git flow init</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git flow feature start feature_branch === git checkout develop &amp;&amp; git checkout -b feature_branch</span><br>// 可用类型如下：feature / release / hotfix / support<br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git flow feature finish feature_branch === git checkout develop &amp;&amp; git merge feature_branch</span><br></code></pre></td></tr></table></figure><h3 id="3-GIT-远程代码合并"><a href="#3-GIT-远程代码合并" class="headerlink" title="3. GIT 远程代码合并"></a>3. GIT 远程代码合并</h3><h4 id="3-1-下载需要合并的分支"><a href="#3-1-下载需要合并的分支" class="headerlink" title="3.1 下载需要合并的分支"></a>3.1 下载需要合并的分支</h4><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">$ git <span class="hljs-keyword">clone</span> <span class="hljs-title">https</span>://gitee.com/alingfly/ASF_Test.git<br></code></pre></td></tr></table></figure><h4 id="3-2-添加需要合并远程仓库"><a href="#3-2-添加需要合并远程仓库" class="headerlink" title="3.2 添加需要合并远程仓库"></a>3.2 添加需要合并远程仓库</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp">$ git remote <span class="hljs-keyword">add</span> <span class="hljs-keyword">base</span> https:<span class="hljs-comment">//github.com/AClumsy/ASF.git</span><br></code></pre></td></tr></table></figure><p>将 <code>base</code>作为远程仓库，添加到 <code>本地仓库(origin)</code>中，设置别名为 <code>base</code>(自定义，这里我是为了方便区分仓库名)</p><h4 id="3-3-把base远程仓库中数据抓取到本仓库"><a href="#3-3-把base远程仓库中数据抓取到本仓库" class="headerlink" title="3.3 把base远程仓库中数据抓取到本仓库"></a>3.3 把<code>base</code>远程仓库中数据抓取到本仓库</h4><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">$ git fetch base  From https://github.com/AClumsy/ASF    * [new branch]      <span class="hljs-keyword">master</span>     <span class="hljs-title">-&gt; base</span>/<span class="hljs-literal">master</span><br></code></pre></td></tr></table></figure><h4 id="3-4-checkout切换到base分支上，命名为-asf"><a href="#3-4-checkout切换到base分支上，命名为-asf" class="headerlink" title="3.4 checkout切换到base分支上，命名为 asf"></a>3.4 <code>checkout</code>切换到<code>base</code>分支上，命名为 <code>asf</code></h4><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">$ git checkout -b asf base/master  Switched <span class="hljs-built_in">to</span> <span class="hljs-keyword">a</span> <span class="hljs-built_in">new</span> branch <span class="hljs-string">&#x27;asf&#x27;</span>  Branch <span class="hljs-string">&#x27;asf&#x27;</span> <span class="hljs-built_in">set</span> up <span class="hljs-built_in">to</span> track remote branch <span class="hljs-string">&#x27;master&#x27;</span> <span class="hljs-built_in">from</span> <span class="hljs-string">&#x27;base&#x27;</span>. <span class="hljs-comment"> //查看一下所有分支$ git branch * asf  asf_test</span><br></code></pre></td></tr></table></figure><p>由于我们需要把<code>asf</code>分支合并到<code>asf_test</code>分支中去，我们在切换到<code>asf_test</code>分支。</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crystal"><span class="hljs-variable">$ </span>git checkout asf_test<br></code></pre></td></tr></table></figure><h4 id="3-5-合并"><a href="#3-5-合并" class="headerlink" title="3.5 合并"></a>3.5 合并</h4><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cos">$ git <span class="hljs-keyword">merge</span> asf<br></code></pre></td></tr></table></figure><p>合并完成之后会出现很多冲突，需要在本地代码中解决冲突，然后在提交到<code>ASF_Test</code>中去。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">git push origin asf_test // 上传asf_test 分支到远程库</span><br></code></pre></td></tr></table></figure><h4 id="完整-分支同步过程"><a href="#完整-分支同步过程" class="headerlink" title="完整 分支同步过程"></a>完整 分支同步过程</h4><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">git <span class="hljs-keyword">clone </span>本地仓库（合并源）<br>git remote <span class="hljs-keyword">add </span><span class="hljs-keyword">base </span>期望被合并仓库<br>git fetch <span class="hljs-keyword">base</span><br><span class="hljs-keyword"></span>git push <span class="hljs-keyword">base </span><span class="hljs-built_in">v1</span>.<span class="hljs-number">6</span><br>git remote rm <span class="hljs-keyword">origin</span><br></code></pre></td></tr></table></figure><h3 id="4-不同分支-commit-同步"><a href="#4-不同分支-commit-同步" class="headerlink" title="4. 不同分支 commit 同步"></a>4. 不同分支 commit 同步</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">1. 切换到需要 合入 commit 的分支<br>2. cherry-pick 提交，并解决冲突后，push<br>$ git cherry-pick commitID<br></code></pre></td></tr></table></figure><h3 id="5-常用代码指令"><a href="#5-常用代码指令" class="headerlink" title="5. 常用代码指令"></a>5. 常用代码指令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">git log<br>git status<br>git add .<br>git commit -m &quot;&quot;<br>// 设置别名<br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git config --global alias.co checkout</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git config --global alias.ci commit</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git config --global alias.br branch</span><br></code></pre></td></tr></table></figure><h3 id="6-更新-gitignore-文件配置【技巧】"><a href="#6-更新-gitignore-文件配置【技巧】" class="headerlink" title="6. 更新 .gitignore 文件配置【技巧】"></a>6. 更新 <strong>.gitignore</strong> 文件配置【技巧】</h3><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-comment"># 删除git 缓存</span><br>git rm -r <span class="hljs-params">--cached</span> .<br>git add .<br>git commit -m &#x27;update <span class="hljs-string">.gitignore</span>&#x27;<br><br>配置语法：<br>　　以斜杠“/”开头表示目录；<br>　　以星号“*”通配多个字符；<br>　　以问号“?”通配单个字符<br>　　以方括号“[]”包含单个字符的匹配列表；<br>　　以叹号“!”表示不忽略<span class="hljs-params">(跟踪)</span>匹配到的文件或目录；<br>　　此外，git 对于 <span class="hljs-string">.ignore</span> 配置文件是按行从上到下进行规则匹配的，意味着如果前面的规则匹配的范围更大，则后面的规则将不会生效；<br></code></pre></td></tr></table></figure><h3 id="7-分支合并"><a href="#7-分支合并" class="headerlink" title="7. 分支合并"></a>7. 分支合并</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">git merge fixes enhancements // 合并分支`fixes`和`enhancements`在当前分支的顶部</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git merge -s ours obsolete // 合并`obsolete`分支到当前分支，使用`ours`合并策略</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git merge --no-commit maint // 将分支`maint`合并到当前分支中，但不要自动进行新的提交</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git merge dev // 将分支`dev`合并到当前分支中，自动进行新的提交</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">定期合并 dev分支到 当前分支</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git checkout feature/31124-190618 <span class="hljs-comment">#切换到feature/31124-190618分支</span></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git merge --no-ff develop <span class="hljs-comment">#把dev代码合并大feature</span></span><br></code></pre></td></tr></table></figure><h3 id="8-Git-分支管理"><a href="#8-Git-分支管理" class="headerlink" title="8. Git 分支管理"></a>8. Git 分支管理</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">查看本地分支</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git branch</span><br>* master<br><span class="hljs-meta prompt_"># </span><span class="language-bash">创建分支</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git branch testing</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git branch</span><br>* master<br>  testing<br><span class="hljs-meta prompt_"># </span><span class="language-bash">分支切换，使用 git checkout -b (branchname) 命令来创建新分支并立即切换到该分支下</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git checkout -b newtest</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git checkout master</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">删除分支</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git branch -d (branchname)</span><br></code></pre></td></tr></table></figure><h3 id="9-子模块"><a href="#9-子模块" class="headerlink" title="9. 子模块"></a>9. 子模块</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs shell">git submodule update --init  //初始化版本<br><span class="hljs-meta prompt_"># </span><span class="language-bash">下载子项目</span><br>git submodule add https://e.coding.net/govindustry/hrss/hrss-web-comm.git src/hrss-web-comm<br><span class="hljs-meta prompt_"># </span><span class="language-bash">克隆项目后，默认子模块目录下无任何内容。需要在项目根目录执行如下命令完成子模块的下载：</span><br>git submodule init<br>git submodule update<br><span class="hljs-meta prompt_"># </span><span class="language-bash">或者</span><br>git submodule update --init --recursive<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">如果给 git <span class="hljs-built_in">clone</span> 命令传递 --recurse-submodules 选项，它就会自动初始化并更新仓库中的每一个子模块， 包括可能存在的嵌套子模块。</span><br>git clone --recurse-submodules https://e.coding.net/govindustry/hrss/hrss-web-comm.git src/hrss-web-comm<br>git submodule update --remote  //更新到最新版本<br><span class="hljs-meta prompt_">#</span><span class="language-bash">查看修改内容可以看到增加了子模块，并且新文件下为子模块的提交<span class="hljs-built_in">hash</span>摘要</span><br>git diff --cached<br><br>子模块的更新<br>子模块的维护者提交了更新后，使用子模块的项目必须手动更新才能包含最新的提交。<br><br>在项目中，进入到子模块目录下，执行 git pull更新，查看git log查看相应提交。<br><br>完成后返回到项目目录，可以看到子模块有待提交的更新，使用git add，提交即可。<br><br>删除子模块<br>有时子模块的项目维护地址发生了变化，或者需要替换子模块，就需要删除原有的子模块。<br><br>删除子模块较复杂，步骤如下：<br><br>rm -rf 子模块目录 删除子模块目录及源码<br>vi .gitmodules 删除项目目录下.gitmodules文件中子模块相关条目<br>vi .git/config 删除配置项中子模块相关条目<br>rm .git/module/* 删除模块下的子模块目录，每个子模块对应一个目录，注意只删除对应的子模块目录即可<br><br></code></pre></td></tr></table></figure><h3 id="10-查看配置"><a href="#10-查看配置" class="headerlink" title="10. 查看配置"></a>10. 查看配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">查看用户名 ：git config user.name<br>查看密码： git config user.password<br>查看邮箱：git config user.email<br>查看配置信息： $ git config --list<br><span class="hljs-meta prompt_"># </span><span class="language-bash">修改所有的 name 和 email</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git config --global --replace-all user.name <span class="hljs-string">&quot;你的 git 的名称&quot;</span></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git config --global --replace-all uesr.email <span class="hljs-string">&quot;你的 git 的邮箱&quot;</span></span><br></code></pre></td></tr></table></figure><p>注意： coding 每一个团队下都需要配置一次 ssh 公钥</p><p>![image-20210827105306454](&#x2F;Users&#x2F;sunny&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20210827105306454.png)</p><h3 id="11-无痕删除-commit"><a href="#11-无痕删除-commit" class="headerlink" title="11. 无痕删除 commit"></a>11. 无痕删除 commit</h3><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs gauss"><span class="hljs-meta"># 1、查看提交日志</span><br>git <span class="hljs-built_in">log</span><br><span class="hljs-meta"># 2、然后执行如下的命令：</span><br>git rebase -i commit号<br><span class="hljs-meta"># 3.然后将要删除的 commit号 的前缀 `pick` 改为 `drop`。(最顶部)</span><br>pick xxx =》 <span class="hljs-built_in">drop</span> xxx<br><span class="hljs-meta"># 4.然后可以通过如下命令再次查看是否已经删除：</span><br>git <span class="hljs-built_in">log</span><br><span class="hljs-meta"># 5.最后通过如下命令将现在的状态推送到远程仓库即可：</span><br>git <span class="hljs-keyword">push</span> origin HEAD --force<br></code></pre></td></tr></table></figure><p><a href="https://cloud.tencent.com/developer/article/1511875">https://cloud.tencent.com/developer/article/1511875</a></p><ul><li><p>删除最后一条提交</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs aspectj">git reset --<span class="hljs-keyword">soft</span> HEAD~<span class="hljs-number">1</span><br><span class="hljs-comment">// HEAD^的意思是上一个版本，也可以写成HEAD~1</span><br><span class="hljs-comment">//如果你进行了2次commit，想都撤回，可以使用HEAD~2</span><br></code></pre></td></tr></table></figure></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js">--mixed<br>意思是：不删除工作空间改动代码，撤销commit，并且撤销git add . 操作<br>这个为默认参数,git reset --mixed <span class="hljs-variable constant_">HEAD</span>^ 和 git reset <span class="hljs-variable constant_">HEAD</span>^ 效果是一样的。<br><br><br>--soft<br>不删除工作空间改动代码，撤销commit，不撤销git add .<br><br>--hard<br>删除工作空间改动代码，撤销commit，撤销git add .<br><br>注意完成这个操作后，就恢复到了上一次的commit状态。<br><br>顺便说一下，如果commit注释写错了，只是想改一下注释，只需要：<br>git commit --amend<br><br>此时会进入默认vim编辑器，修改注释完毕后保存就好了。<br></code></pre></td></tr></table></figure><h3 id="12-还原本地分支"><a href="#12-还原本地分支" class="headerlink" title="12.还原本地分支"></a>12.还原本地分支</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">git <span class="hljs-keyword">fetch</span> <span class="hljs-comment">--all</span><br>origin/master为想恢复的分支名称，这里是github默认主分支<br>git <span class="hljs-keyword">reset</span> <span class="hljs-comment">--hard origin/master</span><br>git最新改版变成下面，弃用master改为main<br>git <span class="hljs-keyword">reset</span> <span class="hljs-comment">--hard origin/main</span><br>git pull<br></code></pre></td></tr></table></figure><h3 id="13-删除分支"><a href="#13-删除分支" class="headerlink" title="13. 删除分支"></a>13. 删除分支</h3><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs clean"># 删除本地分支大写的 D<br>git branch -D 要删除的分支名<br>### 批量清理本地分支<br>git branch | grep <span class="hljs-string">&#x27;qa&#x27;</span> | xargs git branch -d<br><br># 删除远程分支<br>git push origin --delete 要删除的分支名<br>### 批量删除远程分支<br>cd .git/refs/remotes/ 删除origin文件夹<br></code></pre></td></tr></table></figure><h3 id="git-统计代码行数"><a href="#git-统计代码行数" class="headerlink" title="git 统计代码行数"></a>git 统计代码行数</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">git</span> log --pretty=tformat: --numstat | awk &#x27;&#123; add += $<span class="hljs-number">1</span>; subs += $<span class="hljs-number">2</span>; loc += $<span class="hljs-number">1</span> - $<span class="hljs-number">2</span> &#125; END &#123; printf <span class="hljs-string">&quot;added lines: %s, removed lines: %s, total lines: %s\n&quot;</span>, add, subs, loc &#125;&#x27; -<br><span class="hljs-attribute">1</span>. git ls-files | xargs wc -l<br><span class="hljs-attribute">2</span>. 使用cloc工具 安装：npm install -g cloc 执行：cloc .\src\ .\config<span class="hljs-punctuation">\</span><br><span class="hljs-punctuation"></span><span class="hljs-number">3</span>. 使用vscode插件统计：VSCodeCounter<br></code></pre></td></tr></table></figure><h3 id="删除变基操作"><a href="#删除变基操作" class="headerlink" title="删除变基操作"></a>删除变基操作</h3><p>rm -fr “.git&#x2F;rebase-merge”</p><h3 id="代码统计指令"><a href="#代码统计指令" class="headerlink" title="代码统计指令"></a>代码统计指令</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs swift">读取每一行日志并分成数个字段进行处理，并在处理完成后执行<span class="hljs-type">END指定的命令输出汇总信息</span><br><br>awk &#x27;&#123; add <span class="hljs-operator">+=</span> <span class="hljs-variable">$1</span>; subs <span class="hljs-operator">+=</span> <span class="hljs-variable">$2</span>; loc <span class="hljs-operator">+=</span> <span class="hljs-variable">$1</span> <span class="hljs-operator">-</span> <span class="hljs-variable">$2</span> &#125; <span class="hljs-type">END</span> &#123; printf <span class="hljs-string">&quot;added lines: %s, removed lines: %s, total lines: %s<span class="hljs-subst">\n</span>&quot;</span>, add, subs, loc &#125;&#x27;<br><span class="hljs-number">2</span>. 统计一定时间内产生的代码行数<br>git log <span class="hljs-operator">--</span>since<span class="hljs-operator">=</span><span class="hljs-number">2019</span><span class="hljs-operator">-</span><span class="hljs-number">01</span><span class="hljs-operator">-</span><span class="hljs-number">01</span> <span class="hljs-operator">--</span>until<span class="hljs-operator">==</span><span class="hljs-number">2019</span><span class="hljs-operator">-</span><span class="hljs-number">12</span><span class="hljs-operator">-</span><span class="hljs-number">31</span> <span class="hljs-operator">--</span>pretty<span class="hljs-operator">=</span>tformat: <span class="hljs-operator">--</span>numstat <span class="hljs-operator">|</span> awk &#x27;&#123; add <span class="hljs-operator">+=</span> <span class="hljs-variable">$1</span>; subs <span class="hljs-operator">+=</span> <span class="hljs-variable">$2</span>; loc <span class="hljs-operator">+=</span> <span class="hljs-variable">$1</span> <span class="hljs-operator">-</span> <span class="hljs-variable">$2</span> &#125; <span class="hljs-type">END</span> &#123; printf <span class="hljs-string">&quot;added lines: %s, removed lines: %s, total lines: %s<span class="hljs-subst">\n</span>&quot;</span>, add, subs, loc &#125;&#x27;<br><span class="hljs-number">3</span>. 统计指定开发者一段时间内产生的代码行数<br>git log <span class="hljs-operator">--</span>since <span class="hljs-operator">=</span><span class="hljs-number">2019</span><span class="hljs-operator">-</span><span class="hljs-number">01</span><span class="hljs-operator">-</span><span class="hljs-number">01</span> <span class="hljs-operator">--</span>until<span class="hljs-operator">==</span><span class="hljs-number">2019</span><span class="hljs-operator">-</span><span class="hljs-number">12</span><span class="hljs-operator">-</span><span class="hljs-number">31</span> <span class="hljs-operator">--</span>author<span class="hljs-operator">=</span><span class="hljs-string">&quot;psr&quot;</span> <span class="hljs-operator">--</span>pretty<span class="hljs-operator">=</span>tformat: <span class="hljs-operator">--</span>numstat <span class="hljs-operator">|</span> awk &#x27;&#123; add <span class="hljs-operator">+=</span> <span class="hljs-variable">$1</span>; subs <span class="hljs-operator">+=</span> <span class="hljs-variable">$2</span>; loc <span class="hljs-operator">+=</span> <span class="hljs-variable">$1</span> <span class="hljs-operator">-</span> <span class="hljs-variable">$2</span> &#125; <span class="hljs-type">END</span> &#123; printf <span class="hljs-string">&quot;added lines: %s, removed lines: %s, total lines: %s<span class="hljs-subst">\n</span>&quot;</span>, add, subs, loc &#125;&#x27;<br></code></pre></td></tr></table></figure><h3 id="Q-A"><a href="#Q-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h3><p>1、错误 Error: spawn git ENOENT</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">// 设置 git 报错<br>I also <span class="hljs-built_in">get</span> <span class="hljs-keyword">the</span> error.<br>In <span class="hljs-keyword">the</span> settings.json <span class="hljs-keyword">of</span> vscode:<br><br><span class="hljs-string">&quot;git.path&quot;</span>: <span class="hljs-string">&quot;/user/bin/git&quot;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>指令</category>
      
    </categories>
    
    
    <tags>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-08-22-nginx配置</title>
    <link href="/2025/11/28/2022-08-22-%E3%80%90%E9%83%A8%E7%BD%B2%E3%80%91nginx%E9%85%8D%E7%BD%AE/"/>
    <url>/2025/11/28/2022-08-22-%E3%80%90%E9%83%A8%E7%BD%B2%E3%80%91nginx%E9%85%8D%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<h3 id="1-root"><a href="#1-root" class="headerlink" title="1. root"></a>1. root</h3><p>语法：root path<br>配置段：<code>http、server、location、if</code></p><p>root的处理结果是：root路径＋location路径</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">location <span class="hljs-regexp">/t/</span> &#123;<br>     root <span class="hljs-regexp">/www/</span>root<span class="hljs-regexp">/html/</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>请求的URI是&#x2F;t&#x2F;a.html时，web服务器将会返回服务器上的&#x2F;www&#x2F;root&#x2F;html&#x2F;t&#x2F;a.html的文件。</p><h3 id="2-alias"><a href="#2-alias" class="headerlink" title="2.alias"></a>2.alias</h3><p>语法：alias path<br>配置段：location</p><p>alias的处理结果是：使用alias路径替换location路径<br>alias后面必须要用“&#x2F;”结束，否则会找不到文件的。。。而root则可有可无</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">location <span class="hljs-regexp">/t/</span> &#123;<br> alias <span class="hljs-regexp">/www/</span>root<span class="hljs-regexp">/html/</span>new_t/;<br>&#125;<br></code></pre></td></tr></table></figure><p>请求的URI是&#x2F;t&#x2F;a.html时，web服务器将会返回服务器上的&#x2F;www&#x2F;root&#x2F;html&#x2F;new_t&#x2F;a.html的文件。</p><h3 id="3-try-files"><a href="#3-try-files" class="headerlink" title="3.try_files"></a>3.try_files</h3><p>语法：try_files 文件路径… 重写的uri<br>配置段：server location</p><p>try_files后面至少要有一个文件路径一个重写uri。<br>查找路径是按照给定的root或alias为根路径来查找的；<br>如果给出的file都没有匹配到，则会进行一个内部重定向到最后一个参数给定的uri，就是新的location匹配；<br>最后一个参数是回退URI且必须存在，否则会出现内部500错误；</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> / &#123;<br>  <span class="hljs-attribute">root</span> /data/dist;<br>  <span class="hljs-attribute">try_files</span> <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /index.html<br>  expires <span class="hljs-number">7d</span>; <span class="hljs-comment"># expires 是nginx控制缓存的一种方式，7d=7天。</span><br>&#125;<br></code></pre></td></tr></table></figure><p>访问<a href="http://localhost/example?a=1%E6%97%B6$uri%E4%B8%BA/example%EF%BC%8C$request_uri%E5%8C%85%E6%8B%ACURI%E5%8F%82%E6%95%B0%E4%B8%BA/example?a=1%EF%BC%8C%E5%A4%84%E7%90%86%E9%A1%BA%E5%BA%8F%E6%98%AF%EF%BC%9A">http://localhost/example?a=1时$uri为/example，$request_uri包括URI参数为/example?a=1，处理顺序是：</a></p><p>$uri是指&#x2F;example文件, 会先找root目录&#x2F;data&#x2F;dist下的&#x2F;example文件，也就是&#x2F;data&#x2F;dist&#x2F;example这个文件，找到直接返回。<br>$uri&#x2F;也就是&#x2F;example&#x2F;目录，找不到再尝试找&#x2F;data&#x2F;dist&#x2F;example&#x2F;目录下的index开头的文件，找到直接返回。<br>如果前面文件都没匹配找到，就会 fallback 到 try_files 的最后一个选项 &#x2F;index.html，发起一个内部 “子请求”，也就是相当于 nginx 发起一个 HTTP 请求到 <a href="http://localhost/index.html%E3%80%82%E9%87%8D%E6%96%B0%E5%8C%B9%E9%85%8Dlocation%E3%80%82">http://localhost/index.html。重新匹配location。</a></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> / &#123;<br>  <span class="hljs-attribute">try_files</span> /app/cache/ <span class="hljs-variable">$uri</span> <span class="hljs-variable">@fallback</span>;<br>  <span class="hljs-attribute">index</span> index.php index.html;<br>&#125;<br><br><span class="hljs-section">location</span> <span class="hljs-variable">@fallback</span> &#123;<br>  <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/(.*)$</span> http://www.baidu.com <span class="hljs-comment"># 跳转到百度，和try_files最后一个参数作用相同。</span><br>&#125;<br></code></pre></td></tr></table></figure><h1 id="sub-filter-过滤及替换响应内容"><a href="#sub-filter-过滤及替换响应内容" class="headerlink" title="sub_filter 过滤及替换响应内容"></a>sub_filter 过滤及替换响应内容</h1><p>Accept-Encoding 设为空值，以禁用压缩，是因为 sub_filter 只能处理未经压缩的内容；又 sub_filter 一般只替换 text&#x2F;html 且仅工作一次，不符合需求，故对配置稍做微调。</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs lasso">location / &#123;<br>    <span class="hljs-params">...</span> <br>    proxy_set_header Accept<span class="hljs-params">-Encoding</span> <span class="hljs-string">&#x27;&#x27;</span>;<br>    sub_filter_types *;<br>    sub_filter_once off;<br>    sub_filter <span class="hljs-string">&#x27;查找内容：源站域名&#x27;</span> <span class="hljs-string">&#x27;替换为：反代站域名&#x27;</span>;<br>    <span class="hljs-params">...</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="rewrite-和-location"><a href="#rewrite-和-location" class="headerlink" title="rewrite 和 location"></a>rewrite 和 location</h3><p>表面看 rewrite 和 location 功能有点像，都能实现跳转，主要区别在于 rewrite 是在同一域名内更改获取资源的路径，而 location 是对一类路径做控制访问或反向代理，可以 proxy_pass 到其他机器。很多情况下 rewrite 也会写在 location 里，它们的执行顺序是：</p><p>执行 server 块的 rewrite 指令（这里的块指的是 server 关键字后{}包围的区域，其它 xx 块类似）<br>执行location匹配<br>执行选定的location中的rewrite指令<br>如果其中某步 URI 被重写，则重新循环执行1-3，直到找到真实存在的文件；<br>如果循环超过 10 次，则返回 500 Internal Server Error 错误。</p><p>匹配不到的话，重定向到 @fallback，然后重写到百度。</p><h4 id="location-优先级介绍"><a href="#location-优先级介绍" class="headerlink" title="location 优先级介绍"></a>location 优先级介绍</h4><p>location 匹配方式有以下几种</p><ol><li>location &#x3D; &#x2F;path&#x2F;a&#x2F;exact.png {}: 精确匹配</li><li>location ^~ &#x2F;path&#x2F;a&#x2F; {}: 优先前缀匹配（符合最长匹配原则）</li><li>location ~ &#x2F;Path?&#x2F; {} ： 区分大小写正则匹配（首次匹配原则）</li><li>location ~* &#x2F;path?&#x2F; {} : 不区分大小写正则匹配（首次匹配原则）</li><li>location &#x2F;path&#x2F;a&#x2F;test.png {} : 前缀匹配（符合最长匹配原则）</li><li>location 优先级匹配与配置的先后顺序无关，优先级排列顺序如下</li></ol><p>精确匹配 &gt; 优先前缀匹配 &gt; 区分大小写正则匹配&#x3D;不区分大小写正则匹配 &gt; 前缀匹配</p><h3 id="rewrite-指令"><a href="#rewrite-指令" class="headerlink" title="rewrite 指令"></a>rewrite 指令</h3><p>语法：rewrite regex replacement [flag];<br>作用域：server 、location、if<br>功能：如果一个URI匹配指定的正则表达式regex，URI就按照 replacement 重写。</p><p>rewrite 按配置文件中出现的顺序执行。可以使用 flag 标志来终止指令的进一步处理。</p><p>如果 replacement 以 http:&#x2F;&#x2F; 、 https:&#x2F;&#x2F; 或 $ scheme 开始，将不再继续处理，这个重定向将返回给客户端。<br>示例：第一种情况，重写的字符串带 http:&#x2F;&#x2F;</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span><span class="hljs-regexp"> ^~</span> /redirect &#123;<br>    <span class="hljs-comment"># 当匹配前缀表达式 /redirect/(.*)时 请求将被临时重定向到 http://www.$1.com</span><br>    <span class="hljs-comment"># 相当于 flag 写为 redirect</span><br>    <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/(.*)$</span> http://www.<span class="hljs-variable">$1</span>.com;<br>    <span class="hljs-attribute">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&quot;ok&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>在浏览器中输入 127.0.0.1:8080&#x2F;redirect&#x2F;baidu ，则临时重定向到 <a href="http://www.baidu.com/">www.baidu.com</a> 后面的 return 指令将没有机会执行了。</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span><span class="hljs-regexp"> ^~</span> /redirect &#123;<br>    <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/(.*)$</span> www.<span class="hljs-variable">$1</span>.com;<br>    <span class="hljs-attribute">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&quot;ok&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="发送请求如下"><a href="#发送请求如下" class="headerlink" title="发送请求如下"></a>发送请求如下</h1><h1 id="curl-127-0-0-1-8080-redirect-baidu"><a href="#curl-127-0-0-1-8080-redirect-baidu" class="headerlink" title="curl 127.0.0.1:8080&#x2F;redirect&#x2F;baidu"></a>curl 127.0.0.1:8080&#x2F;redirect&#x2F;baidu</h1><h1 id="ok"><a href="#ok" class="headerlink" title="ok"></a>ok</h1><p>此处没有带 http:&#x2F;&#x2F; 所以只是简单的重写。请求的 URI 由 &#x2F;test1&#x2F;baidu 重写为 <a href="http://www.baidu.com/">www.baidu.com</a> 因为会顺序执行 rewrite 指令，所以 下一步执行 return 指令，响应后返回 ok</p><p>flag 有四种参数可以选择：</p><p>last 停止处理后续 rewrite 指令集，然后对当前重写的新 URI 在 rewrite 指令集上重新查找。<br>break 停止处理后续 rewrite 指令集，并不再重新查找，但是当前location 内剩余非 rewrite 语句和 location 外的 非rewrite 语句可以执行。<br>redirect 如果 replacement 不是以 http:&#x2F;&#x2F; 或 https:&#x2F;&#x2F; 开始，返回 302 临时重定向<br>permanent 返回 301 永久重定向<br>示例 1：</p><h1 id="rewrite-后面没有任何-flag-时就顺序执行"><a href="#rewrite-后面没有任何-flag-时就顺序执行" class="headerlink" title="rewrite 后面没有任何 flag 时就顺序执行"></a>rewrite 后面没有任何 flag 时就顺序执行</h1><h1 id="当-location-中没有-rewrite-模块指令可被执行时-就重写发起新一轮location-匹配"><a href="#当-location-中没有-rewrite-模块指令可被执行时-就重写发起新一轮location-匹配" class="headerlink" title="当 location 中没有 rewrite 模块指令可被执行时 就重写发起新一轮location 匹配"></a>当 location 中没有 rewrite 模块指令可被执行时 就重写发起新一轮location 匹配</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">location / &#123;<br>    <span class="hljs-comment"># 顺序执行如下两条rewrite指令 </span><br>    rewrite ^/test1 /test2;<br>    rewrite ^/test2 /test3;  <span class="hljs-comment"># 此处发起新一轮 location 匹配 URI为/test3</span><br>&#125;<br><br>location = /test2 &#123;<br>    <span class="hljs-built_in">return</span> 200 “/test2”;<br>&#125;  <br><br>location = /test3 &#123;<br>    <span class="hljs-built_in">return</span> 200 “/test3”;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="发送如下请求"><a href="#发送如下请求" class="headerlink" title="发送如下请求"></a>发送如下请求</h1><h1 id="curl-127-0-0-1-8080-test1"><a href="#curl-127-0-0-1-8080-test1" class="headerlink" title="curl 127.0.0.1:8080&#x2F;test1"></a>curl 127.0.0.1:8080&#x2F;test1</h1><h1 id="test3"><a href="#test3" class="headerlink" title="&#x2F;test3"></a>&#x2F;test3</h1><p>如果正则表达regex式中包含 “}” 或 “;”，那么整个表达式需要用双引号或单引号包围。</p><p>示例 2：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> / &#123;<br>    <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/test1</span> /test2;<br>    <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/test2</span> /test3 <span class="hljs-literal">last</span>;  <span class="hljs-comment"># 此处发起新一轮location匹配 uri为/test3</span><br>    <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/test3</span> /test4;<br>    <span class="hljs-attribute">proxy_pass</span> http://www.baidu.com;<br>&#125;<br><br><span class="hljs-section">location</span> = /test2 &#123;<br>    <span class="hljs-attribute">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&quot;/test2&quot;</span>;<br>&#125;  <br><br><span class="hljs-section">location</span> = /test3 &#123;<br>    <span class="hljs-attribute">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&quot;/test3&quot;</span>;<br>&#125;<br><span class="hljs-section">location</span> = /test4 &#123;<br>    <span class="hljs-attribute">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&quot;/test4&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>发送如下请求 curl 127.0.0.1:8080&#x2F;test1 返回 &#x2F;test3</p><p>当如果将上面的 location &#x2F; 改成如下代码</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> / &#123;<br>    <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/test1</span> /test2;<br>    <span class="hljs-comment"># 此处不会发起新一轮location匹配；当是会终止执行后续rewrite模块指令重写后的 URI 为 /more/index.html</span><br>    <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/test2</span> /more/index.html <span class="hljs-literal">break</span>;  <br>    <span class="hljs-attribute">rewrite</span> /more/index\.html /test4; <span class="hljs-comment"># 这条指令会被忽略</span><br><br>    <span class="hljs-comment"># 因为 proxy_pass 不是rewrite模块的指令 所以它不会被 break终止</span><br>    <span class="hljs-attribute">proxy_pass</span> https://www.baidu.com;<br>&#125;<br></code></pre></td></tr></table></figure><p>发送请求 127.0.0.1:8080&#x2F;test1<br>代理到 <a href="https://www.baidu.com/">https://www.baidu.com</a></p><p>rewrite 后的请求参数：<br>如果替换字符串 replacement 包含新的请求参数，则在它们之后附加先前的请求参数。如果你不想要之前的参数，则在替换字符串 replacement 的末尾放置一个问号，避免附加它们。</p><h1 id="由于最后加了个-，原来的请求参数将不会被追加到-rewrite-之后的-URI-后面"><a href="#由于最后加了个-，原来的请求参数将不会被追加到-rewrite-之后的-URI-后面" class="headerlink" title="由于最后加了个 ?，原来的请求参数将不会被追加到 rewrite 之后的 URI 后面*"></a>由于最后加了个 ?，原来的请求参数将不会被追加到 rewrite 之后的 URI 后面*</h1><p>rewrite ^&#x2F;users&#x2F;(.*)$ &#x2F;show?user&#x3D;$1? last;</p><h1 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h1><ul><li>1、&#x3D; 开头</li><li>精确匹配</li></ul><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-keyword">location</span> <span class="hljs-title">= /login</span> &#123; ... &#125;<br></code></pre></td></tr></table></figure><ul><li>2、^~ 开头</li><li>表示 URL 以某个常规字符串开头，不区分大小写，并关闭正则匹配，当搜索到这个普通匹配模式后，将不再继续搜索正则匹配模式。</li></ul><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-keyword">location</span> <span class="hljs-title">^~ /static</span>/ &#123; ... &#125;<br></code></pre></td></tr></table></figure><ul><li>3、~ 开头</li><li>表示区分大小写的正则匹配，以gif、jpg、js、css结尾</li></ul><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coq">location ~ \.(gif|<span class="hljs-type">jpg</span>|<span class="hljs-type">png</span>|<span class="hljs-type">js</span>|<span class="hljs-type">css</span>)$ &#123; ... &#125;<br></code></pre></td></tr></table></figure><ul><li>4、~* 开头</li><li>表示不区分大小写的正则匹配，以 .png 结尾</li></ul><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-keyword">location</span> <span class="hljs-title">~* \.png</span>$ &#123; ... &#125;<br></code></pre></td></tr></table></figure><ul><li>5、&#x2F; 开头</li><li>通用匹配，任何请求都会匹配到。</li></ul><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-keyword">location</span> <span class="hljs-title">/ &#123; ... &#125;</span><br></code></pre></td></tr></table></figure><ul><li>各符号优先级：</li><li>&#x3D; &gt; ^~ &gt; <del>|</del>* &gt; &#x2F;</li><li>.表示除\n之外的任意字符</li><li>*表示匹配0-无穷</li><li>+表示匹配1-无穷</li></ul><h3 id="墙代理-nginx图片服务"><a href="#墙代理-nginx图片服务" class="headerlink" title="墙代理+nginx图片服务"></a>墙代理+nginx图片服务</h3><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs nsis">server &#123;<br>    listen <span class="hljs-number">80</span><span class="hljs-comment">;</span><br>    listen [::]:<span class="hljs-number">80</span><span class="hljs-comment">;</span><br>    server_name blowsysun.<span class="hljs-literal">top</span><span class="hljs-comment">;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">301</span> https://<span class="hljs-variable">$server_name</span>:<span class="hljs-number">443</span><span class="hljs-variable">$request_uri</span><span class="hljs-comment">;</span><br>&#125;<br><br>server &#123;<br>    listen       <span class="hljs-number">443</span> ssl http2<span class="hljs-comment">;</span><br>    listen       [::]:<span class="hljs-number">443</span> ssl http2<span class="hljs-comment">;</span><br>    server_name blowsysun.<span class="hljs-literal">top</span><span class="hljs-comment">;</span><br>    charset utf-<span class="hljs-number">8</span><span class="hljs-comment">;</span><br><br>    <span class="hljs-comment"># ssl配置</span><br>    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4<span class="hljs-comment">;</span><br>    ssl_ecdh_curve secp384r1<span class="hljs-comment">;</span><br>    ssl_prefer_server_ciphers <span class="hljs-literal">on</span><span class="hljs-comment">;</span><br>    ssl_session_cache shared:SSL:<span class="hljs-number">10</span>m<span class="hljs-comment">;</span><br>    ssl_session_timeout <span class="hljs-number">10</span>m<span class="hljs-comment">;</span><br>    ssl_session_tickets <span class="hljs-literal">off</span><span class="hljs-comment">;</span><br>    ssl_certificate /etc/v2ray/blowsysun.<span class="hljs-literal">top</span>.pem<span class="hljs-comment">;</span><br>    ssl_certificate_key /etc/v2ray/blowsysun.<span class="hljs-literal">top</span>.key<span class="hljs-comment">;</span><br><br>    <span class="hljs-comment"># root /usr/share/nginx/html;</span><br>    location / &#123;<br>        root /usr/share/nginx/html<span class="hljs-comment">;</span><br>        proxy_ssl_server_name <span class="hljs-literal">on</span><span class="hljs-comment">;</span><br>        proxy_pass https://<span class="hljs-number">86817</span>.com/<span class="hljs-comment">;</span><br>        proxy_set_header Accept-Encoding <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-comment">;</span><br>        sub_filter <span class="hljs-string">&quot;86817.com&quot;</span> <span class="hljs-string">&quot;blowsysun.top&quot;</span><span class="hljs-comment">;</span><br>        sub_filter_once <span class="hljs-literal">off</span><span class="hljs-comment">;</span><br>    &#125;<br><br>    location = /robots.txt &#123;&#125;<br><br>    location /images/ &#123;<br>      root /usr/share/nginx/<span class="hljs-comment">;</span><br>      autoindex <span class="hljs-literal">on</span><span class="hljs-comment">; # 打开目录浏览功能</span><br>      <span class="hljs-comment">#autoindex_exact_size off; #默认为on，显示出文件的确切大小，单位是bytes。改为off后，显示出文件的大概大小，单位是kB或者MB或者GB</span><br>      <span class="hljs-comment">#autoindex_localtime on; #默认为off，显示的文件时间为GMT时间。</span><br>改为<span class="hljs-literal">on</span>后，显示的文件时间为文件的服务器时间<br>      <span class="hljs-comment">#charset utf-8;</span><br>    &#125;<br><br>    location /nEmeUFJM0hbD &#123;<br>      proxy_redirect <span class="hljs-literal">off</span><span class="hljs-comment">;</span><br>      proxy_pass http://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">22768</span><span class="hljs-comment">;</span><br>      proxy_http_version <span class="hljs-number">1.1</span><span class="hljs-comment">;</span><br>      proxy_set_header Upgrade <span class="hljs-variable">$http_upgrade</span><span class="hljs-comment">;</span><br>      proxy_set_header Connection <span class="hljs-string">&quot;upgrade&quot;</span><span class="hljs-comment">;</span><br>      proxy_set_header Host <span class="hljs-variable">$host</span><span class="hljs-comment">;</span><br>      <span class="hljs-comment"># Show real IP in v2ray access.log</span><br>      proxy_set_header X-Real-IP <span class="hljs-variable">$remote_addr</span><span class="hljs-comment">;</span><br>      proxy_set_header X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span><span class="hljs-comment">;</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="项目1"><a href="#项目1" class="headerlink" title="项目1"></a>项目1</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">worker_processes</span> auto;<br><span class="hljs-attribute">worker_rlimit_nofile</span> <span class="hljs-number">65535</span>;<br><span class="hljs-attribute">error_log</span> logs/<span class="hljs-literal">error</span>.log;<br><span class="hljs-attribute">pid</span> /var/run/nginx.pid;<br><span class="hljs-attribute">daemon</span> <span class="hljs-literal">off</span>;<br><br><span class="hljs-section">events</span> &#123;<br>    <span class="hljs-attribute">worker_connections</span> <span class="hljs-number">2048</span>;<br>&#125;<br><br><span class="hljs-section">http</span> &#123;<br>    <span class="hljs-attribute">log_format</span>  main  <span class="hljs-string">&#x27;<span class="hljs-variable">$remote_addr</span> - <span class="hljs-variable">$remote_user</span> [<span class="hljs-variable">$time_local</span>] &quot;<span class="hljs-variable">$request</span>&quot; &#x27;</span><br>                      <span class="hljs-string">&#x27;<span class="hljs-variable">$status</span> <span class="hljs-variable">$body_bytes_sent</span> &quot;<span class="hljs-variable">$http_referer</span>&quot; &#x27;</span><br>                      <span class="hljs-string">&#x27;&quot;<span class="hljs-variable">$http_user_agent</span>&quot; &quot;<span class="hljs-variable">$http_x_forwarded_for</span>&quot; &quot;<span class="hljs-variable">$http_referer</span>&quot;&#x27;</span>;<br><br>    <span class="hljs-attribute">access_log</span>  logs/access.log  main;<br>    <span class="hljs-attribute">client_max_body_size</span>    <span class="hljs-number">100m</span>;<br>    <span class="hljs-attribute">sendfile</span>            <span class="hljs-literal">on</span>;<br>    <span class="hljs-attribute">tcp_nopush</span>          <span class="hljs-literal">on</span>;<br>    <span class="hljs-attribute">tcp_nodelay</span>         <span class="hljs-literal">on</span>;<br>    <span class="hljs-attribute">keepalive_timeout</span>   <span class="hljs-number">65</span>;<br>    <span class="hljs-attribute">types_hash_max_size</span> <span class="hljs-number">2048</span>;<br><br>    <span class="hljs-attribute">gzip</span> <span class="hljs-literal">on</span>;<br>    <span class="hljs-attribute">gzip_disable</span> <span class="hljs-string">&quot;msie6&quot;</span>;<br>    <span class="hljs-attribute">gzip_vary</span> <span class="hljs-literal">on</span>;<br>    <span class="hljs-attribute">gzip_proxied</span> any;<br>    <span class="hljs-attribute">gzip_comp_level</span> <span class="hljs-number">6</span>;<br>    <span class="hljs-attribute">gzip_buffers</span> <span class="hljs-number">16</span> <span class="hljs-number">8k</span>;<br>    <span class="hljs-attribute">gzip_http_version</span> <span class="hljs-number">1</span>.<span class="hljs-number">1</span>;<br>    <span class="hljs-attribute">gzip_min_length</span> <span class="hljs-number">256</span>;<br>    <span class="hljs-attribute">gzip_types</span> text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss application/javascript text/javascript application/vnd.ms-fontobject application/x-font-ttf font/opentype image/svg+xml image/x-icon;<br><br>    <span class="hljs-attribute">proxy_connect_timeout</span> <span class="hljs-number">300s</span>;<br>    <span class="hljs-attribute">proxy_send_timeout</span> <span class="hljs-number">300s</span>;<br>    <span class="hljs-attribute">proxy_read_timeout</span> <span class="hljs-number">300s</span>;<br>    <span class="hljs-attribute">send_timeout</span> <span class="hljs-number">300s</span>;<br>    <span class="hljs-attribute">fastcgi_connect_timeout</span> <span class="hljs-number">300</span>;<br>    <span class="hljs-attribute">fastcgi_send_timeout</span> <span class="hljs-number">300</span>;<br>    <span class="hljs-attribute">fastcgi_read_timeout</span> <span class="hljs-number">300</span>;<br><br>    <span class="hljs-attribute">include</span>             /usr/local/openresty/nginx/mime.types;<br>    <span class="hljs-attribute">default_type</span>        application/octet-stream;<br><br>    <span class="hljs-comment"># Load modular configuration files from the /etc/nginx/conf.d directory.</span><br>    <span class="hljs-comment"># See http://nginx.org/en/docs/ngx_core_module.html#include</span><br>    <span class="hljs-comment"># for more information.</span><br>    <span class="hljs-attribute">include</span> servers/<span class="hljs-regexp">*.conf</span>;<br><br>    <span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span> default_server;<br>    <span class="hljs-attribute">listen</span>       [::]:<span class="hljs-number">80</span> default_server;<br>        <span class="hljs-attribute">server_name</span>  _;<br>        <span class="hljs-comment">#root         /usr/local/openresty/nginx/html/;</span><br><br>        <span class="hljs-comment"># 重写env.config.js路径</span><br>        <span class="hljs-section">location</span> <span class="hljs-regexp">~ .+/env.config.js$</span>  &#123;<br>           <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^(.*)$</span> /env.config.js <span class="hljs-literal">break</span>;<br>           <span class="hljs-attribute">root</span>  /usr/local/openresty/nginx/html;<br>        &#125;<br><br>        <span class="hljs-comment"># 重写/static_res资源路径</span><br>        <span class="hljs-section">location</span> <span class="hljs-regexp">~ .+/static_res/</span>  &#123;<br>           <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^.*(\/static_res\/.*)$</span> <span class="hljs-variable">$1</span> <span class="hljs-literal">break</span>;<br>           <span class="hljs-attribute">root</span>  /usr/local/openresty/nginx/html;<br>        &#125;<br><br>        <span class="hljs-comment"># 重写/assets/img/中图片资源路径</span><br>        <span class="hljs-section">location</span> <span class="hljs-regexp">~ .+/assets_res/</span>  &#123;<br>           <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^.*(\/assets_res\/.*)$</span> <span class="hljs-variable">$1</span> <span class="hljs-literal">break</span>;<br>           <span class="hljs-attribute">root</span>  /usr/local/openresty/nginx/html;<br>        &#125;<br><br>        <span class="hljs-comment"># 重写/assets/img/中图片资源路径</span><br>        <span class="hljs-section">location</span> <span class="hljs-regexp">~ .+/assets/</span>  &#123;<br>           <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^.*(\/assets\/.*)$</span> <span class="hljs-variable">$1</span> <span class="hljs-literal">break</span>;<br>           <span class="hljs-attribute">root</span>  /usr/local/openresty/nginx/html;<br>        &#125;<br><br>        <span class="hljs-comment"># 主入口配置</span><br>        <span class="hljs-section">location</span> / &#123;<br>            <span class="hljs-attribute">add_header</span> Cache-Control <span class="hljs-string">&#x27;no-cache, must-revalidate, proxy-revalidate, max-age=0&#x27;</span>;<br>            <span class="hljs-attribute">alias</span> /usr/local/openresty/nginx/html/;<br>            <span class="hljs-attribute">index</span> index.html;<br>            <span class="hljs-attribute">try_files</span> <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /index.html;<br><br>            <span class="hljs-attribute">if</span> (<span class="hljs-variable">$request_filename</span> <span class="hljs-regexp">~* .*.(html|htm)$)</span><br>            &#123;<br>                <span class="hljs-attribute">expires</span> -<span class="hljs-number">1s</span>;<br>            &#125;<br><br>            <span class="hljs-attribute">if</span> (<span class="hljs-variable">$request_filename</span> <span class="hljs-regexp">~* .*.(gif|jpg|jpeg|png|svg)$)</span><br>            &#123;<br>                <span class="hljs-attribute">expires</span> <span class="hljs-number">30d</span>;<br>            &#125;<br><br>            <span class="hljs-attribute">if</span> (<span class="hljs-variable">$request_filename</span> <span class="hljs-regexp">~ .*.(js|css)$)</span><br>            &#123;<br>                <span class="hljs-attribute">expires</span> <span class="hljs-number">12h</span>;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-comment"># 接口</span><br>        <span class="hljs-section">location</span> /xadmin/ &#123;<br>            <span class="hljs-attribute">proxy_pass</span> http://xxx-backend:8090;<br>            <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/xadmin/(.*)$</span> /xadmin/<span class="hljs-variable">$1</span> <span class="hljs-literal">break</span>;<br>        &#125;<br>        <span class="hljs-section">location</span> /platform/ &#123;<br>            <span class="hljs-attribute">proxy_pass</span> http://xxx-backend:8080;<br>            <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/platform/(.*)$</span> /platform/<span class="hljs-variable">$1</span> <span class="hljs-literal">break</span>;<br>        &#125;<br>        <br>        <span class="hljs-section">location</span> /ping &#123;<br>            <span class="hljs-attribute">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&quot;oK&quot;</span>;<br>        &#125;<br><br>        <span class="hljs-attribute">error_page</span> <span class="hljs-number">404</span> /<span class="hljs-number">404</span>.html;<br>            <span class="hljs-section">location</span> = /40x.html &#123;<br>        &#125;<br><br>        <span class="hljs-attribute">error_page</span> <span class="hljs-number">500</span> <span class="hljs-number">502</span> <span class="hljs-number">503</span> <span class="hljs-number">504</span> /50x.html;<br>            <span class="hljs-section">location</span> = /50x.html &#123;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="项目2-微前端-独立部署"><a href="#项目2-微前端-独立部署" class="headerlink" title="项目2 - 微前端 独立部署"></a>项目2 - 微前端 独立部署</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">user</span>  root;<br><span class="hljs-attribute">worker_processes</span>  auto;<br><br><span class="hljs-comment">#error_log  logs/error.log;</span><br><span class="hljs-comment">#error_log  logs/error.log  notice;</span><br><span class="hljs-comment">#error_log  logs/error.log  info;</span><br><br><span class="hljs-comment">#pid        logs/nginx.pid;</span><br><br><br><span class="hljs-section">events</span> &#123;<br>    <span class="hljs-attribute">worker_connections</span>  <span class="hljs-number">1024</span>;<br>&#125;<br><br><br><span class="hljs-section">http</span> &#123;<br>    <span class="hljs-attribute">include</span>       mime.types;<br>    <span class="hljs-attribute">default_type</span>  application/octet-stream;<br><br>    <span class="hljs-comment">#log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br>    <span class="hljs-comment">#                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br>    <span class="hljs-comment">#                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><br>    <span class="hljs-comment">#access_log  logs/access.log  main;</span><br><br>    <span class="hljs-attribute">sendfile</span>            <span class="hljs-literal">on</span>;<br>    <span class="hljs-attribute">tcp_nopush</span>          <span class="hljs-literal">on</span>;<br>    <span class="hljs-attribute">tcp_nodelay</span>         <span class="hljs-literal">on</span>;<br>    <span class="hljs-attribute">keepalive_timeout</span>   <span class="hljs-number">65</span>;<br>    <span class="hljs-attribute">types_hash_max_size</span> <span class="hljs-number">2048</span>;<br><br>    <span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span> default_server;<br>        <span class="hljs-attribute">listen</span>       [::]:<span class="hljs-number">80</span> default_server;<br>        <span class="hljs-attribute">server_name</span>  _;<br>        <span class="hljs-attribute">root</span>         /usr/share/nginx/html;<br><br>        <span class="hljs-comment"># 资源下载</span><br>        <span class="hljs-section">location</span><span class="hljs-regexp"> ^~</span> /zyx/portal/doc/ &#123;<br>           <span class="hljs-comment">#需要下载的文件存放的目录</span><br>           <span class="hljs-attribute">alias</span>  /data/zyx_web/;<br>           <span class="hljs-attribute">sendfile</span> <span class="hljs-literal">on</span>;<br>           <span class="hljs-attribute">autoindex</span> <span class="hljs-literal">on</span>;  <span class="hljs-comment"># 开启目录文件列表</span><br>           <span class="hljs-attribute">autoindex_exact_size</span> <span class="hljs-literal">on</span>;  <span class="hljs-comment"># 显示出文件的确切大小，单位是bytes</span><br>           <span class="hljs-attribute">autoindex_localtime</span> <span class="hljs-literal">on</span>;  <span class="hljs-comment"># 显示的文件时间为文件的服务器时间</span><br>           <span class="hljs-attribute">charset</span> utf-<span class="hljs-number">8</span>,gbk;  <span class="hljs-comment"># 避免中文乱码</span><br>       &#125;<br><br>        <span class="hljs-comment"># 主应用</span><br>        <span class="hljs-section">location</span><span class="hljs-regexp"> ^~/zyx</span> &#123;<br>              <span class="hljs-attribute">alias</span> /data/zyx_web/zyx-web-main;<br>              <span class="hljs-attribute">index</span> index.html;<br>              <span class="hljs-attribute">try_files</span> <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /zyx/index.html;<br>        &#125;<br><br>        <span class="hljs-comment"># 政企通</span><br>        <span class="hljs-section">location</span><span class="hljs-regexp"> ^~/zyx/sub/enterprise</span> &#123;<br>              <span class="hljs-attribute">add_header</span> Cache-Control <span class="hljs-string">&#x27;no-cache, must-revalidate, proxy-revalidate, max-age=0&#x27;</span>;<br>              <span class="hljs-attribute">alias</span> /data/zyx_web/zyx-web-government-enterprise-through;<br>              <span class="hljs-attribute">index</span> index.html;<br>              <span class="hljs-attribute">try_files</span> <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /zyx/sub/enterprise/index.html;<br>        &#125;<br><br>        <span class="hljs-comment"># 统一门户</span><br>        <span class="hljs-section">location</span><span class="hljs-regexp"> ^~/zyx/sub/portal</span> &#123;<br>              <span class="hljs-attribute">add_header</span> Cache-Control <span class="hljs-string">&#x27;no-cache, must-revalidate, proxy-revalidate, max-age=0&#x27;</span>;<br>              <span class="hljs-attribute">alias</span> /data/zyx_web/zyx-web-portal;<br>              <span class="hljs-attribute">index</span> index.html;<br>              <span class="hljs-attribute">try_files</span> <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /zyx/sub/portal/index.html;<br>        &#125;<br>        <span class="hljs-comment"># 标签系统</span><br>        <span class="hljs-section">location</span><span class="hljs-regexp"> ^~/zyx/sub/tag</span> &#123;<br>                <span class="hljs-attribute">add_header</span> Cache-Control <span class="hljs-string">&#x27;no-cache, must-revalidate, proxy-revalidate, max-age=0&#x27;</span>;<br>                <span class="hljs-attribute">alias</span> /data/zyx_web/zyx-web-tag;<br>                <span class="hljs-attribute">index</span> index.html;<br>                <span class="hljs-attribute">try_files</span> <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /zyx/sub/tag/index.html;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="项目3-微前端-合并部署"><a href="#项目3-微前端-合并部署" class="headerlink" title="项目3 - 微前端 合并部署"></a>项目3 - 微前端 合并部署</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">user</span>  root;<br><span class="hljs-attribute">worker_processes</span> auto;<br><span class="hljs-attribute">worker_rlimit_nofile</span> <span class="hljs-number">65535</span>;<br><span class="hljs-attribute">error_log</span> logs/<span class="hljs-literal">error</span>.log;<br><span class="hljs-attribute">pid</span> /var/run/nginx.pid;<br><span class="hljs-attribute">daemon</span> <span class="hljs-literal">off</span>;<br><br><span class="hljs-section">events</span> &#123;<br>    <span class="hljs-attribute">worker_connections</span> <span class="hljs-number">2048</span>;<br>&#125;<br><br><span class="hljs-section">http</span> &#123;<br>    <span class="hljs-attribute">log_format</span>  main  <span class="hljs-string">&#x27;<span class="hljs-variable">$remote_addr</span> - <span class="hljs-variable">$remote_user</span> [<span class="hljs-variable">$time_local</span>] &quot;<span class="hljs-variable">$request</span>&quot; &#x27;</span><br>                      <span class="hljs-string">&#x27;<span class="hljs-variable">$status</span> <span class="hljs-variable">$body_bytes_sent</span> &quot;<span class="hljs-variable">$http_referer</span>&quot; &#x27;</span><br>                      <span class="hljs-string">&#x27;&quot;<span class="hljs-variable">$http_user_agent</span>&quot; &quot;<span class="hljs-variable">$http_x_forwarded_for</span>&quot; &quot;<span class="hljs-variable">$http_referer</span>&quot;&#x27;</span>;<br><br>    <span class="hljs-attribute">access_log</span>  logs/access.log  main;<br>    <span class="hljs-attribute">client_max_body_size</span>    <span class="hljs-number">100m</span>;<br>    <span class="hljs-attribute">sendfile</span>            <span class="hljs-literal">on</span>;<br>    <span class="hljs-attribute">tcp_nopush</span>          <span class="hljs-literal">on</span>;<br>    <span class="hljs-attribute">tcp_nodelay</span>         <span class="hljs-literal">on</span>;<br>    <span class="hljs-attribute">keepalive_timeout</span>   <span class="hljs-number">65</span>;<br>    <span class="hljs-attribute">types_hash_max_size</span> <span class="hljs-number">2048</span>;<br>    <br>    <span class="hljs-attribute">gzip</span> <span class="hljs-literal">on</span>;<br>    <span class="hljs-attribute">gzip_static</span> <span class="hljs-literal">on</span>;<br>    <span class="hljs-attribute">gzip_disable</span> <span class="hljs-string">&quot;msie6&quot;</span>;<br>    <span class="hljs-attribute">gzip_vary</span> <span class="hljs-literal">on</span>;<br>    <span class="hljs-attribute">gzip_proxied</span> any;<br>    <span class="hljs-attribute">gzip_comp_level</span> <span class="hljs-number">6</span>;<br>    <span class="hljs-attribute">gzip_buffers</span> <span class="hljs-number">16</span> <span class="hljs-number">8k</span>;<br>    <span class="hljs-attribute">gzip_http_version</span> <span class="hljs-number">1</span>.<span class="hljs-number">0</span>;<br>    <span class="hljs-attribute">gzip_min_length</span> <span class="hljs-number">20</span>;<br>    <span class="hljs-attribute">gzip_types</span> text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss application/javascript text/javascript application/vnd.ms-fontobject application/x-font-ttf font/opentype image/svg+xml image/x-icon;<br><br><br>    <span class="hljs-attribute">proxy_connect_timeout</span> <span class="hljs-number">300s</span>;<br>    <span class="hljs-attribute">proxy_send_timeout</span> <span class="hljs-number">300s</span>;   <br>    <span class="hljs-attribute">proxy_read_timeout</span> <span class="hljs-number">300s</span>;   <br>    <span class="hljs-attribute">send_timeout</span> <span class="hljs-number">300s</span>;    <br>    <span class="hljs-attribute">fastcgi_connect_timeout</span> <span class="hljs-number">300</span>;    <br>    <span class="hljs-attribute">fastcgi_send_timeout</span> <span class="hljs-number">300</span>;   <br>    <span class="hljs-attribute">fastcgi_read_timeout</span> <span class="hljs-number">300</span>;     <br><br>    <span class="hljs-attribute">include</span>             /usr/local/openresty/nginx/mime.types;<br>    <span class="hljs-attribute">default_type</span>        application/octet-stream;<br><br>    <span class="hljs-attribute">include</span> servers/<span class="hljs-regexp">*.conf</span>;<br>  <br>    <span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span> default_server;<br>        <span class="hljs-attribute">listen</span>       [::]:<span class="hljs-number">80</span> default_server;<br>        <span class="hljs-attribute">server_name</span>  _;<br>        <span class="hljs-comment"># 重写env.config.js路径</span><br>        <span class="hljs-section">location</span> <span class="hljs-regexp">~ .+/env.config.js$</span>  &#123;<br>           <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^(.*)$</span> /env.config.js <span class="hljs-literal">break</span>;<br>           <span class="hljs-attribute">root</span>  /usr/local/openresty/nginx/html;<br>        &#125;<br>        <br>        <span class="hljs-section">location</span><span class="hljs-regexp"> ^~</span> /zyx_dev &#123;<br>            <span class="hljs-attribute">add_header</span> Cache-Control <span class="hljs-string">&#x27;no-cache, must-revalidate, proxy-revalidate, max-age=0&#x27;</span>;<br>            <span class="hljs-attribute">proxy_hide_header</span> Host;<br>            <span class="hljs-attribute">alias</span> /usr/local/openresty/nginx/html/zyx-web-main;<br>            <span class="hljs-attribute">index</span> index.html;<br>            <span class="hljs-attribute">try_files</span> <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /index.html;<br><br>            <span class="hljs-attribute">if</span> (<span class="hljs-variable">$request_filename</span> <span class="hljs-regexp">~* .*.(html|htm)$)</span><br>            &#123;<br>                <span class="hljs-attribute">expires</span> -<span class="hljs-number">1s</span>;<br>            &#125;<br><br>            <span class="hljs-attribute">if</span> (<span class="hljs-variable">$request_filename</span> <span class="hljs-regexp">~* .*.(gif|jpg|jpeg|png|svg)$)</span><br>            &#123;<br>                <span class="hljs-attribute">expires</span> <span class="hljs-number">30d</span>;<br>            &#125;<br><br>            <span class="hljs-attribute">if</span> (<span class="hljs-variable">$request_filename</span> <span class="hljs-regexp">~ .*.(js|css)$)</span><br>            &#123;       <br>                <span class="hljs-attribute">expires</span> <span class="hljs-number">12h</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-section">location</span> /zyx_dev/sub/portal &#123;<br>            <span class="hljs-attribute">add_header</span> Cache-Control <span class="hljs-string">&#x27;no-cache, must-revalidate, proxy-revalidate, max-age=0&#x27;</span>;<br>            <span class="hljs-attribute">alias</span> /usr/local/openresty/nginx/html/zyx-web-portal;<br>            <span class="hljs-attribute">index</span> index.html;<br>            <span class="hljs-attribute">try_files</span> <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /zyx/sub/portal/index.html;<br>        &#125;<br>        <span class="hljs-section">location</span> /zyx_dev/sub/enterprise &#123;<br>            <span class="hljs-attribute">add_header</span> Cache-Control <span class="hljs-string">&#x27;no-cache, must-revalidate, proxy-revalidate, max-age=0&#x27;</span>;<br>            <span class="hljs-attribute">alias</span> /usr/local/openresty/nginx/html/zyx-web-government-enterprise-through;<br>            <span class="hljs-attribute">index</span> index.html;<br>            <span class="hljs-attribute">try_files</span> <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /zyx/sub/enterprise/index.html;<br>        &#125;<br>        <span class="hljs-section">location</span> /zyx_dev/sub/tag &#123;<br>            <span class="hljs-attribute">add_header</span> Cache-Control <span class="hljs-string">&#x27;no-cache, must-revalidate, proxy-revalidate, max-age=0&#x27;</span>;<br>            <span class="hljs-attribute">alias</span> /usr/local/openresty/nginx/html/zyx-web-tag;<br>            <span class="hljs-attribute">index</span> index.html;<br>            <span class="hljs-attribute">try_files</span> <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /zyx/sub/tag/index.html;<br>        &#125;<br>        <span class="hljs-attribute">error_page</span> <span class="hljs-number">404</span> /<span class="hljs-number">404</span>.html;<br>            <span class="hljs-section">location</span> = /40x.html &#123;<br>        &#125;<br><br>        <span class="hljs-attribute">error_page</span> <span class="hljs-number">500</span> <span class="hljs-number">502</span> <span class="hljs-number">503</span> <span class="hljs-number">504</span> /50x.html;<br>            <span class="hljs-section">location</span> = /50x.html &#123;<br>        &#125; <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>部署</category>
      
    </categories>
    
    
    <tags>
      
      <tag>前端工程化</tag>
      
      <tag>nginx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-10-24 项目管理</title>
    <link href="/2025/11/28/2022-10-24-%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/"/>
    <url>/2025/11/28/2022-10-24-%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/</url>
    
    <content type="html"><![CDATA[<p><img src="/assets/images/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/%E4%BA%A7%E5%93%81%E8%BF%AD%E4%BB%A3%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B%E8%A7%84%E8%8C%83.png" alt="产品迭代开发流程规范"></p><p>启规执监收</p><h2 id="需求管理（收集整理、拆解分配）"><a href="#需求管理（收集整理、拆解分配）" class="headerlink" title="需求管理（收集整理、拆解分配）"></a>需求管理（收集整理、拆解分配）</h2><h2 id="人员管理（ISV、内部成员）"><a href="#人员管理（ISV、内部成员）" class="headerlink" title="人员管理（ISV、内部成员）"></a>人员管理（ISV、内部成员）</h2><h2 id="代码管理（分支、质量）"><a href="#代码管理（分支、质量）" class="headerlink" title="代码管理（分支、质量）"></a>代码管理（分支、质量）</h2><h2 id="缺陷管理（UI、需求缺陷）"><a href="#缺陷管理（UI、需求缺陷）" class="headerlink" title="缺陷管理（UI、需求缺陷）"></a>缺陷管理（UI、需求缺陷）</h2><h2 id="部署管理（私有化、公有云）"><a href="#部署管理（私有化、公有云）" class="headerlink" title="部署管理（私有化、公有云）"></a>部署管理（私有化、公有云）</h2>]]></content>
    
    
    <categories>
      
      <category>前端工程化</category>
      
      <category>项目管理</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nginx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-11-23-【部署】登录页微服务拆分</title>
    <link href="/2025/11/28/2022-11-23-%E3%80%90%E9%83%A8%E7%BD%B2%E3%80%91%E7%99%BB%E5%BD%95%E9%A1%B5%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8B%86%E5%88%86/"/>
    <url>/2025/11/28/2022-11-23-%E3%80%90%E9%83%A8%E7%BD%B2%E3%80%91%E7%99%BB%E5%BD%95%E9%A1%B5%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8B%86%E5%88%86/</url>
    
    <content type="html"><![CDATA[<p>P2-5号工程前端登录页微服务拆分<br>一、需求描述<br>为满足合规要求将原有企业端前端部署页面一分为二独立部署。<br>二、带来的问题</p><ol><li>如何保持登录态（登录成功后TOKEN如何传递）</li><li>新企业接入前端如何部署（手动部署？自动部署）</li><li>不同企业登录后，如何做到退出跳转正确的登录页面？<br>三、整体方案<br> 为保持登录态,我们将存有TOKEN数据的cookie存放在根域名路径下，也就是登录页NG下，用户所有请求均通过登录页NG进行分发，登录相关页面及请求直接访问登录NG资源，而其他业务页面及请求通过登录NG代理转发到业务NG；每新增一个企业使用，将为其新增一套个性化UI的登录NG，业务相关界面均通过此NG转发。<br>3.1 部署架构图<br><img src="/assets/images/%E7%99%BB%E5%BD%95%E9%A1%B5%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8B%86%E5%88%86/%E7%99%BB%E5%BD%95%E9%A1%B5%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8B%86%E5%88%86.png" alt="部署架构图"><br>3.2 部署设计<br><img src="/assets/images/%E7%99%BB%E5%BD%95%E9%A1%B5%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8B%86%E5%88%86/%E7%99%BB%E5%BD%95%E9%A1%B5%E4%B8%AA%E6%80%A7%E5%8C%96UIcoding%E9%85%8D%E7%BD%AE.jpg" alt="部署架构图"></li></ol><p>1、tsf创建部署组<br>2、流水线配置部署组id<br>3、选择所需环境及页面参数，立即构建</p><p>3.3 退出登录处理<br>由于所有资源均通过登录页NG分发，所以浏览器URL中域名保持不变，只需将原有企业端退出逻辑跳转路径更改为相对路径下的登录页路由地址即可。</p><p>【方案2】<br>登录页下使用iframe内嵌，企业端页面，通过postMessage传递token数据。</p><p>优势：<br>业务请求不用通过登录页NG转发，页面内部嵌入iframe，通过iframe内部router跳转。</p>]]></content>
    
    
    <categories>
      
      <category>TSF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>TSF</tag>
      
      <tag>coding</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-11-29-【多线程】web worker</title>
    <link href="/2025/11/28/2022-11-29-%E3%80%90%E5%A4%9A%E7%BA%BF%E7%A8%8B%E3%80%91web%20worker/"/>
    <url>/2025/11/28/2022-11-29-%E3%80%90%E5%A4%9A%E7%BA%BF%E7%A8%8B%E3%80%91web%20worker/</url>
    
    <content type="html"><![CDATA[<ol><li>问题1： work个数有上限吗？</li></ol><h2 id="同页面的-Web-Worker"><a href="#同页面的-Web-Worker" class="headerlink" title="同页面的 Web Worker"></a>同页面的 Web Worker</h2><h3 id="示例1：Worker-线程完成轮询，模拟消息实时通知"><a href="#示例1：Worker-线程完成轮询，模拟消息实时通知" class="headerlink" title="示例1：Worker 线程完成轮询，模拟消息实时通知"></a>示例1：Worker 线程完成轮询，模拟消息实时通知</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;script&gt;<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">createWorker</span>(<span class="hljs-params">f</span>) &#123;<br>    <span class="hljs-comment">// 立即执行函数，转换为二进制数据</span><br>    <span class="hljs-keyword">var</span> blob = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>([<span class="hljs-string">&#x27;(&#x27;</span> + f.<span class="hljs-title function_">toString</span>() + <span class="hljs-string">&#x27;)()&#x27;</span>]);<br>    <span class="hljs-keyword">var</span> url = <span class="hljs-variable language_">window</span>.<span class="hljs-property">URL</span>.<span class="hljs-title function_">createObjectURL</span>(blob);<br>    <span class="hljs-keyword">var</span> worker = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Worker</span>(url);<br>    <span class="hljs-keyword">return</span> worker;<br>  &#125;<br><br>  <span class="hljs-keyword">var</span> pollingWorker = <span class="hljs-title function_">createWorker</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) &#123;<br>    <span class="hljs-built_in">setInterval</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>      self.<span class="hljs-title function_">postMessage</span>(&#123; <span class="hljs-attr">data</span>: <span class="hljs-string">&#x27;成功了&#x27;</span> &#125;);<br>    &#125;, <span class="hljs-number">1000</span>);<br>  &#125;);<br><br>  pollingWorker.<span class="hljs-property">onmessage</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) &#123;<br>    <span class="hljs-comment">// render data</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(event.<span class="hljs-property">data</span>);<br>  &#125;;<br><br>  pollingWorker.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">&#x27;init&#x27;</span>);<br><br>  <br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-10-24 开发资源大礼包</title>
    <link href="/2025/11/28/2022-10-24-%E3%80%90%E7%A0%94%E5%8F%91%E5%B7%A5%E5%85%B7%E6%B1%87%E6%80%BB%E3%80%91%E5%BC%80%E5%8F%91%E8%B5%84%E6%BA%90%E5%A4%A7%E7%A4%BC%E5%8C%85/"/>
    <url>/2025/11/28/2022-10-24-%E3%80%90%E7%A0%94%E5%8F%91%E5%B7%A5%E5%85%B7%E6%B1%87%E6%80%BB%E3%80%91%E5%BC%80%E5%8F%91%E8%B5%84%E6%BA%90%E5%A4%A7%E7%A4%BC%E5%8C%85/</url>
    
    <content type="html"><![CDATA[<h1 id="实用网站"><a href="#实用网站" class="headerlink" title="实用网站"></a>实用网站</h1><p><a href="http://json.cn/">JSON格式化</a><br><a href="https://tinify.cn/">图片压缩</a><br><a href="https://npmtrends.com/ava-vs-jasmine-core-vs-jest-vs-mocha">npm下载量比较工具</a><br><a href="https://caniuse.com/">兼容支持自查</a></p><h1 id="使用工具"><a href="#使用工具" class="headerlink" title="使用工具"></a>使用工具</h1><p>谷歌插件：<br>取色：<br>hosts修改：</p><h2 id="【vue】"><a href="#【vue】" class="headerlink" title="【vue】"></a>【vue】</h2><h2 id="【react】"><a href="#【react】" class="headerlink" title="【react】"></a>【react】</h2><h2 id="【工具】"><a href="#【工具】" class="headerlink" title="【工具】"></a>【工具】</h2><p>图表处理：echart<br>日期处理：moment、dayjs<br>数据精度处理：currency</p><p>【监控】<br>RUM、<br>【架构】<br><a href="https://www.lernajs.cn/">lernajs</a></p><h2 id="微前端方案汇总"><a href="#微前端方案汇总" class="headerlink" title="微前端方案汇总"></a>微前端方案汇总</h2><ul><li>技术栈无关，主框架不限制接入应用的技术栈，微应用具备完全自主权</li><li>独立开发、独立部署，微应用仓库独立，前后端可独立开发，部署完成后主框架自动完成同步更新</li><li>增量升级，在面对各种复杂场景时，我们通常很难对一个已经存在的系统做全量的技术栈升级或重构，而微前端是一种非常好的实施渐进式重构的手段和策略</li><li>独立运行时，每个微应用之间状态隔离，运行时状态不共享</li></ul><h3 id="一、微前端方案思路"><a href="#一、微前端方案思路" class="headerlink" title="一、微前端方案思路"></a>一、微前端方案思路</h3><ul><li>在前端技术领域已有如下几种成熟的实现微前端的思想：</li><li>基于接口协议：子应用按照协议导出几个接口，主应用在运行过程中调用子应用导出的这几个接口</li><li>基于沙箱隔离：主应用创建一个隔离环境，让子应用基本不用考虑自己是在什么环境下运营，按照普通的开发思路进行开发即可</li><li>基于模块协议：主应用把子应用当作一个模块，和模块的使用方式无异</li></ul><h3 id="二、微前端实现的几种方式"><a href="#二、微前端实现的几种方式" class="headerlink" title="二、微前端实现的几种方式"></a>二、微前端实现的几种方式</h3><ul><li>在前端技术领域已有如下几种方式落地实施：</li><li>路由分发：开发成本低，维护成本低，可行性高，不限技术栈，实现简单</li><li>iFrame：开发成本低，维护成本低，可行性高，不限技术栈，实现简单</li><li>应用微服务化：开发成本高，维护成本低，可行性中等，不限技术栈，实现难</li><li>微件化：开发成本中等，维护成本中等，可行性低，有技术栈限制，实现难</li><li>微应用化：开发成本中等，维护成本中等，可行性高，有技术栈限制，实现较难</li><li>纯 Web Components：开发成本高，维护成本低，可行性高，不限技术栈，实现简单</li><li>结合 Web Components：开发成本高，维护成本低，可行性高，不限技术栈，实现简单</li></ul><h3 id="三、17个实现微前端的框架简介"><a href="#三、17个实现微前端的框架简介" class="headerlink" title="三、17个实现微前端的框架简介"></a>三、17个实现微前端的框架简介</h3><h4 id="1-Single-Spa：最早的前端微服务-Javascript-框架，兼容多种前端技术栈"><a href="#1-Single-Spa：最早的前端微服务-Javascript-框架，兼容多种前端技术栈" class="headerlink" title="1. Single-Spa：最早的前端微服务 Javascript 框架，兼容多种前端技术栈"></a>1. Single-Spa：最早的前端微服务 Javascript 框架，兼容多种前端技术栈</h4><ul><li>single-spa 仅仅是一个子应用生命周期的调度者，阿里系开源微前端框架，</li><li>是一个将多个单页面应用聚合为一个整体应用的 JavaScript 微前端框架，</li><li>在同一页面上使用多个前端框架，而不用刷新页面，</li><li>不限技术栈，</li><li>支持独立部署每一个单页面应用，</li><li>新功能使用新框架，旧的单页应用不用重写可以共存，</li><li>有效改善初始加载时间，延迟加载代码，</li><li>文档地址：<a href="https://zh-hans.single-spa.js/">https://zh-hans.single-spa.js</a>…</li></ul><h4 id="2-Qiankun：基于Single-Spa，阿里系开源微前端框架"><a href="#2-Qiankun：基于Single-Spa，阿里系开源微前端框架" class="headerlink" title="2. Qiankun：基于Single-Spa，阿里系开源微前端框架"></a>2. Qiankun：基于Single-Spa，阿里系开源微前端框架</h4><ul><li>阿里飞冰微前端框架，兼容多种前端技术栈，</li><li>基于 single-spa 封装，提供了更加开箱即用的 API，</li><li>不限技术栈，</li><li>HTML Entry 接入方式，让你接入微应用像使用 iframe 一样简单，</li><li>样式隔离，确保微应用之间样式互相不干扰，</li><li>JS 沙箱，确保微应用之间全局变量&#x2F;事件不冲突，</li><li>资源预加载，在浏览器空闲时间预加载未打开的微应用资源，加速微应用打开速度，</li><li>umi 插件，提供了 @umijs&#x2F;plugin-qiankun 供 umi 应用一键切换成微前端架构系统，</li><li>文档地址：<a href="https://qiankun.umijs.org/zh/">https://qiankun.umijs.org/zh/</a>…</li></ul><h4 id="腾讯无界"><a href="#腾讯无界" class="headerlink" title="腾讯无界"></a>腾讯无界</h4><ul><li><a href="https://wujie-micro.github.io/doc/guide/">https://wujie-micro.github.io/doc/guide/</a></li></ul><h3 id="3-Icestark：阿里飞冰微前端框架"><a href="#3-Icestark：阿里飞冰微前端框架" class="headerlink" title="3. Icestark：阿里飞冰微前端框架"></a>3. Icestark：阿里飞冰微前端框架</h3><ul><li>后台比较分散，体验差别大，因为要频繁跳转导致操作效率低，希望能统一收口的一个系统内，</li><li>单页面应用非常庞大，多人协作成本高，开发&#x2F;构建时间长，依赖升级回归成本高，</li><li>不限技术栈，</li><li>系统有二方&#x2F;三方接入的需求，</li><li>文档地址：<a href="https://micro-frontends.ice.w/">https://micro-frontends.ice.w</a>…</li></ul><h4 id="4-Alibaba-Cloud-Alfa-是在阿里云控制台体系中孵化的微前端方案，定位是面向企业级的微前端体系化解决方案"><a href="#4-Alibaba-Cloud-Alfa-是在阿里云控制台体系中孵化的微前端方案，定位是面向企业级的微前端体系化解决方案" class="headerlink" title="4. Alibaba Cloud Alfa 是在阿里云控制台体系中孵化的微前端方案，定位是面向企业级的微前端体系化解决方案"></a>4. Alibaba Cloud Alfa 是在阿里云控制台体系中孵化的微前端方案，定位是面向企业级的微前端体系化解决方案</h4><ul><li>不限技术栈，</li><li>箱即用，无代码侵入，</li><li>善的微前端体系支撑，</li><li>整的前端容器沙箱，</li><li>实例兼容，</li><li>档地址：<a href="https://alfajs.io/">https://alfajs.io/</a></li></ul><h4 id="5-Module-Federation：是-Zack-Jackson-发明的-JavaScript-架构，Zack-Jackson-随后提出为其创建一个-Webpack-插件。"><a href="#5-Module-Federation：是-Zack-Jackson-发明的-JavaScript-架构，Zack-Jackson-随后提出为其创建一个-Webpack-插件。" class="headerlink" title="5. Module Federation：是 Zack Jackson 发明的 JavaScript 架构，Zack Jackson 随后提出为其创建一个 Webpack 插件。"></a>5. Module Federation：是 Zack Jackson 发明的 JavaScript 架构，Zack Jackson 随后提出为其创建一个 Webpack 插件。</h4><ul><li>是webpack给出的微前端方案，</li><li>使 JavaScript 应用可以动态运行另一个 JavaScript 应用中的代码，同时可以共享依赖，</li><li>依赖自动管理，可以共享 Host 中的依赖，版本不满足要求时自动 fallback 到 Remote 中依赖，</li><li>共享模块粒度自由掌控，小到一个单独组件，大到一个完整应用。既实现了组件级别的复用，又实现了微服务的基本功能，</li><li>共享模块非常灵活，模块中所有组件都可以通过异步加载调用，</li><li>文档地址：<a href="https://webpack.js.org/concep">https://webpack.js.org/concep</a>…</li></ul><h4 id="6-FrintJS：用于构建可伸缩和响应式应用程序的模块化-JavaScript-框架"><a href="#6-FrintJS：用于构建可伸缩和响应式应用程序的模块化-JavaScript-框架" class="headerlink" title="6. FrintJS：用于构建可伸缩和响应式应用程序的模块化 JavaScript 框架"></a>6. FrintJS：用于构建可伸缩和响应式应用程序的模块化 JavaScript 框架</h4><ul><li>加载来自不同 bundlers 的应用程序，为应用程序提供结构，并处理诸如路由、依赖关系等问题，</li><li>通过附加的软件包支持 RN 和 Vue，但文档和测试大多数是针对 React 的，</li><li>文档地址：<a href="https://frint.js.org/">https://frint.js.org/</a></li></ul><h4 id="7-Bit：将独立的组件构建、集成和组合到一起和管理前端"><a href="#7-Bit：将独立的组件构建、集成和组合到一起和管理前端" class="headerlink" title="7. Bit：将独立的组件构建、集成和组合到一起和管理前端"></a>7. Bit：将独立的组件构建、集成和组合到一起和管理前端</h4><ul><li>具有传统单体式前端的安全性和健壮性，</li><li>介接入方式简单、可伸缩性强，</li><li>通过 简单的解耦代码库、自治团队、小型定义良好的 API、独立的发布管道 和 持续增量升级，增强工作流程，</li><li>文档地址：<a href="https://bit.dev/docs/quick-start">https://bit.dev/docs/quick-start</a></li></ul><h4 id="8-PuzzleJS：用于可扩展和快速建站的微前端框架"><a href="#8-PuzzleJS：用于可扩展和快速建站的微前端框架" class="headerlink" title="8. PuzzleJS：用于可扩展和快速建站的微前端框架"></a>8. PuzzleJS：用于可扩展和快速建站的微前端框架</h4><ul><li>SEO 友好，在服务端进行准备和渲染，</li><li>当片段所需的 api 出现故障时，PuzzleJs 可保证其他页面片段仍正常工作，</li><li>文档地址：<a href="https://github.com/puzzle-js/">https://github.com/puzzle-js/</a>…</li></ul><h4 id="9-Mooa：基于Angular的微前端服务框架"><a href="#9-Mooa：基于Angular的微前端服务框架" class="headerlink" title="9. Mooa：基于Angular的微前端服务框架"></a>9. Mooa：基于Angular的微前端服务框架</h4><ul><li>兼容多种前端技术栈，</li><li>构建插件化的 Web 开发平台，满足业务快速变化及分布式多团队并行开发的需求，</li><li>构建服务化的中间件，搭建高可用及高复用的前端微服务平台，</li><li>支持前端的独立交付及部署，</li><li>文档地址：<a href="https://github.com/phodal/mooa">https://github.com/phodal/mooa</a></li></ul><h4 id="10-ngx-planet：一个强大、可靠、完善、完全可用于生产环境的-Angular-微前端库"><a href="#10-ngx-planet：一个强大、可靠、完善、完全可用于生产环境的-Angular-微前端库" class="headerlink" title="10. ngx-planet：一个强大、可靠、完善、完全可用于生产环境的 Angular 微前端库"></a>10. ngx-planet：一个强大、可靠、完善、完全可用于生产环境的 Angular 微前端库</h4><ul><li>只支持 Angular 框架，不支持其他 MV* 前端框架，</li><li>支持同时渲染多个子应用，</li><li>支持并存(coexist)和默认(default)两种模式, 默认模式切换其他子应用销毁当前子应用，并存模式不会销毁，而是隐藏，</li><li>支持子应用的预加载，</li><li>支持样式隔离，</li><li>内置多个应用之间的通信，</li><li>支持跨应用组件的渲染，</li><li>完善的示例，包含路由配置、懒加载等所有功能，</li><li>文档地址：<a href="https://github.com/worktile/n">https://github.com/worktile/n</a>…</li></ul><h4 id="11-Ara-Framework：Ara-是一个使用Airbnb-的-Hypernova轻松开发和集成微前端的框架"><a href="#11-Ara-Framework：Ara-是一个使用Airbnb-的-Hypernova轻松开发和集成微前端的框架" class="headerlink" title="11. Ara Framework：Ara 是一个使用Airbnb 的 Hypernova轻松开发和集成微前端的框架"></a>11. Ara Framework：Ara 是一个使用Airbnb 的 Hypernova轻松开发和集成微前端的框架</h4><ul><li>技术栈自由，</li><li>架构灵活，</li><li>文档地址：<a href="https://ara-framework.github/">https://ara-framework.github</a>….</li></ul><h4 id="12-Micro-app：是京东零售推出的基于类WebComponent进行渲染，从组件化的思维实现的微前端技术"><a href="#12-Micro-app：是京东零售推出的基于类WebComponent进行渲染，从组件化的思维实现的微前端技术" class="headerlink" title="12. Micro-app：是京东零售推出的基于类WebComponent进行渲染，从组件化的思维实现的微前端技术"></a>12. Micro-app：是京东零售推出的基于类WebComponent进行渲染，从组件化的思维实现的微前端技术</h4><ul><li>使用简单，接入微前端成本低，</li><li>零依赖，</li><li>兼容所有框架（不需要提供脚手架工具），</li><li>提供了JS沙箱、样式隔离、元素隔离、预加载、资源地址补全、插件系统、数据通信等一系列完善的功能，</li><li><a href="https://zeroing.jd.com/">https://zeroing.jd.com/</a></li></ul><h4 id="13-Piral：基于-React-的微前端，目标是让你可以使用微前端轻松构建门户应用程序"><a href="#13-Piral：基于-React-的微前端，目标是让你可以使用微前端轻松构建门户应用程序" class="headerlink" title="13. Piral：基于 React 的微前端，目标是让你可以使用微前端轻松构建门户应用程序"></a>13. Piral：基于 React 的微前端，目标是让你可以使用微前端轻松构建门户应用程序</h4><ul><li>渐进迁移，</li><li>共享库，</li><li>共享现有布局和程序框架，</li><li>文档地址：<a href="https://github.com/smapiot/piral">https://github.com/smapiot/piral</a></li></ul><h4 id="14-OpenComponent：目标是“前端世界中的无服务器”，旨在成为一个一站式微前端框架，从而使其成为一个丰富而复杂的系统，其中包括从组件处理到注册表、再到模板、甚至包括-CLI-工具"><a href="#14-OpenComponent：目标是“前端世界中的无服务器”，旨在成为一个一站式微前端框架，从而使其成为一个丰富而复杂的系统，其中包括从组件处理到注册表、再到模板、甚至包括-CLI-工具" class="headerlink" title="14. OpenComponent：目标是“前端世界中的无服务器”，旨在成为一个一站式微前端框架，从而使其成为一个丰富而复杂的系统，其中包括从组件处理到注册表、再到模板、甚至包括 CLI 工具"></a>14. OpenComponent：目标是“前端世界中的无服务器”，旨在成为一个一站式微前端框架，从而使其成为一个丰富而复杂的系统，其中包括从组件处理到注册表、再到模板、甚至包括 CLI 工具</h4><ul><li>同构小单元代码，</li><li>组件化渲染应用页面，</li><li>文档地址：<a href="https://github.com/opencompon">https://github.com/opencompon</a>…</li></ul><h4 id="15-Liugi：是一个微前端-JavaScript-框架，你可以使用它创建由本地和分布式视图驱动的管理用户界面"><a href="#15-Liugi：是一个微前端-JavaScript-框架，你可以使用它创建由本地和分布式视图驱动的管理用户界面" class="headerlink" title="15. Liugi：是一个微前端 JavaScript 框架，你可以使用它创建由本地和分布式视图驱动的管理用户界面"></a>15. Liugi：是一个微前端 JavaScript 框架，你可以使用它创建由本地和分布式视图驱动的管理用户界面</h4><ul><li>允许 Web 应用程序与应用程序包含的微前端进行通信，</li><li>可以配置路由、导航、授权和 UX 元素等设置，</li><li>文档地址：<a href="https://github.com/SAP/luigi">https://github.com/SAP/luigi</a></li></ul><h4 id="16-Mosaic：是一组服务，库以及规范定义了其组件之间如何彼此交互，用来支持大型网站的微服务式架构"><a href="#16-Mosaic：是一组服务，库以及规范定义了其组件之间如何彼此交互，用来支持大型网站的微服务式架构" class="headerlink" title="16. Mosaic：是一组服务，库以及规范定义了其组件之间如何彼此交互，用来支持大型网站的微服务式架构"></a>16. Mosaic：是一组服务，库以及规范定义了其组件之间如何彼此交互，用来支持大型网站的微服务式架构</h4><ul><li>使用了片段（Fragments）的机制，这些片段由单独的服务程序提供服务，并根据模板定义在运行时组合在一起，</li><li>由一堆软件包组成，这些软件包处理不同的问题，例如路由、布局、模板存储、甚至展示 UI，</li><li>文档地址：<a href="https://www.mosaic9.org/">https://www.mosaic9.org/</a></li></ul><h4 id="17-SystemJS：不是微前端框架，但它确实为跨浏览器的独立模块管理提供了解决方案"><a href="#17-SystemJS：不是微前端框架，但它确实为跨浏览器的独立模块管理提供了解决方案" class="headerlink" title="17. SystemJS：不是微前端框架，但它确实为跨浏览器的独立模块管理提供了解决方案"></a>17. SystemJS：不是微前端框架，但它确实为跨浏览器的独立模块管理提供了解决方案</h4><ul><li>使我们无需依赖本机浏览器支持，即可使用与 JS 模块相关的不同功能，诸如动态导入和导入映射等，并且所有这些都具有接近本机的性能，</li><li>提供便捷的方式访问其“模块注册表”，以便你随时了解浏览器中哪些模块是可用的，</li><li>文档地址：<a href="https://github.com/systemjs/s">https://github.com/systemjs/s</a>…</li></ul><h3 id="四、选择微前端方案的时候需要考虑能否解决好以下10个问题"><a href="#四、选择微前端方案的时候需要考虑能否解决好以下10个问题" class="headerlink" title="四、选择微前端方案的时候需要考虑能否解决好以下10个问题"></a>四、选择微前端方案的时候需要考虑能否解决好以下10个问题</h3><ul><li>微应用的注册、异步加载和生命周期管理；</li><li>微应用之间、主从之间的消息机制；</li><li>微应用之间的安全隔离措施；</li><li>微应用的框架无关、版本无关；</li><li>微应用之间、主从之间的公共依赖的库、业务逻辑(utils)以及版本怎么管理；</li><li>微应用独立调试、和主应用联调的方式，快速定位报错（发射问题）；</li><li>微应用的发布流程；</li><li>微应用打包优化问题；</li><li>微应用专有云场景的出包方案；</li><li>渐进式升级：用微应用方案平滑重构老项目。</li></ul><p><a href="https://qiankun.umijs.org/zh">微前端 qiankun - 阿里</a> 通过监听url change事件，在路由变化时匹配到渲染的子应用，获取到相关资源并进行渲染。</p><p><a href="https://zeroing.jd.com/">微前端 MicroApp - 京东</a> 基于WebComponent的思路将子应用以组件化形式接入主应用中。</p><p><a href="https://zh-hans.single-spa.js.org/docs/getting-started-overview/">微前端 single-spa</a> 最早的前端微服务 Javascript 框架，兼容多种前端技术栈</p><p><a href="https://micro-frontends.ice.work/">微前端 Icestark - 阿里</a>面向大型系统的微前端解决方案</p><p><a href="https://alfajs.io/">微前端 alfajs - 阿里</a> 企业级的微前端解决方案</p><p><a href="https://webpack.js.org/concepts/module-federation/">微前端 Module Federation - webpack5</a> 是 Zack Jackson 发明的 JavaScript 架构，Zack Jackson 随后提出为其创建一个 Webpack 插件。</p><p><a href="https://webpack.js.org/concepts/module-federation/">微前端 Bit</a> 将独立的组件构建、集成和组合到一起和管理前端</p><p><a href="https://webpack.js.org/concepts/module-federation/">微前端 PuzzleJS</a> 用于可扩展和快速建站的微前端框架</p><p><a href="https://github.com/woai3c/mini-single-spa">微前端 mini教学项目</a></p>]]></content>
    
    
    <categories>
      
      <category>前端工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>前端工程化</tag>
      
      <tag>开发资源</tag>
      
      <tag>tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2021-03-06-【UI组件库】10分钟搞定自定义vue组件库</title>
    <link href="/2025/11/28/2021-03-06-%E3%80%90UI%E7%BB%84%E4%BB%B6%E5%BA%93%E3%80%9110%E5%88%86%E9%92%9F%E6%90%9E%E5%AE%9A%E8%87%AA%E5%AE%9A%E4%B9%89vue%E7%BB%84%E4%BB%B6%E5%BA%93/"/>
    <url>/2025/11/28/2021-03-06-%E3%80%90UI%E7%BB%84%E4%BB%B6%E5%BA%93%E3%80%9110%E5%88%86%E9%92%9F%E6%90%9E%E5%AE%9A%E8%87%AA%E5%AE%9A%E4%B9%89vue%E7%BB%84%E4%BB%B6%E5%BA%93/</url>
    
    <content type="html"><![CDATA[<h1 id="10分钟搞定自定义vue组件库-kissing-cat"><a href="#10分钟搞定自定义vue组件库-kissing-cat" class="headerlink" title="10分钟搞定自定义vue组件库:kissing_cat:"></a>10分钟搞定自定义vue组件库:kissing_cat:</h1><h2 id="前言-sunny"><a href="#前言-sunny" class="headerlink" title="前言:sunny:"></a>前言:sunny:</h2><p>随着项目的日趋壮大，有时候原有的组件不能满足我们的各种需求，就需要在原有的组件上进行改造。自定义的个性化UI组件越来越多，为了更好地管理它们，同时提高组件的可复用性、扩展性，决定打造一套完整的UI组件库。</p><h2 id="技术栈-sunny"><a href="#技术栈-sunny" class="headerlink" title="技术栈:sunny:"></a>技术栈:sunny:</h2><ul><li>vue-cli3</li><li>vue2.X的基本语法</li><li>npm的发布</li></ul><h2 id="完整项目目录结构-sunny"><a href="#完整项目目录结构-sunny" class="headerlink" title="完整项目目录结构:sunny:"></a>完整项目目录结构:sunny:</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs stylus">wwlocal-ui<br>├─ <span class="hljs-selector-class">.eslintrc</span><span class="hljs-selector-class">.js</span><br>├─ <span class="hljs-selector-class">.gitignore</span><br>├─ <span class="hljs-selector-class">.npmignore</span><br>├─ babel<span class="hljs-selector-class">.config</span><span class="hljs-selector-class">.js</span><br>├─ docs   <span class="hljs-comment">// vuepress开发目录</span><br>│  ├─ <span class="hljs-selector-class">.vuepress</span><br>│  │  ├─ components   <span class="hljs-comment">// 在markdown中可以使用的vue组件</span><br>│  │  │  ├─ ww-search-bar<span class="hljs-selector-class">.vue</span><br>│  │  ├─ config<span class="hljs-selector-class">.js</span>   <span class="hljs-comment">// vurepess配置修改入口,包括左边sidebar,右上方nav导航菜单等</span><br>│  ├─ README<span class="hljs-selector-class">.md</span><br>│  └─ views<br>│     ├─ basic-components<br>│     │  ├─ searchBar<span class="hljs-selector-class">.md</span><br>│     └─ business-components<br>│        ├─ xxx<span class="hljs-selector-class">.md</span><br>├─ package-lock<span class="hljs-selector-class">.json</span><br>├─ package<span class="hljs-selector-class">.json</span>   <span class="hljs-comment">// 与npm发布相关，记录版本号，包入口文件地址</span><br>├─ packages   <span class="hljs-comment">// 组件库源码目录</span><br>│  ├─ search<br>│  │  ├─ index<span class="hljs-selector-class">.js</span><br>│  │  └─ <span class="hljs-attribute">src</span><br>│  │     └─ search<span class="hljs-selector-class">.vue</span><br>│  ├─ index<span class="hljs-selector-class">.js</span>   <span class="hljs-comment">// 组件库源码组件入口文件,执行npm run build的目标文件</span><br>├─ public   <span class="hljs-comment">//公共资源入口，如favicon</span><br>│  ├─ favicon<span class="hljs-selector-class">.ico</span><br>│  └─ index<span class="hljs-selector-class">.html</span><br>├─ static   <span class="hljs-comment">//静态资源入口，如icon图标</span><br>│  ├─ <span class="hljs-selector-tag">image</span> <br>├─ README<span class="hljs-selector-class">.md</span><br>├─ demo<br>│     └─ <span class="hljs-attribute">page</span><br>│  │     └─ testSearchBar<span class="hljs-selector-class">.vue</span><br>│  ├─ App<span class="hljs-selector-class">.vue</span><br>│  ├─ <span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.js</span><br>├─ vue<span class="hljs-selector-class">.config</span>.js<br></code></pre></td></tr></table></figure><h3 id="创建项目-sunny"><a href="#创建项目-sunny" class="headerlink" title="创建项目:sunny:"></a>创建项目:sunny:</h3><p>项目名起自己觉得有意义的名字就行了</p><blockquote><p>$ vue create demo-ui</p></blockquote><p>注意：由于我们是开发一个第三方依赖库，我们选择 <code>Manually select features</code>。</p><p>选择那些特性需要安装在项目中</p><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs delphi"><span class="hljs-comment">(*) Babel</span><br><span class="hljs-comment">( ) TypeScript</span><br><span class="hljs-comment">( ) Progressive Web App (PWA) Support</span><br><span class="hljs-comment">( ) Router</span><br><span class="hljs-comment">( ) Vuex</span><br><span class="hljs-comment">(*)</span> CSS Pre-processors<br><span class="hljs-comment">(*) Linter / Formatter</span><br><span class="hljs-comment">( ) Unit Testing</span><br><span class="hljs-comment">( ) E2E Testing</span><br></code></pre></td></tr></table></figure><p>系统默认的包含了基本的 <code>Babel + ESLint</code> 设置的 <code>preset</code>，我们只需要选择CSS配置。移动键盘上下键选择需要的特性，按下键盘空格键即可选中</p><p>安装哪一种 <code>CSS 预处理语言</code></p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nix">Sass<span class="hljs-symbol">/SCSS</span> (<span class="hljs-keyword">with</span> dart-sass)<br>Sass<span class="hljs-symbol">/SCSS</span> (<span class="hljs-keyword">with</span> node-sass)<br>Less<br>Stylus<br></code></pre></td></tr></table></figure><p>由于政务微信中的样式采用Sass，所以我们选择第一项即可 为什么不选择第二项呢？ 因为<code>dart-sass</code>比<code>node-sass</code>更好下载</p><p>选择代码风格</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">ESLint with <span class="hljs-built_in">error</span> prevention only<br>ESLint + Airbnb<span class="hljs-built_in"> config</span><br><span class="hljs-built_in"></span>ESLint + Standard<span class="hljs-built_in"> config</span><br><span class="hljs-built_in"></span>ESLint + Prettier<br></code></pre></td></tr></table></figure><p>一般选 <code>ESLint + Prettier</code>的组合</p><p>那种方式进行代码格式检测</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">(*) Lint <span class="hljs-keyword">on</span> save<br>( ) Lint <span class="hljs-keyword">and</span> fix <span class="hljs-keyword">on</span> <span class="hljs-keyword">commit</span><br></code></pre></td></tr></table></figure><p>选择<code>Ctrl+S</code>保存时检测代码格式即可</p><p>配置文件生成方式</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lua">In dedicated <span class="hljs-built_in">config</span> files<br>In <span class="hljs-built_in">package</span>.json<br></code></pre></td></tr></table></figure><p>看个人喜好，我选第一种</p><p>是否保存预配置</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">Save <span class="hljs-keyword">this</span> <span class="hljs-keyword">as</span> a preset <span class="hljs-keyword">for</span> future projects? (y/N)<br></code></pre></td></tr></table></figure><p>看项目需要，我这里选择 <code>N</code>。回车后，系统会自动帮我们把选择的配置集成到模板中，然后生成一个完整的项目。</p><h3 id="调整目录-sunny"><a href="#调整目录-sunny" class="headerlink" title="调整目录:sunny:"></a>调整目录:sunny:</h3><p>将src目录改为demo，用于测试我们自己开发的UI组件（在引入vuepress之后这个文件夹也不再需要了）。在根目录中创建一个<code>packages</code>目录用来存放我们要开发的UI组件；</p><p>新增packages目录，该目录未加入webpack编译；</p><blockquote><p>注：cli3 提供一个可选的 <code>vue.config.js</code> 配置文件。如果这个文件存在则他会被自动加载，所有的对项目和<code>webpack</code>的配置，都在这个文件中。</p></blockquote><blockquote><p>注: vue的package文件夹采用了<code>monorepo</code>:monorepo是一种将多个package放在一个repo中的代码管理模式，摒弃了传统的多个package多个repo的模式。关于monorepo可以在 <a href="https://juejin.cn/post/6844903961896435720">Vue3.0 中的 monorepo 管理模式</a>这篇文章中了解</p></blockquote><h3 id="webpack配置修改-sunny"><a href="#webpack配置修改-sunny" class="headerlink" title="webpack配置修改:sunny:"></a>webpack配置修改:sunny:</h3><p>packages 是我们新增的一个目录，默认是不被 webpack 处理的，所以需要添加配置对该目录的支持。</p><p>chainWebpack 是一个函数，会接收一个基于 webpack-chain 的 ChainableConfig 实例。允许对内部的 webpack 配置进行更细粒度的修改。在根目录创建vue.config.js文件，作如下配置：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 修改 src 为 demo</span><br><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;path&quot;</span>);<br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">pages</span>: &#123;<br>    <span class="hljs-attr">index</span>: &#123;<br>      <span class="hljs-attr">entry</span>: <span class="hljs-string">&quot;demo/main.js&quot;</span>,<br>      <span class="hljs-attr">template</span>: <span class="hljs-string">&quot;public/index.html&quot;</span>,<br>      <span class="hljs-attr">filename</span>: <span class="hljs-string">&quot;index.html&quot;</span><br>    &#125;<br>  &#125;,<br>  <span class="hljs-comment">// 扩展 webpack 配置，使 packages 加入编译</span><br>  <span class="hljs-attr">chainWebpack</span>: <span class="hljs-function"><span class="hljs-params">config</span> =&gt;</span> &#123;<br>    config.<span class="hljs-property">module</span><br>      .<span class="hljs-title function_">rule</span>(<span class="hljs-string">&quot;js&quot;</span>)<br>      .<span class="hljs-property">include</span>.<span class="hljs-title function_">add</span>(path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;packages&quot;</span>))<br>      .<span class="hljs-title function_">end</span>()<br>      .<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;babel&quot;</span>)<br>      .<span class="hljs-title function_">loader</span>(<span class="hljs-string">&quot;babel-loader&quot;</span>)<br>      .<span class="hljs-title function_">tap</span>(<span class="hljs-function"><span class="hljs-params">options</span> =&gt;</span> &#123;<br>        <span class="hljs-keyword">return</span> options;<br>      &#125;);<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="组件编写-sunny"><a href="#组件编写-sunny" class="headerlink" title="组件编写:sunny:"></a>组件编写:sunny:</h2><h3 id="SearchBar-组件"><a href="#SearchBar-组件" class="headerlink" title="SearchBar 组件"></a>SearchBar 组件</h3><ol><li>在 <code>packages</code> 目录下，所有的单个组件都以文件夹的形式存储，所有这里创建一个目录 <code>search</code></li><li>在 <code>search</code> 目录下创建 <code>src</code> 目录存储组件源码</li><li>在 <code>search</code> 目录下创建 <code>index.js</code> 文件对外提供对组件的引用。</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">SearchBar</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./src/index.vue&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-variable constant_">COMPONENT_PREFIX</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../constants&#x27;</span><br><br><span class="hljs-comment">// 为组件提供 install 安装方法，供按需引入</span><br><span class="hljs-title class_">SearchBar</span>.<span class="hljs-property">install</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">Vue</span>) &#123;<br>  <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">component</span>(<span class="hljs-variable constant_">COMPONENT_PREFIX</span> + <span class="hljs-title class_">SearchBar</span>.<span class="hljs-property">name</span>, <span class="hljs-title class_">SearchBar</span>);<br>&#125;;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">SearchBar</span>;<br></code></pre></td></tr></table></figure><ol><li><code>/packages/search/src/index.vue</code>核心组件代码。</li></ol><h3 id="导出所有组件-sunny"><a href="#导出所有组件-sunny" class="headerlink" title="导出所有组件:sunny:"></a>导出所有组件:sunny:</h3><ul><li>整合所有的组件，对外导出，即一个完整的组件库 修改 <code>/packages/index.js</code> 文件，对整个组件库进行导出:</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Package</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../package.json&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">SearchBar</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./search&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-variable constant_">COMPONENT_PREFIX</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./constants&#x27;</span><br><br><span class="hljs-comment">// 存储组件列表</span><br><span class="hljs-keyword">const</span> components = &#123; <span class="hljs-title class_">SearchBar</span> &#125;;<br><span class="hljs-keyword">const</span> component_version = <span class="hljs-title class_">Package</span>.<span class="hljs-property">version</span><br><br><span class="hljs-comment">// 定义 install 方法，接收 Vue 作为参数。如果使用 use 注册插件，则所有的组件都将被注册</span><br><span class="hljs-keyword">const</span> install = <span class="hljs-keyword">function</span>(<span class="hljs-params">Vue</span>) &#123;<br>  <span class="hljs-comment">// 遍历注册全局组件</span><br>  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(components).<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">key</span>) &#123;<br>    <span class="hljs-keyword">const</span> item = components[key]<br>    <span class="hljs-keyword">if</span> (item.<span class="hljs-property">install</span>) &#123;<br>      <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(item);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.<span class="hljs-property">name</span>) &#123;<br>      <span class="hljs-comment">// 统一加 组件前缀</span><br>      <span class="hljs-keyword">const</span> name = <span class="hljs-variable constant_">COMPONENT_PREFIX</span> + item.<span class="hljs-property">name</span><br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(name)<br>      <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">component</span>(name, item);<br>    &#125;<br>  &#125;);<br>&#125;;<br><span class="hljs-comment">// 判断是否是直接引入文件</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> !== <span class="hljs-string">&#x27;undefined&#x27;</span> &amp;&amp; <span class="hljs-variable language_">window</span>.<span class="hljs-property">Vue</span>) &#123;<br>  <span class="hljs-title function_">install</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">Vue</span>);<br>&#125;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-comment">// 导出的对象必须具有 install，才能被 Vue.use() 方法安装</span><br>  <span class="hljs-attr">version</span>: component_version,<br>  install,<br>  ...components<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="组件库打包"><a href="#组件库打包" class="headerlink" title="组件库打包"></a>组件库打包</h3><ul><li><code>package.json</code> 中的<code>script</code>下新增一条编译为库的命令,然后就可以使用<code>npm run lib</code>命令进行打包啦</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-string">&quot;scripts&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;lib&quot;</span>: <span class="hljs-string">&quot;vue-cli-service build --target lib --name zyx-ui --dest lib packages/index.js&quot;</span><br>  &#125;,<br></code></pre></td></tr></table></figure><p><strong>注:</strong></p><ol><li><code>--target</code>: 构建目标，默认为应用模式。这里修改为 lib 启用库模式。</li><li><code>dest</code> : 输出目录，默认 dist。这里我们改成 lib</li><li><code>[entry]</code>: 最后一个参数为入口文件，默认为 src&#x2F;App.vue。这里我们指定编译 packages&#x2F; 组件库目录</li></ol><ul><li>执行编译库命令</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm run lib<br></code></pre></td></tr></table></figure><h3 id="npm发布包"><a href="#npm发布包" class="headerlink" title="npm发布包"></a>npm发布包</h3><ul><li>首先创建一个npm账户  <code>$ npm adduser</code> 注册一个内部用户，具体操作同npm，可以自行百度。</li></ul><ul><li>配置 <code>package.json</code> 文件中发布到 <code>npm</code> 的字段</li></ul><ol><li>name: 包名，该名字是唯一的。可在 npm 官网搜索名字，如果存在则需换个名字。</li><li>version: 版本号，每次发布至 npm 需要修改版本号，不能和历史版本号相同。</li><li>description: 项目描述。</li><li>main: 入口文件，该字段需指向我们最终编译后的包文件。</li><li>keyword：关键字，以空格分离希望用户最终搜索的词。</li><li>author：作者</li><li>private：是否私有，需要修改为 false 才能发布到 npm</li><li>license： 开源协议</li><li>browserslist: 指定了项目的目标浏览器的范围</li><li>repository: 指定代码所在的位置</li></ol><ul><li>执行发布指令</li></ul><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript"><span class="hljs-built_in">npm</span> publish<br></code></pre></td></tr></table></figure><ul><li>另外，可在24小时内对已发布的包进行撤回操作 <code>npm unpublish 你的包名</code></li></ul><p>如果失败可加上 <code>--force</code>参数</p>]]></content>
    
    
    <categories>
      
      <category>vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>UI组件库</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2019-04-16-echart3使用技巧</title>
    <link href="/2025/11/28/2021-03-11-%E3%80%90UI%E7%BB%84%E4%BB%B6%E5%BA%93%E3%80%9115%E5%88%86%E9%92%9F%E6%90%9E%E5%AE%9AUI%E7%BB%84%E4%BB%B6%E5%BA%93%E5%AE%98%E7%BD%91%E5%88%B6%E4%BD%9C/"/>
    <url>/2025/11/28/2021-03-11-%E3%80%90UI%E7%BB%84%E4%BB%B6%E5%BA%93%E3%80%9115%E5%88%86%E9%92%9F%E6%90%9E%E5%AE%9AUI%E7%BB%84%E4%BB%B6%E5%BA%93%E5%AE%98%E7%BD%91%E5%88%B6%E4%BD%9C/</url>
    
    <content type="html"><![CDATA[<h1 id="15分钟搞定UI组件库官网制作-kissing-cat"><a href="#15分钟搞定UI组件库官网制作-kissing-cat" class="headerlink" title="15分钟搞定UI组件库官网制作:kissing_cat:"></a>15分钟搞定UI组件库官网制作:kissing_cat:</h1><h2 id="技术栈-sunny"><a href="#技术栈-sunny" class="headerlink" title="技术栈:sunny:"></a>技术栈:sunny:</h2><ul><li>vue-cli3</li><li><a href="https://vuepress.vuejs.org/zh/">vuepress</a></li></ul><h2 id="官网制作-kissing-heart"><a href="#官网制作-kissing-heart" class="headerlink" title="官网制作:kissing_heart:"></a>官网制作:kissing_heart:</h2><p>使用 <a href="https://vuepress.vuejs.org/zh/">vuepress</a></p><ul><li>在原有项目中加包</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">安装依赖</span><br>npm install -D vuepress<br><span class="hljs-meta prompt_"># </span><span class="language-bash">创建一个 docs 目录</span><br>mkdir docs<br></code></pre></td></tr></table></figure><ul><li>在<code>package.json</code>中进行脚本配置</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-string">&quot;scripts&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;docs:dev&quot;</span>: <span class="hljs-string">&quot;vuepress dev docs&quot;</span>,<br>    <span class="hljs-string">&quot;docs:build&quot;</span>: <span class="hljs-string">&quot;vuepress build docs&quot;</span><br>  &#125;,<br></code></pre></td></tr></table></figure><ul><li>简单配置 在<code>docs/.vuepress</code>下新建文件<code>config.js</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">base</span>: <span class="hljs-string">&#x27;/demo-ui/&#x27;</span>,<br>  <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;项目名称&#x27;</span>,<br>  <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;项目描述&#x27;</span>,<br>  <span class="hljs-attr">head</span>: [[<span class="hljs-string">&#x27;link&#x27;</span>, &#123; <span class="hljs-attr">rel</span>: <span class="hljs-string">&#x27;icon&#x27;</span>, <span class="hljs-attr">href</span>: <span class="hljs-string">&#x27;/favicon.png&#x27;</span> &#125;]],<br>  <span class="hljs-attr">themeConfig</span>: &#123;<br>    <span class="hljs-comment">// 导航栏logo</span><br>    <span class="hljs-attr">logo</span>: <span class="hljs-string">&#x27;/favicon.png&#x27;</span>,<br>    <span class="hljs-attr">nav</span>: [<br>      &#123; <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;主页&#x27;</span>, <span class="hljs-attr">link</span>: <span class="hljs-string">&#x27;/&#x27;</span> &#125;,<br>      &#123; <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;git&#x27;</span>, <span class="hljs-attr">link</span>: <span class="hljs-string">&#x27;http://xxx.xxx.xx/demo-ui.git&#x27;</span> &#125;,<br>    ],<br>    <span class="hljs-comment">// 显示所有页面的标题链接</span><br>    <span class="hljs-attr">displayAllHeaders</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">sidebar</span>: [<br>      [<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-string">&#x27;介绍&#x27;</span>],<br>      &#123;<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;组件&#x27;</span>,<br>        <span class="hljs-attr">collapsable</span>: <span class="hljs-literal">false</span>,<br>        <span class="hljs-attr">children</span>: [<br>          &#123;<br>            <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;基础组件&#x27;</span>,<br>            <span class="hljs-attr">collapsable</span>: <span class="hljs-literal">false</span>,<br>            <span class="hljs-attr">children</span>: [<br>              [<span class="hljs-string">&#x27;views/basic-components/searchBar&#x27;</span>, <span class="hljs-string">&#x27;searchBar&#x27;</span>],<br>              [<span class="hljs-string">&#x27;views/basic-components/topBar&#x27;</span>, <span class="hljs-string">&#x27;topBar&#x27;</span>]<br>            ]<br>          &#125;,<br>          &#123;<br>            <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;业务组件&#x27;</span>,<br>            <span class="hljs-attr">collapsable</span>: <span class="hljs-literal">false</span>,<br>            <span class="hljs-attr">children</span>: [<br>              [<span class="hljs-string">&#x27;views/business-components/weTree&#x27;</span>, <span class="hljs-string">&#x27;weTree&#x27;</span>]<br>            ]<br>          &#125;<br>        ]<br>      &#125;,<br>    ],<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure><ul><li>使用vue组件（非必须，可跳过）</li></ul><p>官网中提到，所有在 <code>.vuepress/components</code> 中找到的 <code>*.vue</code> 文件将会自动地被注册为全局的异步组件，可以在<code>markdown</code>中引用,我们可以在这里编写展示案例 ；（当然也可以直接使用下面的<a href="https://docs.chenjianhui.site/vuepress-plugin-demo-container/zh/"><code>vuepress-plugin-demo-container</code></a>直接在md中编写示例），vue文件中的代码高亮我用的是<code>vue-highlightjs</code>: 在<code>/docs/.vuepress/components/</code>下创建搜索框<code>ww-search-bar.vue</code>文件</p><ul><li>使用<a href="https://docs.chenjianhui.site/vuepress-plugin-demo-container/zh/"><code>vuepress-plugin-demo-container</code></a> 插件，</li></ul><p>可用于展示示例及代码，使用 ::: demo XXX ::: 包裹需要展示的示例。具体使用请查看官网介绍。</p><ul><li>配置中文文案</li></ul><p>在 docs -&gt; .vuepress -&gt; config.js 中添加如下配置：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">locales</span>: &#123;<br>    <span class="hljs-comment">// 键名是该语言所属的子路径</span><br>    <span class="hljs-comment">// 作为特例，默认语言可以使用 &#x27;/&#x27; 作为其路径。</span><br>    <span class="hljs-string">&#x27;/&#x27;</span>: &#123;<br>      <span class="hljs-string">&quot;lang&quot;</span>: <span class="hljs-string">&quot;zh-CN&quot;</span>,<br>      <span class="hljs-string">&quot;demo-block&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;hide-text&quot;</span>: <span class="hljs-string">&quot;隐藏代码&quot;</span>,<br>        <span class="hljs-string">&quot;show-text&quot;</span>: <span class="hljs-string">&quot;显示代码&quot;</span>,<br>        <span class="hljs-string">&quot;copy-text&quot;</span>: <span class="hljs-string">&quot;复制代码&quot;</span>,<br>        <span class="hljs-string">&quot;copy-success&quot;</span>: <span class="hljs-string">&quot;复制成功&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br></code></pre></td></tr></table></figure><ul><li>引入 自定义组件库中的组件，便于md文档中直接使用，无需挨个引入组件：</li></ul><p>在 docs -&gt; .vuepress 目录下添加 <code>enhanceApp.js</code>文件，内容如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> demoUI <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../packages&#x27;</span><br><span class="hljs-keyword">export</span> <span class="hljs-title function_">default</span> (&#123; <span class="hljs-title class_">Vue</span> &#125;) =&gt; &#123;<br>  <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(demoUI)<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>自定义官网模板样式（非必须，可跳过）</li></ul><p>在 docs -&gt; .vuepress 目录下添加styles文件夹，再添加palette.styl 文件，内容如下：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-comment">// 用于重写默认颜色常量，或者设置新的 stylus 颜色常量</span><br><span class="hljs-comment">// 颜色</span><br><span class="hljs-variable">$accentColor</span> = <span class="hljs-selector-id">#1296db</span><br><span class="hljs-variable">$textColor</span> = <span class="hljs-selector-id">#2c3e50</span><br><span class="hljs-variable">$borderColor</span> = <span class="hljs-selector-id">#eaecef</span><br><span class="hljs-variable">$codeBgColor</span> = <span class="hljs-selector-id">#282c34</span><br><span class="hljs-variable">$arrowBgColor</span> = <span class="hljs-selector-id">#ccc</span><br><span class="hljs-variable">$badgeTipColor</span> = <span class="hljs-selector-id">#16a0e2</span><br><span class="hljs-variable">$badgeWarningColor</span> = <span class="hljs-built_in">darken</span>(#ffe564, <span class="hljs-number">35%</span>)<br><span class="hljs-variable">$badgeErrorColor</span> = <span class="hljs-selector-id">#DA5961</span><br><br><span class="hljs-comment">// 布局</span><br><span class="hljs-variable">$navbarHeight</span> = <span class="hljs-number">3.6rem</span><br><span class="hljs-variable">$sidebarWidth</span> = <span class="hljs-number">20rem</span><br><span class="hljs-variable">$contentWidth</span> = <span class="hljs-number">740px</span><br><span class="hljs-variable">$homePageWidth</span> = <span class="hljs-number">960px</span><br><br><span class="hljs-comment">// 响应式变化点</span><br><span class="hljs-variable">$MQNarrow</span> = <span class="hljs-number">959px</span><br><span class="hljs-variable">$MQMobile</span> = <span class="hljs-number">719px</span><br><span class="hljs-variable">$MQMobileNarrow</span> = <span class="hljs-number">419px</span><br></code></pre></td></tr></table></figure><ul><li>编写文档</li></ul><p>由于所有的页面在生成静态 HTML 时都需要通过 Node.js 服务端渲染，对于SSR 不怎么友好的组件（比如包含了自定义指令），你可以将它们包裹在内置的 ClientOnly 组件中，而且注意因为是ssr,组件内部beforeCreate, created生命周期钩子函数访问不到浏览器 &#x2F; DOM 的 API，只能在beforeMount和mounted中调用。</p><p><code>/docs/views/components/basic</code>下创建<code>README.md</code>:</p><ul><li>打包官网项目</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs she">npm run docs:build<br></code></pre></td></tr></table></figure><h3 id="可参考-完整的组件doc"><a href="#可参考-完整的组件doc" class="headerlink" title="[可参考] 完整的组件doc"></a>[可参考] 完整的组件doc</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section">### WwSearchBar 搜索输入框</span><br><br>通过鼠标或键盘输入字符<br><br>:::warning Input 为受控组件，它<span class="hljs-strong">**总会显示 Vue 绑定值**</span>。<br><br>通常情况下，应当处理 <span class="hljs-code">`input`</span> 事件，并更新组件的绑定值（或使用<span class="hljs-code">`v-model`</span>）。否则，输入框内显示的值将不会改变。<br><br>不支持 <span class="hljs-code">`v-model`</span> 修饰符。<br>:::<br><br><span class="hljs-section">### 基础用法</span><br><br>::: demo<br>​<span class="hljs-code">```html</span><br><span class="hljs-code">&lt;template&gt;</span><br><span class="hljs-code">  &lt;div class=&quot;app&quot;&gt;</span><br><span class="hljs-code">    &lt;WwSearchBar v-on:onClear=&quot;clearChatListSearchInput&quot;</span><br><span class="hljs-code">                        v-on:onChanged=&quot;onChanged($event)&quot;</span><br><span class="hljs-code">                        :defaultCenter=&quot;false&quot;</span><br><span class="hljs-code">                        :searchKeyword=&quot;searchKeyword&quot;</span><br><span class="hljs-code">                        type=&quot;white&quot;</span><br><span class="hljs-code">                        :inputWidth=&quot;220&quot;/&gt;</span><br><span class="hljs-code">  &lt;/div&gt;</span><br><span class="hljs-code">&lt;/template&gt;</span><br><span class="hljs-code">&lt;script&gt;</span><br><span class="hljs-code">export default &#123;</span><br><span class="hljs-code">  data() &#123;</span><br><span class="hljs-code">    return &#123;</span><br><span class="hljs-code">      searchKeyword: &#x27;&#x27;</span><br><span class="hljs-code">    &#125;</span><br><span class="hljs-code">  &#125;,</span><br><span class="hljs-code">  methods: &#123;</span><br><span class="hljs-code">    onChanged(value) &#123;</span><br><span class="hljs-code">      this.searchKeyword = value</span><br><span class="hljs-code">    &#125;,</span><br><span class="hljs-code">    clearChatListSearchInput() &#123;</span><br><span class="hljs-code">      this.searchKeyword = &#x27;&#x27;</span><br><span class="hljs-code">    &#125;,</span><br><span class="hljs-code">  &#125;,</span><br><span class="hljs-code">&#125;;</span><br><span class="hljs-code">&lt;/script&gt;</span><br><span class="hljs-code">:::</span><br><span class="hljs-code"></span><br><span class="hljs-code">### 灰色主题</span><br><span class="hljs-code"></span><br><span class="hljs-code">::: demo 通过设置 ```</span>type=&quot;gray&quot;<span class="hljs-code">```</span><br><span class="hljs-code">​```</span>html<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span></span><br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span></span><br><span class="hljs-code">    &lt;WwSearchBar v-on:onClear=&quot;clearChatListSearchInput&quot;</span><br><span class="hljs-code">                        v-on:onChanged=&quot;onChanged($event)&quot;</span><br><span class="hljs-code">                        :defaultCenter=&quot;false&quot;</span><br><span class="hljs-code">                        :searchKeyword=&quot;searchKeyword&quot;</span><br><span class="hljs-code">                        type=&quot;gray&quot;</span><br><span class="hljs-code">                        :inputWidth=&quot;220&quot;/&gt;</span><br><span class="hljs-code">  &lt;/div&gt;</span><br><span class="hljs-code">&lt;/template&gt;</span><br><span class="hljs-code">&lt;script&gt;</span><br><span class="hljs-code">export default &#123;</span><br><span class="hljs-code">  data() &#123;</span><br><span class="hljs-code">    return &#123;</span><br><span class="hljs-code">      searchKeyword: &#x27;&#x27;</span><br><span class="hljs-code">    &#125;</span><br><span class="hljs-code">  &#125;,</span><br><span class="hljs-code">  methods: &#123;</span><br><span class="hljs-code">    onChanged(value) &#123;</span><br><span class="hljs-code">      this.searchKeyword = value</span><br><span class="hljs-code">    &#125;,</span><br><span class="hljs-code">    clearChatListSearchInput() &#123;</span><br><span class="hljs-code">      this.searchKeyword = &#x27;&#x27;</span><br><span class="hljs-code">    &#125;,</span><br><span class="hljs-code">  &#125;,</span><br><span class="hljs-code">&#125;;</span><br><span class="hljs-code">&lt;/script&gt;</span><br><span class="hljs-code">:::</span><br><span class="hljs-code"></span><br><span class="hljs-section">### placeholder 自定义</span><br><br>::: demo 通过设置 <span class="hljs-code">```placeholder``` </span>来修改提示信息<br>​<span class="hljs-code">```html</span><br><span class="hljs-code">&lt;template&gt;</span><br><span class="hljs-code">  &lt;div class=&quot;app&quot;&gt;</span><br><span class="hljs-code">    &lt;WwSearchBar v-on:onClear=&quot;clearChatListSearchInput&quot;</span><br><span class="hljs-code">                        v-on:onChanged=&quot;onChanged($event)&quot;</span><br><span class="hljs-code">                        :defaultCenter=&quot;false&quot;</span><br><span class="hljs-code">                        :searchKeyword=&quot;searchKeyword&quot;</span><br><span class="hljs-code">                        type=&quot;white&quot;</span><br><span class="hljs-code">                        placeHolder=&quot;自定义搜索提示&quot;</span><br><span class="hljs-code">                        :inputWidth=&quot;220&quot;/&gt;</span><br><span class="hljs-code">  &lt;/div&gt;</span><br><span class="hljs-code">&lt;/template&gt;</span><br><span class="hljs-code">&lt;script&gt;</span><br><span class="hljs-code">export default &#123;</span><br><span class="hljs-code">  data() &#123;</span><br><span class="hljs-code">    return &#123;</span><br><span class="hljs-code">      searchKeyword: &#x27;&#x27;</span><br><span class="hljs-code">    &#125;</span><br><span class="hljs-code">  &#125;,</span><br><span class="hljs-code">  methods: &#123;</span><br><span class="hljs-code">    onChanged(value) &#123;</span><br><span class="hljs-code">      this.searchKeyword = value</span><br><span class="hljs-code">    &#125;,</span><br><span class="hljs-code">    clearChatListSearchInput() &#123;</span><br><span class="hljs-code">      this.searchKeyword = &#x27;&#x27;</span><br><span class="hljs-code">    &#125;,</span><br><span class="hljs-code">  &#125;,</span><br><span class="hljs-code">&#125;;</span><br><span class="hljs-code">&lt;/script&gt;</span><br><span class="hljs-code">:::</span><br><span class="hljs-code"></span><br><span class="hljs-code">&lt;ClientOnly&gt;</span><br><span class="hljs-code">### SearchBar Attributes</span><br><span class="hljs-code">| 参数| 说明 | 类型 | 可选值 | 默认值 |</span><br><span class="hljs-code">| :------ | ------ | ------ | ------ | ------ |</span><br><span class="hljs-code">| defaultCenter | 提示文案是否居中 | boolean | false / true | false |</span><br><span class="hljs-code">| searchKeyword | 输入关键字 | string | - | - |</span><br><span class="hljs-code">| type | 搜索框类型 | string | white / gray | white |</span><br><span class="hljs-code">| inputWidth | 输入字符宽度，根据字符长度计算 | string | -  | - |</span><br><span class="hljs-code">| autoFocus | 是否自动获取焦点 | boolean | - | false |</span><br><span class="hljs-code"></span><br><span class="hljs-code">&lt;/ClientOnly&gt;</span><br><span class="hljs-code"></span><br><span class="hljs-code">### SearchBar Events</span><br><span class="hljs-code">| 事件名称 | 说明 | 回调参数 |</span><br><span class="hljs-code">|---------|--------|---------|</span><br><span class="hljs-code">| onBegin | 在 SearchBar 获得焦点时触发 | (searchKeyword: String) |</span><br><span class="hljs-code">| onEnd | 在 SearchBar 失去焦点时触发 | (searchKeyword: String) |</span><br><span class="hljs-code">| onClear | 在点击由 `clearable` 属性生成的清空按钮时触发 | - |</span><br><span class="hljs-code">| onChanged | 在 SearchBar 值改变时触发 | (searchKeyword: String) |</span><br><span class="hljs-code"></span><br></code></pre></td></tr></table></figure><h2 id="官网部署-sunny-手动部署"><a href="#官网部署-sunny-手动部署" class="headerlink" title="官网部署:sunny: - [手动部署]"></a>官网部署:sunny: - [手动部署]</h2><ul><li><p>申请devcloud服务器</p></li><li><p>登录devcloud服务器</p></li><li><p>安装并配置iFit</p></li><li><p>利用iFit 上传官网包至服务器</p></li><li><p>安装nginx</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum install nginx -y<br></code></pre></td></tr></table></figure><ul><li>修改nginx配置</li></ul><p>静态资源路径修改</p><p>添加项目别名，避免项目内资源应用路径错误</p><ul><li>重启nginx</li><li>域名申请</li></ul>]]></content>
    
    
    <categories>
      
      <category>vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>UI组件库</tag>
      
      <tag>vuepress</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2021-09-28-【小程序】小程序开发-环境篇</title>
    <link href="/2025/11/28/2021-09-28-%E3%80%90%E5%B0%8F%E7%A8%8B%E5%BA%8F%E3%80%91%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91-%E5%88%86%E5%8C%85/"/>
    <url>/2025/11/28/2021-09-28-%E3%80%90%E5%B0%8F%E7%A8%8B%E5%BA%8F%E3%80%91%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91-%E5%88%86%E5%8C%85/</url>
    
    <content type="html"><![CDATA[<h2 id="微信小程序分包"><a href="#微信小程序分包" class="headerlink" title="微信小程序分包"></a>微信小程序分包</h2><h3 id="一、为什么要分包？"><a href="#一、为什么要分包？" class="headerlink" title="一、为什么要分包？"></a>一、为什么要分包？</h3><ol><li>小程序要求压缩包体积不能大于2M，否则无法编译发布；</li><li>在实际项目中，体积大于2M时就需要通过分包机制进行发布上传；</li><li>对小程序进行分包，可以优化小程序首次启动的下载时间，因为分包后主包体积小了，有效提高用户体验；</li><li>将小程序划分成不同的子包，在构建时打包成不同的分包，用户在使用时按需进行加载，提高了程序性能；</li></ol><h3 id="二、使用分包"><a href="#二、使用分包" class="headerlink" title="二、使用分包"></a>二、使用分包</h3><p><strong>1、常规分包</strong></p><p>通过在 app.json <code>subpackages</code> 字段声明项目分包结构，配置如下：</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs prolog">&#123;<br>  <span class="hljs-string">&quot;pages&quot;</span>:[<br>    <span class="hljs-string">&quot;pages/index&quot;</span>,<br>    <span class="hljs-string">&quot;pages/logs&quot;</span><br>  ],<br>  <span class="hljs-string">&quot;subpackages&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;root&quot;</span>: <span class="hljs-string">&quot;packageA&quot;</span>,<br>      <span class="hljs-string">&quot;pages&quot;</span>: [<br>        <span class="hljs-string">&quot;pages/cat&quot;</span>,<br>        <span class="hljs-string">&quot;pages/dog&quot;</span><br>      ]<br>    &#125;, &#123;<br>      <span class="hljs-string">&quot;root&quot;</span>: <span class="hljs-string">&quot;packageB&quot;</span>,<br>      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;pack2&quot;</span>,<br>      <span class="hljs-string">&quot;pages&quot;</span>: [<br>        <span class="hljs-string">&quot;pages/apple&quot;</span>,<br>        <span class="hljs-string">&quot;pages/banana&quot;</span><br>      ]<br>    &#125;<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="打包原则"><a href="#打包原则" class="headerlink" title="打包原则"></a>打包原则</h4><ul><li>声明 <code>subpackages</code> 后，将按 <code>subpackages</code> 配置路径进行打包，<code>subpackages</code> 配置路径外的目录将被打包到 app（主包） 中</li><li>app（主包）也可以有自己的 pages（即最外层的 pages 字段）</li><li><code>subpackage</code> 的根目录不能是另外一个 <code>subpackage</code> 内的子目录</li><li><code>tabBar</code> 页面必须在 app（主包）内</li></ul><h4 id="引用原则"><a href="#引用原则" class="headerlink" title="引用原则"></a>引用原则</h4><ul><li><code>packageA</code> 无法 require <code>packageB</code> JS 文件，但可以 require <code>app</code>、自己 package 内的 JS 文件；使用 <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/subpackages/async.html">分包异步化</a> 时不受此条限制</li><li><code>packageA</code> 无法 import <code>packageB</code> 的 template，但可以 require <code>app</code>、自己 package 内的 template</li><li><code>packageA</code> 无法使用 <code>packageB</code> 的资源，但可以使用 <code>app</code>、自己 package 内的资源</li></ul><h4 id="低版本兼容"><a href="#低版本兼容" class="headerlink" title="低版本兼容"></a>低版本兼容</h4><p>由微信后台编译来处理旧版本客户端的兼容，后台会编译两份代码包，一份是分包后代码，另外一份是整包的兼容代码。 新客户端用分包，老客户端还是用的整包，完整包会把各个 <code>subpackage</code> 里面的路径放到 pages 中。</p><h2 id="分包步骤"><a href="#分包步骤" class="headerlink" title="分包步骤"></a>分包步骤</h2><ol><li><p>规划分包后，包文件管理，通过工具迁移页面</p></li><li><p>配置app.json 配置 <code>subpackages</code></p></li><li><p>修改页面跳转路径、组件、工具包、静态资源路径是否正确，wx.navigateTo({</p></li><li><p>通过工具编译，预览检测资源路径是否正确</p></li></ol><p><strong>2、独立分包</strong></p><p>  独立分包是小程序中一种特殊类型的分包，可以独立于主包和其他分包运行。一个小程序中可以有多个独立分包。常见应用场景为：临时加的广告也或活动页面</p>]]></content>
    
    
    <categories>
      
      <category>小程序</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mini-program</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2021-05-06-vue编码规范</title>
    <link href="/2025/11/28/2021-05-06-%E3%80%90%E8%A7%84%E8%8C%83%E3%80%91vue%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/"/>
    <url>/2025/11/28/2021-05-06-%E3%80%90%E8%A7%84%E8%8C%83%E3%80%91vue%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/</url>
    
    <content type="html"><![CDATA[<blockquote></blockquote><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>前端规范管理，eslint、stylelint辅助管理。</p><blockquote><p>ESLint、Stylelint、Prettier、EditorConfig这些检测工具的工作原理都比较类似，不外乎对象实例化-编译Javascript-遍历AST检测-输出检测结果这四步流程</p></blockquote><ul><li>ESLint：检测代码质量和代码风格;</li><li>StyleLint：检测样式代码质量和代码风格;</li><li>Prettier：检测代码风格;（ESLint、StyleLint调和剂，解决重复的规则【Error Loop】）</li><li>EditorConfig：统一不同IDE之间的配置差异，例如一个编辑器行缩进使用的是Tab，另一个编辑器使用的则是空格Space;</li></ul><h2 id="规范配置步骤"><a href="#规范配置步骤" class="headerlink" title="规范配置步骤"></a>规范配置步骤</h2><ul><li>vue项目完整的规范配置，分为以下四步：</li></ul><ol><li>核心规则配置：各检测工具必要的规则配置文件，没有它们检测工具无法执行，如.eslintrc文件。</li><li>命令行脚本配置：package.json的script属性配置执行脚本，开发人员手动执行命令，如npm run lint。</li><li>开发环境配置：webpack开发环境构建配置中，添加开发环境运行时检测插件，类似于启动器，运行时自动执行各自的检测工具进行检测。</li><li>编辑器配置：VSCode编辑器安装插件并配置属性，实时进行检测。</li></ol><h2 id="第一步："><a href="#第一步：" class="headerlink" title="第一步："></a>第一步：</h2><h3 id="1-eslint配置-eslintrc-js"><a href="#1-eslint配置-eslintrc-js" class="headerlink" title="1. eslint配置 - .eslintrc.js"></a>1. eslint配置 - .eslintrc.js</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">root</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-attr">env</span>: &#123;<br>    <span class="hljs-attr">node</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">browser</span>: <span class="hljs-literal">true</span>,<br>  &#125;,<br>  <span class="hljs-attr">extends</span>: [<span class="hljs-string">&#x27;plugin:vue/essential&#x27;</span>, <span class="hljs-string">&#x27;airbnb-base&#x27;</span>, <span class="hljs-string">&#x27;plugin:prettier/recommended&#x27;</span>],<br>  <span class="hljs-attr">parserOptions</span>: &#123;<br>    <span class="hljs-attr">parser</span>: <span class="hljs-string">&#x27;babel-eslint&#x27;</span>,<br>    <span class="hljs-attr">ecmaFeatures</span>: &#123;<br>      <span class="hljs-attr">jsx</span>: <span class="hljs-literal">true</span>,<br>    &#125;,<br>  &#125;,<br>  <span class="hljs-attr">plugins</span>: [<span class="hljs-string">&#x27;import&#x27;</span>],<br>  <span class="hljs-attr">settings</span>: &#123;<br>    <span class="hljs-comment">// 别名</span><br>    <span class="hljs-string">&#x27;import/resolver&#x27;</span>: &#123;<br>      <span class="hljs-attr">alias</span>: &#123;<br>        <span class="hljs-attr">map</span>: [[<span class="hljs-string">&#x27;@&#x27;</span>, <span class="hljs-string">&#x27;./src/&#x27;</span>]],<br>        <span class="hljs-attr">extensions</span>: [<span class="hljs-string">&#x27;.js&#x27;</span>, <span class="hljs-string">&#x27;.vue&#x27;</span>],<br>      &#125;,<br>    &#125;,<br>  &#125;,<br>  <span class="hljs-attr">rules</span>: &#123;<br>    <span class="hljs-string">&#x27;func-names&#x27;</span>: <span class="hljs-number">0</span>,<br>    <span class="hljs-string">&#x27;import/extensions&#x27;</span>: <span class="hljs-number">0</span>,<br>    <span class="hljs-string">&#x27;no-unused-expressions&#x27;</span>: <span class="hljs-number">0</span>,<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 导入语句前不允许有任何非导入语句</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-string">&#x27;import/first&#x27;</span>: <span class="hljs-string">&#x27;error&#x27;</span>,<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 禁止重复导入模块</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-string">&#x27;import/no-duplicates&#x27;</span>: <span class="hljs-string">&#x27;error&#x27;</span>,<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 禁止使用 let 导出</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-string">&#x27;import/no-mutable-exports&#x27;</span>: <span class="hljs-string">&#x27;warn&#x27;</span>,<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 禁用导入的模块时使用 webpack 特有的语法（感叹号）</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-string">&#x27;import/no-webpack-loader-syntax&#x27;</span>: <span class="hljs-string">&#x27;warn&#x27;</span>,<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 当只有一个导出时，必须使用 export default 来导出</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-string">&#x27;import/prefer-default-export&#x27;</span>: <span class="hljs-string">&#x27;off&#x27;</span>,<br>    <span class="hljs-string">&#x27;import/no-extraneous-dependencies&#x27;</span>: [<br>      <span class="hljs-string">&#x27;error&#x27;</span>,<br>      &#123;<br>        <span class="hljs-attr">devDependencies</span>: <span class="hljs-literal">true</span>,<br>      &#125;,<br>    ],<br>    <span class="hljs-string">&#x27;no-plusplus&#x27;</span>: [<br>      <span class="hljs-string">&#x27;error&#x27;</span>,<br>      &#123;<br>        <span class="hljs-attr">allowForLoopAfterthoughts</span>: <span class="hljs-literal">true</span>,<br>      &#125;,<br>    ],<br>    <span class="hljs-string">&#x27;import/no-dynamic-require&#x27;</span>: <span class="hljs-number">0</span>,<br>    <span class="hljs-string">&#x27;global-require&#x27;</span>: <span class="hljs-number">0</span>,<br>    <span class="hljs-string">&#x27;no-console&#x27;</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&#x27;production&#x27;</span> ? <span class="hljs-string">&#x27;warn&#x27;</span> : <span class="hljs-string">&#x27;off&#x27;</span>,<br>    <span class="hljs-string">&#x27;no-debugger&#x27;</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&#x27;production&#x27;</span> ? <span class="hljs-string">&#x27;warn&#x27;</span> : <span class="hljs-string">&#x27;off&#x27;</span>,<br>  &#125;,<br>&#125;;<br><br></code></pre></td></tr></table></figure><h4 id="1-1eslint忽略文件-eslintignore"><a href="#1-1eslint忽略文件-eslintignore" class="headerlink" title="1.1eslint忽略文件 .eslintignore"></a>1.1eslint忽略文件 .eslintignore</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript">dist<span class="hljs-comment">/**</span><br><span class="hljs-comment">es/**</span><br><span class="hljs-comment">lib/**</span><br><span class="hljs-comment">**/</span>node_modules<br></code></pre></td></tr></table></figure><h3 id="2-stylelint配置"><a href="#2-stylelint配置" class="headerlink" title="2. stylelint配置"></a>2. stylelint配置</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-comment">// processors: [&#x27;stylelint-processor-html&#x27;],</span><br>  <span class="hljs-comment">// extends: [&#x27;stylelint-config-tx 替换tx&#x27;,&#x27;css-properties-sorting&#x27;, &#x27;stylelint-config-prettier&#x27;],</span><br>  <span class="hljs-attr">extends</span>: [<span class="hljs-string">&#x27;css-properties-sorting&#x27;</span>, <span class="hljs-string">&#x27;stylelint-config-prettier&#x27;</span>],<br>  <span class="hljs-attr">plugins</span>: [<span class="hljs-string">&#x27;stylelint-order&#x27;</span>], <span class="hljs-comment">// stylelint-order是CSS属性排序插件</span><br>  <span class="hljs-attr">rules</span>: &#123;<br>    <span class="hljs-comment">// &quot;color-hex-case&quot;: &quot;lower&quot;, // 颜色值为小写字母(stylelint-config-standard)</span><br>    <span class="hljs-comment">// &quot;color-no-invalid-hex&quot;: true, // 颜色值不能为无效值(stylelint-config-standard)</span><br>    <span class="hljs-string">&#x27;font-family-name-quotes&#x27;</span>: <span class="hljs-string">&#x27;always-where-recommended&#x27;</span>, <span class="hljs-comment">// 字体系列中命名时带引号</span><br>    <span class="hljs-string">&#x27;function-url-quotes&#x27;</span>: <span class="hljs-string">&#x27;always&#x27;</span>, <span class="hljs-comment">// 地址一定要写引号</span><br>    <span class="hljs-comment">// &#x27;number-leading-zero&#x27;: &#x27;never&#x27;, // 或分数低于1的数字是否需要前导零</span><br>    <span class="hljs-string">&#x27;number-no-trailing-zeros&#x27;</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 禁止在数量尾随零</span><br>    <span class="hljs-comment">// &#x27;string-quotes&#x27;: &#x27;double&#x27;, // 指定字串</span><br>    <span class="hljs-string">&#x27;length-zero-no-unit&#x27;</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 禁止单位零长度。</span><br>    <span class="hljs-string">&#x27;value-keyword-case&#x27;</span>: <span class="hljs-string">&#x27;lower&#x27;</span>, <span class="hljs-comment">// 指定小写关键字的值</span><br>    <span class="hljs-string">&#x27;value-list-comma-newline-after&#x27;</span>: <span class="hljs-string">&#x27;always-multi-line&#x27;</span>, <span class="hljs-comment">// 在值列表的逗号后指定一个换行符或禁止留有空格</span><br>    <span class="hljs-string">&#x27;shorthand-property-no-redundant-values&#x27;</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 不允许在简写属性冗余值</span><br>    <span class="hljs-comment">// &quot;property-case&quot;: &quot;lower&quot;, // 为属性指定小写(stylelint-config-standard)</span><br>    <span class="hljs-string">&#x27;keyframe-declaration-no-important&#x27;</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 不允许!important在关键帧声明</span><br>    <span class="hljs-comment">// &quot;block-closing-brace-empty-line-before&quot;: &quot;never&quot;, // 不允许关闭括号前空一行(stylelint-config-standard)</span><br>    <span class="hljs-comment">// &quot;block-closing-brace-newline-after&quot;: &quot;always&quot;, // 需要一个换行符关闭括号后的空白(stylelint-config-standard)</span><br>    <span class="hljs-comment">// &quot;block-opening-brace-newline-after&quot;: &quot;always-multi-line&quot;, // 开括号的块之后需要新的一行(stylelint-config-standard)</span><br>    <span class="hljs-string">&#x27;selector-class-pattern&#x27;</span>: <span class="hljs-string">&quot;^[a-z]+([a-z0-9]?|[a-z0-9(-_&#x27;% ]*[a-z0-9)])$&quot;</span>, <span class="hljs-comment">// 兼容stylelint的bug(less的mixin没处理好), 暂时先这样处理～～～指定一个模式类选择符，限制选择器名称写法</span><br>    <span class="hljs-string">&#x27;selector-id-pattern&#x27;</span>: <span class="hljs-string">&quot;^[a-z]+([a-z0-9]?|[a-z0-9(-_&#x27;% ]*[a-z0-9)])$&quot;</span>, <span class="hljs-comment">// 兼容stylelint的bug(less的mixin没处理好), 暂时先这样处理～～～指定一个模式，id选择器，限制选择器名称写法</span><br>    <span class="hljs-string">&#x27;no-empty-source&#x27;</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// 不允许空的来源</span><br>    <span class="hljs-string">&#x27;at-rule-no-unknown&#x27;</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// 不允许at-rules不明</span><br>    <span class="hljs-comment">// &quot;indentation&quot;: 2, // 指定缩进(stylelint-config-standard)</span><br>    <span class="hljs-string">&#x27;max-nesting-depth&#x27;</span>: [<span class="hljs-number">5</span>, &#123; <span class="hljs-attr">severity</span>: <span class="hljs-string">&#x27;warning&#x27;</span> &#125;], <span class="hljs-comment">// 允许嵌套的深度为5</span><br>    <span class="hljs-string">&#x27;no-duplicate-selectors&#x27;</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 不允许重复的选择器</span><br>    <span class="hljs-comment">// &quot;no-eol-whitespace&quot;: true, // 不允许行尾空白(stylelint-config-standard)</span><br>    <span class="hljs-comment">// &quot;no-invalid-double-slash-comments&quot;: true // 不允许双斜杠注释(/ /…)不支持CSS(stylelint-config-standard)</span><br>    <span class="hljs-string">&#x27;order/order&#x27;</span>: [<br>      <span class="hljs-comment">// 指定声明块内的内容顺序</span><br>      [<span class="hljs-string">&#x27;custom-properties&#x27;</span>, <span class="hljs-string">&#x27;declarations&#x27;</span>],<br>    ],<br>    <span class="hljs-comment">// &quot;declaration-block-properties-order&quot;: &quot;alphabetical&quot;,</span><br>    <span class="hljs-string">&#x27;order/properties-order&#x27;</span>: [<br>      <span class="hljs-comment">// 指定声明块内属性的字母顺序</span><br>      <span class="hljs-string">&#x27;position&#x27;</span>,<br>      <span class="hljs-string">&#x27;top&#x27;</span>,<br>      <span class="hljs-string">&#x27;right&#x27;</span>,<br>      <span class="hljs-string">&#x27;bottom&#x27;</span>,<br>      <span class="hljs-string">&#x27;left&#x27;</span>,<br>      <span class="hljs-string">&#x27;z-index&#x27;</span>,<br>      <span class="hljs-string">&#x27;display&#x27;</span>,<br>      <span class="hljs-string">&#x27;float&#x27;</span>,<br>      <span class="hljs-string">&#x27;width&#x27;</span>,<br>      <span class="hljs-string">&#x27;height&#x27;</span>,<br>      <span class="hljs-string">&#x27;max-width&#x27;</span>,<br>      <span class="hljs-string">&#x27;max-height&#x27;</span>,<br>      <span class="hljs-string">&#x27;min-width&#x27;</span>,<br>      <span class="hljs-string">&#x27;min-height&#x27;</span>,<br>      <span class="hljs-string">&#x27;padding&#x27;</span>,<br>      <span class="hljs-string">&#x27;padding-top&#x27;</span>,<br>      <span class="hljs-string">&#x27;padding-right&#x27;</span>,<br>      <span class="hljs-string">&#x27;padding-bottom&#x27;</span>,<br>      <span class="hljs-string">&#x27;padding-left&#x27;</span>,<br>      <span class="hljs-string">&#x27;margin&#x27;</span>,<br>      <span class="hljs-string">&#x27;margin-top&#x27;</span>,<br>      <span class="hljs-string">&#x27;margin-right&#x27;</span>,<br>      <span class="hljs-string">&#x27;margin-bottom&#x27;</span>,<br>      <span class="hljs-string">&#x27;margin-left&#x27;</span>,<br>      <span class="hljs-string">&#x27;margin-collapse&#x27;</span>,<br>      <span class="hljs-string">&#x27;margin-top-collapse&#x27;</span>,<br>      <span class="hljs-string">&#x27;margin-right-collapse&#x27;</span>,<br>      <span class="hljs-string">&#x27;margin-bottom-collapse&#x27;</span>,<br>      <span class="hljs-string">&#x27;margin-left-collapse&#x27;</span>,<br>      <span class="hljs-string">&#x27;overflow&#x27;</span>,<br>      <span class="hljs-string">&#x27;overflow-x&#x27;</span>,<br>      <span class="hljs-string">&#x27;overflow-y&#x27;</span>,<br>      <span class="hljs-string">&#x27;clip&#x27;</span>,<br>      <span class="hljs-string">&#x27;clear&#x27;</span>,<br>      <span class="hljs-string">&#x27;font&#x27;</span>,<br>      <span class="hljs-string">&#x27;font-family&#x27;</span>,<br>      <span class="hljs-string">&#x27;font-size&#x27;</span>,<br>      <span class="hljs-string">&#x27;font-smoothing&#x27;</span>,<br>      <span class="hljs-string">&#x27;osx-font-smoothing&#x27;</span>,<br>      <span class="hljs-string">&#x27;font-style&#x27;</span>,<br>      <span class="hljs-string">&#x27;font-weight&#x27;</span>,<br>      <span class="hljs-string">&#x27;hyphens&#x27;</span>,<br>      <span class="hljs-string">&#x27;src&#x27;</span>,<br>      <span class="hljs-string">&#x27;line-height&#x27;</span>,<br>      <span class="hljs-string">&#x27;letter-spacing&#x27;</span>,<br>      <span class="hljs-string">&#x27;word-spacing&#x27;</span>,<br>      <span class="hljs-string">&#x27;color&#x27;</span>,<br>      <span class="hljs-string">&#x27;text-align&#x27;</span>,<br>      <span class="hljs-string">&#x27;text-decoration&#x27;</span>,<br>      <span class="hljs-string">&#x27;text-indent&#x27;</span>,<br>      <span class="hljs-string">&#x27;text-overflow&#x27;</span>,<br>      <span class="hljs-string">&#x27;text-rendering&#x27;</span>,<br>      <span class="hljs-string">&#x27;text-size-adjust&#x27;</span>,<br>      <span class="hljs-string">&#x27;text-shadow&#x27;</span>,<br>      <span class="hljs-string">&#x27;text-transform&#x27;</span>,<br>      <span class="hljs-string">&#x27;word-break&#x27;</span>,<br>      <span class="hljs-string">&#x27;word-wrap&#x27;</span>,<br>      <span class="hljs-string">&#x27;white-space&#x27;</span>,<br>      <span class="hljs-string">&#x27;vertical-align&#x27;</span>,<br>      <span class="hljs-string">&#x27;list-style&#x27;</span>,<br>      <span class="hljs-string">&#x27;list-style-type&#x27;</span>,<br>      <span class="hljs-string">&#x27;list-style-position&#x27;</span>,<br>      <span class="hljs-string">&#x27;list-style-image&#x27;</span>,<br>      <span class="hljs-string">&#x27;pointer-events&#x27;</span>,<br>      <span class="hljs-string">&#x27;cursor&#x27;</span>,<br>      <span class="hljs-string">&#x27;background&#x27;</span>,<br>      <span class="hljs-string">&#x27;background-attachment&#x27;</span>,<br>      <span class="hljs-string">&#x27;background-color&#x27;</span>,<br>      <span class="hljs-string">&#x27;background-image&#x27;</span>,<br>      <span class="hljs-string">&#x27;background-position&#x27;</span>,<br>      <span class="hljs-string">&#x27;background-repeat&#x27;</span>,<br>      <span class="hljs-string">&#x27;background-size&#x27;</span>,<br>      <span class="hljs-string">&#x27;border&#x27;</span>,<br>      <span class="hljs-string">&#x27;border-collapse&#x27;</span>,<br>      <span class="hljs-string">&#x27;border-top&#x27;</span>,<br>      <span class="hljs-string">&#x27;border-right&#x27;</span>,<br>      <span class="hljs-string">&#x27;border-bottom&#x27;</span>,<br>      <span class="hljs-string">&#x27;border-left&#x27;</span>,<br>      <span class="hljs-string">&#x27;border-color&#x27;</span>,<br>      <span class="hljs-string">&#x27;border-image&#x27;</span>,<br>      <span class="hljs-string">&#x27;border-top-color&#x27;</span>,<br>      <span class="hljs-string">&#x27;border-right-color&#x27;</span>,<br>      <span class="hljs-string">&#x27;border-bottom-color&#x27;</span>,<br>      <span class="hljs-string">&#x27;border-left-color&#x27;</span>,<br>      <span class="hljs-string">&#x27;border-spacing&#x27;</span>,<br>      <span class="hljs-string">&#x27;border-style&#x27;</span>,<br>      <span class="hljs-string">&#x27;border-top-style&#x27;</span>,<br>      <span class="hljs-string">&#x27;border-right-style&#x27;</span>,<br>      <span class="hljs-string">&#x27;border-bottom-style&#x27;</span>,<br>      <span class="hljs-string">&#x27;border-left-style&#x27;</span>,<br>      <span class="hljs-string">&#x27;border-width&#x27;</span>,<br>      <span class="hljs-string">&#x27;border-top-width&#x27;</span>,<br>      <span class="hljs-string">&#x27;border-right-width&#x27;</span>,<br>      <span class="hljs-string">&#x27;border-bottom-width&#x27;</span>,<br>      <span class="hljs-string">&#x27;border-left-width&#x27;</span>,<br>      <span class="hljs-string">&#x27;border-radius&#x27;</span>,<br>      <span class="hljs-string">&#x27;border-top-right-radius&#x27;</span>,<br>      <span class="hljs-string">&#x27;border-bottom-right-radius&#x27;</span>,<br>      <span class="hljs-string">&#x27;border-bottom-left-radius&#x27;</span>,<br>      <span class="hljs-string">&#x27;border-top-left-radius&#x27;</span>,<br>      <span class="hljs-string">&#x27;border-radius-topright&#x27;</span>,<br>      <span class="hljs-string">&#x27;border-radius-bottomright&#x27;</span>,<br>      <span class="hljs-string">&#x27;border-radius-bottomleft&#x27;</span>,<br>      <span class="hljs-string">&#x27;border-radius-topleft&#x27;</span>,<br>      <span class="hljs-string">&#x27;content&#x27;</span>,<br>      <span class="hljs-string">&#x27;quotes&#x27;</span>,<br>      <span class="hljs-string">&#x27;outline&#x27;</span>,<br>      <span class="hljs-string">&#x27;outline-offset&#x27;</span>,<br>      <span class="hljs-string">&#x27;opacity&#x27;</span>,<br>      <span class="hljs-string">&#x27;filter&#x27;</span>,<br>      <span class="hljs-string">&#x27;visibility&#x27;</span>,<br>      <span class="hljs-string">&#x27;size&#x27;</span>,<br>      <span class="hljs-string">&#x27;zoom&#x27;</span>,<br>      <span class="hljs-string">&#x27;transform&#x27;</span>,<br>      <span class="hljs-string">&#x27;box-align&#x27;</span>,<br>      <span class="hljs-string">&#x27;box-flex&#x27;</span>,<br>      <span class="hljs-string">&#x27;box-orient&#x27;</span>,<br>      <span class="hljs-string">&#x27;box-pack&#x27;</span>,<br>      <span class="hljs-string">&#x27;box-shadow&#x27;</span>,<br>      <span class="hljs-string">&#x27;box-sizing&#x27;</span>,<br>      <span class="hljs-string">&#x27;table-layout&#x27;</span>,<br>      <span class="hljs-string">&#x27;animation&#x27;</span>,<br>      <span class="hljs-string">&#x27;animation-delay&#x27;</span>,<br>      <span class="hljs-string">&#x27;animation-duration&#x27;</span>,<br>      <span class="hljs-string">&#x27;animation-iteration-count&#x27;</span>,<br>      <span class="hljs-string">&#x27;animation-name&#x27;</span>,<br>      <span class="hljs-string">&#x27;animation-play-state&#x27;</span>,<br>      <span class="hljs-string">&#x27;animation-timing-function&#x27;</span>,<br>      <span class="hljs-string">&#x27;animation-fill-mode&#x27;</span>,<br>      <span class="hljs-string">&#x27;transition&#x27;</span>,<br>      <span class="hljs-string">&#x27;transition-delay&#x27;</span>,<br>      <span class="hljs-string">&#x27;transition-duration&#x27;</span>,<br>      <span class="hljs-string">&#x27;transition-property&#x27;</span>,<br>      <span class="hljs-string">&#x27;transition-timing-function&#x27;</span>,<br>      <span class="hljs-string">&#x27;background-clip&#x27;</span>,<br>      <span class="hljs-string">&#x27;backface-visibility&#x27;</span>,<br>      <span class="hljs-string">&#x27;resize&#x27;</span>,<br>      <span class="hljs-string">&#x27;appearance&#x27;</span>,<br>      <span class="hljs-string">&#x27;user-select&#x27;</span>,<br>      <span class="hljs-string">&#x27;interpolation-mode&#x27;</span>,<br>      <span class="hljs-string">&#x27;direction&#x27;</span>,<br>      <span class="hljs-string">&#x27;marks&#x27;</span>,<br>      <span class="hljs-string">&#x27;page&#x27;</span>,<br>      <span class="hljs-string">&#x27;set-link-source&#x27;</span>,<br>      <span class="hljs-string">&#x27;unicode-bidi&#x27;</span>,<br>      <span class="hljs-string">&#x27;speak&#x27;</span>,<br>    ],<br>    <span class="hljs-string">&#x27;selector-pseudo-element-no-unknown&#x27;</span>: [<br>      <span class="hljs-literal">true</span>,<br>      &#123;<br>        <span class="hljs-attr">ignorePseudoElements</span>: [<span class="hljs-string">&#x27;v-deep&#x27;</span>],<br>      &#125;,<br>    ],<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="3-prettier配置-prettier-config-js"><a href="#3-prettier配置-prettier-config-js" class="headerlink" title="3. prettier配置 - prettier.config.js"></a>3. prettier配置 - prettier.config.js</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-comment">// 一行最多 120 字符</span><br>  <span class="hljs-attr">printWidth</span>: <span class="hljs-number">120</span>,<br>  <span class="hljs-comment">// 使用 2 个空格缩进</span><br>  <span class="hljs-attr">tabWidth</span>: <span class="hljs-number">2</span>,<br>  <span class="hljs-comment">// 不使用缩进符，而使用空格</span><br>  <span class="hljs-attr">useTabs</span>: <span class="hljs-literal">false</span>,<br>  <span class="hljs-comment">// 行尾需要有分号</span><br>  <span class="hljs-attr">semi</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-comment">// 使用单引号</span><br>  <span class="hljs-attr">singleQuote</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-comment">// 对象的 key 仅在必要时用引号</span><br>  <span class="hljs-attr">quoteProps</span>: <span class="hljs-string">&#x27;as-needed&#x27;</span>,<br>  <span class="hljs-comment">// jsx 不使用单引号，而使用双引号</span><br>  <span class="hljs-attr">jsxSingleQuote</span>: <span class="hljs-literal">false</span>,<br>  <span class="hljs-comment">// 末尾需要有逗号</span><br>  <span class="hljs-attr">trailingComma</span>: <span class="hljs-string">&#x27;all&#x27;</span>,<br>  <span class="hljs-comment">// 大括号内的首尾需要空格</span><br>  <span class="hljs-attr">bracketSpacing</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-comment">// jsx 标签的反尖括号需要换行</span><br>  <span class="hljs-attr">jsxBracketSameLine</span>: <span class="hljs-literal">false</span>,<br>  <span class="hljs-comment">// 箭头函数，只有一个参数的时候，也需要括号</span><br>  <span class="hljs-attr">arrowParens</span>: <span class="hljs-string">&#x27;always&#x27;</span>,<br>  <span class="hljs-comment">// 每个文件格式化的范围是文件的全部内容</span><br>  <span class="hljs-attr">rangeStart</span>: <span class="hljs-number">0</span>,<br>  <span class="hljs-attr">rangeEnd</span>: <span class="hljs-title class_">Infinity</span>,<br>  <span class="hljs-comment">// 不需要写文件开头的 @prettier</span><br>  <span class="hljs-attr">requirePragma</span>: <span class="hljs-literal">false</span>,<br>  <span class="hljs-comment">// 不需要自动在文件开头插入 @prettier</span><br>  <span class="hljs-attr">insertPragma</span>: <span class="hljs-literal">false</span>,<br>  <span class="hljs-comment">// 使用默认的折行标准</span><br>  <span class="hljs-attr">proseWrap</span>: <span class="hljs-string">&#x27;preserve&#x27;</span>,<br>  <span class="hljs-comment">// 根据显示样式决定 html 要不要折行</span><br>  <span class="hljs-attr">htmlWhitespaceSensitivity</span>: <span class="hljs-string">&#x27;css&#x27;</span>,<br>  <span class="hljs-comment">// vue 文件中的 script 和 style 内不用缩进</span><br>  <span class="hljs-attr">vueIndentScriptAndStyle</span>: <span class="hljs-literal">false</span>,<br>  <span class="hljs-comment">// 换行符使用 lf</span><br>  <span class="hljs-attr">endOfLine</span>: <span class="hljs-string">&#x27;lf&#x27;</span>,<br>&#125;;<br><br></code></pre></td></tr></table></figure><h3 id="4-EditorConfig部分："><a href="#4-EditorConfig部分：" class="headerlink" title="4. EditorConfig部分："></a>4. EditorConfig部分：</h3><blockquote><p> editorConfig的作用是专门抹平不同编辑器同一配置之间差异。比较神奇的是它并不需要项目配依赖且配置及其简单，只需要编辑器安装指定扩展插件以及项目配置文件.editorConfig即可。</p><blockquote><ul><li>VSCode中安装插件：EditorConfig for VS Code</li><li>项目根目录下创建并配置.editorConfig：</li></ul></blockquote></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript">root = <span class="hljs-literal">true</span><br><br>[*]<br>charset = utf-<span class="hljs-number">8</span><br>indent_style = space<br>indent_size = <span class="hljs-number">4</span><br>end_of_line = lf<br>insert_final_newline = <span class="hljs-literal">true</span><br>trim_trailing_whitespace = <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><h4 id="依赖清单"><a href="#依赖清单" class="headerlink" title="依赖清单"></a>依赖清单</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 依赖清单</span><br>[<br>    <span class="hljs-comment">// ESLint</span><br>    eslint,<br>    babel-eslint,<br>    eslint-plugin-vue,<br>    eslint-webpack-plugin,      <span class="hljs-comment">// 开发环境实时检测(可选</span><br>    <br>    <span class="hljs-comment">// StyleLint(可选)</span><br>    stylelint,<br>    stylelint-webpack-plugin,   <span class="hljs-comment">// 开发环境实时检测</span><br>    stylelint-config-standard,<br>    <br>    <span class="hljs-comment">// Prettier(可选)</span><br>    prettier,<br>    eslint-config-prettier,<br>    eslint-plugin-prettier,<br>    stylelint-config-prettier<br>]<br></code></pre></td></tr></table></figure><h4 id="完整示例"><a href="#完整示例" class="headerlink" title="完整示例"></a>完整示例</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><br><span class="hljs-comment">// ESLint</span><br><span class="hljs-string">&quot;eslint&quot;</span>: <span class="hljs-string">&quot;^6.7.2&quot;</span>,<br><span class="hljs-string">&quot;eslint-config-airbnb-base&quot;</span>: <span class="hljs-string">&quot;^14.2.1&quot;</span>,<br><span class="hljs-string">&quot;eslint-import-resolver-alias&quot;</span>: <span class="hljs-string">&quot;^1.1.2&quot;</span>,<br><span class="hljs-string">&quot;eslint-plugin-vue&quot;</span>: <span class="hljs-string">&quot;^6.2.2&quot;</span>,<br><br><span class="hljs-comment">// StyleLint(可选)</span><br><span class="hljs-string">&quot;stylelint&quot;</span>: <span class="hljs-string">&quot;^13.12.0&quot;</span>,<br><span class="hljs-string">&quot;stylelint-order&quot;</span>: <span class="hljs-string">&quot;^4.1.0&quot;</span>,<br><br><span class="hljs-comment">// Prettier(可选)</span><br><span class="hljs-string">&quot;prettier&quot;</span>: <span class="hljs-string">&quot;^2.3.2&quot;</span>,<br><span class="hljs-string">&quot;eslint-config-prettier&quot;</span>: <span class="hljs-string">&quot;^8.3.0&quot;</span>,<br><span class="hljs-string">&quot;eslint-plugin-prettier&quot;</span>: <span class="hljs-string">&quot;^3.3.1&quot;</span>,<br><span class="hljs-string">&quot;stylelint-config-prettier&quot;</span>: <span class="hljs-string">&quot;^8.0.2&quot;</span>,<br></code></pre></td></tr></table></figure><h2 id="第二步-命令行脚本配置"><a href="#第二步-命令行脚本配置" class="headerlink" title="第二步 - 命令行脚本配置"></a>第二步 - 命令行脚本配置</h2><p>在package.json文件的script脚本中配置</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;<br> <span class="hljs-comment">// 省略其余属性...</span><br> <span class="hljs-string">&quot;script&quot;</span>: &#123;<br>     <span class="hljs-string">&quot;eslint-lint&quot;</span>: <span class="hljs-string">&quot;eslint --ext .js,.vue --fix src&quot;</span>,<br>     <span class="hljs-string">&quot;stylelint-lint&quot;</span>: <span class="hljs-string">&quot;stylelint src/**/.css src/**/.vue src/**/.less --fix&quot;</span><br> &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="【有待争议的规则点】"><a href="#【有待争议的规则点】" class="headerlink" title="【有待争议的规则点】"></a>【有待争议的规则点】</h1><h2 id="vue相关"><a href="#vue相关" class="headerlink" title="vue相关"></a>vue相关</h2><p>1、vue&#x2F;html-self-closing 自关闭标签<br>2、vue&#x2F;attributes-order 属性顺序<br>3、vue&#x2F;attribute-hyphenation 属性需用连字符分割单词，（这里不建议，父子组件使用时，无法直接搜索）</p>]]></content>
    
    
    <categories>
      
      <category>规范</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vue</tag>
      
      <tag>eslint</tag>
      
      <tag>stylelint</tag>
      
      <tag>Prettier</tag>
      
      <tag>EditorConfig</tag>
      
      <tag>jsconfig【vscode工作空间配置】</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-10-10-linux指令</title>
    <link href="/2025/11/28/2021-11-15%E3%80%90%E7%A7%AF%E7%B4%AF%E3%80%91%E4%BC%81%E5%BE%AE%E6%89%AB%E7%A0%81%E7%99%BB%E5%BD%95/"/>
    <url>/2025/11/28/2021-11-15%E3%80%90%E7%A7%AF%E7%B4%AF%E3%80%91%E4%BC%81%E5%BE%AE%E6%89%AB%E7%A0%81%E7%99%BB%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<h3 id="企业微信-政务微信二维码扫码登录-【前端接入】"><a href="#企业微信-政务微信二维码扫码登录-【前端接入】" class="headerlink" title="企业微信&#x2F;政务微信二维码扫码登录 【前端接入】"></a>企业微信&#x2F;政务微信二维码扫码登录 【前端接入】</h3><h4 id="1-生成企业微信-政务微信二维码"><a href="#1-生成企业微信-政务微信二维码" class="headerlink" title="1. 生成企业微信&#x2F;政务微信二维码"></a>1. 生成企业微信&#x2F;政务微信二维码</h4><ol><li>企业微信扫码登录：<a href="https://work.weixin.qq.com/api/doc/90000/90135/91019">https://work.weixin.qq.com/api/doc/90000/90135/91019</a> </li><li>政务微信扫码登录：<a href="http://wwlocal-dev.pdcts.com.cn/api/doc#10719">http://wwlocal-dev.pdcts.com.cn/api/doc#10719</a></li></ol><p>注意：由于企业微信、政务微信实例化二维码的方法名相同，会导致实例化方法被覆盖，无法同时区分是哪个二维码；如果系统需要同时接入企业微信及政务微信，则需要重写实例化二维码方法；具体代码及传入参数如下：</p><h4 id="生成二维码-核心代码"><a href="#生成二维码-核心代码" class="headerlink" title="生成二维码 核心代码"></a>生成二维码 核心代码</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 实例化二维码</span><br>(<span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-variable language_">window</span>, <span class="hljs-variable language_">document</span>, <span class="hljs-literal">undefined</span></span>) &#123;<br>  <span class="hljs-keyword">var</span> temp = <span class="hljs-string">&#x27;/wwopen/sso/qrConnect&#x27;</span>;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">ZwWwLogin</span>(<span class="hljs-params">data</span>) &#123;<br>    <span class="hljs-keyword">var</span> host = data.<span class="hljs-property">host</span>;<br>    <span class="hljs-keyword">var</span> frame = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;iframe&#x27;</span>);<br>    <span class="hljs-keyword">var</span> url =<br>      host +<br>      temp +<br>      <span class="hljs-string">&#x27;?appid=&#x27;</span> +<br>      data.<span class="hljs-property">appid</span> +<br>      <span class="hljs-string">&#x27;&amp;agentid=&#x27;</span> +<br>      data.<span class="hljs-property">agentid</span> +<br>      <span class="hljs-string">&#x27;&amp;redirect_uri=&#x27;</span> +<br>      data.<span class="hljs-property">redirect_uri</span>;<br>    url += data.<span class="hljs-property">style</span> ? <span class="hljs-string">&#x27;&amp;style=&#x27;</span> + data.<span class="hljs-property">style</span> : <span class="hljs-string">&#x27;&#x27;</span>;<br>    url += data.<span class="hljs-property">href</span> ? <span class="hljs-string">&#x27;&amp;href=&#x27;</span> + data.<span class="hljs-property">href</span> : <span class="hljs-string">&#x27;&#x27;</span>;<br><br>    frame.<span class="hljs-property">src</span> = url;<br>    frame.<span class="hljs-property">frameBorder</span> = <span class="hljs-string">&#x27;0&#x27;</span>;<br>    frame.<span class="hljs-property">allowTransparency</span> = <span class="hljs-string">&#x27;true&#x27;</span>;<br>    frame.<span class="hljs-property">scrolling</span> = <span class="hljs-string">&#x27;no&#x27;</span>;<br>    frame.<span class="hljs-property">width</span> = <span class="hljs-string">&#x27;300px&#x27;</span>;<br>    frame.<span class="hljs-property">height</span> = <span class="hljs-string">&#x27;400px&#x27;</span>;<br>    <span class="hljs-keyword">var</span> el = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(data.<span class="hljs-property">id</span>);<br>    el.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>    el.<span class="hljs-title function_">appendChild</span>(frame);<br><br>    frame.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-keyword">if</span> (frame.<span class="hljs-property">contentWindow</span>.<span class="hljs-property">postMessage</span> &amp;&amp; <span class="hljs-variable language_">window</span>.<span class="hljs-property">addEventListener</span>) &#123;<br>        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;message&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) &#123;<br>          <span class="hljs-keyword">var</span> hostArr = host.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;:&#x27;</span>);<br>          <span class="hljs-keyword">if</span> (hostArr[<span class="hljs-number">1</span>] == <span class="hljs-number">80</span>) host = hostArr[<span class="hljs-number">0</span>];<br>          <span class="hljs-keyword">if</span> (event.<span class="hljs-property">data</span> &amp;&amp; event.<span class="hljs-property">origin</span>.<span class="hljs-title function_">indexOf</span>(host) &gt; -<span class="hljs-number">1</span>) &#123;<br>            event.<span class="hljs-property">data</span>.<span class="hljs-property">code</span>;<br>            <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span> = event.<span class="hljs-property">data</span>;<br>          &#125;<br>        &#125;);<br>        frame.<span class="hljs-property">contentWindow</span>.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">&#x27;ask_usePostMessage&#x27;</span>, <span class="hljs-string">&#x27;*&#x27;</span>);<br>      &#125;<br>    &#125;;<br>  &#125;<br><br>  <span class="hljs-variable language_">window</span>.<span class="hljs-property">ZwWwLogin</span> = <span class="hljs-title class_">ZwWwLogin</span>;<br>&#125;)(<span class="hljs-variable language_">window</span>, <span class="hljs-variable language_">document</span>);<br><br></code></pre></td></tr></table></figure><h4 id="实例化二维码，传参"><a href="#实例化二维码，传参" class="headerlink" title="实例化二维码，传参"></a>实例化二维码，传参</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">new</span> <span class="hljs-title class_">ZwWwLogin</span>(&#123;<br><span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;wx_reg&quot;</span>,<br><span class="hljs-string">&quot;redirect_uri&quot;</span>: <span class="hljs-built_in">encodeURIComponent</span>(redirect_uri),<br><span class="hljs-comment">// 直接设置 样式文件编码内容</span><br><span class="hljs-string">&quot;href&quot;</span>: <span class="hljs-string">&#x27;data:text/css;base64,...&#x27;</span><br><span class="hljs-string">&quot;host&quot;</span>: item.<span class="hljs-property">Host</span><br><span class="hljs-string">&quot;appid&quot;</span>: item.<span class="hljs-property">AppId</span>,<br><span class="hljs-string">&quot;agentid&quot;</span>: item.<span class="hljs-property">AgentId</span><br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="2-自定义二维码样式"><a href="#2-自定义二维码样式" class="headerlink" title="2. 自定义二维码样式"></a>2. 自定义二维码样式</h4><ol><li>方式一：链接方式引入css文件</li></ol><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stylus">&#123;<br><span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;wx_reg&quot;</span>,<br><span class="hljs-comment">// 设置编码 链接</span><br><span class="hljs-string">&quot;href&quot;</span>: <span class="hljs-built_in">encodeURIComponent</span>(location<span class="hljs-selector-class">.origin</span> + <span class="hljs-string">&#x27;/static/css/WeChat.css&#x27;</span>),<br>...<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>内容如下</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.impowerBox</span> <span class="hljs-selector-class">.qrcode</span> &#123;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">160px</span>;<br>&#125;<br><span class="hljs-selector-class">.wrp_code_rl_bg</span> &#123;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">160px</span>;<br>  <span class="hljs-attribute">left</span>: <span class="hljs-number">68px</span>;<br>&#125;<br><span class="hljs-selector-class">.wrp_code_iframe</span> &#123;<br>  <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">32px</span>;<br>&#125;<br><span class="hljs-selector-class">.wrp_code_rl_label</span> &#123;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.9</span>);<br>&#125;<br><span class="hljs-selector-class">.impowerBox</span> <span class="hljs-selector-class">.title</span> &#123;<br>  <span class="hljs-comment">/* display: none; */</span><br>  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span>;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-number">#27282e</span>;<br>&#125;<br><span class="hljs-selector-class">.wrp_code_rl_mask</span> &#123;<br>  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.9</span>;<br>  <span class="hljs-attribute">background</span>: <span class="hljs-number">#27282e</span>;<br>&#125;<br><span class="hljs-selector-class">.impowerBox</span> <span class="hljs-selector-class">.info</span> &#123;<br>  <span class="hljs-attribute">display</span>: none;<br>&#125;<br><span class="hljs-selector-class">.status_icon</span> &#123;<br>  <span class="hljs-attribute">display</span>: none <span class="hljs-meta">!important</span>;<br>&#125;<br><span class="hljs-selector-class">.impowerBox</span> <span class="hljs-selector-class">.status</span> &#123;<br>  <span class="hljs-attribute">text-align</span>: center;<br>  <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">0px</span>;<br>&#125;<br><span class="hljs-selector-class">.impowerBox</span> <span class="hljs-selector-class">.status</span> <span class="hljs-selector-class">.status_txt</span> &#123;<br>  <span class="hljs-attribute">text-align</span>: center;<br>&#125;<br><span class="hljs-selector-class">.impowerBox</span> <span class="hljs-selector-class">.status</span> <span class="hljs-selector-class">.status_txt</span> <span class="hljs-selector-tag">h4</span> &#123;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-number">#4490d6</span>;<br>&#125;<br><span class="hljs-selector-class">.impowerBox</span> <span class="hljs-selector-class">.status</span><span class="hljs-selector-class">.status_browser</span> &#123;<br>  <span class="hljs-attribute">text-align</span>: center;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">25px</span> <span class="hljs-number">0px</span>;<br>&#125;<br><span class="hljs-selector-id">#wx_default_tip</span> &#123;<br>  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">url</span>(<span class="hljs-string">../img/zwwx1.jpg</span>) no-repeat;<br>  <span class="hljs-attribute">background-size</span>: auto <span class="hljs-number">28px</span>;<br>  <span class="hljs-attribute">background-position-x</span>: center;<br>  <span class="hljs-attribute">background-position-y</span>: -<span class="hljs-number">2px</span>;<br>&#125;<br><span class="hljs-selector-id">#wx_default_tip</span> &gt; <span class="hljs-selector-tag">p</span> &#123;<br>  <span class="hljs-attribute">display</span>: none;<br>&#125;<br><span class="hljs-selector-class">.wrp_code_rl_info</span> &#123;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.9</span>);<br>&#125;<br></code></pre></td></tr></table></figure><ol><li>方式二：base64编码</li></ol><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">&#123;<br><span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;wx_reg&quot;</span>,<br><span class="hljs-string">//</span> 设置编码<br><span class="hljs-string">&quot;href&quot;</span>: &#x27;data<span class="hljs-function">:text</span>/css;base64,<span class="hljs-string">....</span>&#x27;,<br><span class="hljs-string">...</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="3-扫码登录交互"><a href="#3-扫码登录交互" class="headerlink" title="3. 扫码登录交互"></a>3. 扫码登录交互</h4><p>以政务微信为例（企业微信类似）</p><ol><li>用户扫码成功后，将重定向到实例化二维码时传入的redirect_ur地址（这里redirect_ur传入的是当前登录页url），代码中监听路由变化，获取回调的返回的code与后端接口交互。</li></ol><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs autoit">watch:&#123;<br> $route(<span class="hljs-keyword">to</span>) &#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">to</span>.query.code) &#123;<br>   this.requestWechatLogin(<span class="hljs-keyword">to</span>.query.code)<span class="hljs-comment">;</span><br>   &#125;<br>  &#125;<br>&#125;,<br></code></pre></td></tr></table></figure><h4 id="4-扫码成功-失败-交互"><a href="#4-扫码成功-失败-交互" class="headerlink" title="4. 扫码成功&#x2F;失败 交互"></a>4. 扫码成功&#x2F;失败 交互</h4><p> 调用后端接口，成功则写入登录态，失败则前端根据业务给出相应提示。</p><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><p><a href="https://developer.work.weixin.qq.com/document/path/91019">企业微信-构造扫码登录链接</a><br><a href="https://work.weixin.qq.com/wework_admin/frame?version=3.1.12.90288&platform=mac#apps">企业微信-管理后台</a></p><p><a href="https://wwlocal-dev.pdcts.com.cn/api/doc#10719">政务微信-开发文档</a><br><a href="https://wwlocal-dev.pdcts.com.cn/wework_admin/frame#apps/modApiApp/5629499564213125">政务微信-管理后台</a></p>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2021-09-28-【小程序】小程序开发-环境篇</title>
    <link href="/2025/11/28/2021-09-28-%E3%80%90%E5%B0%8F%E7%A8%8B%E5%BA%8F%E3%80%91%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91%E4%B8%8A/"/>
    <url>/2025/11/28/2021-09-28-%E3%80%90%E5%B0%8F%E7%A8%8B%E5%BA%8F%E3%80%91%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91%E4%B8%8A/</url>
    
    <content type="html"><![CDATA[<h2 id="小程序开发基础"><a href="#小程序开发基础" class="headerlink" title="小程序开发基础"></a>小程序开发基础</h2><h3 id="一、环境准备"><a href="#一、环境准备" class="headerlink" title="一、环境准备"></a>一、环境准备</h3><ol><li><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/quickstart/getstart.html#%E7%94%B3%E8%AF%B7%E5%B8%90%E5%8F%B7">小程序开发账号申请</a> </p></li><li><p>开发环境准备：<a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html">微信小程序开发工具</a>（建议稳定版）</p></li></ol><h3 id="二、项目创建"><a href="#二、项目创建" class="headerlink" title="二、项目创建"></a>二、项目创建</h3><p>打开微信小程序开发工具，点击 新建小程序</p><p>![image-20211206111829375](&#x2F;Users&#x2F;sunny&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20211206111829375.png)</p><ul><li>文件类型说明</li></ul><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/structure.html">WXML：</a>类似VUE 中的 template模板</p><p>是框架设计的一套标签语言，结合<a href="https://developers.weixin.qq.com/miniprogram/dev/component/">基础组件</a>、<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxml/event.html">事件系统</a>，可以构建出页面的结构（常用标签<view></view> 类似 div，用于页面布局，标签<text></text> 用于文字展示）</p><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxss.html">WXSS</a>：类似.css 文件，样式不能嵌套编写，尺寸单位建议全部使用rpx，包括字体大小</p><p> rpx（尺寸单位）: 自适应单位，目前按 iPhone6 作为视觉稿的标准，规定屏幕宽为750rpx。如在 iPhone6 上，屏幕宽度为375px，共有750个物理像素，则750rpx &#x3D; 375px &#x3D; 750物理像素，1rpx &#x3D; 0.5px &#x3D; 1物理像素。 </p><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxs/">WXS</a></p><p>VUE中的filters可用WXS替代，但存在很多限制。</p><h3 id="三、UI组件库选型"><a href="#三、UI组件库选型" class="headerlink" title="三、UI组件库选型"></a>三、UI组件库选型</h3><p>小程序原生开发中自带部分<a href="https://developers.weixin.qq.com/miniprogram/dev/component/cover-image.html">基础组件</a>，以满足日常开发需求；但仍需要额外的扩展组件以填充复杂系统的开发工作，这里选用官方推荐的 <a href="https://wechat-miniprogram.github.io/weui/docs/">weui</a> 组件库，需自建项目单独引入。</p><h4 id="引入组件库"><a href="#引入组件库" class="headerlink" title="引入组件库"></a>引入组件库</h4><ol><li>通过 <a href="https://wechat-miniprogram.github.io/weui/docs/reference/configuration/app.html#useExtendedLib">useExtendedLib 扩展库</a> 的方式引入，这种方式引入的组件将不会计入代码包大小。</li><li>可以通过<a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/npm.html">npm (opens new window)</a>方式下载构建，npm包名为<code>weui-miniprogram</code></li></ol><h4 id="引入组件"><a href="#引入组件" class="headerlink" title="引入组件"></a>引入组件</h4><p>这里通过npm方式引入组件库</p><p> pages&#x2F;xxx页面&#x2F;xxx页面.json 中引入需要的组件，如下：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;usingComponents&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;mp-cells&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;weui-miniprogram/cells/cells&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;mp-cell&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;weui-miniprogram/cell/cell&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="四、网络请求"><a href="#四、网络请求" class="headerlink" title="四、网络请求"></a>四、网络请求</h3><h4 id="1-普通网络请求"><a href="#1-普通网络请求" class="headerlink" title="1. 普通网络请求"></a>1. 普通网络请求</h4><h4 id="2-资源上传请求"><a href="#2-资源上传请求" class="headerlink" title="2. 资源上传请求"></a>2. 资源上传请求</h4><p>request.js </p><ol><li>支持get&#x2F;post&#x2F;put&#x2F;delete 类型请求</li><li>对创建类型接口（create）进行多次请求拦截</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> app = <span class="hljs-title function_">getApp</span>();<br><br><span class="hljs-comment">// 1s内重复调用 同一个接口，直接返回，不调用接口</span><br><span class="hljs-keyword">let</span> lastRequestUrl;<br><span class="hljs-keyword">let</span> sameRequestTimeOut;<br><span class="hljs-keyword">let</span> sameRequestLimitSecond = <span class="hljs-number">2000</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">request</span> = (<span class="hljs-params">url, options</span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (lastRequestUrl == url &amp;&amp; url.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&#x27;Create&#x27;</span>) !== -<span class="hljs-number">1</span>) &#123;<br>      <span class="hljs-title function_">reject</span>(<span class="hljs-string">&#x27;重复请求&#x27;</span>);<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// 防止重复调用同一个接口</span><br>    <span class="hljs-built_in">clearTimeout</span>(sameRequestTimeOut);<br>    lastRequestUrl = url;<br>    sameRequestTimeOut = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>      lastRequestUrl = <span class="hljs-string">&#x27;&#x27;</span>;<br>    &#125;, sameRequestLimitSecond);<br><br>    <span class="hljs-keyword">if</span> (!app) app = <span class="hljs-title function_">getApp</span>();<br>    <span class="hljs-keyword">if</span> (app.<span class="hljs-property">isRequesting</span>) &#123;<br>      app.<span class="hljs-property">isRequesting</span> = <span class="hljs-literal">false</span>;<br>      wx.<span class="hljs-title function_">hideLoading</span>();<br>    &#125;<br>    <span class="hljs-built_in">clearTimeout</span>(app.<span class="hljs-property">requestTO</span>);<br>    app.<span class="hljs-property">requestTO</span> = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>      app.<span class="hljs-property">isRequesting</span> = <span class="hljs-literal">true</span>;<br>      wx.<span class="hljs-title function_">showLoading</span>(&#123;<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;加载中&#x27;</span>,<br>      &#125;);<br>    &#125;, <span class="hljs-number">200</span>);<br><br>    wx.<span class="hljs-title function_">request</span>(&#123;<br>      <span class="hljs-attr">url</span>: <span class="hljs-string">`<span class="hljs-subst">$&#123;app.globalData.baseurl&#125;</span><span class="hljs-subst">$&#123;url&#125;</span>`</span>,<br>      <span class="hljs-attr">method</span>: options.<span class="hljs-property">method</span>,<br>      <span class="hljs-attr">data</span>: options.<span class="hljs-property">data</span>,<br>      <span class="hljs-attr">header</span>: &#123;<br>        <span class="hljs-string">&#x27;Abp.TenantId&#x27;</span>: <span class="hljs-number">1</span>,<br>        <span class="hljs-string">&#x27;content-type&#x27;</span>: options.<span class="hljs-property">isObj</span><br>          ? <span class="hljs-string">&#x27;application/json&#x27;</span><br>          : <span class="hljs-string">&#x27;application/x-www-form-urlencoded&#x27;</span>,<br>        <span class="hljs-title class_">Authorization</span>: <span class="hljs-string">&#x27;Bearer &#x27;</span> + app.<span class="hljs-property">globalData</span>.<span class="hljs-property">token</span>.<span class="hljs-property">accessToken</span>,<br>      &#125;,<br>      <span class="hljs-title function_">success</span>(<span class="hljs-params">response</span>) &#123;<br>        <span class="hljs-keyword">if</span> (response.<span class="hljs-property">statusCode</span> == <span class="hljs-number">200</span>) &#123;<br>          <span class="hljs-title function_">resolve</span>(response.<span class="hljs-property">data</span>);<br>          <span class="hljs-keyword">return</span>;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (response.<span class="hljs-property">statusCode</span> === <span class="hljs-number">401</span>) &#123;<br>          <span class="hljs-comment">// 401 权限过期，则重新请求获取token，登录后 重新调用用户想调用的接口</span><br>          app.<span class="hljs-title function_">login</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>            <span class="hljs-comment">// request(url, options);</span><br>            <span class="hljs-title function_">resolve</span>(&#123; <span class="hljs-attr">status</span>: <span class="hljs-number">401</span> &#125;);<br>          &#125;);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          <span class="hljs-comment">// 如果有返回错误信息，则提示</span><br>          <span class="hljs-keyword">if</span> (response.<span class="hljs-property">data</span>.<span class="hljs-property">error</span> &amp;&amp; response.<span class="hljs-property">data</span>.<span class="hljs-property">error</span>.<span class="hljs-property">message</span>) &#123;<br>            <span class="hljs-comment">// 弹出接口错误提示</span><br>            wx.<span class="hljs-title function_">showToast</span>(&#123;<br>              <span class="hljs-attr">title</span>: response.<span class="hljs-property">data</span>.<span class="hljs-property">error</span>.<span class="hljs-property">message</span>,<br>              <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;error&#x27;</span>,<br>              <span class="hljs-attr">duration</span>: <span class="hljs-number">2000</span>,<br>            &#125;);<br>          &#125;<br>          <span class="hljs-title function_">reject</span>(response.<span class="hljs-property">data</span>);<br>        &#125;<br>      &#125;,<br>      <span class="hljs-title function_">fail</span>(<span class="hljs-params">error</span>) &#123;<br>        <span class="hljs-built_in">clearTimeout</span>(app.<span class="hljs-property">requestTO</span>);<br>        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>          <span class="hljs-keyword">if</span> (app.<span class="hljs-property">isRequesting</span> == <span class="hljs-literal">true</span>) wx.<span class="hljs-title function_">hideLoading</span>();<br>          app.<span class="hljs-property">isRequesting</span> = <span class="hljs-literal">false</span>;<br>        &#125;, <span class="hljs-number">300</span>);<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(error);<br>        <span class="hljs-title function_">reject</span>(error.<span class="hljs-property">data</span>);<br>      &#125;,<br>      <span class="hljs-attr">complete</span>: <span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-built_in">clearTimeout</span>(app.<span class="hljs-property">requestTO</span>);<br>        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>          <span class="hljs-keyword">if</span> (app.<span class="hljs-property">isRequesting</span> == <span class="hljs-literal">true</span>) wx.<span class="hljs-title function_">hideLoading</span>();<br><br>          app.<span class="hljs-property">isRequesting</span> = <span class="hljs-literal">false</span>;<br>        &#125;, <span class="hljs-number">300</span>);<br>      &#125;,<br>    &#125;);<br>  &#125;);<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">get</span> = (<span class="hljs-params">url, options = &#123;&#125;</span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>(url, &#123;<br>    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;GET&#x27;</span>,<br>    <span class="hljs-attr">data</span>: options,<br>  &#125;);<br>&#125;;<br><br><span class="hljs-comment">//post对象</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">postObj</span> = (<span class="hljs-params">url, options</span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>(url, &#123;<br>    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>    <span class="hljs-attr">data</span>: options,<br>    <span class="hljs-attr">isObj</span>: <span class="hljs-literal">true</span>,<br>  &#125;);<br>&#125;;<br><span class="hljs-comment">//post参数</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">post</span> = (<span class="hljs-params">url, options</span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>(url, &#123;<br>    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>    <span class="hljs-attr">data</span>: options,<br>    <span class="hljs-attr">isObj</span>: <span class="hljs-literal">false</span>,<br>  &#125;);<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">put</span> = (<span class="hljs-params">url, options</span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>(url, &#123;<br>    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;PUT&#x27;</span>,<br>    <span class="hljs-attr">data</span>: options,<br>  &#125;);<br>&#125;;<br><br><span class="hljs-comment">// 不能声明DELETE（关键字）</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">remove</span> = (<span class="hljs-params">url, options</span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>(url, &#123;<br>    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;DELETE&#x27;</span>,<br>    <span class="hljs-attr">data</span>: options,<br>  &#125;);<br>&#125;;<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  get,<br>  post,<br>  put,<br>  remove,<br>  postObj,<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="五、获取用户信息及头像"><a href="#五、获取用户信息及头像" class="headerlink" title="五、获取用户信息及头像"></a>五、获取用户信息及头像</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h3 id="六、分享"><a href="#六、分享" class="headerlink" title="六、分享"></a>六、分享</h3><h4 id="1-分享好友"><a href="#1-分享好友" class="headerlink" title="1. 分享好友"></a>1. 分享好友</h4><p>通过 onShareAppMessage 方法，可自定义每个页面的分享好友功能，可设置分享文案，图片及点击跳转的url。</p><h4 id="2-分享朋友圈"><a href="#2-分享朋友圈" class="headerlink" title="2. 分享朋友圈"></a>2. 分享朋友圈</h4><p>通过 onShareTimeline 方法，可自定义每个页面的分享朋友圈功能。</p><h3 id="3-全局分享配置"><a href="#3-全局分享配置" class="headerlink" title="3. 全局分享配置"></a>3. 全局分享配置</h3><p>当然，也可以通过监听路由切换方式，全局设置分享功能，代码如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 全局分享配置，页面无需开启分享</span><br><span class="hljs-comment"> * 使用隐式页面函数进行页面分享配置</span><br><span class="hljs-comment"> * 使用隐式路由（wx.onAppRoute）获取当前页面路由，并根据路由来进行全局分享、自定义分享</span><br><span class="hljs-comment"> */</span><br>!(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">let</span> shareUrl = <span class="hljs-string">&#x27;/assets/images/img-share.png&#x27;</span>;<br>  <span class="hljs-comment">//获取页面配置并进行页面分享配置</span><br>  <span class="hljs-keyword">var</span> <span class="hljs-title class_">PageTmp</span> = <span class="hljs-title class_">Page</span>;<br>  <span class="hljs-title class_">Page</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">pageConfig</span>) &#123;<br>    <span class="hljs-comment">//1. 获取当前页面路由</span><br>    <span class="hljs-keyword">let</span> routerUrl = <span class="hljs-string">&#x27;&#x27;</span>;<br>    wx.<span class="hljs-title function_">onAppRoute</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) &#123;<br>      <span class="hljs-keyword">let</span> pages = <span class="hljs-title function_">getCurrentPages</span>(),<br>        view = pages[pages.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>];<br>      routerUrl = view.<span class="hljs-property">route</span>;<br>    &#125;);<br>    <span class="hljs-comment">//2. 全局开启分享配置</span><br>    pageConfig = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(<br>      &#123;<br>        <span class="hljs-attr">onShareAppMessage</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>          <span class="hljs-comment">//根据不同路由设置不同分享内容（微信小程序分享自带参数，如非特例，不需配置分享路径）</span><br>          <span class="hljs-keyword">let</span> shareInfo = &#123;&#125;;<br>          <span class="hljs-comment">//目前发现这里的变量只能用App外定义的全局的，或者缓存~~~~</span><br>          shareInfo = &#123;<br>            <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;上万家庭都在使用的家庭健康助手&#x27;</span>,<br>            <span class="hljs-comment">// title: pageConfigs[routerUrl],</span><br>            <span class="hljs-attr">imageUrl</span>: shareUrl,<br>            <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/&#x27;</span> + routerUrl,<br>          &#125;;<br>          <span class="hljs-keyword">return</span> shareInfo;<br>        &#125;,<br>        <span class="hljs-attr">onShareTimeline</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>          <span class="hljs-comment">//根据不同路由设置不同分享内容（微信小程序分享自带参数，如非特例，不需配置分享路径）</span><br>          <span class="hljs-keyword">let</span> shareInfo = &#123;&#125;;<br>          <span class="hljs-comment">//目前发现这里的变量只能用App外定义的全局的，或者缓存~~~~</span><br>          shareInfo = &#123;<br>            <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;上万家庭都在使用的家庭健康助手&#x27;</span>,<br>            <span class="hljs-comment">// title: pageConfigs[routerUrl],</span><br>            <span class="hljs-attr">imageUrl</span>: shareUrl,<br>            <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/&#x27;</span> + routerUrl,<br>          &#125;;<br>          <span class="hljs-keyword">return</span> shareInfo;<br>        &#125;,<br>      &#125;,<br>      pageConfig,<br>    );<br>    <span class="hljs-comment">// 配置页面模板</span><br>    <span class="hljs-title class_">PageTmp</span>(pageConfig);<br>  &#125;;<br>&#125;)();<br></code></pre></td></tr></table></figure><h3 id="六、上拉下拉"><a href="#六、上拉下拉" class="headerlink" title="六、上拉下拉"></a>六、上拉下拉</h3><h4 id="1-上拉加载更多"><a href="#1-上拉加载更多" class="headerlink" title="1. 上拉加载更多"></a>1. 上拉加载更多</h4><h4 id="2-下拉刷新"><a href="#2-下拉刷新" class="headerlink" title="2. 下拉刷新"></a>2. 下拉刷新</h4>]]></content>
    
    
    <categories>
      
      <category>小程序</category>
      
    </categories>
    
    
    <tags>
      
      <tag>commitizen</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2021-05-06-vue优化</title>
    <link href="/2025/11/28/2021-12-06-%E3%80%90%E4%BC%98%E5%8C%96%E3%80%91vue%E4%BC%98%E5%8C%96/"/>
    <url>/2025/11/28/2021-12-06-%E3%80%90%E4%BC%98%E5%8C%96%E3%80%91vue%E4%BC%98%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<blockquote></blockquote><span id="more"></span><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>项目越做越大，页面越来越多，导致项目也越来越卡顿。</p><h2 id="解决思路"><a href="#解决思路" class="headerlink" title="解决思路"></a>解决思路</h2><ul><li>1、首屏优化</li><li>2、技术债务编码优化</li><li>3、打包优化，cdn</li></ul><h2 id="首屏优化"><a href="#首屏优化" class="headerlink" title="首屏优化"></a>首屏优化</h2><p>在Vue项目中，引入到工程中的所有js、css文件，编译时都会被打包进vendor.js，浏览器在加载该文件之后才能开始显示首屏。若是引入的库众多，那么vendor.js文件体积将会相当的大，影响首屏的体验。利用webpack的externals配置。防止将某些 import 的包(package)打包到 bundle 中，而是在运行时(runtime)再去从外部获取这些扩展依赖(external dependencies)。</p><ol><li>首先安装webpack的可视化资源分析工具，命令行执行：</li></ol><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs applescript">&#x27;<span class="hljs-comment"># NPM </span><br> npm i webpack-bundle-analyzer -D<br> <span class="hljs-comment"># Yarn </span><br> yarn add -D webpack-bundle-analyzer<br></code></pre></td></tr></table></figure><p>2.1 然后在webpack的dev开发模式配置中，引入插件，代码如下：<code>const { BundleAnalyzerPlugin } = require(&#39;webpack-bundle-analyzer&#39;)</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-attr">plugins</span>: [<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">BundleAnalyzerPlugin</span>()<br>]<br></code></pre></td></tr></table></figure><p>2.2 vue-cli3中vue.config.js中加入配置</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-attr">chainWebpack</span>: <span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// 关闭prefetch: vue-cli3 默认会把所有通过import()按需加载的javascript文件加上 prefetch</span><br>    config.<span class="hljs-property">plugins</span>.<span class="hljs-title function_">delete</span>(<span class="hljs-string">&#x27;prefetch&#x27;</span>);<br>    <span class="hljs-comment">// 打包分析插件</span><br>    config.<span class="hljs-title function_">plugin</span>(<span class="hljs-string">&#x27;webpack-bundle-analyzer&#x27;</span>).<span class="hljs-title function_">use</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;webpack-bundle-analyzer&#x27;</span>).<span class="hljs-property">BundleAnalyzerPlugin</span>);<br><br>    <span class="hljs-comment">// 复写html指令，防止xss攻击</span><br>    config.<span class="hljs-property">module</span><br>      .<span class="hljs-title function_">rule</span>(<span class="hljs-string">&#x27;vue&#x27;</span>)<br>      .<span class="hljs-title function_">use</span>(<span class="hljs-string">&#x27;vue-loader&#x27;</span>)<br>      .<span class="hljs-title function_">loader</span>(<span class="hljs-string">&#x27;vue-loader&#x27;</span>)<br>      .<span class="hljs-title function_">tap</span>(<span class="hljs-function">(<span class="hljs-params">options</span>) =&gt;</span> &#123;<br>        options.<span class="hljs-property">compilerOptions</span>.<span class="hljs-property">directives</span> = &#123;<br>          <span class="hljs-title function_">html</span>(<span class="hljs-params">node, directiveMeta</span>) &#123;<br>            (node.<span class="hljs-property">props</span> || (node.<span class="hljs-property">props</span> = [])).<span class="hljs-title function_">push</span>(&#123;<br>              <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;innerHTML&#x27;</span>,<br>              <span class="hljs-attr">value</span>: <span class="hljs-string">`$xss.process(_s(<span class="hljs-subst">$&#123;directiveMeta.value&#125;</span>))`</span>,<br>            &#125;);<br>          &#125;,<br>        &#125;;<br><br>        <span class="hljs-keyword">return</span> options;<br>      &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><ol start="3"><li><p>最后命令行执行npm run build –report , 浏览器会自动打开分析结果</p></li><li><p>app.xxx.js 文件过大</p></li></ol><p>解决方案：</p><ol><li>代码分割 CommonsChunkPlugin；</li><li>提取第三方库 vendor</li><li>外部引入第三方库 external</li><li>设置缓存</li><li>代码压缩 uglifyJsPlugin</li></ol><p>引入CommonChunkPlugin，并在router&#x2F;index.js中使用require.ensure()进行组件的引入：</p><h3 id="一、对于第三方js库的优化，分离打包"><a href="#一、对于第三方js库的优化，分离打包" class="headerlink" title="一、对于第三方js库的优化，分离打包"></a>一、对于第三方js库的优化，分离打包</h3><p>  生产环境是内网的话，就把资源放内网，通过静态文件引入，会比node_modules和外网CDN的打包加载快很多。如果有外网的话，可以通过CDN方式引入，因为不用占用访问外网的带宽，不仅可以为您节省流量，还能通过CDN加速，获得更快的访问速度。但是要注意下，如果你引用的CDN 资源存在于第三方服务器，在安全性上并不完全可控。        </p><p>  目前采用引入依赖包生产环境的js文件方式加载，直接通过window可以访问暴露出的全局变量，不必通过import引入，Vue.use去注册        </p><p>  在webpack的dev开发配置文件中, 加入如下参数，可以分离打包第三方资源包，key为依赖包名称，value是源码抛出来的全局变量。如下图所示，可以看到打包后vue相关资源包已经排除在外了。对于一些其他的工具库，尽量采用按需引入的方式。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-attr">externals</span>: &#123;<br>    <span class="hljs-attr">vue</span>: <span class="hljs-string">&#x27;Vue&#x27;</span>,<br>    <span class="hljs-attr">vuex</span>: <span class="hljs-string">&#x27;Vuex&#x27;</span>,<br>    <span class="hljs-string">&#x27;vue-router&#x27;</span>: <span class="hljs-string">&#x27;VueRouter&#x27;</span>,<br>    <span class="hljs-attr">axios</span>: <span class="hljs-string">&#x27;axios&#x27;</span>,<br>    <span class="hljs-string">&#x27;element-ui&#x27;</span>: <span class="hljs-string">&#x27;ELEMENT&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="四、开启gizp压缩"><a href="#四、开启gizp压缩" class="headerlink" title="四、开启gizp压缩"></a>四、开启gizp压缩</h3><p>gizp压缩是一种http请求优化方式，通过减少文件体积来提高加载速度。html、js、css文件甚至json数据都可以用它压缩，可以减小60%以上的体积。前端配置gzip压缩，并且服务端使用nginx开启gzip，用来减小网络传输的流量大小。<br>命令行执行：npm i compression-webpack-plugin  -D在webpack的dev开发配置文件中加入如下代码:const CompressionWebpackPlugin &#x3D; require(‘compression-webpack-plugin’)</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-attr">plugins</span>: [<br>   <span class="hljs-keyword">new</span> <span class="hljs-title class_">CompressionWebpackPlugin</span>()<br>]<br></code></pre></td></tr></table></figure><p><a href="https://my.oschina.net/kaikai1/blog/3067588">参考资料</a></p><p>前端项目配置Gzip的两种方式<br>1、静态压缩：前端工程打包成Gzip,然后nginx开启Gzip模块</p><ul><li>vue-cli生成的项目，安装 compression-webpack-plugin 插件</li><li>nginx配置gizp</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">listen</span> <span class="hljs-number">4300</span>;<br>    <span class="hljs-attribute">server_name</span> localhost;<br>    <span class="hljs-section">location</span> / &#123;<br>        <span class="hljs-attribute">root</span> /home/static/web/wechat;<br>        <span class="hljs-attribute">index</span> /index.html;<br>        <span class="hljs-attribute">try_files</span> <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /index.html;<br>        <span class="hljs-attribute">gzip_static</span> <span class="hljs-literal">on</span>; <span class="hljs-comment">#静态压缩</span><br>    &#125;<br></code></pre></td></tr></table></figure><p>2、直接采用nginx进行Gzip化<br>2.1 nginx配置gizp</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">在nginx.conf文件夹的http里面配置数据<br><br>gzip on; <span class="hljs-comment">#开启或关闭gzip on off</span><br>gzip_min_length 5k; <span class="hljs-comment">#gzip压缩最小文件大小，超出进行压缩（自行调节）</span><br>gzip_buffers 4 16k; <span class="hljs-comment">#buffer 不用修改</span><br>gzip_comp_level 8; <span class="hljs-comment">#压缩级别:1-10，数字越大压缩的越好，时间也越长</span><br>gzip_types text/plain application/x-javascript application/javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png; <span class="hljs-comment">#  压缩文件类型</span><br>gzip_vary on; <span class="hljs-comment"># 和http头有关系，加个vary头，给代理服务器用的，有的浏览器支持压缩，有的不支持，所以避免浪费不支持的也压缩，所以根据客户端的HTTP头来判断，是否需要压缩</span><br></code></pre></td></tr></table></figure><p>2.2 开启gzip</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs nix">gzip on;<br><span class="hljs-comment"># 启用gzip压缩的最小文件，小于设置值的文件将不会压缩</span><br>gzip_min_length <span class="hljs-number">1</span>k;<br><span class="hljs-comment"># gzip 压缩级别，1-9，数字越大压缩的越好，也越占用CPU时间，后面会有详细说明</span><br>gzip_comp_level <span class="hljs-number">1</span>;<br><span class="hljs-comment"># 进行压缩的文件类型。javascript有多种形式。其中的值可以在 mime.types 文件中找到。</span><br>gzip_types text<span class="hljs-symbol">/plain</span> application<span class="hljs-symbol">/javascript</span> application<span class="hljs-symbol">/x-javascript</span> text<span class="hljs-symbol">/css</span> application<span class="hljs-symbol">/xml</span> text<span class="hljs-symbol">/javascript</span> application<span class="hljs-symbol">/x-httpd-php</span> image<span class="hljs-symbol">/jpeg</span> image<span class="hljs-symbol">/gif</span> image<span class="hljs-symbol">/png</span> application<span class="hljs-symbol">/vnd.ms-fontobject</span> font<span class="hljs-symbol">/ttf</span> font<span class="hljs-symbol">/opentype</span> font<span class="hljs-symbol">/x-woff</span> image<span class="hljs-symbol">/svg+xml</span>;<br><span class="hljs-comment"># 是否在http header中添加Vary: Accept-Encoding，建议开启</span><br>gzip_vary on;<br><span class="hljs-comment"># 禁用IE 6 gzip</span><br>gzip_disable <span class="hljs-string">&quot;MSIE [1-6]<span class="hljs-char escape_">\.</span>&quot;</span>;<br><span class="hljs-comment"># 设置压缩所需要的缓冲区大小     </span><br>gzip_buffers <span class="hljs-number">32</span> <span class="hljs-number">4</span>k;<br><span class="hljs-comment"># 设置gzip压缩针对的HTTP协议版本</span><br>gzip_http_version <span class="hljs-number">1.0</span>;<br></code></pre></td></tr></table></figure><p>前后端gzip压缩区别；<br>nginx开启gzip 压缩会耗费cpu资源；会降低</p><p>双端Gzip区别及其意义<br>不同之处在于：</p><ul><li>1、Webpack压缩会在构建运行期间一次压缩文件，然后将这些压缩版本保存到磁盘。</li><li>2、nginx在请求时压缩文件时，某些包可能内置了缓存,因此性能损失只发生一次(或不经常),但通常不同之处在于,这将在响应 HTTP请求时发生。</li><li>3、对于实时压缩,让上游代理(例如 Nginx)处理 gzip和缓存通常更高效，因为它们是专门为此而构建的,并且不会遭受服务端程序运行时的开销(许多都是用C语言编写的) 。</li><li>4、使用 Webpack的好处是， Nginx每次请求服务端都要压缩很久才回返回信息回来，不仅服务器开销会增大很多，请求方也会等的不耐烦。我们在 Webpack打包时就直接生成高压缩等级的文件，作为静态资源放在服务器上，这时将 Nginx作为二重保障就会高效很多。</li><li>5、注：具体是在请求时实时压缩，或在构建时去生成压缩文件，就要看项目业务情况。</li></ul><p>原则：<br>1、小文件无需压缩，浪费资源<br>2、图片&#x2F;mp3这样的二进制文件,不必压缩 因为压缩率比较小, 比如100-&gt;80字节</p>]]></content>
    
    
    <categories>
      
      <category>vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>优化</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2021-12-09-水印</title>
    <link href="/2025/11/28/2021-12-09-%E3%80%90%E5%AE%89%E5%85%A8%E3%80%91%E6%B0%B4%E5%8D%B0/"/>
    <url>/2025/11/28/2021-12-09-%E3%80%90%E5%AE%89%E5%85%A8%E3%80%91%E6%B0%B4%E5%8D%B0/</url>
    
    <content type="html"><![CDATA[<h2 id=""><a href="#" class="headerlink" title=""></a></h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> drawWaterMark = <span class="hljs-keyword">function</span> (<span class="hljs-params">content = <span class="hljs-string">&#x27;水印&#x27;</span></span>) &#123;<br>  <span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>;<br>  <span class="hljs-keyword">const</span> width = <span class="hljs-string">&#x27;300&#x27;</span>;<br>  <span class="hljs-keyword">const</span> height = <span class="hljs-string">&#x27;200&#x27;</span>;<br>  <span class="hljs-keyword">const</span> textAlign = <span class="hljs-string">&#x27;center&#x27;</span>;<br>  <span class="hljs-keyword">const</span> textBaseline = <span class="hljs-string">&#x27;middle&#x27;</span>;<br>  <span class="hljs-keyword">const</span> font = <span class="hljs-string">&#x27;16px Microsoft Yahei&#x27;</span>;<br>  <span class="hljs-keyword">const</span> fillStyle = <span class="hljs-string">&#x27;rgba(184, 184, 184, 0.2)&#x27;</span>;<br>  <span class="hljs-keyword">const</span> rotate = <span class="hljs-string">&#x27;30&#x27;</span>;<br>  <span class="hljs-keyword">const</span> zIndex = <span class="hljs-number">10000</span>;<br><br>  <span class="hljs-keyword">const</span> canvas = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;canvas&#x27;</span>);<br><br>  canvas.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&#x27;width&#x27;</span>, <span class="hljs-string">`<span class="hljs-subst">$&#123;width&#125;</span>px`</span>);<br>  canvas.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&#x27;height&#x27;</span>, <span class="hljs-string">`<span class="hljs-subst">$&#123;height&#125;</span>px`</span>);<br>  <span class="hljs-keyword">const</span> ctx = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">&#x27;2d&#x27;</span>);<br><br>  ctx.<span class="hljs-property">textAlign</span> = textAlign;<br>  ctx.<span class="hljs-property">textBaseline</span> = textBaseline;<br>  ctx.<span class="hljs-property">font</span> = font;<br>  ctx.<span class="hljs-property">fillStyle</span> = fillStyle;<br>  ctx.<span class="hljs-title function_">rotate</span>((<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">180</span>) * rotate);<br>  ctx.<span class="hljs-title function_">fillText</span>(content, <span class="hljs-built_in">parseFloat</span>(width) / <span class="hljs-number">2</span>, <span class="hljs-built_in">parseFloat</span>(height) / <span class="hljs-number">4</span>);<br><br>  <span class="hljs-keyword">const</span> base64Url = canvas.<span class="hljs-title function_">toDataURL</span>();<br>  <span class="hljs-keyword">const</span> watermarkDiv = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;div&#x27;</span>);<br>  <span class="hljs-keyword">const</span> styleStr = <span class="hljs-string">`</span><br><span class="hljs-string">  position:fixed;</span><br><span class="hljs-string">  top:0;</span><br><span class="hljs-string">  left:0;</span><br><span class="hljs-string">  bottom:0;</span><br><span class="hljs-string">  right:0;</span><br><span class="hljs-string">  width:100%;</span><br><span class="hljs-string">  height:100%;</span><br><span class="hljs-string">  z-index:<span class="hljs-subst">$&#123;zIndex&#125;</span>;</span><br><span class="hljs-string">  pointer-events:none;</span><br><span class="hljs-string">  background-repeat:repeat;</span><br><span class="hljs-string">  background-image:url(&#x27;<span class="hljs-subst">$&#123;base64Url&#125;</span>&#x27;)`</span>;<br>  watermarkDiv.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&#x27;style&#x27;</span>, styleStr);<br>  watermarkDiv.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">&#x27;watermark&#x27;</span>);<br><br>  container.<span class="hljs-title function_">insertBefore</span>(watermarkDiv, container.<span class="hljs-property">firstChild</span>);<br><br>  <span class="hljs-comment">// 防止用户通过控制台修改样式去除水印效果</span><br>  <span class="hljs-comment">/* MutationObserver 监听DOM结构变化的接口。 */</span><br>  <span class="hljs-keyword">const</span> observer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MutationObserver</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> wmInstance = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;.watermark&#x27;</span>);<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;MutationObserver&#x27;</span>);<br>    <span class="hljs-keyword">if</span> ((wmInstance &amp;&amp; wmInstance.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">&#x27;style&#x27;</span>) !== styleStr) || !wmInstance) &#123;<br>      <span class="hljs-comment">// 如果标签在，只修改了属性，重新赋值属性</span><br>      <span class="hljs-keyword">if</span> (wmInstance) &#123;<br>        <span class="hljs-comment">// console.log(&#x27;水印属性修改了&#x27;);</span><br>        wmInstance.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&#x27;style&#x27;</span>, styleStr);<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// console.log(&#x27;水印被删除了&#x27;);</span><br>        container.<span class="hljs-title function_">insertBefore</span>(watermarkDiv, container.<span class="hljs-property">firstChild</span>);<br>      &#125;<br>    &#125;<br>  &#125;);<br><br>  <span class="hljs-comment">// 防删除</span><br>  observer.<span class="hljs-title function_">observe</span>(container, &#123;<br>    <span class="hljs-attr">attributes</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// node 的特性（attribute）</span><br>    <span class="hljs-attr">subtree</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// node 的所有后代的更改</span><br>    <span class="hljs-attr">childList</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// node 的直接子节点的更改</span><br>  &#125;);<br>  <span class="hljs-comment">// 防编辑样式</span><br>  observer.<span class="hljs-title function_">observe</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;.watermark&#x27;</span>), &#123;<br>    <span class="hljs-attr">attributes</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// node 的特性（attribute）</span><br>    <span class="hljs-attr">subtree</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// node 的所有后代的更改</span><br>    <span class="hljs-attr">childList</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// node 的直接子节点的更改</span><br>  &#125;);<br>&#125;;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MutationObserver</tag>
      
      <tag>canvas</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-10-24 BEM规范</title>
    <link href="/2025/11/28/2022-01-02-%E3%80%90%E8%A7%84%E8%8C%83%E3%80%91BEM%E8%A7%84%E8%8C%83/"/>
    <url>/2025/11/28/2022-01-02-%E3%80%90%E8%A7%84%E8%8C%83%E3%80%91BEM%E8%A7%84%E8%8C%83/</url>
    
    <content type="html"><![CDATA[<p>##CSS—BEM 命名规范</p><h2 id="1-什么是-BEM-命名规范"><a href="#1-什么是-BEM-命名规范" class="headerlink" title="1 什么是 BEM 命名规范"></a>1 什么是 BEM 命名规范</h2><ul><li>Bem 是块（block）、元素（element）、修饰符（modifier）的简写，由 Yandex 团队提出的一种前端 CSS 命名方法论。</li></ul><blockquote><ul><li>中划线 ：仅作为连字符使用，表示某个块或者某个子元素的多单词之间的连接记号。</li></ul></blockquote><blockquote><p>__ 双下划线：双下划线用来连接块和块的子元素</p></blockquote><blockquote><p>_ 单下划线：单下划线用来描述一个块或者块的子元素的一种状态</p></blockquote><ul><li>BEM 是一个简单又非常有用的命名约定。让你的前端代码更容易阅读和理解，更容易协作，更容易控制，更加健壮和明确，而且更加严密。</li></ul><h3 id="1-1-BEM-命名模式"><a href="#1-1-BEM-命名模式" class="headerlink" title="1.1 BEM 命名模式"></a>1.1 BEM 命名模式</h3><p>BEM 命名约定的模式是：</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-title">.block &#123;&#125;</span><br><br><span class="hljs-title">.block__element &#123;&#125;</span><br><br><span class="hljs-title">.block--modifier &#123;&#125;</span><br></code></pre></td></tr></table></figure><ul><li>每一个块(block)名应该有一个命名空间（前缀）</li><li><code>block</code>  代表了更高级别的抽象或组件。</li><li><code>block__element</code>  代表 .block 的后代，用于形成一个完整的 .block 的整体。</li><li><code>block--modifier</code>  代表 .block 的不同状态或不同版本。 使用两个连字符和下划线而不是一个，是为了让你自己的块可以用单个连字符来界定。如：</li></ul><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs lua">.<span class="hljs-built_in">sub</span>-block__element &#123;&#125;<br><br>.<span class="hljs-built_in">sub</span>-block<span class="hljs-comment">--modifier &#123;&#125;</span><br></code></pre></td></tr></table></figure><h3 id="1-2-BEM-命名法的好处"><a href="#1-2-BEM-命名法的好处" class="headerlink" title="1.2 BEM 命名法的好处"></a>1.2 BEM 命名法的好处</h3><p>BEM的关键是，可以获得更多的描述和更加清晰的结构，从其名字可以知道某个标记的含义。于是，通过查看 HTML 代码中的 class 属性，就能知道元素之间的关联。<br>常规的命名法示例：</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs applescript">&lt;<span class="hljs-keyword">div</span> <span class="hljs-built_in">class</span>=<span class="hljs-string">&quot;article&quot;</span>&gt;<br>    &lt;<span class="hljs-keyword">div</span> <span class="hljs-built_in">class</span>=<span class="hljs-string">&quot;body&quot;</span>&gt;<br>        &lt;button <span class="hljs-built_in">class</span>=<span class="hljs-string">&quot;button-primary&quot;</span>&gt;&lt;/button&gt;<br>        &lt;button <span class="hljs-built_in">class</span>=<span class="hljs-string">&quot;button-success&quot;</span>&gt;&lt;/button&gt;<br>    &lt;/<span class="hljs-keyword">div</span>&gt;<br>&lt;/<span class="hljs-keyword">div</span>&gt;<br></code></pre></td></tr></table></figure><ul><li>这种写法从 DOM 结构和类命名上可以了解每个元素的意义，但无法明确其真实的层级关系。在 css 定义时，也必须依靠层级选择器来限定约束作用域，以避免跨组件的样式污染。</li></ul><p>使用了 BEM 命名方法的示例：</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><br>&lt;<span class="hljs-keyword">div</span> <span class="hljs-built_in">class</span>=<span class="hljs-string">&quot;article&quot;</span>&gt;<br>    &lt;<span class="hljs-keyword">div</span> <span class="hljs-built_in">class</span>=<span class="hljs-string">&quot;article__body&quot;</span>&gt;<br>        &lt;<span class="hljs-keyword">div</span> <span class="hljs-built_in">class</span>=<span class="hljs-string">&quot;tag&quot;</span>&gt;&lt;/<span class="hljs-keyword">div</span>&gt;<br>        &lt;button <span class="hljs-built_in">class</span>=<span class="hljs-string">&quot;article__button--primary&quot;</span>&gt;&lt;/button&gt;<br>        &lt;button <span class="hljs-built_in">class</span>=<span class="hljs-string">&quot;article__button--success&quot;</span>&gt;&lt;/button&gt;<br>    &lt;/<span class="hljs-keyword">div</span>&gt;<br>&lt;/<span class="hljs-keyword">div</span>&gt;<br></code></pre></td></tr></table></figure><ul><li>通过 BEM 命名方式，模块层级关系简单清晰，而且 css 书写上也不必作过多的层级选择。</li></ul><h2 id="2-如何使用-BEM-命名法"><a href="#2-如何使用-BEM-命名法" class="headerlink" title="2 如何使用 BEM 命名法"></a>2 如何使用 BEM 命名法</h2><h3 id="2-1-什么时候应该用-BEM-格式"><a href="#2-1-什么时候应该用-BEM-格式" class="headerlink" title="2.1 什么时候应该用 BEM 格式"></a>2.1 什么时候应该用 BEM 格式</h3><ul><li>使用 BEM 的诀窍是，你要知道什么时候哪些东西是应该写成 BEM 格式的。</li><li>并不是每个地方都应该使用 BEM 命名方式。当需要明确关联性的模块关系时，应当使用 BEM 格式。</li><li>比如只是一条公共的单独的样式，就没有使用 BEM 格式的意义：</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.hide</span> &#123;<br>    <span class="hljs-attribute">display</span>: none <span class="hljs-meta">!important</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-2-在-CSS-预处理器中使用-BEM-格式"><a href="#2-2-在-CSS-预处理器中使用-BEM-格式" class="headerlink" title="2.2 在 CSS 预处理器中使用 BEM 格式"></a>2.2 在 CSS 预处理器中使用 BEM 格式</h3><ul><li>BEM 的一个槽点是，命名方式长而难看，书写不雅。相比 BEM 格式带来的便利来说，我们应客观看待。</li><li>而且，一般来说会使用通过 LESS&#x2F;SASS 等预处理器语言来编写 CSS，利用其语言特性书写起来要简单很多。</li></ul><blockquote><p>以 LESS 为例：</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs css"><br><span class="hljs-selector-class">.article</span> &#123;<br>    <span class="hljs-attribute">max-width</span>: <span class="hljs-number">1200px</span>;<br>    &amp;__body &#123;<br>        <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;<br>    &#125;<br>    &amp;__button &#123;<br>        <span class="hljs-attribute">padding</span>: <span class="hljs-number">5px</span> <span class="hljs-number">8px</span>;<br>        &amp;<span class="hljs-attr">--primary</span> &#123;<span class="hljs-attribute">background</span>: blue;&#125;<br>        &amp;<span class="hljs-attr">--success</span> &#123;<span class="hljs-attribute">background</span>: green;&#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-3-在流行框架的组件中使用-BEM-格式"><a href="#2-3-在流行框架的组件中使用-BEM-格式" class="headerlink" title="2.3 在流行框架的组件中使用 BEM 格式"></a>2.3 在流行框架的组件中使用 BEM 格式</h3><ul><li>在当前流行的  <code>Vue.js</code>  &#x2F;  <code>React</code>  &#x2F;  <code>Angular</code>  等前端框架中，都有 CSS 组件级作用域的编译实现，其基本原理均为利用 CSS 属性选择器特性，为不同的组件生成不同的属性选择器。</li><li>当你选择了这种局部作用域的写法时，在较小的组件中，BEM 格式可能显得没那么重要。但对于公共的、全局性的模块样式定义，还是推荐使用 BEM 格式。</li><li>另外，对于对外发布的公共组件来说，一般为了风格的可定制性，都不会使用这种局部作用域方式来定义组件样式。此时使用 BEM 格式也会大显其彩。</li></ul><h3 id="2-4-避免-block-el1-el2-的格式"><a href="#2-4-避免-block-el1-el2-的格式" class="headerlink" title="2.4 避免 .block__el1__el2 的格式"></a>2.4 避免 .block__el1__el2 的格式</h3><ul><li>在深层次嵌套的 DOM</li><li>结构下，应避免过长的样式名称定义。</li><li>层级最后不要超过 4 级，不然增加阅读的理解难度</li></ul><h2 id="3-总结"><a href="#3-总结" class="headerlink" title="3 总结"></a>3 总结</h2><ul><li>BEM 最难的部分之一是明确作用域是从哪开始和到哪结束的，以及什么时候使用或不使用它。随着不断使用的经验积累，你慢慢就会知道怎么用，这些问题也不再是问题。技术无好坏，合适方最好。</li></ul><h2 id="推荐写法和风格"><a href="#推荐写法和风格" class="headerlink" title="推荐写法和风格"></a>推荐写法和风格</h2><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs stata">.<span class="hljs-keyword">form</span> &#123; &#125;<br>.<span class="hljs-keyword">form</span>--theme-xmas &#123; &#125;<br>.<span class="hljs-keyword">form</span>--simple &#123; &#125;<br>.form__input &#123; &#125;<br>.form__submit &#123; &#125;<br>.form__submit--disabled &#123; &#125;<br><br><span class="hljs-comment">//对应的HTML结构如下：</span><br>&lt;<span class="hljs-keyword">form</span> <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;form form--theme-xmas form--simple&quot;</span>&gt;<br>  &lt;<span class="hljs-keyword">input</span> <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;form__input&quot;</span> <span class="hljs-keyword">type</span>=<span class="hljs-string">&quot;text&quot;</span> /&gt;<br>  &lt;<span class="hljs-keyword">input</span><br>    <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;form__submit form__submit--disabled&quot;</span><br>    <span class="hljs-keyword">type</span>=<span class="hljs-string">&quot;submit&quot;</span> /&gt;<br>&lt;/<span class="hljs-keyword">form</span>&gt;<br></code></pre></td></tr></table></figure><h2 id="4-相关参考"><a href="#4-相关参考" class="headerlink" title="4 相关参考"></a>4 相关参考</h2><ul><li><a href="https://link.juejin.cn/?target=http://getbem.com">getbem.com</a></li><li><a href="https://link.juejin.cn/?target=https://github.com/Tencent/tmt-workflow/wiki/%25E2%2592%259B-%255B%25E8%25A7%2584%25E8%258C%2583%255D--CSS-BEM-%25E4%25B9%25A6%25E5%2586%2599%25E8%25A7%2584%25E8%258C%2583">github.com&#x2F;Tencent&#x2F;tmt…</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>规范</category>
      
    </categories>
    
    
    <tags>
      
      <tag>BEM</tag>
      
      <tag>前端工程化</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-01-20-开发环境准备</title>
    <link href="/2025/11/28/2022-01-20-%E3%80%90init%E3%80%91%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/"/>
    <url>/2025/11/28/2022-01-20-%E3%80%90init%E3%80%91%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/</url>
    
    <content type="html"><![CDATA[<p>MAC开发环境</p><p>开发<br>git,node,nvm,yarn,vscode,Xversion(svn),ugit<br>文档<br>xmind,draw.io,typora,yapi<br>运维<br>iterm,weterm,postman,jmeter,docker,vmware</p><p>nvm使用指令</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">nvm install <span class="hljs-keyword">node</span><span class="hljs-title">：安装最新版本的 node</span>。<br>nvm install [<span class="hljs-tag">&lt;version&gt;</span>]：安装指定的 <span class="hljs-keyword">node</span> <span class="hljs-title">版本。</span><br><span class="hljs-title">nvm</span> ls：查看已安装的<span class="hljs-keyword">node</span> <span class="hljs-title">版本列表。</span><br><span class="hljs-title">nvm</span> uninstall <span class="hljs-tag">&lt;version&gt;</span>：卸载指定的 <span class="hljs-keyword">node</span> <span class="hljs-title">版本。</span><br><span class="hljs-title">nvm</span> use <span class="hljs-tag">&lt;version&gt;</span>：切换指定的 <span class="hljs-keyword">node</span> <span class="hljs-title">版本（临时）。</span><br><span class="hljs-title">// 永久切换版本 ！！！</span><br><span class="hljs-title">nvm</span> alias default <span class="hljs-tag">&lt;version&gt;</span>：切换默认的 <span class="hljs-keyword">node</span> <span class="hljs-title">版本（永久）。</span><br></code></pre></td></tr></table></figure><h1 id="装机必备工具"><a href="#装机必备工具" class="headerlink" title="装机必备工具"></a>装机必备工具</h1><p>Paste - 复制粘贴历史记录神器(试用一个月，298&#x2F;年)<br>Iterm2 - 命令行工具 <a href="https://blog.csdn.net/daiyuhe/article/details/88667875">配置入口</a><br>draw.io - 绘图工具</p>]]></content>
    
    
    <categories>
      
      <category>前端工程化</category>
      
      <category>项目管理</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nginx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-03-08-微前端qiankun实践</title>
    <link href="/2025/11/28/2022-03-08-%E3%80%90%E6%9E%B6%E6%9E%84%E3%80%91%E5%BE%AE%E5%89%8D%E7%AB%AFqiankun/"/>
    <url>/2025/11/28/2022-03-08-%E3%80%90%E6%9E%B6%E6%9E%84%E3%80%91%E5%BE%AE%E5%89%8D%E7%AB%AFqiankun/</url>
    
    <content type="html"><![CDATA[<blockquote></blockquote><span id="more"></span><p><img src="/assets/images/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/%E5%BE%AE%E5%89%8D%E7%AB%AF%E6%96%B9%E6%A1%88.png" alt="微前端方案"></p><p>1、什么是微前端？为什么微前端方案？</p><blockquote><p>2016 年底在 ThoughtWorks 技术雷达中提出，将多个独立的前端应用聚合在一起组成一个全新的应用，各个应用之间彼此独立，互不干扰，应用内高内聚，应用间松耦合；对于用户来说就是一个完整的应用，但是在技术角度上是由一个个独立的应用组合组合而成；</p></blockquote><ul><li>拆分、聚合</li><li>源码交付，自由组合 – 拆</li><li>应用接入 – 合</li><li>需求体量较大，避免巨石应用 – 拆</li></ul><p>2、什么是 qiankun、为什么 qiankun？</p><ul><li>qiankun 是一个基于  single-spa  的微前端实现库，解决了应用加载，以及 js&#x2F;css 污染问题，更简单好用。</li><li>方案成熟可靠、口碑较好，部门内部也有不少项目生产实践</li><li>接入简单，不会对原有工程造成很大“破坏”。</li><li>避免巨石应用，方便应用接入</li><li>与 emp 相比更适合当前技术底座</li></ul><p>3、带来怎样的收益，价值在哪里？</p><ul><li>技术栈无关、易扩展：主框架不限制接入应用的技术栈，项目无限扩展</li><li>独立开发、独立部署：微应用仓库独立，前后端可独立开发，独立部署互不干扰</li><li>增量升级：微前端是一种非常好的实施渐进式重构的手段和策略</li><li>对团队来说，快速实践产出文档，形成组织过程资产</li></ul><p>4、缺点</p><ul><li>依赖不共享，重复加载资源</li><li>通过主应用共享依赖，子应用独立运行时需要启动主应用</li></ul><h2 id="1-qiankun-本地实践"><a href="#1-qiankun-本地实践" class="headerlink" title="1. qiankun 本地实践"></a>1. qiankun 本地实践</h2><h4 id="1-1-SwitchyOmega-whistle-代理"><a href="#1-1-SwitchyOmega-whistle-代理" class="headerlink" title="1.1 SwitchyOmega+whistle 代理"></a>1.1 SwitchyOmega+whistle 代理</h4><blockquote><p>前言：前端开发过程中经常会遇到需要对请求做拦截，然后通过代理工具或者其他方式转发到指定的服务器上。最常见的场景就是在单点登录的情况下，需要用域名来访问，带上登录 token，后端才能识别成合法的用户请求。下文介绍一下 chrome 插件 SwitchyOmega 和基于 nodejs 的代理工具 whistle 的使用方法</p></blockquote><ul><li><a href="http://wproxy.org/whistle/">whistle</a><blockquote><p>whistle(读音[ˈwɪsəl]，拼音[wēisǒu])基于 Node 实现的跨平台 web 调试代理工具，类似的工具有 Windows 平台上的 Fiddler，主要用于查看、修改 HTTP、HTTPS、Websocket 的请求、响应，也可以作为 HTTP 代理服务器使用，不同于 Fiddler 通过断点修改请求响应的方式，whistle 采用的是类似配置系统 hosts 的方式，一切操作都可以通过配置实现，支持域名、路径、正则表达式、通配符、通配路径等多种匹配方式，且可以通过 Node 模块扩展功能。</p></blockquote></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"># 安装<br>npm install -g whistle<br># 启动<br>w2 start<br></code></pre></td></tr></table></figure><ul><li><a href="https://chrome.google.com/webstore/detail/proxy-switchyomega/padekgcemlokbadohgkifijomclgjgif?hl=zh-CN">SwitchyOmega</a></li></ul><blockquote><p>作为 chrome 的浏览器插件，安装后可以随时方便地使用。支持设置不同的场景模式，并且可以按照预定规则进行自动切换场景。直接在 chrome 网上应用店搜索就可以安装：</p></blockquote><p>项目分为三大层，底层调度层，核心层和业务层。</p><ul><li>底层调度层：主要借助 single-spa 做应用的调度，加载，卸载；qiankun 主要提供 js 隔离，样式隔离，以及应用注册和应用通信功能等上层功能。和业务无关</li><li>核心层：主要接入 qiankun 框架，抽离出系统中的公共模块，例如登录注册，头部 header、侧边菜单 sidebar 等功能，负责鉴权、全局事件处理，应用分发等</li><li>业务层：主要负责业务，根据主系统的要求，做系统的改造，接入微前端</li></ul><h4 id="1-2-项目配置"><a href="#1-2-项目配置" class="headerlink" title="1.2 项目配置"></a>1.2 项目配置</h4><p>将普通的项目改造成 qiankun 主应用基座，需要进行四步操作：</p><ul><li>当前 qiankun 版本 “qiankun”: “^2.4.10”,</li></ul><ol><li>创建微应用容器 - 用于承载微应用，渲染显示微应用；</li><li>注册微应用 - 设置微应用激活条件，微应用地址等等；</li><li>创建子应用 - 微前端接入配置；</li><li>启动 qiankun - 主应用基座中启动。</li></ol><h4 id="1-2-1-创建微应用容器"><a href="#1-2-1-创建微应用容器" class="headerlink" title="1.2.1 创建微应用容器"></a>1.2.1 创建微应用容器</h4><p>app.vue 中通过<code>$route.name</code>判断是否为项目路由</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">v-show</span>=<span class="hljs-string">&quot;!$route.name&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;qianKunBox&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;in-qiankun&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">router-view</span> <span class="hljs-attr">v-show</span>=<span class="hljs-string">&quot;$route.name&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">router-view</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="1-2-2-注册微应用"><a href="#1-2-2-注册微应用" class="headerlink" title="1.2.2 注册微应用"></a>1.2.2 注册微应用</h4><ul><li><code>vue.config.js</code> 改造配置文件<br>用于给主应用接入时进行注册，对应主应用注册子应用时的 registerMicroApps 中的某一个自入口的 name</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> packageName = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./package.json&quot;</span>).<span class="hljs-property">name</span>;<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-comment">// ... other configs</span><br>  <span class="hljs-attr">configureWebpack</span>: &#123;<br>    <span class="hljs-comment">// 让主应用能正确识别微应用暴露出来的一些信息</span><br>    <span class="hljs-attr">output</span>: &#123;<br>      <span class="hljs-attr">library</span>: <span class="hljs-string">`<span class="hljs-subst">$&#123;packageName&#125;</span>`</span>,<br>      <span class="hljs-attr">libraryTarget</span>: <span class="hljs-string">&quot;umd&quot;</span>,<br>      <span class="hljs-attr">jsonpFunction</span>: <span class="hljs-string">`webpackJsonp_<span class="hljs-subst">$&#123;packageName&#125;</span>`</span>,<br>    &#125;,<br>  &#125;,<br>  <span class="hljs-comment">// ... other configs</span><br>&#125;;<br></code></pre></td></tr></table></figure><ul><li>src&#x2F;qiankun&#x2F;config.js 子应用注册信息</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> &#123; <span class="hljs-variable constant_">VUE_APP_ROUTER_BASE</span> &#125; = process.<span class="hljs-property">env</span>;<br><br><span class="hljs-keyword">const</span> props = &#123;<br>  <span class="hljs-attr">header</span>: <span class="hljs-literal">false</span>,<br>  <span class="hljs-attr">sidebar</span>: <span class="hljs-literal">false</span>,<br>  <span class="hljs-attr">isParentSlider</span>: <span class="hljs-literal">true</span>,<br>&#125;;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> subAppRouter = [<br>  &#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;hrss-web-portal&quot;</span>,<br>    <span class="hljs-attr">entry</span>: <span class="hljs-string">`<span class="hljs-subst">$&#123;VUE_APP_ROUTER_BASE&#125;</span>/sub/portal/?t=<span class="hljs-subst">$&#123;<span class="hljs-built_in">Date</span>.now()&#125;</span>`</span>,<br>    <span class="hljs-attr">container</span>: <span class="hljs-string">&quot;#qianKunBox&quot;</span>,<br>    <span class="hljs-attr">activeRule</span>: <span class="hljs-string">`<span class="hljs-subst">$&#123;VUE_APP_ROUTER_BASE&#125;</span>/portal`</span>,<br>    <span class="hljs-attr">props</span>: &#123;<br>      ...props,<br>      <span class="hljs-attr">baseRouter</span>: <span class="hljs-string">`<span class="hljs-subst">$&#123;VUE_APP_ROUTER_BASE&#125;</span>/portal`</span>,<br>      <span class="hljs-attr">isParentSlider</span>: <span class="hljs-literal">false</span>,<br>    &#125;,<br>  &#125;,<br>];<br></code></pre></td></tr></table></figure><ul><li>注册子应用信息</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;core-js/stable&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;regenerator-runtime/runtime&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;@/core&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; registerMicroApps, setDefaultMountApp, start &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;qiankun&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./app.vue&quot;</span>;<br><span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./router&quot;</span>;<br><span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./store&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; topbarConfig, sideBarConfig &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./config&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; dealApps &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/qiankun&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-variable constant_">MUTATIONTYPES</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./store/mutations-type&quot;</span>;<br><br><span class="hljs-keyword">const</span> &#123; <span class="hljs-variable constant_">VUE_APP_ROUTER_BASE</span> &#125; = process.<span class="hljs-property">env</span>;<br><span class="hljs-keyword">const</span> storeGlobalTypes = <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$storeGlobalTypes</span>;<br><br><span class="hljs-keyword">let</span> appMain = <span class="hljs-literal">null</span>;<br><span class="hljs-comment">// 初始化应用渲染</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">initRender</span> = (<span class="hljs-params">props = &#123;&#125;</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> &#123; userInfo &#125; = props;<br>  <span class="hljs-keyword">if</span> (!appMain) &#123;<br>    appMain = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>      router,<br>      store,<br>      <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">h</span>) =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>),<br>    &#125;).$mount(<span class="hljs-string">&quot;#app&quot;</span>);<br>  &#125;<br>  <span class="hljs-comment">// 此处省略大段设置 用户信息、菜单代码...</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">dealApps</span>(appMain);<br>&#125;;<br><span class="hljs-comment">// 注册微前端</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">register</span>(<span class="hljs-params">apps</span>) &#123;<br>  <span class="hljs-title function_">registerMicroApps</span>(apps, &#123;<br>    <span class="hljs-attr">beforeLoad</span>: [<br>      <span class="hljs-function">(<span class="hljs-params">app</span>) =&gt;</span> &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[LifeCycle] before load %c%s&quot;</span>, <span class="hljs-string">&quot;color: green;&quot;</span>, app.<span class="hljs-property">name</span>);<br>      &#125;,<br>    ],<br>    <span class="hljs-attr">beforeMount</span>: [<br>      <span class="hljs-function">(<span class="hljs-params">app</span>) =&gt;</span> &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[LifeCycle] before mount %c%s&quot;</span>, <span class="hljs-string">&quot;color: green;&quot;</span>, app.<span class="hljs-property">name</span>);<br>        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>          store.<span class="hljs-title function_">commit</span>(<span class="hljs-string">`index/<span class="hljs-subst">$&#123;MUTATIONTYPES.SET_APP_LOAD&#125;</span>`</span>, <span class="hljs-literal">true</span>);<br>        &#125;, <span class="hljs-number">1</span>);<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;main beforeMount &quot;</span>, app);<br>        store.<span class="hljs-title function_">commit</span>(<br>          <span class="hljs-string">`global/<span class="hljs-subst">$&#123;storeGlobalTypes.SET_SIDEBAR_STATUS&#125;</span>`</span>,<br>          app.<span class="hljs-property">props</span>.<span class="hljs-property">isParentSlider</span><br>        ); <span class="hljs-comment">// 设置顶栏</span><br>      &#125;,<br>    ],<br>    <span class="hljs-attr">afterUnmount</span>: [<br>      <span class="hljs-function">(<span class="hljs-params">app</span>) =&gt;</span> &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<br>          <span class="hljs-string">&quot;[LifeCycle] after unmount %c%s&quot;</span>,<br>          <span class="hljs-string">&quot;color: green;&quot;</span>,<br>          app.<span class="hljs-property">name</span><br>        );<br>      &#125;,<br>    ],<br>  &#125;);<br>  <span class="hljs-comment">// 设置默认打开的微前端 应用 TODO 如果路径存在则跳转，否则走默认路径</span><br>  <span class="hljs-title function_">setDefaultMountApp</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;VUE_APP_ROUTER_BASE&#125;</span>/portal`</span>);<br><br>  <span class="hljs-comment">// 启动qiankun</span><br>  <span class="hljs-title function_">start</span>(&#123;<br>    <span class="hljs-attr">sandbox</span>: &#123; <span class="hljs-attr">strictStyleIsolation</span>: <span class="hljs-literal">false</span> &#125;,<br>  &#125;);<br>&#125;<br><br><span class="hljs-keyword">const</span> apps = <span class="hljs-title function_">initRender</span>(&#123;<br>  <span class="hljs-attr">userInfo</span>: &#123;<br>    <span class="hljs-attr">isLogin</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">info</span>: &#123;<br>      <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;nickname&quot;</span>,<br>    &#125;,<br>    <span class="hljs-comment">// 用户中心可操作列表</span><br>    <span class="hljs-attr">menu</span>: [],<br>  &#125;,<br>&#125;);<br><span class="hljs-comment">// 微前端主应用，微应用注册</span><br><span class="hljs-title function_">register</span>(apps);<br></code></pre></td></tr></table></figure><h4 id="1-2-3-创建子应用"><a href="#1-2-3-创建子应用" class="headerlink" title="1.2.3 创建子应用"></a>1.2.3 创建子应用</h4><ul><li>子应用导出钩子函数</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// eslint-disable-next-line require-await</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">bootstrap</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[vue] vue app bootstraped&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">// eslint-disable-next-line require-await</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">mount</span>(<span class="hljs-params">props</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[vue] vue app mount&quot;</span>, props);<br>  <span class="hljs-title function_">initRender</span>(props);<br>&#125;<br><br><span class="hljs-comment">// eslint-disable-next-line require-await</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">unmount</span>(<span class="hljs-params"></span>) &#123;<br>  instance.$destroy();<br>  instance = <span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-依赖共享优化"><a href="#2-依赖共享优化" class="headerlink" title="2. 依赖共享优化"></a>2. 依赖共享优化</h2><blockquote><p>虽然 qiankun 微前端方案，能带来应用独立部署独立开发的好处，但是独立部署时，各子应用将重复引入相同依赖包，使项目整体包体积。这里可以将 chunk-vendor 中的依赖包通过 webpack 的 externals 忽略，再通过外链方式引入 html 模板中，依赖包可通过 copy-webpack-plugin 从 node_modules 取出。</p><blockquote><ol><li>复用主应用公共依赖</li><li>子应用间共享依赖</li></ol></blockquote></blockquote><h3 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h3><h4 id="1-主应用提取”公共“依赖"><a href="#1-主应用提取”公共“依赖" class="headerlink" title="1. 主应用提取”公共“依赖"></a>1. 主应用提取”公共“依赖</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-attr">externals</span>: &#123;<br>  <span class="hljs-attr">vue</span>: <span class="hljs-string">&#x27;Vue&#x27;</span>,<br>  <span class="hljs-attr">vuex</span>: <span class="hljs-string">&#x27;Vuex&#x27;</span>,<br>  <span class="hljs-attr">axios</span>: <span class="hljs-string">&#x27;axios&#x27;</span>,<br>  <span class="hljs-string">&#x27;tdesign-vue&#x27;</span>: <span class="hljs-string">&#x27;TDesign&#x27;</span>,<br>  <span class="hljs-string">&#x27;vue-router&#x27;</span>: <span class="hljs-string">&#x27;VueRouter&#x27;</span>,<br>  <span class="hljs-comment">// vue: &#123;</span><br>  <span class="hljs-comment">//   commonjs: &#x27;vue&#x27;,</span><br>  <span class="hljs-comment">//   commonjs2: &#x27;vue&#x27;,</span><br>  <span class="hljs-comment">//   amd: &#x27;vue&#x27;,</span><br>  <span class="hljs-comment">//   root: &#x27;Vue&#x27;, // 外链cdn加载挂载到window上的变量名</span><br>  <span class="hljs-comment">// &#125;,</span><br><span class="hljs-attr">plugins</span>: [<br>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">CopyWebpackPlugin</span>(&#123;<br>    <span class="hljs-attr">patterns</span>: [<br>      &#123; <span class="hljs-attr">from</span>: path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">&#x27;/node_modules/vue/dist/vue.min.js&#x27;</span>), <span class="hljs-attr">to</span>: <span class="hljs-string">&#x27;./lib/vue.min.js&#x27;</span> &#125;,<br>      &#123;<br>        <span class="hljs-attr">from</span>: path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">&#x27;/node_modules/vue-router/dist/vue-router.min.js&#x27;</span>),<br>        <span class="hljs-attr">to</span>: <span class="hljs-string">&#x27;./lib/vue-router.min.js&#x27;</span>,<br>      &#125;,<br>      &#123; <span class="hljs-attr">from</span>: path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">&#x27;/node_modules/vuex/dist/vuex.min.js&#x27;</span>), <span class="hljs-attr">to</span>: <span class="hljs-string">&#x27;./lib/vuex.min.js&#x27;</span> &#125;,<br>      &#123; <span class="hljs-attr">from</span>: path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">&#x27;/node_modules/axios/dist/axios.min.js&#x27;</span>), <span class="hljs-attr">to</span>: <span class="hljs-string">&#x27;./lib/axios.min.js&#x27;</span> &#125;,<br>      &#123; <span class="hljs-attr">from</span>: path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">&#x27;/node_modules/tdesign-vue/dist/tdesign.min.js&#x27;</span>), <span class="hljs-attr">to</span>: <span class="hljs-string">&#x27;./lib/tdesign.min.js&#x27;</span> &#125;,<br>      &#123; <span class="hljs-attr">from</span>: path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">&#x27;/node_modules/tdesign-vue/dist/tdesign.min.css&#x27;</span>), <span class="hljs-attr">to</span>: <span class="hljs-string">&#x27;./lib/tdesign.min.css&#x27;</span> &#125;,<br>    ],<br>  &#125;),<br></code></pre></td></tr></table></figure><h4 id="2-主应用外链引入"><a href="#2-主应用外链引入" class="headerlink" title="2. 主应用外链引入"></a>2. 主应用外链引入</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;script ignore src=<span class="hljs-string">&quot;&lt;%= VUE_APP_CDN_PATH%&gt;/lib/vue.min.js&quot;</span>&gt;&lt;/script&gt;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">ignore</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;&lt;%= VUE_APP_CDN_PATH%&gt;/lib/vue-router.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">ignore</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;&lt;%= VUE_APP_CDN_PATH%&gt;/lib/vuex.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">ignore</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;&lt;%= VUE_APP_CDN_PATH%&gt;/lib/axios.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">ignore</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;&lt;%= VUE_APP_CDN_PATH%&gt;/lib/tdesign.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure><h4 id="3-main-js-加载子应用前注入依赖"><a href="#3-main-js-加载子应用前注入依赖" class="headerlink" title="3. main.js 加载子应用前注入依赖"></a>3. main.js 加载子应用前注入依赖</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> commonCssLibs = [<span class="hljs-string">&#x27;tdesign.min.css&#x27;</span>];<br><span class="hljs-keyword">const</span> commonJsLibs = [<span class="hljs-string">&#x27;vue.min.js&#x27;</span>, <span class="hljs-string">&#x27;vue-router.min.js&#x27;</span>, <span class="hljs-string">&#x27;vuex.min.js&#x27;</span>, <span class="hljs-string">&#x27;axios.min.js&#x27;</span>, <span class="hljs-string">&#x27;tdesign.min.js&#x27;</span>];<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">loadScript</span> = (<span class="hljs-params">url</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> script = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;script&#x27;</span>);<br>  script.<span class="hljs-property">type</span> = <span class="hljs-string">&#x27;text/javascript&#x27;</span>;<br>  script.<span class="hljs-property">src</span> = url;<br>  script.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&#x27;ignore&#x27;</span>, <span class="hljs-string">&#x27;true&#x27;</span>); <span class="hljs-comment">// 避免重复加载</span><br>  script.<span class="hljs-property">onerror</span> = <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`加载失败<span class="hljs-subst">$&#123;url&#125;</span>，请刷新重试`</span>);<br>  &#125;;<br>  <span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span>.<span class="hljs-title function_">appendChild</span>(script);<br>&#125;;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">loadLink</span> = (<span class="hljs-params">url</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> script = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;link&#x27;</span>);<br>  script.<span class="hljs-property">rel</span> = <span class="hljs-string">&#x27;stylesheet&#x27;</span>;<br>  script.<span class="hljs-property">type</span> = <span class="hljs-string">&#x27;text/css&#x27;</span>;<br>  script.<span class="hljs-property">href</span> = url;<br>  script.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&#x27;ignore&#x27;</span>, <span class="hljs-string">&#x27;true&#x27;</span>); <span class="hljs-comment">// 避免重复加载</span><br>  script.<span class="hljs-property">onerror</span> = <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`加载失败<span class="hljs-subst">$&#123;url&#125;</span>，请刷新重试`</span>);<br>  &#125;;<br>  <span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span>.<span class="hljs-title function_">appendChild</span>(script);<br>&#125;;<br><br><span class="hljs-comment">// 注册子应用，加载之前注入依赖</span><br><span class="hljs-title function_">registerMicroApps</span>(apps, &#123;<br>    <span class="hljs-attr">beforeLoad</span>: [<br>      <span class="hljs-function">(<span class="hljs-params">app</span>) =&gt;</span> &#123;<br>        commonJsLibs.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">libName</span>) =&gt;</span> &#123;<br>          <span class="hljs-keyword">const</span> libUrl = <span class="hljs-string">`<span class="hljs-subst">$&#123;VUE_APP_ROUTER_BASE&#125;</span>/lib/<span class="hljs-subst">$&#123;libName&#125;</span>`</span>;<br>          <span class="hljs-title function_">loadScript</span>(libUrl);<br>        &#125;);<br>        commonCssLibs.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">libName</span>) =&gt;</span> &#123;<br>          <span class="hljs-keyword">const</span> libUrl = <span class="hljs-string">`<span class="hljs-subst">$&#123;VUE_APP_ROUTER_BASE&#125;</span>/lib/<span class="hljs-subst">$&#123;libName&#125;</span>`</span>;<br>          <span class="hljs-title function_">loadLink</span>(libUrl);<br>        &#125;);<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;[LifeCycle] before load %c%s&#x27;</span>, <span class="hljs-string">&#x27;color: green;&#x27;</span>, app.<span class="hljs-property">name</span>);<br>      &#125;,<br>    ],<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="4-子应用打包忽略公共依赖"><a href="#4-子应用打包忽略公共依赖" class="headerlink" title="4. 子应用打包忽略公共依赖"></a>4. 子应用打包忽略公共依赖</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-attr">externals</span>: &#123;<br>  <span class="hljs-attr">vue</span>: <span class="hljs-string">&#x27;Vue&#x27;</span>,<br>  <span class="hljs-attr">vuex</span>: <span class="hljs-string">&#x27;Vuex&#x27;</span>,<br>  <span class="hljs-attr">axios</span>: <span class="hljs-string">&#x27;axios&#x27;</span>,<br>  <span class="hljs-string">&#x27;tdesign-vue&#x27;</span>: <span class="hljs-string">&#x27;TDesign&#x27;</span>,<br>  <span class="hljs-string">&#x27;vue-router&#x27;</span>: <span class="hljs-string">&#x27;VueRouter&#x27;</span>,<br>  <span class="hljs-comment">// vue: &#123;</span><br>  <span class="hljs-comment">//   commonjs: &#x27;vue&#x27;,</span><br>  <span class="hljs-comment">//   commonjs2: &#x27;vue&#x27;,</span><br>  <span class="hljs-comment">//   amd: &#x27;vue&#x27;,</span><br>  <span class="hljs-comment">//   root: &#x27;Vue&#x27;, // 外链cdn加载挂载到window上的变量名</span><br>  <span class="hljs-comment">// &#125;,</span><br></code></pre></td></tr></table></figure><h2 id="3-线上部署"><a href="#3-线上部署" class="headerlink" title="3. 线上部署"></a>3. 线上部署</h2>]]></content>
    
    
    <categories>
      
      <category>架构</category>
      
    </categories>
    
    
    <tags>
      
      <tag>前端工程化</tag>
      
      <tag>qiankun</tag>
      
      <tag>微前端</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-03-08-微前端qiankun部署</title>
    <link href="/2025/11/28/2022-03-14-%E3%80%90%E6%9E%B6%E6%9E%84%E3%80%91%E5%BE%AE%E5%89%8D%E7%AB%AFqiankun%E9%83%A8%E7%BD%B2/"/>
    <url>/2025/11/28/2022-03-14-%E3%80%90%E6%9E%B6%E6%9E%84%E3%80%91%E5%BE%AE%E5%89%8D%E7%AB%AFqiankun%E9%83%A8%E7%BD%B2/</url>
    
    <content type="html"><![CDATA[<blockquote></blockquote><span id="more"></span><h2 id="3-线上部署"><a href="#3-线上部署" class="headerlink" title="3. 线上部署"></a>3. 线上部署</h2><p>微前端部署，可多台机器部署，也可部署在同主机不同目录。</p><h3 id="一、单主机部署"><a href="#一、单主机部署" class="headerlink" title="一、单主机部署"></a>一、单主机部署</h3><ol><li>同端口部署，<code>nginx</code>核心配置</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs javascript">server &#123;<br>  listen       <span class="hljs-number">13000</span>;<br>  #server_name localhost;<br>  index index.<span class="hljs-property">html</span>;<br><br>  root /data/deployments/html-zyx/;<br><br>  error_page <span class="hljs-number">500</span> <span class="hljs-number">502</span> <span class="hljs-number">503</span> <span class="hljs-number">504</span> /50x.<span class="hljs-property">html</span>;<br><br>  add_header <span class="hljs-title class_">Cache</span>-<span class="hljs-title class_">Control</span> <span class="hljs-string">&#x27;no-cache, must-revalidate, proxy-revalidate, max-age=0&#x27;</span>;<br>  add_header X-<span class="hljs-variable constant_">XSS</span>-<span class="hljs-title class_">Protection</span> <span class="hljs-string">&quot;1; mode=block&quot;</span>; <br> <br>location ^~ /zyx &#123;<br>alias /data/deployments/html/zyx-web-admin;<br>index index.<span class="hljs-property">html</span> index.<span class="hljs-property">htm</span>;<br>try_files $uri $uri/ <span class="hljs-regexp">/zyx/i</span>ndex.<span class="hljs-property">html</span>;<br>&#125;<br><br>location ^~ <span class="hljs-regexp">/zyx/</span>sub/tag &#123;<br>alias /data/deployments/html/zyx-web-tag;<br>index index.<span class="hljs-property">html</span> index.<span class="hljs-property">htm</span>;<br>try_files $uri $uri/ <span class="hljs-regexp">/zyx/i</span>ndex.<span class="hljs-property">html</span>;<br>&#125;<br><br>location ^~ <span class="hljs-regexp">/zyx/</span>sub/zd &#123;<br>alias /data/deployments/html/zyx-web;<br>index index.<span class="hljs-property">html</span> index.<span class="hljs-property">htm</span>;<br>try_files $uri $uri/ <span class="hljs-regexp">/zyx/i</span>ndex.<span class="hljs-property">html</span>;<br>&#125;<br><br>location ^~ <span class="hljs-regexp">/zyx/</span>sub/gbmo &#123;<br>alias /data/deployments/html/gbmo-web;<br>index index.<span class="hljs-property">html</span> index.<span class="hljs-property">htm</span>;<br>try_files $uri $uri/ <span class="hljs-regexp">/zyx/i</span>ndex.<span class="hljs-property">html</span>;<br>&#125;<br><br>location ^~ <span class="hljs-regexp">/zyx/</span>api/ &#123;<br>proxy_pass <span class="hljs-attr">http</span>:<span class="hljs-comment">//IP地址:20000;</span><br>rewrite ^<span class="hljs-regexp">/zyx/</span>api/(.*)$ /zyx/api/$1 <span class="hljs-keyword">break</span>;<br>proxy_redirect off;<br>proxy_set_header <span class="hljs-title class_">Host</span> $host;<br>proxy_set_header X-<span class="hljs-title class_">Real</span>-<span class="hljs-variable constant_">IP</span> $remote_addr;<br>proxy_set_header X-<span class="hljs-title class_">Forwarded</span>-<span class="hljs-title class_">For</span> $proxy_add_x_forwarded_for;<br>proxy_cookie_path / <span class="hljs-string">&quot;/; httponly; secure; SameSite=Lax&quot;</span>;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="2"><li>单主机多端口部署</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs javascript">server &#123;<br>        listen       <span class="hljs-number">80</span> default_server;<br>        listen       [::]:<span class="hljs-number">80</span> default_server;<br>        server_name  _;<br><br>        location ^~ /zyx &#123;<br>            add_header <span class="hljs-title class_">Cache</span>-<span class="hljs-title class_">Control</span> <span class="hljs-string">&#x27;no-cache, must-revalidate, proxy-revalidate, max-age=0&#x27;</span>;<br>            root /usr/local/openresty/nginx/html/zyx-web-main;<br>            index index.<span class="hljs-property">html</span>;<br>            try_files $uri $uri/ /index.<span class="hljs-property">html</span>;<br>        &#125;<br>    &#125;<br><br>    server &#123;<br>        listen       <span class="hljs-number">9011</span> default_server;<br>    listen       [::]:<span class="hljs-number">9011</span> default_server;<br>        server_name  _;<br><br>        location ^~ <span class="hljs-regexp">/zyx/</span>sub/enterprise &#123;<br>            add_header <span class="hljs-title class_">Cache</span>-<span class="hljs-title class_">Control</span> <span class="hljs-string">&#x27;no-cache, must-revalidate, proxy-revalidate, max-age=0&#x27;</span>;<br>            root /usr/local/openresty/nginx/html/zyx-web-government-enterprise-through/;<br>            index index.<span class="hljs-property">html</span>;<br>            try_files $uri $uri/ /index.<span class="hljs-property">html</span>;<br>        &#125;<br>    &#125;<br>    server &#123;<br>        listen       <span class="hljs-number">9012</span> default_server;<br>    listen       [::]:<span class="hljs-number">9012</span> default_server;<br>        server_name  _;<br><br>        location ^~ <span class="hljs-regexp">/zyx/</span>sub/portal &#123;<br>            add_header <span class="hljs-title class_">Cache</span>-<span class="hljs-title class_">Control</span> <span class="hljs-string">&#x27;no-cache, must-revalidate, proxy-revalidate, max-age=0&#x27;</span>;<br>            root /usr/local/openresty/nginx/html/zyx-web-portal/;<br>            index index.<span class="hljs-property">html</span>;<br>            try_files $uri $uri/ /index.<span class="hljs-property">html</span>;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><h3 id="二、多台主机部署"><a href="#二、多台主机部署" class="headerlink" title="二、多台主机部署"></a>二、多台主机部署</h3><ol><li>主应用nginx配置</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs javascript">server &#123;<br>    listen       <span class="hljs-number">80</span> default_server;<br>    listen       [::]:<span class="hljs-number">80</span> default_server;<br>    server_name  _;<br>    location ^~ /zyx &#123;<br>        add_header <span class="hljs-title class_">Cache</span>-<span class="hljs-title class_">Control</span> <span class="hljs-string">&#x27;no-cache, must-revalidate, proxy-revalidate, max-age=0&#x27;</span>;<br>        alias /usr/local/openresty/nginx/html;<br>        index index.<span class="hljs-property">html</span>;<br>        try_files $uri $uri/ /index.<span class="hljs-property">html</span>;<br><br>        <span class="hljs-keyword">if</span> ($request_filename ~* .*.(html|htm)$)<br>        &#123;<br>            expires -1s;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> ($request_filename ~* .*.(gif|jpg|jpeg|png|svg)$)<br>        &#123;<br>            expires 30d;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> ($request_filename ~ .*.(js|css)$)<br>        &#123;       <br>            expires 12h;<br>        &#125;<br>    &#125;<br>    # 访问子应用时，直接跳转相应主机ip，这里直接访问tsf上子应用部署组<br>    location /zyx/sub/portal &#123;<br>      proxy_pass <span class="hljs-attr">http</span>:<span class="hljs-comment">//exp-zyx-web-portal;</span><br>    &#125;<br>    location /zyx/sub/enterprise &#123;<br>      proxy_pass <span class="hljs-attr">http</span>:<span class="hljs-comment">//exp-zyx-web-government-enterprise-through;</span><br>    &#125;<br>    location /zyx/sub/tag &#123;<br>      proxy_pass <span class="hljs-attr">http</span>:<span class="hljs-comment">//exp-zyx-web-tag;</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>架构</category>
      
    </categories>
    
    
    <tags>
      
      <tag>前端工程化</tag>
      
      <tag>nginx</tag>
      
      <tag>qiankun</tag>
      
      <tag>微前端</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-03-08-docker部署</title>
    <link href="/2025/11/28/2022-03-15-%E3%80%90%E9%83%A8%E7%BD%B2%E3%80%91docker%E5%9F%BA%E7%A1%80%E9%95%9C%E5%83%8F/"/>
    <url>/2025/11/28/2022-03-15-%E3%80%90%E9%83%A8%E7%BD%B2%E3%80%91docker%E5%9F%BA%E7%A1%80%E9%95%9C%E5%83%8F/</url>
    
    <content type="html"><![CDATA[<blockquote></blockquote><span id="more"></span><h2 id="镜像制作"><a href="#镜像制作" class="headerlink" title="镜像制作"></a>镜像制作</h2><h3 id="1-Dockerfile-编写"><a href="#1-Dockerfile-编写" class="headerlink" title="1. Dockerfile 编写"></a>1. Dockerfile 编写</h3><h4 id="1-1-openresty-1-15-8-2-镜像制作"><a href="#1-1-openresty-1-15-8-2-镜像制作" class="headerlink" title="1.1 openresty 1.15.8.2 镜像制作"></a>1.1 openresty 1.15.8.2 镜像制作</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> centos:<span class="hljs-number">7.6</span>.<span class="hljs-number">1810</span><br><br><span class="hljs-keyword">MAINTAINER</span> openresty1.<span class="hljs-number">15.8</span>.<span class="hljs-number">2</span> &lt;<span class="hljs-number">827516789</span>@qq.com&gt;<br> <br><span class="hljs-keyword">RUN</span><span class="language-bash">   yum install -y yum-utils &amp;&amp; yum-config-manager --add-repo https://openresty.org/package/centos/openresty.repo &amp;&amp; yum clean  all &amp;&amp;  yum install -y openresty  </span><br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> useradd appuser &amp;&amp;  <span class="hljs-built_in">mkdir</span> -p /mnt/data/logs/nginx/ &amp;&amp; <span class="hljs-built_in">mkdir</span> -p /home/appuser/openresty/nginx/logs/ &amp;&amp;  <span class="hljs-built_in">mkdir</span> -p /home/appuser/www-prod/</span><br><span class="hljs-keyword">ADD</span><span class="language-bash"> ./www-prod/ /home/appuser/www-prod/</span><br><span class="hljs-keyword">ADD</span><span class="language-bash"> ./html /usr/local/openresty/nginx/html/</span><br><span class="hljs-keyword">ADD</span><span class="language-bash"> ./conf/ /usr/local/openresty/nginx/conf/</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">chown</span> -R appuser.appuser /usr/local/openresty/ &amp;&amp; <span class="hljs-built_in">chown</span> -R appuser.appuser /home/appuser/</span><br><span class="hljs-comment">#RUN yum -y install epel-release  &amp;&amp; yum install -y yum-utils &amp;&amp; yum-config-manager --add-repo https://openresty.org/package/centos/openresty.repo &amp;&amp; yum install -y openresty &amp;&amp; yum clean all &amp;&amp; chmod +x start.sh &amp;&amp; chmod +x auto-reload.sh</span><br><span class="hljs-comment">#ADD nginx.conf /usr/local/openresty/nginx/conf/nginx.conf</span><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">8004</span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> /usr/local/openresty/nginx/sbin/nginx -g <span class="hljs-string">&#x27;daemon off;&#x27;</span> -c   /usr/local/openresty/nginx/conf/nginx.conf</span><br></code></pre></td></tr></table></figure><h3 id="nginx-1-23-2-镜像"><a href="#nginx-1-23-2-镜像" class="headerlink" title="nginx 1.23.2 镜像"></a>nginx 1.23.2 镜像</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment"># 发布空间：ccr.ccs.tencentyun.com/goff/arm-nginx:latest</span><br><span class="hljs-comment"># 使用 arm64v8/ubuntu:20.04 作为基础镜像</span><br><span class="hljs-comment"># 占用空间：127 MB</span><br><span class="hljs-comment"># 使用bash替换ubuntu的dash</span><br><span class="hljs-comment"># 设置nginx默认使用前台运行 daemon off;</span><br><span class="hljs-keyword">FROM</span> dockerhub.woa.com/arm64v8/ubuntu:<span class="hljs-number">20.04</span><br><span class="hljs-comment"># 安装 腾讯云文件配置 挂载服务</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y tzdata &amp;&amp; <span class="hljs-built_in">ln</span> -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Asia/Shanghai&quot;</span> &gt; /etc/timezone \</span><br><span class="language-bash">&amp;&amp; apt-get install -y wget net-tools telnet inetutils-ping tcpdump tar procps vim zip unzip cron curl apt-utils \</span><br><span class="language-bash">&amp;&amp; wget -P /root/ https://tsf-doc-attachment-1300555551.cos.ap-guangzhou.myqcloud.com/%E5%85%AC%E6%9C%89%E4%BA%91/%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE/tsf-consul-template-docker.zip \</span><br><span class="language-bash">&amp;&amp; unzip /root/tsf-consul-template-docker.zip -d /root \</span><br><span class="language-bash">&amp;&amp; tar -zxf  /root/tsf-consul-template-docker.arm.tar.gz -C /root/ \</span><br><span class="language-bash">&amp;&amp; <span class="hljs-built_in">mv</span> /root/consul-template /root/tsf-consul-template-docker \</span><br><span class="language-bash">&amp;&amp; <span class="hljs-built_in">rm</span> -rf /root/tsf-consul-template-docker.tar.gz \</span><br><span class="language-bash">&amp;&amp; <span class="hljs-built_in">mkdir</span> -p /data/tsf_std/stdout/logs \</span><br><span class="language-bash"><span class="hljs-comment"># 安装nodejs  单纯静态资源部署 不需要此步骤</span></span><br><span class="hljs-comment"># &amp;&amp; apt install -y gnupg2 ca-certificates lsb-release \</span><br><span class="hljs-comment"># &amp;&amp; mkdir -p /data/nodejs &amp;&amp; cd /data/nodejs \</span><br><span class="hljs-comment"># &amp;&amp; wget -c https://nodejs.org/download/release/v12.22.10/node-v12.22.10-linux-arm64.tar.gz &amp;&amp; tar -xf node-v12.22.10-linux-arm64.tar.gz \</span><br><span class="hljs-comment"># &amp;&amp; ln -s /data/nodejs/node-v12.22.10-linux-arm64/bin/node /usr/local/bin/node &amp;&amp; ln -s /data/nodejs/node-v12.22.10-linux-arm64/bin/npm /usr/local/bin/npm \</span><br><span class="hljs-comment"># &amp;&amp; npm install -g yarn --registry=https://mirrors.tencent.com/npm/ \</span><br><span class="hljs-comment"># 安装nginx</span><br>&amp;&amp; apt install  -y curl gnupg2 ca-certificates lsb-release ubuntu-keyring  \<br>&amp;&amp; curl https://nginx.org/keys/nginx_signing.key | gpg --dearmor | tee /usr/share/keyrings/nginx-archive-keyring.gpg &gt;/dev/null \<br>&amp;&amp; echo <span class="hljs-string">&quot;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] http://nginx.org/packages/mainline/ubuntu `lsb_release -cs` nginx&quot;</span> | tee /etc/apt/sources.list.d/nginx.list \<br>&amp;&amp; apt update &amp;&amp; apt-cache madison nginx &amp;&amp; apt install -y nginx=<span class="hljs-number">1.23</span>.<span class="hljs-number">2</span>-<span class="hljs-number">1</span>~focal &amp;&amp; mkdir -p /etc/nginx/logs/ \<br>&amp;&amp; ln -b -s  /bin/bash  /bin/sh  \<br>&amp;&amp; sed -i <span class="hljs-string">&#x27;/worker_processes/adaemon off;&#x27;</span> /etc/nginx/nginx.conf<br><br><span class="hljs-keyword">ADD</span><span class="language-bash"> mime.types /etc/nginx/</span><br><span class="hljs-keyword">ADD</span><span class="language-bash"> mime.types /etc/nginx/conf.d/</span><br></code></pre></td></tr></table></figure><h3 id="2-构建镜像"><a href="#2-构建镜像" class="headerlink" title="2. 构建镜像"></a>2. 构建镜像</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">docker build -t <span class="hljs-attr">openresty</span>:<span class="hljs-number">1.15</span><span class="hljs-number">.8</span><span class="hljs-number">.2</span> -f ./<span class="hljs-title class_">Dockerfile</span> .<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>部署</category>
      
    </categories>
    
    
    <tags>
      
      <tag>前端工程化</tag>
      
      <tag>nginx</tag>
      
      <tag>docker</tag>
      
      <tag>openresty</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-03-08-docker基础</title>
    <link href="/2025/11/28/2022-03-18-%E3%80%90%E9%83%A8%E7%BD%B2%E3%80%91docker%E5%9F%BA%E7%A1%80/"/>
    <url>/2025/11/28/2022-03-18-%E3%80%90%E9%83%A8%E7%BD%B2%E3%80%91docker%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<h2 id="1-基本概念"><a href="#1-基本概念" class="headerlink" title="1. 基本概念"></a>1. 基本概念</h2><h4 id="1-1-linux-安装-docker"><a href="#1-1-linux-安装-docker" class="headerlink" title="1.1 linux 安装 docker"></a>1.1 linux 安装 docker</h4><ol><li>自动安装 docker</li></ol><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">curl -fsSL <span class="hljs-keyword">https</span>://<span class="hljs-built_in">get</span>.docker.com | bash -s docker <span class="hljs-comment">--mirror Aliyun</span><br></code></pre></td></tr></table></figure><h2 id="2-dockerfile"><a href="#2-dockerfile" class="headerlink" title="2. dockerfile"></a>2. dockerfile</h2><h3 id="2-1-单文件构建"><a href="#2-1-单文件构建" class="headerlink" title="2.1 单文件构建"></a>2.1 单文件构建</h3><p>在多阶构建出来之前使用单个文件进行构建，单文件就是将所有的构建过程（包括项目的依赖、编译、测试、打包过程）全部包含在一个 Dockerfile 中之下</p><h3 id="2-2-多文件构建"><a href="#2-2-多文件构建" class="headerlink" title="2.2 多文件构建"></a>2.2 多文件构建</h3><ul><li>Dockerfile.run 就是运行时程序所必须需要的一些组件的 Dockerfile，它包含了最精简的库；</li><li>Dockerfile.build 只是用来构建，构建完就没用了；</li><li>build.sh 的功能就是将 Dockerfile.run 和 Dockerfile.build 进行组成，把 Dockerfile.build 构建好的东西拿出来，然后再执行 Dockerfile.run，算是一个调度的角色。</li></ul><h3 id="2-3-多阶构建"><a href="#2-3-多阶构建" class="headerlink" title="2.3 多阶构建"></a>2.3 多阶构建</h3><p>完成多阶段构建我们只需要在 Dockerfile 中多次使用 FORM 声明，每次 FROM 指令可以使用不同的基础镜像，并且每次 FROM 指令都会开始新的构建，我们可以选择将一个阶段的构建结果复制到另一个阶段，在最终的镜像中只会留下最后一次构建的结果，这样就可以很容易地解决前面提到的问题，并且只需要编写一个 Dockerfile 文件。</p><p>&#x2F;&#x2F; 守护进程，容器内进程关闭则容器销毁。</p><p>CMD nginx -g ‘daemon off;’</p><h3 id="2-4-dockerfile-编写"><a href="#2-4-dockerfile-编写" class="headerlink" title="2.4 dockerfile 编写"></a>2.4 dockerfile 编写</h3><h5 id="Dockerfile-中-ADD-和-COPY"><a href="#Dockerfile-中-ADD-和-COPY" class="headerlink" title="Dockerfile 中 ADD 和 COPY"></a>Dockerfile 中 ADD 和 COPY</h5><p>打包 + nginx 部署</p><ul><li>生成 dockerfile</li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> node:<span class="hljs-number">10</span>-alpine<br><br><span class="hljs-keyword">ENV</span> PROJECT_ENV production<br><span class="hljs-keyword">ENV</span> NODE_ENV production<br><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /code</span><br><br><span class="hljs-comment"># 首次添加此两个文件，充分利用缓存</span><br><span class="hljs-keyword">ADD</span><span class="language-bash"> package.json package-lock.json /code</span><br><span class="hljs-keyword">ADD</span><span class="language-bash"> . /code</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> npm install &amp;&amp; npm run build &amp;&amp; npm install -g http-server</span><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">80</span><br><br><span class="hljs-keyword">CMD</span><span class="language-bash"> http-server ./public -p 80</span><br>//ps: 每一个指令的前缀都必须是大写的。<br></code></pre></td></tr></table></figure><ul><li>打镜像 docker build</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js">docker build -t zyx-nginx .<br><span class="hljs-comment">// 如果需要使用非根目录下 dockerfile 的目录和名字 可以加 -f参数</span><br>docker build -t zyx-nginx . -f ./devops/dockerfile.<span class="hljs-property">nginx</span><br><br>docker build [<span class="hljs-variable constant_">OPTIONS</span>] <span class="hljs-variable constant_">PATH</span> | <span class="hljs-variable constant_">URL</span> | -<br><br>docker build -t <span class="hljs-attr">openresty</span>:<span class="hljs-number">1.15</span><span class="hljs-number">.8</span><span class="hljs-number">.2</span> -f ./<span class="hljs-title class_">Dockerfile</span> .<br><br>docker build -t zyx-nginx . -f ./devops/dockerfile<br><br></code></pre></td></tr></table></figure><ul><li>运行容器</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">docker run --name zyx-nginx-ct -d -p <span class="hljs-number">8080</span>:<span class="hljs-number">80</span> zyx-nginx<br></code></pre></td></tr></table></figure><ul><li>ADD 和 COPY： 将文件或目录复制到 Dockerfile 构建的镜像中</li><li>EXPOSE： 指定运行该镜像的容器使用的端口，可以是多个。</li><li>RUN ： 指令告诉 docker 在镜像内执行命令</li><li>FROM ：通过 FROM 指定的镜像名称，这个镜像称之为基础镜像，必须位于第一条非注释指令</li><li>WORKDIR： 在容器内部设置工作目录</li></ul><h2 id="3-docker-常用指令"><a href="#3-docker-常用指令" class="headerlink" title="3. docker 常用指令"></a>3. docker 常用指令</h2><p>列出所有容器 ID</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">docker ps -aq</span><br></code></pre></td></tr></table></figure><p>查看所有运行或者不运行容器</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">docker ps -<span class="hljs-selector-tag">a</span><br></code></pre></td></tr></table></figure><p>停止所有的 container（容器），这样才能够删除其中的 images：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">docker stop <span class="hljs-variable">$</span>(docker <span class="hljs-built_in">ps</span> <span class="hljs-literal">-a</span> <span class="hljs-literal">-q</span>) 或者 docker stop <span class="hljs-variable">$</span>(docker <span class="hljs-built_in">ps</span> <span class="hljs-literal">-aq</span>)<br></code></pre></td></tr></table></figure><p>如果想要删除所有 container（容器）的话再加一个指令：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">docker <span class="hljs-built_in">rm</span> <span class="hljs-variable">$</span>(docker <span class="hljs-built_in">ps</span> <span class="hljs-literal">-a</span> <span class="hljs-literal">-q</span>) 或者 docker <span class="hljs-built_in">rm</span> <span class="hljs-variable">$</span>(docker <span class="hljs-built_in">ps</span> <span class="hljs-literal">-aq</span>)<br></code></pre></td></tr></table></figure><p>查看当前有些什么 images</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">docker images</span><br></code></pre></td></tr></table></figure><p>删除 images（镜像），通过 image 的 id 来指定删除谁，重复时 加上 tag</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">docker rmi &lt;image <span class="hljs-built_in">id</span>&gt;<br></code></pre></td></tr></table></figure><p>想要删除 untagged images，也就是那些 id 为的 image 的话可以用</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coq">docker rmi $(docker images | <span class="hljs-type">grep</span> <span class="hljs-string">&quot;^&lt;none&gt;&quot;</span> | <span class="hljs-type">awk</span> <span class="hljs-string">&quot;&#123;print $3&#125;&quot;</span>)<br></code></pre></td></tr></table></figure><p>要删除全部 image（镜像）的话</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">docker rmi $(docker images -q)<br></code></pre></td></tr></table></figure><p>强制删除全部 image 的话</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">docker rmi <span class="hljs-operator">-f</span> <span class="hljs-variable">$</span>(docker images <span class="hljs-literal">-q</span>)<br></code></pre></td></tr></table></figure><p>从容器到宿主机复制</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">cp</span> tomcat:/webapps/js/text.js /home/admin<br>docker  <span class="hljs-built_in">cp</span> 容器名:  容器路径       宿主机路径<br></code></pre></td></tr></table></figure><p>从宿主机到容器复制</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">cp</span> /home/admin/text.js tomcat:/webapps/js<br>docker <span class="hljs-built_in">cp</span> 宿主路径中文件      容器名  容器路径<br></code></pre></td></tr></table></figure><p>删除所有停止的容器</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs axapta">docker <span class="hljs-built_in">container</span> prune<br></code></pre></td></tr></table></figure><p>删除所有不使用的镜像</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">docker <span class="hljs-selector-tag">image</span> prune <span class="hljs-attr">--force</span> <span class="hljs-attr">--all</span><br>或者docker <span class="hljs-selector-tag">image</span> prune -f -<span class="hljs-selector-tag">a</span><br></code></pre></td></tr></table></figure><p>停止、启动、杀死、重启一个容器</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">docker stop <span class="hljs-type">Name</span>或者ID<br>docker <span class="hljs-keyword">start</span> <span class="hljs-type">Name</span>或者ID<br>docker kill <span class="hljs-type">Name</span>或者ID<br>docker <span class="hljs-keyword">restart</span> <span class="hljs-type">name</span>或者ID<br></code></pre></td></tr></table></figure><p>docker 进入容器，查看配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">exec</span> ：在运行的容器中执行命令<br>        -d :分离模式: 在后台运行<br>        -i :即使没有附加也保持STDIN（标准输入） 打开,以交互模式运行容器，通常与 -t 同时使用；<br>        -t: 为容器重新分配一个伪输入终端，通常与 -i 同时使用；<br>docker <span class="hljs-built_in">exec</span> -it  f94d2c317477 /bin/bash<br></code></pre></td></tr></table></figure><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs elm"><span class="hljs-title">export</span> 和 <span class="hljs-keyword">import</span> 导出的是一个容器的快照, 不是镜像本身, 也就是说没有 layer。<br><br>你的 dockerfile 里的 workdir, entrypoint 之类的所有东西都会丢失，commit 过的话也会丢失。<br><br>快照文件将丢弃所有的历史记录和元数据信息（即仅保存容器当时的快照状态），而镜像存储文件将保存完整记录，体积也更大。<br><br> docker save 保存的是镜像（image），docker ex<span class="hljs-keyword">port</span> 保存的是容器（container）；<br> docker load 用来载入镜像包，docker <span class="hljs-keyword">import</span> 用来载入容器包，但两者都会恢复为镜像；<br> docker load 不能对载入的镜像重命名，而 docker <span class="hljs-keyword">import</span> 可以为镜像指定新名称。<br></code></pre></td></tr></table></figure><h2 id="4-企业级镜像仓库"><a href="#4-企业级镜像仓库" class="headerlink" title="4. 企业级镜像仓库"></a>4. 企业级镜像仓库</h2><p>Harbor 镜像仓库 搭建</p><p>Harbor 基本使用</p><h2 id="5-docker-上传镜像"><a href="#5-docker-上传镜像" class="headerlink" title="5. docker 上传镜像"></a>5. docker 上传镜像</h2><p>docker commit 容器 id blowsysun&#x2F;nginx_vue</p><p>docker push blowsysun&#x2F;nginx_vue</p><p>docker inspect</p><h2 id="mysql-安装"><a href="#mysql-安装" class="headerlink" title="mysql 安装"></a>mysql 安装</h2><p><a href="https://blog.csdn.net/Ber_Bai/article/details/116572207">mysql 安装参考文档</a></p><h3 id="最新版本"><a href="#最新版本" class="headerlink" title="最新版本"></a>最新版本</h3><p>docker pull mysql</p><h3 id="5-7-版本-本文基于-5-7-版本"><a href="#5-7-版本-本文基于-5-7-版本" class="headerlink" title="5.7 版本 本文基于 5.7 版本"></a>5.7 版本 本文基于 5.7 版本</h3><p>docker pull mysql:5.7</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> run -d <span class="hljs-punctuation">\</span><br><span class="hljs-punctuation"></span>-p <span class="hljs-number">3306</span>:<span class="hljs-number">3306</span> <span class="hljs-punctuation">\</span><br><span class="hljs-punctuation"></span>--name mysql <span class="hljs-punctuation">\</span><br><span class="hljs-punctuation"></span>-e MYSQL_ROOT_PASSWORD=jueduianquan996  <span class="hljs-punctuation">\</span><br><span class="hljs-punctuation"></span>mysql:<span class="hljs-number">5</span>.<span class="hljs-number">7</span><br><br><span class="hljs-attribute">docker</span> exec -it mysql bash<br><br><span class="hljs-attribute">mysql</span> -uroot -p<br><span class="hljs-comment"># Enter password:</span><br><br><span class="hljs-comment"># mysql&gt; show variables like &#x27;%datadir%&#x27;;</span><br><span class="hljs-attribute">show</span> variables like &#x27;%datadir%&#x27;;<br></code></pre></td></tr></table></figure><h3 id="拷贝容器配置文件"><a href="#拷贝容器配置文件" class="headerlink" title="拷贝容器配置文件"></a>拷贝容器配置文件</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker cp mysql:<span class="hljs-regexp">/etc/my</span>sql <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/mysql/</span>conf<br></code></pre></td></tr></table></figure><p>mysql 容器的配置文件存在 &#x2F;etc&#x2F;mysql 下</p><h3 id="映射-数据-文件吗"><a href="#映射-数据-文件吗" class="headerlink" title="映射 数据 文件吗"></a>映射 数据 文件吗</h3><ul><li>&#x2F;etc&#x2F;mysql 为配置文件路径</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> stop mysql<br><span class="hljs-attribute">docker</span> rm mysql<br><br><span class="hljs-attribute">docker</span> run -d <span class="hljs-punctuation">\</span><br><span class="hljs-punctuation"></span>-p <span class="hljs-number">3306</span>:<span class="hljs-number">3306</span> <span class="hljs-punctuation">\</span><br><span class="hljs-punctuation"></span>--name mysql <span class="hljs-punctuation">\</span><br><span class="hljs-punctuation"></span>-v /usr/local/mysql/conf/mysql:/etc/mysql <span class="hljs-punctuation">\</span><br><span class="hljs-punctuation"></span>-v /usr/local/mysql/data:/var/lib/mysql/ <span class="hljs-punctuation">\</span><br><span class="hljs-punctuation"></span>-e MYSQL_ROOT_PASSWORD=jueduianquan996 <span class="hljs-punctuation">\</span><br><span class="hljs-punctuation"></span>--restart always  <span class="hljs-punctuation">\</span><br><span class="hljs-punctuation"></span>mysql:<span class="hljs-number">5</span>.<span class="hljs-number">7</span><br></code></pre></td></tr></table></figure><h3 id="修改-mysql-密码"><a href="#修改-mysql-密码" class="headerlink" title="修改 mysql 密码"></a>修改 mysql 密码</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">set</span> <span class="hljs-keyword">password</span> <span class="hljs-keyword">for</span> 用户名@localhost = <span class="hljs-keyword">password</span>(‘新密码’);<br></code></pre></td></tr></table></figure><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><ol><li>navicat 无法远程连接 mysql，</li></ol><ul><li>开启 MySQL 远程访问权限 允许远程连接</li><li>轻量服务器开通 3306 端口访问</li></ul><ol start="2"><li></li></ol><h3 id="查看-容器映射地址"><a href="#查看-容器映射地址" class="headerlink" title="查看 容器映射地址"></a>查看 容器映射地址</h3><p>&#x2F;&#x2F; 找到运行中的容器 id<br>docker ps<br>docker inspect 容器 Id</p><p>找到 HostConfig 字段</p><h2 id="轻量服务器安装"><a href="#轻量服务器安装" class="headerlink" title="轻量服务器安装"></a>轻量服务器安装</h2><p>unbuntu</p><ol><li><p>安装 git</p></li><li><p>安装 docker</p></li><li><p>安装 nvm</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.2/install.sh | bash<br><span class="hljs-built_in">source</span> ~/.bashrc<br></code></pre></td></tr></table></figure><ol start="4"><li>安装 nodejs</li></ol><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nvm</span> install v16.<span class="hljs-number">18</span>.<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><ol start="5"><li>安装 pm2</li></ol><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">npm <span class="hljs-keyword">install</span> pm2 -g<br></code></pre></td></tr></table></figure><ol start="6"><li>运行 nest</li><li>常规指令</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">pm2 start /workspace/git/pay-back/packages/server/dist/main.js -i 2 --name=payBack --watch<br>pm2 start /workspace/git/pay-back/packages/server/dist/main.js --name=payBack --watch<br>pm2 start /workspace/git/pay-back/packages/push-server/dist/main.js --name=pushServer --watch<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">指定环境变量，要更新环境变量或 PM2 选项，请指定--update-envCLI</span><br>NODE_ENV=prod pm2 start /workspace/git/pay-back/packages/push-server/dist/main.js --name=pushServer --watch --update-env<br></code></pre></td></tr></table></figure><ol><li>区分生产的 pm2 指令</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">pm2 start /workspace/git/pay-back/packages/server/ecosystem.config.js --env prod --watch<br>pm2 start /workspace/git/pay-back/packages/push-server/ecosystem.config.js --env prod --watch<br></code></pre></td></tr></table></figure><ol><li><p>修改 ubuntu<br>sudo chmod -R 777 +文件名</p></li><li><p>docker 权限</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chmod</span> 666 /var/run/docker.sock<br></code></pre></td></tr></table></figure><ol start="9"><li><p>ubuntu 启用 root 账户<br><a href="https://blog.csdn.net/thebestleo/article/details/123451471">https://blog.csdn.net/thebestleo/article/details/123451471</a></p></li><li><p>安装 firefox</p></li></ol><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">npx playwright <span class="hljs-keyword">install</span> firefox<br></code></pre></td></tr></table></figure><ol start="11"><li>vue3 添加 lodash</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 引入包</span><br>pnpm install lodash-es @<span class="hljs-built_in">type</span>/lodash-es<br><br><span class="hljs-comment"># vite.config 添加配置，未配置将导致504问题</span><br>optimizeDeps: &#123;<br>    include: [<span class="hljs-string">&#x27;lodash&#x27;</span>]<br>&#125;<br></code></pre></td></tr></table></figure><ol start="12"><li>echart 使用技巧</li></ol><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-meta"># 设置内容区域位置</span><br><span class="hljs-symbol">grid:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-symbol">  right:</span> <span class="hljs-number">60</span>,<br>  <span class="hljs-comment">// top: &#x27;30%&#x27;,</span><br><span class="hljs-symbol">  x2:</span> <span class="hljs-number">20</span>,<br><span class="hljs-symbol">  y2:</span> <span class="hljs-number">30</span>,<br><span class="hljs-symbol">  x:</span> <span class="hljs-number">50</span>,<br><span class="hljs-symbol">  y:</span> <span class="hljs-number">80</span>,<br><span class="hljs-punctuation">&#125;;</span><br></code></pre></td></tr></table></figure><table><thead><tr><th>序号</th><th>类别</th><th>成人</th><th>儿童</th><th>备注</th></tr></thead><tbody><tr><td>1</td><td>证件与票务</td><td>身份证、驾照、学生证&#x2F;军官证、现金+储蓄卡</td><td>户口本或出生证明</td><td>登机、酒店、自驾、无信号地区</td></tr><tr><td>2</td><td>衣物</td><td>速干短袖3、轻薄长裤2、冲锋衣&#x2F;薄羽绒1、运动鞋1、徒步鞋1、亮色长裙&#x2F;衬衫1</td><td>速干短袖3、长裤2、抓绒外套1、羽绒马甲1、运动鞋1、溯溪凉鞋1、备用袜子5</td><td>昼夜温差10 ℃左右</td></tr><tr><td>3</td><td>防晒&amp;防护</td><td>SPF50+防晒霜50 ml×2、遮阳帽、墨镜、防沙面巾、驱蚊液</td><td>儿童防晒霜30 ml、遮阳帽、儿童墨镜、驱蚊贴</td><td>草原紫外线强、风沙大</td></tr><tr><td>4</td><td>药品&amp;急救</td><td>布洛芬、蒙脱石散、创可贴、氯雷他定、晕车药</td><td>小儿布洛芬、口服补液盐、益生菌</td><td>感冒、肠胃、过敏、长途车</td></tr><tr><td>5</td><td>电子设备</td><td>手机、20000 mAh充电宝×2、相机、无人机、插线板</td><td>—</td><td>草原插座稀缺</td></tr><tr><td>6</td><td>日用&amp;个护</td><td>洗漱包、湿巾2包、润肤露、雨衣3件、头灯</td><td>儿童保温水壶500 ml、小毛毯</td><td>蒙古包旱厕、夜拍星空</td></tr><tr><td>7</td><td>孩子专属</td><td>—</td><td>折叠推车、零食补给、画笔贴纸</td><td>车程防无聊、推车省体力</td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>部署</category>
      
    </categories>
    
    
    <tags>
      
      <tag>前端工程化</tag>
      
      <tag>nginx</tag>
      
      <tag>docker</tag>
      
      <tag>openresty</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-10-10-部署 - jenkinsfile</title>
    <link href="/2025/11/28/2022-04-10-%E3%80%90%E9%83%A8%E7%BD%B2%E3%80%91jenkinsfile/"/>
    <url>/2025/11/28/2022-04-10-%E3%80%90%E9%83%A8%E7%BD%B2%E3%80%91jenkinsfile/</url>
    
    <content type="html"><![CDATA[<p><strong>这里对语法进行简单介绍</strong></p><p><strong>Example</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript">stages<br>pipeline &#123;<br>   agent any<br>   stages &#123;<br>       <span class="hljs-title function_">stage</span>(<span class="hljs-params"><span class="hljs-string">&#x27;Example&#x27;</span></span>) &#123;<br>           steps &#123;<br>               echo <span class="hljs-string">&#x27;Hello World&#x27;</span><br>           &#125;<br>       &#125;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>agent</strong></p><p>在任何可用的agent 上执行Pipeline或stage。例如：agent any</p><p>还有其他的agent后面可跟的参数，例如：none，label，node，docker</p><p><strong>none</strong></p><p>当在pipeline块的顶层使用none时，将不会为整个Pipeline运行分配全局agent ，每个stage部分将需要包含其自己的agent部分。</p><p><strong>label</strong></p><p>使用提供的label标签，在Jenkins环境中可用的代理上执行Pipeline或stage。例如：agent { label ‘my-defined-label’ }</p><p><strong>node</strong></p><p>agent { node { label ‘labelName’ } }，等同于 agent { label ‘labelName’ }，但node允许其他选项（如customWorkspace）。</p><p><strong>docker</strong></p><p>定义此参数时，执行Pipeline或stage时会动态供应一个docker节点去接受Docker-based的Pipelines。docker还可以接受一个args，直接传递给docker run调用。例如：agent { docker ‘maven:3-alpine’ }</p><p><strong>stages</strong></p><p>包含一个或多个stage的序列，Pipeline的大部分工作在此执行。建议stages至少包含至少一个stage指令，用于连接各个交付过程，如构建，测试和部署等。</p><p><strong>steps</strong></p><p>steps包含一个或多个在stage块中执行的step序列。</p><p><strong>总结：</strong></p><p>1、Pipeline最基本的部分是“step”。基本上，step告诉Jenkins 要做什么，并且作为Declarative Pipeline和Scripted Pipeline语法的基本构建块。 </p><p>2、Pipeline支持两种语法：Declarative Pipeline（在Pipeline 2.5中引入，结构化方式）和Scripted Pipeline，两者都支持建立连续输送的Pipeline。</p><p>3、所有有效的Declarative Pipeline必须包含在一个pipeline块内，例如：</p><p>pipeline { &#x2F;* insert Declarative Pipeline here *&#x2F; }</p><p>4、Declarative Pipeline中的基本语句和表达式遵循与Groovy语法相同的规则 ，但有以下例外：</p><p>​    a.Pipeline的顶层必须是块，具体来说是：pipeline { }</p><p>​    b.没有分号作为语句分隔符。每个声明必须在自己的一行</p><p>​    c.块只能包含Sections, Directives, Steps或赋值语句。</p><p><a href="https://www.redhat.com/zh/topics/devops/what-is-ci-cd">CICD是什么</a></p><h2 id="CI-是什么？CI-和-CD-有什么区别？"><a href="#CI-是什么？CI-和-CD-有什么区别？" class="headerlink" title="CI 是什么？CI 和 CD 有什么区别？"></a>CI 是什么？CI 和 CD 有什么区别？</h2><p>缩略词 CI &#x2F; CD 具有几个不同的含义。CI&#x2F;CD 中的“CI”始终指持续集成，它属于开发人员的自动化流程。成功的 CI 意味着应用代码的新更改会定期构建、测试并合并到共享存储库中。该解决方案可以解决在一次开发中有太多应用分支，从而导致相互冲突的问题。</p><p>CI&#x2F;CD 中的“CD”指的是持续交付和&#x2F;或持续部署，这些相关概念有时会交叉使用。两者都事关管道后续阶段的自动化，但它们有时也会单独使用，用于说明自动化程度。</p><p>持续<em>交付</em>通常是指开发人员对应用的更改会自动进行错误测试并上传到存储库（如 <a href="https://redhatofficial.github.io/#!/main">GitHub</a> 或容器注册表），然后由运维团队将其部署到实时生产环境中。这旨在解决开发和运维团队之间可见性及沟通较差的问题。因此，持续交付的目的就是确保尽可能减少部署新代码时所需的工作量。</p><p>持续<em>部署</em>（另一种“CD”）指的是自动将开发人员的更改从存储库发布到生产环境，以供客户使用。它主要为了解决因手动流程降低应用交付速度，从而使运维团队超负荷的问题。持续部署以持续交付的优势为根基，实现了管道后续阶段的自动化。</p><p><img src="https://www.redhat.com/cms/managed-files/ci-cd-flow-desktop_edited.png" alt="CI&#x2F;CD 流程"></p><p>CI&#x2F;CD 既可能仅指持续集成和持续交付构成的关联环节，也可以指持续集成、持续交付和持续部署这三项构成的关联环节。更为复杂的是，有时“持续交付”也包含了持续部署流程。</p><p>归根结底，我们没必要纠结于这些语义，您只需记得 CI&#x2F;CD 其实就是一个流程（通常形象地表述为管道），用于实现应用开发中的高度持续自动化和持续监控。因案例而异，该术语的具体含义取决于 CI&#x2F;CD 管道的自动化程度。许多企业最开始先添加 CI，然后逐步实现交付和部署的自动化（例如作为<a href="https://www.redhat.com/zh/topics/cloud-native-apps">云原生应用</a>的一部分）。</p>]]></content>
    
    
    <categories>
      
      <category>部署</category>
      
    </categories>
    
    
    <tags>
      
      <tag>前端工程化</tag>
      
      <tag>jenkinsfile</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-10-10-git flow管理规范</title>
    <link href="/2025/11/28/2022-04-16-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91git%E6%8F%90%E4%BA%A4%E8%A7%84%E8%8C%83/"/>
    <url>/2025/11/28/2022-04-16-%E3%80%90%E5%B7%A5%E7%A8%8B%E5%8C%96%E3%80%91git%E6%8F%90%E4%BA%A4%E8%A7%84%E8%8C%83/</url>
    
    <content type="html"><![CDATA[<h2 id="全局gitignore-DS-Store设置"><a href="#全局gitignore-DS-Store设置" class="headerlink" title="全局gitignore .DS_Store设置"></a>全局gitignore .DS_Store设置</h2><p><a href="https://0xmachos.com/2020-01-22-Eradicating-.DS_Store-From-Git/">https://0xmachos.com/2020-01-22-Eradicating-.DS_Store-From-Git/</a></p><h2 id="1-总则"><a href="#1-总则" class="headerlink" title="1. 总则"></a>1. 总则</h2><h3 id="1-1-目的"><a href="#1-1-目的" class="headerlink" title="1.1 目的"></a>1.1 目的</h3><p>为了有效的帮助团队更简洁，更统一的管理好源码，加强源码主提交历史的清晰可读，从源头强化开发过程管理，更有效的保证产品质量。</p><h3 id="1-2-适用范围"><a href="#1-2-适用范围" class="headerlink" title="1.2 适用范围"></a>1.2 适用范围</h3><p>适用于中心全部软件开发人员以及参与中心软件开发的外部合作商的开发人员。软件开发人员包括：架构师、开发工程师、测试工程师以及需要使用源码仓库的相关人员。</p><h2 id="2-规范说明"><a href="#2-规范说明" class="headerlink" title="2. 规范说明"></a>2. 规范说明</h2><h3 id="2-1-源码仓库"><a href="#2-1-源码仓库" class="headerlink" title="2.1 源码仓库"></a>2.1 源码仓库</h3><p>根据项目的保密级别和参与人员范围，可以选择在以下两个仓库选择：</p><ul><li>内部仓库，地址为：</li><li>联合开发仓库，地址为：</li></ul><h3 id="2-2-分支说明"><a href="#2-2-分支说明" class="headerlink" title="2.2 分支说明"></a>2.2 分支说明</h3><h4 id="分支分类"><a href="#分支分类" class="headerlink" title="分支分类"></a>分支分类</h4><pre><code class="hljs">源码仓库的分支按照生命周期分为：</code></pre><ul><li><p>长期分支：<code>master</code>, <code>dev</code></p></li><li><p>临时分支：<code>feature/*</code>, <code>release/*</code>, <code>hotfix/*</code></p><p>源码仓库的分支按照用途又可分为：</p></li><li><p>发布&#x2F;预发布分支：<code>master</code>，<code>release/*</code></p></li><li><p>开发分支：<code>dev</code></p></li><li><p>功能分支：<code>feature/*</code></p></li><li><p>热修复分支：<code>hotfix/*</code></p></li></ul><h4 id="分支用途"><a href="#分支用途" class="headerlink" title="分支用途"></a>分支用途</h4><ul><li><p><code>dev</code>：开发分支，所有最新的功能都在该分支下进行开发。</p></li><li><p><code>master</code>：<strong>发布分支和版本基线分支</strong>，与生产环境保持一致。在生产环境上发现的问题，必须以 <code>master</code> 为基准创建 <code>hotfix/*</code> 分支来修复问题。</p></li><li><p><code>feature/*</code>：作为新功能的特性开发分支，只能从 <code>dev</code> 创建，开发完毕并经过测试之后必须重新合并到 <code>dev</code>。</p><ul><li>命名规则：<code>feature/xxx_v2.4.0_0507_blowsysun</code> ，xxx是功能描述，v2.4.0是版本号，0507是分支创建日期，blowsysun是创建人</li></ul></li><li><p><code>release/*</code>：命名规则<code>release/v+发布的版本号</code>，作为预发布分支，只能从 <code>dev</code> 创建。</p></li><li><p><code>hotfix/*</code>：作为热修复分支，只能从 <code>master</code> 分离出来。仅用于修复在生产环境上发现的 bug，修复完成并测试通过后需要将该分支合并回 <code>dev</code> 及 <code>master</code> 上，并删除该分支。</p><ul><li>命名规则：<code>hotfix/xxx_v2.4.0_0507_blowsysun</code> ，xxx是bug描述，v2.4.0版本号，0507是分支创建日期，blowsysun是创建人，</li></ul></li></ul><h4 id="分支保护"><a href="#分支保护" class="headerlink" title="分支保护"></a>分支保护</h4><p>根据项目管理级别分为两类保护策略：</p><ul><li>通用策略：<code>master</code>分支由管理角色Master负责管理，其他人员无权限修改。</li><li>严控策略：<code>master</code>和<code>dev</code>分支均由管理角色Master负责管理，其他人员无权限修改。</li></ul><h2 id="3-工作流程"><a href="#3-工作流程" class="headerlink" title="3. 工作流程"></a>3. 工作流程</h2><h3 id="3-1-功能开发"><a href="#3-1-功能开发" class="headerlink" title="3.1 功能开发"></a>3.1 功能开发</h3><p><img src="/assets/images/git/git1.png" alt="git分支管理"></p><h4 id="标准流程"><a href="#标准流程" class="headerlink" title="标准流程"></a>标准流程</h4><blockquote><p>开发新功能都应遵循以下流程：</p></blockquote><ol><li>建议每一个功能分支<code>feature/*</code>应与TAPD上的feature有明确的对应关系</li><li>从<code>dev</code>拉取最新的分支，然后以最新的 develop 为基准创建新的功能分支，以 feature&#x2F;f1 为例：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git pull origin dev<br>git checkout -b feature/f1 dev<br></code></pre></td></tr></table></figure><ol start="3"><li>开发人员在各自的功能分支上进行开发工作。</li><li>当前功能分支开发完之后，在代码仓库中提起MR（Merge Request），申请将feature分支合并回dev分支。</li><li>MR Code Reviewer代码审查通过后，合并代码，并删除feature&#x2F;f1分支。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git branch -d feature/f1<br></code></pre></td></tr></table></figure><h3 id="3-2-发布与预发布"><a href="#3-2-发布与预发布" class="headerlink" title="3.2 发布与预发布"></a>3.2 发布与预发布</h3><p><img src="/assets/images/git/git2.png" alt="git分支管理"></p><h4 id="标准流程-1"><a href="#标准流程-1" class="headerlink" title="标准流程"></a>标准流程</h4><blockquote><p>提交到预发布和生产环境应遵循以下流程：</p></blockquote><ol><li><p>从 dev 分支创建新的预发布分支 <code>release/v0.1.0</code>，并部署到预发布环境上测试。</p></li><li><p>在预发布过程中发现问题，则从对应的预发布分支<code>release/v0.1.0</code>拉<code>fix/*</code>分支进行问题修复。issue本地修复后，提MR合并到 release&#x2F;v0.1.0 分支</p></li><li><p>预发布分支 <code>release/v0.1.0</code> 在预发布环境中完全测试通过，在部署到生产环境之前，需要将分支合并回 <code>dev</code> 及 <code>master</code>，并在master打一个正式发布版本的 tag v0.1.0，最后删除 <code>release/v0.1.0</code></p></li></ol><blockquote><p>生产环境发现Bug，需要Hotfix时应遵循以下流程：</p></blockquote><ol><li>从 master 上分离出一个热修复分支 <code>hotfix/*</code>，在此分支修复</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git checkout -b hotfix/queryBug_v2.4.0_0507_blowsysun master<br></code></pre></td></tr></table></figure><ol start="2"><li>验证通过之后，首先将分支重新合并回 <code>dev</code> 及 <code>master</code>，然后在 <code>master</code> 上打一个热修复 tag v0.1.1，最后删除 <code>hotfix/*</code></li></ol><h2 id="4-提交与合并"><a href="#4-提交与合并" class="headerlink" title="4. 提交与合并"></a>4. 提交与合并</h2><h3 id="4-1-Git-commit-message"><a href="#4-1-Git-commit-message" class="headerlink" title="4.1 Git commit message"></a>4.1 Git commit message</h3><p>遵循 <a href="http://git-scm.com/book/zh/v2/%E5%88%86%E5%B8%83%E5%BC%8F-Git-%E5%90%91%E4%B8%80%E4%B8%AA%E9%A1%B9%E7%9B%AE%E8%B4%A1%E7%8C%AE">Git 官方使用手册</a> 中给出的 commit 书写规范：</p><p>本次提交 commit 的摘要（50 个字符或更少）</p><blockquote><p>每次提交建议添加关键词前缀，用于指示本次改动的主题：<br>例如：feat: 增加xxx功能</p></blockquote><ul><li><strong>feat</strong>: 新功能（feature）</li><li><strong>fix</strong>: 修补 bug</li><li>revert: 回滚上一次 commit</li><li>docs: 文档（documentation）</li><li>style: 格式（不影响代码运行的变动）</li><li>refactor: 重构（即不是新增功能，也不是修改 bug 的代码变动）</li><li>perf: 性能优化</li><li>test: 增加测试</li><li>build: 编译相关的修改（例如 webpack, npm, gulp 等）</li><li>ci: CI 相关的修改（例如 Travis, Circle 等）</li><li>chore: 构建过程或辅助工具的变动</li></ul><h3 id="4-2-Merge-Request-MR"><a href="#4-2-Merge-Request-MR" class="headerlink" title="4.2 Merge Request (MR)"></a>4.2 Merge Request (MR)</h3><ul><li>建议在提交时需在标题中添加 <code>[MR]</code> 前缀用于邮件推送时区分 MR 和 ISSUE.</li><li>每个 MR 应该仅包含针对单一主题的一系列变更，不要在一个 MR 中包含多个主题。举例来说：假设你开发了 X 和 Y 两个不同主题的相关内容，若此时将所有 commit 以同一 MR 的形式进行提交，如若 Reviewer 仅认可与 X 相关的变更但不同意 Y 主题的相关变更——这将导致我们将无法对此 MR 进行合并操作。</li><li>每个 MR 提交人必须指定一名 Code Reviewer 进行代码审查，并由 Code Reviewer 进行合并。</li></ul><h2 id="5-定制项目维护和ISV定制开发"><a href="#5-定制项目维护和ISV定制开发" class="headerlink" title="5. 定制项目维护和ISV定制开发"></a>5. 定制项目维护和ISV定制开发</h2><h3 id="5-1-定制项目代码"><a href="#5-1-定制项目代码" class="headerlink" title="5.1 定制项目代码"></a>5.1 定制项目代码</h3><ul><li>定制项目开发分支单独由指定tag版本拉出。</li><li>定制项目开发的feature，由产品评估是否合并到主流版本。</li></ul><p>其他说明待添加</p><h3 id="5-2-ISV定制开发"><a href="#5-2-ISV定制开发" class="headerlink" title="5.2 ISV定制开发"></a>5.2 ISV定制开发</h3><ul><li>ISV定制开发版本代码从版本tag克隆，交付给ISV做三方开发。</li><li>定制开发版本代码由ISV自行维护</li></ul><h2 id="6-其他说明"><a href="#6-其他说明" class="headerlink" title="6. 其他说明"></a>6. 其他说明</h2><h3 id="6-1-冲突解决"><a href="#6-1-冲突解决" class="headerlink" title="6.1 冲突解决"></a>6.1 冲突解决</h3><p>特性代码开发过程中，在提交MR或push代码时，在本地应先做<code>rebase</code>，解决可能存在的冲突后，再提交代码或MR</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git rebase dev<br></code></pre></td></tr></table></figure><h3 id="6-2-多模块项目管理"><a href="#6-2-多模块项目管理" class="headerlink" title="6.2 多模块项目管理"></a>6.2 多模块项目管理</h3><blockquote><p>使用git submodule 管理多个代码仓库</p></blockquote><p>版本交付包通常包含多个模块，每个模块由单独的git仓进行管理。可以使用<code>git submodule</code>管理多仓代码。</p><ul><li>入门文档： <a href="https://blowsysun.gitee.io/2020/11/25/git-submodule%E5%85%A5%E5%9D%91%E6%8C%87%E5%8D%97/#more">git submodule入坑指南</a> </li><li>常用命令</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 初始化</span><br>git submodule init<br><span class="hljs-comment"># 初始化&amp;拉取代码</span><br>git submodule update --init --remote<br><br><span class="hljs-comment"># 添加模块</span><br>git submodule add https://xx.git src/xx<br><br><span class="hljs-comment"># 对子模块批量执行某项git操作</span><br>git submodule foreach &lt;<span class="hljs-built_in">command</span>&gt;<br><span class="hljs-comment"># example</span><br>git submodule foreach git checkout master<br></code></pre></td></tr></table></figure><blockquote><p>版本交付时，应在<strong>所有模块的git  master 分支打tag</strong></p></blockquote><p>- </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git submodule foreach git tag v0.1.0<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>规范</category>
      
    </categories>
    
    
    <tags>
      
      <tag>git flow</tag>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-10-10-git flow管理规范</title>
    <link href="/2025/11/28/2022-04-16-%E3%80%90%E8%A7%84%E8%8C%83%E3%80%91git%20flow%E7%AE%A1%E7%90%86/"/>
    <url>/2025/11/28/2022-04-16-%E3%80%90%E8%A7%84%E8%8C%83%E3%80%91git%20flow%E7%AE%A1%E7%90%86/</url>
    
    <content type="html"><![CDATA[<p><a href="https://govindustry.coding.net/api/qci-plugin/meta?key=codingcorp:tsf_deploy&version=latest&codingProjectName=hrss">https://govindustry.coding.net/api/qci-plugin/meta?key=codingcorp%3Atsf_deploy&amp;version=latest&amp;codingProjectName=hrss</a></p><p><a href="https://govindustry.coding.net/api/qci-plugin/meta?key=codingcorp:tsf_deploy&version=latest&codingProjectName=hrss-web-government-enterprise-through">https://govindustry.coding.net/api/qci-plugin/meta?key=codingcorp%3Atsf_deploy&amp;version=latest&amp;codingProjectName=hrss-web-government-enterprise-through</a></p><h2 id="一、git-flow-介绍"><a href="#一、git-flow-介绍" class="headerlink" title="一、git flow 介绍"></a>一、git flow 介绍</h2><p>1、master（主分支）<br>主分支，存放经过测试，已经完全稳定的代码，即其放的代码是可随时直接上生产使用的代码。主分支不允许提交代码，release 分支经过充分测试后，打 tag 版本号并合并到 master 分支</p><p>2、develop（开发分支）<br>开发分支，一开始从 master 分支中分离出来，用于开发者存放基本稳定代码</p><p>3、feature（功能分支）<br>功能分支，每次开发新功能时候从 develop 中 fork 出来一个 feature 分支，分支名可以采用 feature&#x2F;*的形式命名，如：feature&#x2F;需求编号-日期，feature&#x2F;31124-190618，开发完成合并到 develop 分支，不用时可以将其删除</p><p>4、release（预发分支）<br>预发分支，发布正式版本之前，需要一个预发布的版本进行测试，预发分支一般从从 develop 拉出，release 分支版本命名规范：由 4 个数字段表示，大版本. Release 版本.Hotfix 版本.YYmmdd，如 release&#x2F;2.2.0.190403，预发布结束以后，打 tag 并合并进 Develop 和 Master 分支</p><p>5、hotfix（修补 bug 分支）<br>修补 bug 分支，若遇到生产出现 bug，需要紧急修复，确定对应的 release 版本后，从 master 拉出一个 hotfix 分支，修改完成测试后打 tag 合并到 develop 和 master 分支，如分支名 hotfix&#x2F;2.2.0.190411。</p><h2 id="二、git-分支创建与合并"><a href="#二、git-分支创建与合并" class="headerlink" title="二、git 分支创建与合并"></a>二、git 分支创建与合并</h2><p>创建分支</p><p>如创建 feature&#x2F;31124-190618 分支，从 develop 上，创建并切换 feature 分支：</p><p>$ git checkout develop #切换到 dev 分支<br>$ git checkout -b feature&#x2F;31124-190618 #创建并切换到 feature&#x2F;31124-190618 分支</p><p>把创建的分支 feature 推送远程仓库：</p><p>$ git push -u origin feature&#x2F;31124-190618<br>合并分支：</p><p>如把 feature&#x2F;31124-190618 分支合并到 develop 分支</p><p>先切换分支： $ git checkout develop</p><p>再合并分支：$ git merge –no-ff feature&#x2F;31124-190618</p><p>最终推送到远程仓库：$ git push origin develop</p><h2 id="三、举例说明"><a href="#三、举例说明" class="headerlink" title="三、举例说明"></a>三、举例说明</h2><p>假如开发一个“评论“”功能</p><p>1、 克隆现有仓库<br>$ git clone <a href="http://git.uwscloud.com/uws/uws-data.git">http://git.uwscloud.com/uws/uws-data.git</a></p><p>2、创建并切换到 feature&#x2F;31124-190618 分支</p><p>git checkout develop #切换到 dev 分支<br>git checkout -b feature&#x2F;31124-190618 #创建并切换到 feature&#x2F;31124-190618 分支</p><p>git push -u origin feature&#x2F;31124-190618 #把创建的分支推送到远程仓库<br>3、开发过程中，定期把 dev 代码合并到 feature 分支，feature 分支始终保持最新代码</p><p>git checkout feature&#x2F;31124-190618 #切换到 feature&#x2F;31124-190618 分支</p><p>git merge –no-ff develop #把 dev 代码合并大 feature<br>4、开发完成提交</p><p>git add .</p><p>git commit -m ‘finish discuss feature’<br>5、开发完成，提交测试，从 develop 中 fork 出 release，并把 feature 合并到 release，在 release 上测试并修改 bug</p><p>git checkout develop #切换到 dev 分支<br>git checkout -b release&#x2F;2.2.0-190618 #创建并切换到 release&#x2F;2.2.0-190618 分支</p><p>git merge –no-ff feature-31124-190618 #把开发完成的 feature 分支合并到 release&#x2F;2.2.0-190618<br>6、直接上线测试通过的 release 版本，上线后把将 release 合并到 develop 和 master</p><p>7、保持 release 本地最新<br>git pull release&#x2F;2.2.0-190618</p><ul><li>release 合并到 develop 并 push 到远程<br>git checkout develop<br>git pull develop<br>git merge –no-ff release&#x2F;2.2.0-190618<br>git push</li><li>release 合并到 master 并 push 到远程<br>git checkout master<br>git pull master<br>git merge –no-ff release&#x2F;2.2.0-190618<br>git push</li></ul><p>9、对合并生成的新节点，打一个 tag</p><p>对合并生成的新节点，做一个标签<br>git tag -a release&#x2F;2.2.0-190618<br>git push –tags #push 到远程</p><p>#没用可以删除 release<br>git branch -d release&#x2F;2.2.0-190618<br>git push origin –delete release&#x2F;2.2.0-190618<br>10、线上出问题，创建一个修补 bug 分支</p><p>git checkout master<br>git checkout -b hotfix&#x2F;2.2.0-190618<br>11、bug 解决后，hotfix 合并到 develop 和 master 分支</p><ul><li><p>hotfix 合并到 develop 并 push 到远程<br>git checkout develop<br>git pull develop<br>git merge –no-ff hotfix&#x2F;2.2.0-190618<br>git push</p></li><li><p>hotfix 合并到 master 并 push 到远程<br>git checkout master<br>git pull master<br>git merge –no-ff hotfix&#x2F;2.2.0-190618<br>git push</p></li></ul><h1 id="打-tag"><a href="#打-tag" class="headerlink" title="打 tag"></a>打 tag</h1><p>git tag -a hotfix&#x2F;2.2.0-190618 #在当前分支上打一个 tag<br>git tag -a hotfix&#x2F;2.2.0-190618 be6fabcd #在当前分支的某个提交上打一个 tag<br>git push –tags #将当前分支及所有新打的 tag 推送远程仓库</p>]]></content>
    
    
    <categories>
      
      <category>规范</category>
      
    </categories>
    
    
    <tags>
      
      <tag>git flow</tag>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2018-01-28-vue-cli爬坑之路</title>
    <link href="/2025/11/28/2018-01-28-vue-cli%E7%88%AC%E5%9D%91%E4%B9%8B%E8%B7%AF/"/>
    <url>/2025/11/28/2018-01-28-vue-cli%E7%88%AC%E5%9D%91%E4%B9%8B%E8%B7%AF/</url>
    
    <content type="html"><![CDATA[<blockquote><p>近期项目中涉及到H5版本框架转型，使用vue-cli脚手架 结合axios、mint-ui进行项目迁移。<br>这里记录迁移过程以及其中遇到的坑，留备日后所需。本文主要讲解项目开发中所用工具的安装及问题排查<br>。比较懒，拖了很久才更新，懒癌晚期。</p></blockquote><span id="more"></span><h2 id="开发环境"><a href="#开发环境" class="headerlink" title="开发环境"></a>开发环境</h2><blockquote><p>system: MAC || windows</p><p>IDE: webStorm 2017.2.4</p><p>关键字：webpack + vue + vue-router + vuex + axios + mint-ui</p></blockquote><h1 id="vue开发环境准备"><a href="#vue开发环境准备" class="headerlink" title="vue开发环境准备"></a>vue开发环境准备</h1><blockquote><p>开发工具</p><p>1、编辑器： <a href="http://www.jetbrains.com/webstorm/">webstorm</a></p><p>2、版本管理：git</p><p>3、运行环境：node.js</p><p>4、构建环境：webpack</p><p>5、 vue-cli安装</p><p>6、项目编译与运行</p></blockquote><h2 id="一、编辑器安装"><a href="#一、编辑器安装" class="headerlink" title="一、编辑器安装"></a>一、编辑器安装</h2><ul><li>进入<a href="http://www.jetbrains.com/webstorm/">webstorm</a> 官网，下载最新版本并安装。</li><li>破解方法请百度搜索</li></ul><h2 id="二、git安装"><a href="#二、git安装" class="headerlink" title="二、git安装"></a>二、git安装</h2><ul><li>1、下载最新版本<a href="https://git-scm.com/downloads">git客户端</a></li><li>2、设置git配置</li></ul><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs lua">$ git <span class="hljs-built_in">config</span> user.email <span class="hljs-string">&quot;yyy@xxx.com&quot;</span><br>$ git <span class="hljs-built_in">config</span> user.name yyy<br>$ git <span class="hljs-built_in">config</span> <span class="hljs-comment">--global credential.helper store</span><br>$ git <span class="hljs-built_in">config</span> <span class="hljs-comment">--global core.autocrlf false</span><br></code></pre></td></tr></table></figure><ul><li>若报错<code>SSL certificate problem: unable to get local issuer certificate</code> 则执行</li></ul><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">git config --global http.sslVerify <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><ul><li>PS: 若需要代理设置</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs $xslt">git config --global https.proxy http://127.0.0.1:1080<br>git config --global https.proxy https://127.0.0.1:1080<br>// 取消代理<br>git config --global --unset http.proxy<br>git config --global --unset https.proxy<br></code></pre></td></tr></table></figure><h2 id="三、node-js安装"><a href="#三、node-js安装" class="headerlink" title="三、node.js安装"></a>三、node.js安装</h2><ul><li>下载最新 node.js <a href="https://nodejs.org/zh-cn/download/">官网地址</a> 并安装</li><li>代理设置</li></ul><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs arduino">npm config set proxy=http:<span class="hljs-comment">//172.17.18.80:8080</span><br>cnpm config set proxy=http:<span class="hljs-comment">//172.17.18.80:8080</span><br>npm config set http-proxy=http:<span class="hljs-comment">//127.0.0.1:8087</span><br>npm config set https-proxy=http:<span class="hljs-comment">//127.0.0.1:8087</span><br><span class="hljs-comment">// 取消代理</span><br>npm config <span class="hljs-keyword">delete</span> proxy<br>cnpm config <span class="hljs-keyword">delete</span> proxy<br></code></pre></td></tr></table></figure><ul><li>按照 <a href="http://npm.taobao.org/">cnpm设置教程</a> 设置淘宝镜像</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">npm install -<span class="hljs-selector-tag">g</span> cnpm <span class="hljs-attr">--registry</span>=https:<span class="hljs-comment">//registry.npm.taobao.org</span><br></code></pre></td></tr></table></figure><h2 id="四、webpack安装"><a href="#四、webpack安装" class="headerlink" title="四、webpack安装"></a>四、webpack安装</h2><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">npm <span class="hljs-keyword">install</span> -g webpack<br></code></pre></td></tr></table></figure><h2 id="五、vue-cli安装"><a href="#五、vue-cli安装" class="headerlink" title="五、vue-cli安装"></a>五、vue-cli安装</h2><ul><li>执行<code>npm install vue-cli -g </code>全局安装</li></ul><h2 id="六、项目编译与运行"><a href="#六、项目编译与运行" class="headerlink" title="六、项目编译与运行"></a>六、项目编译与运行</h2><p>1、项目启动步骤</p><p>将项目源码检出</p><p>前言：公司网络下请添加代理设置</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">npm<span class="hljs-built_in"> config </span><span class="hljs-built_in">set</span> <span class="hljs-attribute">proxy</span>=http://XXX.xx<br></code></pre></td></tr></table></figure><p>第一步、安装依赖<br><code>npm install</code></p><p>可能存在的报错：</p><blockquote><p>错误 1、</p><blockquote><p>解决办法<br>执行<br> npm install chromedriver –chromedriver_cdnurl&#x3D;<a href="http://cdn.npm.taobao.org/dist/chromedriver">http://cdn.npm.taobao.org/dist/chromedriver</a></p><p>错误 2、</p><blockquote><p>原因看node-gyp的安装需求，<a href="https://github.com/nodejs/node-gyp%EF%BC%8C">https://github.com/nodejs/node-gyp，</a> 部分剪切如下，可以请求的看到需要安装python2.7（其实2.6也行）python3不行</p><p><code>npm rebuild node-sass --force</code></p></blockquote><p>错误 3、 重新编译过程中可能存在报错，如下：</p><blockquote><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs smali">gyp verb<span class="hljs-built_in"> check </span>python checking for Python executable <span class="hljs-string">&quot;python2&quot;</span> in the PATH<br>gyp verb `which` failed Error:<span class="hljs-built_in"> not </span>found: python2<br></code></pre></td></tr></table></figure></blockquote><p>原因在于为安装 python，且必须未python2版本，所以需要官网下载<a href="https://www.python.org/downloads/windows/">Python 2.7版本</a><br>error MSB3411: 未能加载 Visual C++ 组件“VCBuild.exe”。如果<br>未安装该组件，请执行下列操作之一: 1) 安装 Microsoft Windows SDK for W<br>indows Server 2008 和 .NET Framework 3.5；或 2) 安装 Microsoft Visual Studio 2008。</p><blockquote><p>下载并安装 <a href="https://www.microsoft.com/en-us/download/confirmation.aspx?id=11310">Micros oft Windows SDK for Windows Server 2008</a> 解决该问题</p></blockquote><p>错误 4、依然存在错误 3</p><blockquote><p>npm install error： MSBUILD : error MSB3428: 未能加载 Visual C++ 组件“VCBuild.exe”</p><p>执行以下代码</p><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-comment">npm install</span> <span class="hljs-literal">--</span><span class="hljs-comment">global</span> <span class="hljs-literal">--</span><span class="hljs-comment">production windows</span><span class="hljs-literal">-</span><span class="hljs-comment">build</span><span class="hljs-literal">-</span><span class="hljs-comment">tools</span><br></code></pre></td></tr></table></figure><p>最终问题解决，<code>npm install -g node-gyp</code></p></blockquote></blockquote></blockquote><p>第二步</p><ul><li>启动项目</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">npm <span class="hljs-built_in">run</span> dev<br></code></pre></td></tr></table></figure><p>应该就可以启起来了</p>]]></content>
    
    
    <categories>
      
      <category>vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vue</tag>
      
      <tag>前端</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2018-01-30-echarts地图标注</title>
    <link href="/2025/11/28/2018-01-30-echarts%E5%9C%B0%E5%9B%BE%E6%A0%87%E6%B3%A8/"/>
    <url>/2025/11/28/2018-01-30-echarts%E5%9C%B0%E5%9B%BE%E6%A0%87%E6%B3%A8/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><blockquote><p>由于项目需要，根据接口返回城市数据，标注国内地图城市点，这里记录实现过程，以备不时之需。</p></blockquote><h1 id="一、echart插件引入"><a href="#一、echart插件引入" class="headerlink" title="一、echart插件引入"></a>一、echart插件引入</h1><ol><li>按需引入</li></ol><p><a href="http://echarts.baidu.com/builder.html">echart在线定制</a> 这里提供echart官网所给的在线打包工具，可自由选择所需图表、坐标系、组件进行打包下载，并且可对兼容及压缩问题进行设置</p><ol start="2"><li>引入完成echart</li></ol><p><a href="http://echarts.baidu.com/download.html">echart最新版本插件下载</a> 根据所需可选择版本，有常用、精简、完成版，以及源码可供下载</p><h1 id="二、地图文件引入"><a href="#二、地图文件引入" class="headerlink" title="二、地图文件引入"></a>二、地图文件引入</h1><blockquote><p>eharts3 之后版本不再内置地图文件，因此需要我们手动引入官网的js或者json文件（<a href="http://echarts.baidu.com/download-map.html">http://echarts.baidu.com/download-map.html</a> 官网可能暂时下架了js文件，可以导入下面链接的china.js文件）</p></blockquote><h2 id="加载地图"><a href="#加载地图" class="headerlink" title="加载地图"></a>加载地图</h2><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">var</span> myChart = echarts.init(<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&#x27;main&#x27;</span>));<br><span class="hljs-keyword">var</span> option = &#123;<br>  tooltip: &#123;<br>                    <span class="hljs-keyword">show</span>: <span class="hljs-keyword">false</span> <span class="hljs-comment">//不显示提示标签</span><br><span class="hljs-comment">//    formatter: &#x27;&#123;b&#125;&#x27;, //提示标签格式</span><br><span class="hljs-comment">//    backgroundColor:&quot;#ff7f50&quot;,//提示标签背景颜色</span><br><span class="hljs-comment">//    textStyle:&#123;color:&quot;#fff&quot;&#125; //提示标签字体颜色</span><br>  &#125;,<br>  series: [&#123;<br>    type: <span class="hljs-string">&#x27;map&#x27;</span>,<br>    mapType: <span class="hljs-string">&#x27;china&#x27;</span>,<br>    label: &#123;<br>      normal: &#123;<br>        <span class="hljs-keyword">show</span>: <span class="hljs-keyword">true</span>,<span class="hljs-comment">//显示省份标签</span><br>        textStyle:&#123;color:<span class="hljs-string">&quot;#4C77B5&quot;</span>, fontSize: <span class="hljs-string">&quot;12px&quot;</span> &#125;<span class="hljs-comment">//省份标签字体颜色</span><br>      &#125;,<br>      emphasis: &#123;<span class="hljs-comment">//对应的鼠标悬浮效果</span><br>        <span class="hljs-keyword">show</span>: <span class="hljs-keyword">true</span>,<br>        textStyle:&#123;color:<span class="hljs-string">&quot;#800080&quot;</span>&#125;<br>      &#125;<br>    &#125;,<br>    itemStyle: &#123;<br>      normal: &#123;<br>        borderWidth: .<span class="hljs-number">5</span>,<span class="hljs-comment">//区域边框宽度</span><br>        borderColor: <span class="hljs-string">&#x27;#46719A&#x27;</span>,<span class="hljs-comment">//区域边框颜色</span><br>        areaColor:<span class="hljs-string">&quot;#fff&quot;</span>,<span class="hljs-comment">//区域颜色</span><br>      &#125;,<br><span class="hljs-comment">//      emphasis: &#123;</span><br><span class="hljs-comment">//        borderWidth: .5,</span><br><span class="hljs-comment">//        borderColor: &#x27;#4b0082&#x27;,</span><br><span class="hljs-comment">//        areaColor:&quot;#ffdead&quot;,</span><br><span class="hljs-comment">//      &#125;</span><br>      emphasis:&#123;<br>        areaColor: <span class="hljs-keyword">null</span>,<br>        shadowOffsetX: <span class="hljs-number">0</span>,<br>        shadowOffsetY: <span class="hljs-number">0</span>,<br>        shadowBlur: <span class="hljs-number">20</span>,<br>        borderWidth: <span class="hljs-number">0</span>,<br>        shadowColor: <span class="hljs-string">&#x27;rgba(0, 0, 0, 0.5)&#x27;</span><br>      &#125;<br>    &#125;,<br>    data:[<br>      &#123;name:<span class="hljs-string">&#x27;福建&#x27;</span>, selected:<span class="hljs-keyword">true</span>&#125;,<span class="hljs-comment">//福建为选中状态</span><br>      &#123;name:<span class="hljs-string">&#x27;重庆&#x27;</span>, selected:<span class="hljs-keyword">true</span>&#125;,<span class="hljs-comment">//福建为选中状态</span><br>      &#123;name:<span class="hljs-string">&#x27;北京&#x27;</span>, selected:<span class="hljs-keyword">true</span>&#125;,<span class="hljs-comment">//福建为选中状态</span><br>      &#123;name:<span class="hljs-string">&#x27;日本&#x27;</span>, selected:<span class="hljs-keyword">true</span>&#125;<span class="hljs-comment">//福建为选中状态</span><br>    ]<br>  &#125;]<br>&#125;;<br><br>myChart.setOption(option);<br></code></pre></td></tr></table></figure><h2 id="完整demo"><a href="#完整demo" class="headerlink" title="完整demo"></a>完整demo</h2><p><a href="https://zhangyingxuan.github.io/my2017Demo/map.html">演示地址1</a><br><a href="https://zhangyingxuan.github.io/my2017Demo/map2.html">演示地址2</a></p><p>若提示<code>H5单页面手势滑屏切换(请用手机或模拟器访问)</code>，请进入移动端手机模式F5刷新查看，谷歌浏览器直接F12</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 源码实现 --&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>行啊我的2017<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;js/echarts.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;js/china.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;main&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;height:400px&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;js/map.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p><a href="https://github.com/zhangyingxuan/my2017Demo/blob/master/js/china.js">china.js</a> 下载地址：<a href="https://github.com/zhangyingxuan/my2017Demo/blob/master/js/china.js">https://github.com/zhangyingxuan/my2017Demo/blob/master/js/china.js</a></p><p><a href="https://github.com/zhangyingxuan/my2017Demo/blob/master/js/map.js">map.js</a> 下载地址：<a href="https://github.com/zhangyingxuan/my2017Demo/blob/master/js/map.js">https://github.com/zhangyingxuan/my2017Demo/blob/master/js/map.js</a></p>]]></content>
    
    
    <categories>
      
      <category>echart</category>
      
    </categories>
    
    
    <tags>
      
      <tag>前端</tag>
      
      <tag>echart</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2018-02-04-跨域问题整理</title>
    <link href="/2025/11/28/2018-02-04-%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98%E6%95%B4%E7%90%86/"/>
    <url>/2025/11/28/2018-02-04-%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98%E6%95%B4%E7%90%86/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><blockquote><p>跨域问题是前后端分离应用常见问题，解决的方案有很多，从开发阶段到上线后的生产环境<br>均需要解决该问题，</p></blockquote><h1 id="方案一：JSONP"><a href="#方案一：JSONP" class="headerlink" title="方案一：JSONP"></a>方案一：JSONP</h1><ul><li>这个比较常见，但仅适用于GET请求。<blockquote><p>jsonp原理：jsonp,即json+padding,动态创建script标签,利用script标签的src属性可以获取任何域下的js脚本,通过这个特性(也可以说漏洞),服<br>务器端不在返货json格式,而是返回一段调用某个函数的js代码，在src中进行了调用，这样实现了跨域.</p></blockquote></li></ul><h1 id="方案二、apache反向代理"><a href="#方案二、apache反向代理" class="headerlink" title="方案二、apache反向代理"></a>方案二、apache反向代理</h1><ul><li>网上资料太多，自行查找。</li></ul><h1 id="方案三、nginx方向代理"><a href="#方案三、nginx方向代理" class="headerlink" title="方案三、nginx方向代理"></a>方案三、nginx方向代理</h1><h3 id="一、下载"><a href="#一、下载" class="headerlink" title="一、下载"></a>一、下载</h3><p><a href="http://nginx.org/en/download.html">官网下载nginx</a></p><p>建议选择稳定版本</p><h3 id="二、安装运行"><a href="#二、安装运行" class="headerlink" title="二、安装运行"></a>二、安装运行</h3><p>1、将下载的nginx 解压放置在一个没有中文的路径下<code>(这点很重要)</code></p><p>2、修改 conf&#x2F;nginx.conf 中的端口号，设置listen 8888，避免与其他服务端口冲突。</p><p>3、双击nginx.exe （可能直接闪退），或者cd到安装路径，输入nginx</p><p>4、打开浏览器输入<a href="http://localhost:8888/">http://localhost:8888/</a> 查看服务是否成功运行</p><h3 id="三、反向代理配置"><a href="#三、反向代理配置" class="headerlink" title="三、反向代理配置"></a>三、反向代理配置</h3><p><a href="https://www.cnblogs.com/anruy/p/4989161.html">https://www.cnblogs.com/anruy/p/4989161.html</a></p><p><a href="https://www.cnblogs.com/Miss-mickey/p/6734831.html">https://www.cnblogs.com/Miss-mickey/p/6734831.html</a></p><p><a href="https://www.cnblogs.com/xingzc/p/5753030.html">https://www.cnblogs.com/xingzc/p/5753030.html</a></p><h1 id="方案四、前后端分离"><a href="#方案四、前后端分离" class="headerlink" title="方案四、前后端分离"></a>方案四、前后端分离</h1><h1 id="五、webpack代理设置"><a href="#五、webpack代理设置" class="headerlink" title="五、webpack代理设置"></a>五、webpack代理设置</h1><ul><li>如下设置，附带cookie丢失问题，如果每次请求会重新携带不同的cookie时可以用到。</li></ul><p>webpack proxyTable</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-keyword">var</span> sessionId = <span class="hljs-string">&#x27;&#x27;</span><br><br>module.exports = &#123;<br><span class="hljs-comment">// add by yixuanz 代理设置 2017-12-20 14:00:49</span><br>    proxyTable: &#123;<br>      <span class="hljs-string">&#x27;/api&#x27;</span>: &#123;<br>        <span class="hljs-attr">target</span>: <span class="hljs-string">&#x27;http://88.88.88:110/controller&#x27;</span>,<br>        <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,<br>        <span class="hljs-attr">pathRewrite</span>: &#123;<br>          <span class="hljs-string">&#x27;^/api&#x27;</span>: <span class="hljs-string">&#x27;&#x27;</span><br>        &#125;,<br><br>        <span class="hljs-comment">// 解决登录后，cookie丢失。 start</span><br>        <span class="hljs-comment">// PS: 正常情况无需设置以下代码，若出现接口无法获取请求头部的cookie则可参考</span><br>        cookieDomainRewrite: <span class="hljs-string">&#x27;localhost&#x27;</span>,<br>        <span class="hljs-attr">onProxyReq</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">proxyReq, req, res</span>) &#123;<br>          proxyReq.setHeader(<span class="hljs-string">&#x27;Cookie&#x27;</span>, sessionId)<br>        &#125;,<br>        <span class="hljs-attr">onProxyRes</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">proxyRes, req, res</span>) &#123;<br>          let existingCookies = proxyRes.headers[<span class="hljs-string">&#x27;set-cookie&#x27;</span>],<br>            rewrittenCookies = []<br>          <span class="hljs-keyword">if</span> (existingCookies !== <span class="hljs-literal">undefined</span>) &#123;<br>            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">Array</span>.isArray(existingCookies)) &#123;<br>              existingCookies = [existingCookies]<br>            &#125;<br><br>            <span class="hljs-keyword">for</span> (let i = <span class="hljs-number">0</span>; i &lt; existingCookies.<span class="hljs-built_in">length</span>; i++) &#123;<br>              rewrittenCookies.<span class="hljs-built_in">push</span>(existingCookies[i].<span class="hljs-built_in">replace</span>(<span class="hljs-regexp">/;\s*?(Secure)/i</span>, <span class="hljs-string">&#x27;&#x27;</span>))<br>            &#125;<br>            sessionId = rewrittenCookies[rewrittenCookies.<span class="hljs-built_in">length</span> - <span class="hljs-number">1</span>]<br>            proxyRes.headers[<span class="hljs-string">&#x27;set-cookie&#x27;</span>] = rewrittenCookies<br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;,<br>    ...<br>    <span class="hljs-comment">// 解决登录后，cookie丢失。 end</span><br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>JavaScript</category>
      
    </categories>
    
    
    <tags>
      
      <tag>前端</tag>
      
      <tag>JavaScript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2018-01-30-CSS3动画实例</title>
    <link href="/2025/11/28/2018-01-30-CSS3%E5%8A%A8%E6%95%88/"/>
    <url>/2025/11/28/2018-01-30-CSS3%E5%8A%A8%E6%95%88/</url>
    
    <content type="html"><![CDATA[<blockquote><p>c33动画想必大家并不陌生，在CSS3之前想要在网页中实现动画效果，少不了js操作<br>位置或css样式，繁琐而又乏味，而css3新增的动画效果着实简单又好上用，平移、旋转、缩放轻松搞定</p></blockquote><span id="more"></span><ul><li>学习资料</li></ul><p>当然少不了 <a href="http://www.w3school.com.cn/css3/css3_animation.asp">w3cschool</a> 助力</p><h1 id="实例涉及知识点"><a href="#实例涉及知识点" class="headerlink" title="实例涉及知识点"></a>实例涉及知识点</h1><ol><li>CSS3 转换 - 2D转换</li><li>CSS3 过渡</li><li>CSS3 动画</li><li>echarts地图标注</li></ol><h1 id="demo-地址"><a href="#demo-地址" class="headerlink" title="demo 地址"></a>demo 地址</h1><ol><li><a href="https://zhangyingxuan.github.io/my2017Demo/">CSS + Jquery demo演示地址</a></li></ol><p><a href="https://zhangyingxuan.github.io/my2017Demo/">https://zhangyingxuan.github.io/my2017Demo/</a></p><p>动画展示，星星缩放，月亮旋转角度</p><ul><li>星星闪烁</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs CSS"><span class="hljs-selector-class">.page6_header_star4_img</span>&#123;<br>  <span class="hljs-attribute">position</span>: absolute;<br>  <span class="hljs-attribute">left</span>: <span class="hljs-number">4rem</span>;<br>  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">1rem</span>;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">1.5rem</span>;<br><br>  // 使用 beat动画 <span class="hljs-number">2s</span>内执行完一次动画 匀速执行 反复执行<br>  -webkit-<span class="hljs-attribute">animation</span>: beat <span class="hljs-number">2s</span> linear infinite;<br>  -moz-<span class="hljs-attribute">animation</span>: beat <span class="hljs-number">2s</span> linear infinite;<br>  -o-<span class="hljs-attribute">animation</span>: beat <span class="hljs-number">2s</span> linear infinite;<br>  <span class="hljs-attribute">animation</span>: beat <span class="hljs-number">2s</span> linear infinite;<br>&#125;<br>// 统一标识语句,符合w3c标准<br><span class="hljs-keyword">@keyframes</span> beat &#123;<br>  <span class="hljs-number">0%</span> &#123;<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1</span>)&#125;<br>  <span class="hljs-number">15%</span> &#123;<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.2</span>)&#125;   // 放大<span class="hljs-number">1.2</span>倍<br>  <span class="hljs-number">30%</span> &#123;<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1</span>)&#125;<br>  <span class="hljs-number">55%</span> &#123;<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.1</span>)&#125;<br>  <span class="hljs-number">100%</span> &#123;<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1</span>)&#125;<br>&#125;<br><br>// -moz火狐内核识别码<br><span class="hljs-keyword">@-moz-keyframes</span> beat&#123;<br>  <span class="hljs-number">0%</span>&#123;-moz-<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1</span>) &#125;<br>  <span class="hljs-number">15%</span>&#123;-moz-<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.2</span>) &#125;<br>  <span class="hljs-number">30%</span>&#123;-moz-<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1</span>) &#125;<br>  <span class="hljs-number">55%</span>&#123;-moz-<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.1</span>) &#125;<br>  <span class="hljs-number">100%</span>&#123;-moz-<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1</span>) &#125;<br>&#125;<br>// -o代表欧朋【opera】内核识别码<br><span class="hljs-keyword">@-o-keyframes</span> beat&#123;<br>  <span class="hljs-number">0%</span>&#123;-o-<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1</span>) &#125;<br>  <span class="hljs-number">15%</span>&#123;-o-<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.2</span>) &#125;<br>  <span class="hljs-number">30%</span>&#123;-o-<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1</span>) &#125;<br>  <span class="hljs-number">55%</span>&#123;-o-<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.1</span>)&#125;<br>  <span class="hljs-number">100%</span>&#123;-o-<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1</span>) &#125;<br>&#125;<br>// -webkit谷歌内核识别码<br><span class="hljs-keyword">@-webkit-keyframes</span> beat &#123;<br>  <span class="hljs-number">0%</span> &#123;-webkit-<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1</span>)&#125;<br>  <span class="hljs-number">15%</span> &#123;-webkit-<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.2</span>)&#125;<br>  <span class="hljs-number">30%</span> &#123;-webkit-<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1</span>)&#125;<br>  <span class="hljs-number">55%</span> &#123;-webkit-<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.1</span>)&#125;<br>  <span class="hljs-number">100%</span> &#123;-webkit-<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1</span>)&#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>月亮摇摆</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs CSS"><span class="hljs-selector-class">.page6_header_moon_img</span>&#123;<br>// 使用 beat动画 <span class="hljs-number">2s</span>内执行完一次动画 匀速执行 反复交替执行<br>  -webkit-<span class="hljs-attribute">animation</span>: moonRotate <span class="hljs-number">2s</span> linear infinite alternate;<br>  -moz-<span class="hljs-attribute">animation</span>: moonRotate <span class="hljs-number">2s</span> linear infinite alternate;<br>  -o-<span class="hljs-attribute">animation</span>: moonRotate <span class="hljs-number">2s</span> linear infinite alternate;<br>  <span class="hljs-attribute">animation</span>: moonRotate <span class="hljs-number">2s</span> linear infinite alternate;<br><br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">10rem</span>;<br>  <span class="hljs-attribute">position</span>: absolute;<br>  <span class="hljs-attribute">left</span>: <span class="hljs-number">22%</span>;<br>  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">3rem</span>;<br>&#125;<br><br><span class="hljs-keyword">@keyframes</span> moonRotate&#123;<br>  <span class="hljs-selector-tag">from</span>&#123;<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotate</span>(-<span class="hljs-number">15deg</span>) &#125;<br>  <span class="hljs-selector-tag">to</span>&#123;<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotate</span>(<span class="hljs-number">15deg</span>) &#125;<br>&#125;<br>... // 其他浏览器兼容同上<br><br></code></pre></td></tr></table></figure><h3 id="H5-动画"><a href="#H5-动画" class="headerlink" title="H5 动画"></a>H5 动画</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br></pre></td><td class="code"><pre><code class="hljs CSS"><br><span class="hljs-comment">/*尾巴摇动*/</span><br><span class="hljs-selector-class">.dog-tail</span>&#123;<br>    <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>    -webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>    <span class="hljs-attribute">animation</span>:dog-tail <span class="hljs-number">2s</span> infinite ease-in-out;<br>    -webkit-<span class="hljs-attribute">animation</span>:dog-tail <span class="hljs-number">2s</span> infinite ease-in-out;<br>    <span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d;<br>    -webkit-<span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d;<br>    <span class="hljs-attribute">backface-visibility</span>: hidden;<br>    -webkit-<span class="hljs-attribute">backface-visibility</span>: hidden;<br>    <span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000</span>;<br>    -webkit-<span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000</span>;<br>    <span class="hljs-attribute">animation-fill-mode</span>:forwards;<br>    -webkit-<span class="hljs-attribute">animation-fill-mode</span>:forwards;<br>    <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>    -webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">1</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">1</span>;<br>&#125;<br><span class="hljs-keyword">@keyframes</span> dog-tail &#123;<br>    <span class="hljs-number">10%</span> &#123;<br>        <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotate</span>(<span class="hljs-number">15deg</span>);<br>        -webkit-<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotate</span>(<span class="hljs-number">15deg</span>);<br>    &#125;<br>    <span class="hljs-number">20%</span> &#123;<br>        <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotate</span>(-<span class="hljs-number">10deg</span>);<br>        -webkit-<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotate</span>(-<span class="hljs-number">10deg</span>);<br>    &#125;<br>    <span class="hljs-number">30%</span> &#123;<br>        <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotate</span>(<span class="hljs-number">5deg</span>);<br>        -webkit-<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotate</span>(<span class="hljs-number">5deg</span>);<br>    &#125;<br>    <span class="hljs-number">40%</span> &#123;<br>        <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotate</span>(-<span class="hljs-number">5deg</span>);<br>        -webkit-<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotate</span>(-<span class="hljs-number">5deg</span>);<br>    &#125;<br>    <span class="hljs-number">50%</span>,<span class="hljs-number">100%</span> &#123;<br>        <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotate</span>(<span class="hljs-number">0deg</span>);<br>        -webkit-<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotate</span>(<span class="hljs-number">0deg</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">/* 掉落 */</span><br><span class="hljs-selector-class">.diaoluo</span> &#123;<br>    <span class="hljs-attribute">animation</span>: diaoluo <span class="hljs-number">1s</span> infinite ease-in-out;<br>    -webkit-<span class="hljs-attribute">animation</span>: diaoluo <span class="hljs-number">1s</span> infinite ease-in-out;<br>    <span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d;<br>    -webkit-<span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d;<br>    <span class="hljs-attribute">backface-visibility</span>: hidden;<br>    -webkit-<span class="hljs-attribute">backface-visibility</span>: hidden;<br>    <span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000</span>;<br>    -webkit-<span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000</span>;<br>    <span class="hljs-attribute">animation-fill-mode</span>: forwards;<br>    -webkit-<span class="hljs-attribute">animation-fill-mode</span>: forwards;<br>    -webkit-<span class="hljs-attribute">animation-iteration-count</span>: <span class="hljs-number">1</span>;<br>    <span class="hljs-attribute">animation-iteration-count</span>: <span class="hljs-number">1</span>;<br>    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">/*设置只在Z轴上移动*/</span><br>&#125;<br><br><span class="hljs-keyword">@keyframes</span> diaoluo&#123;<br>    <span class="hljs-number">0%</span> &#123;<br>        <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">2.5rem</span>); <span class="hljs-comment">/*设置只在Z轴上移动*/</span><br>        -webkit-<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">2.5rem</span>); <span class="hljs-comment">/*设置只在Z轴上移动*/</span><br>    &#125;<br>    <span class="hljs-number">100%</span> &#123;<br>        <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">/*设置只在Z轴上移动*/</span><br>        -webkit-<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">/*设置只在Z轴上移动*/</span><br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">@keyframes</span> container&#123;<br>    <span class="hljs-number">0%</span>,<br>    <span class="hljs-number">100%</span>,<br>    <span class="hljs-number">20%</span>,<br>    <span class="hljs-number">50%</span>,<br>    <span class="hljs-number">80%</span> &#123;<br>        <span class="hljs-attribute">transition-timing-function</span>: <span class="hljs-built_in">cubic-bezier</span>(<span class="hljs-number">0.215</span>,.<span class="hljs-number">61</span>,.<span class="hljs-number">355</span>,<span class="hljs-number">1</span>); <span class="hljs-comment">/*贝塞尔曲线 ： X1 Y1 X2 Y2*/</span><br>        <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>); <span class="hljs-comment">/*设置只在Z轴上移动*/</span><br>        -webkit-<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>); <span class="hljs-comment">/*设置只在Z轴上移动*/</span><br>    &#125;<br>    <span class="hljs-number">40%</span>,<br>    <span class="hljs-number">43%</span>&#123;<br>        <span class="hljs-attribute">transition-timing-function</span>: <span class="hljs-built_in">cubic-bezier</span>(<span class="hljs-number">0.755</span>,<span class="hljs-number">0.50</span>,<span class="hljs-number">0.855</span>,<span class="hljs-number">0.060</span>);<br>        <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,-<span class="hljs-number">30px</span>,<span class="hljs-number">0</span>);<br>        -webkit-<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,-<span class="hljs-number">30px</span>,<span class="hljs-number">0</span>);<br>    &#125;<br>    <span class="hljs-number">70%</span>&#123;<br>        <span class="hljs-attribute">transition-timing-function</span>: <span class="hljs-built_in">cubic-bezier</span>(<span class="hljs-number">0.755</span>,<span class="hljs-number">0.050</span>,<span class="hljs-number">0.855</span>,<span class="hljs-number">0.060</span>);<br>        <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,-<span class="hljs-number">15px</span>,<span class="hljs-number">0</span>);<br>        -webkit-<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,-<span class="hljs-number">15px</span>,<span class="hljs-number">0</span>);<br>    &#125;<br>    <span class="hljs-number">90%</span>&#123;<br>        <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,-<span class="hljs-number">4px</span>,<span class="hljs-number">0</span>);<br>        -webkit-<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,-<span class="hljs-number">4px</span>,<span class="hljs-number">0</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">/* 右上浮动 */</span><br><span class="hljs-selector-class">.fudong</span>&#123;<br>  <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>  -webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>  <span class="hljs-attribute">animation</span>:fudong <span class="hljs-number">5s</span> infinite ease-in-out;<br>  -webkit-<span class="hljs-attribute">animation</span>:fudong <span class="hljs-number">5s</span> infinite ease-in-out;<br>  <span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d;<br>  -webkit-<span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d;<br>  <span class="hljs-attribute">backface-visibility</span>: hidden;<br>  -webkit-<span class="hljs-attribute">backface-visibility</span>: hidden;<br>  <span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000</span>;<br>  -webkit-<span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000</span>;<br>  <span class="hljs-attribute">animation-fill-mode</span>:forwards;<br>  -webkit-<span class="hljs-attribute">animation-fill-mode</span>:forwards;<br>  <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>  -webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">1</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">1</span>;<br>&#125;<br><span class="hljs-keyword">@keyframes</span>  fudong<br>&#123;<br>    <span class="hljs-number">0%</span>  &#123; <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);&#125;<br>    <span class="hljs-number">50%</span>  &#123; <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0.25rem</span>, -<span class="hljs-number">0.25rem</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0.25rem</span>,-<span class="hljs-number">0.25rem</span>); &#125;<br>    <span class="hljs-number">100%</span>  &#123; <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);&#125;<br>&#125;<br><br><span class="hljs-comment">/* 上下浮动 */</span><br><span class="hljs-selector-class">.fudong_top</span> &#123;<br>  <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>  -webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>  <span class="hljs-attribute">animation</span>:fudong <span class="hljs-number">5s</span> infinite linear;<br>  -webkit-<span class="hljs-attribute">animation</span>:fudong <span class="hljs-number">5s</span> infinite ease-in-out;<br>  <span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d;<br>  -webkit-<span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d;<br>  <span class="hljs-attribute">backface-visibility</span>: hidden;<br>  -webkit-<span class="hljs-attribute">backface-visibility</span>: hidden;<br>  <span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000</span>;<br>  -webkit-<span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000</span>;<br>  <span class="hljs-attribute">animation-fill-mode</span>:forwards;<br>  -webkit-<span class="hljs-attribute">animation-fill-mode</span>:forwards;<br>  <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>-webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">1</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">1</span>;<br>&#125;<br><span class="hljs-keyword">@keyframes</span>  fudong<br>&#123;<br>    <span class="hljs-number">0%</span>  &#123; <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);&#125;<br>    <span class="hljs-number">50%</span>  &#123; <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>, -<span class="hljs-number">0.25rem</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,-<span class="hljs-number">0.25rem</span>); &#125;<br>    <span class="hljs-number">100%</span>  &#123; <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);&#125;<br>&#125;<br><br><span class="hljs-comment">/* 场景动画 - 无特殊需求 请勿随意更改*/</span><br><span class="hljs-comment">/* 跳动提示 */</span><br><span class="hljs-selector-class">.tiaodong</span>&#123;<br>  <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>  -webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>  <span class="hljs-attribute">animation</span>:tiaodong <span class="hljs-number">3s</span> infinite linear;<br>  -webkit-<span class="hljs-attribute">animation</span>:tiaodong <span class="hljs-number">3s</span> infinite linear;<br>  <span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d;<br>  -webkit-<span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d;<br>  <span class="hljs-attribute">backface-visibility</span>: hidden;<br>  -webkit-<span class="hljs-attribute">backface-visibility</span>: hidden;<br>  <span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000</span>;<br>  -webkit-<span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000</span>;<br>  <span class="hljs-attribute">animation-fill-mode</span>:forwards;<br>  -webkit-<span class="hljs-attribute">animation-fill-mode</span>:forwards;<br>  <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>&#125;<br><span class="hljs-keyword">@keyframes</span>  tiaodong<br>&#123;<br>    <span class="hljs-number">0%</span>  &#123; <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);&#125;<br>    <span class="hljs-number">50%</span>  &#123; <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>); &#125;<br>    <span class="hljs-number">75%</span>  &#123; <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0.05rem</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0.05rem</span>); &#125;<br>    <span class="hljs-number">100%</span>  &#123; <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);&#125;<br>&#125;<br><br><span class="hljs-comment">/* 闪动 */</span><br><span class="hljs-selector-class">.dd_line</span> &#123;<br>  <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>  -webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>  <span class="hljs-attribute">animation</span>:dd_line <span class="hljs-number">1.2s</span> infinite linear;<br>  -webkit-<span class="hljs-attribute">animation</span>:dd_line <span class="hljs-number">1.2s</span> infinite linear;<br>  <span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d;<br>  -webkit-<span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d ;<br>  <span class="hljs-attribute">backface-visibility</span>: hidden;<br>  -webkit-<span class="hljs-attribute">backface-visibility</span>: hidden;<br>  <span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000</span>;<br>  -webkit-<span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000</span>;<br>  <span class="hljs-attribute">animation-fill-mode</span>:forwards;<br>  -webkit-<span class="hljs-attribute">animation-fill-mode</span>:forwards;<br>  -webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-keyword">@keyframes</span>  dd_line<br>&#123;<br>  <span class="hljs-number">0%</span>  &#123;-webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>; &#125;<br>  <span class="hljs-number">50%</span>  &#123;-webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0.6</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0.6</span>; &#125;<br>  <span class="hljs-number">100%</span>  &#123;-webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">1</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">1</span>;&#125;<br>&#125;<br><br><span class="hljs-comment">/* 文字闪动 */</span><br><span class="hljs-selector-class">.text_line</span> &#123;<br>  <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>  -webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>  <span class="hljs-attribute">animation</span>:text_line <span class="hljs-number">3s</span> infinite linear;<br>  -webkit-<span class="hljs-attribute">animation</span>:text_line <span class="hljs-number">3s</span> infinite linear;<br>  <span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d;<br>  -webkit-<span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d ;<br>  <span class="hljs-attribute">backface-visibility</span>: hidden;<br>  -webkit-<span class="hljs-attribute">backface-visibility</span>: hidden;<br>  <span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000</span>;<br>  -webkit-<span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000</span>;<br>  <span class="hljs-attribute">animation-fill-mode</span>:forwards;<br>  -webkit-<span class="hljs-attribute">animation-fill-mode</span>:forwards;<br>  -webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">rotate</span>(-<span class="hljs-number">5deg</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">rotate</span>(-<span class="hljs-number">5deg</span>);<br>&#125;<br><span class="hljs-keyword">@keyframes</span>  text_line<br>&#123;<br>  <span class="hljs-number">0%</span>  &#123;-webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">rotate</span>(-<span class="hljs-number">5deg</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">rotate</span>(-<span class="hljs-number">5deg</span>);  &#125;<br>  <span class="hljs-number">50%</span>  &#123;-webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">rotate</span>(-<span class="hljs-number">5deg</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">rotate</span>(-<span class="hljs-number">5deg</span>);  &#125;<br>  <span class="hljs-number">100%</span>  &#123;-webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">1</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">1</span>;<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">rotate</span>(-<span class="hljs-number">5deg</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">rotate</span>(-<span class="hljs-number">5deg</span>);&#125;<br>&#125;<br><br><span class="hljs-comment">/* 淡入 */</span><br><span class="hljs-selector-class">.dr</span> &#123;<br>  <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>  -webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>  <span class="hljs-attribute">animation</span>:dr <span class="hljs-number">2s</span>;<br>  -webkit-<span class="hljs-attribute">animation</span>:dr <span class="hljs-number">2s</span>;<br>  <span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d;<br>  -webkit-<span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d ;<br>  <span class="hljs-attribute">backface-visibility</span>: hidden;<br>  -webkit-<span class="hljs-attribute">backface-visibility</span>: hidden;<br>  <span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000</span>;<br>  -webkit-<span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000</span>;<br>  <span class="hljs-attribute">animation-fill-mode</span>:forwards;<br>  -webkit-<span class="hljs-attribute">animation-fill-mode</span>:forwards;<br>  -webkit-<span class="hljs-attribute">animation-iteration-count</span>:<span class="hljs-number">1</span>;<br>  <span class="hljs-attribute">animation-iteration-count</span>:<span class="hljs-number">1</span>;<br>  -webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-keyword">@keyframes</span>  dr<br>&#123;<br>  <span class="hljs-number">0%</span>  &#123;-webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;&#125;<br>  <span class="hljs-number">50%</span>  &#123;-webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;&#125;<br>  <span class="hljs-number">100%</span>  &#123;-webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">1</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">1</span>;&#125;<br>&#125;<br><br><span class="hljs-comment">/* 朝上滑出淡入 */</span><br><span class="hljs-selector-class">.hcdr_for_top</span> &#123;<br>    <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>    -webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>    <span class="hljs-attribute">animation</span>:hcdr_for_top <span class="hljs-number">2s</span>;<br>    -webkit-<span class="hljs-attribute">animation</span>:hcdr_for_top <span class="hljs-number">2s</span>;<br>    <span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d;<br>    -webkit-<span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d;<br>    <span class="hljs-attribute">backface-visibility</span>: hidden;<br>    -webkit-<span class="hljs-attribute">backface-visibility</span>: hidden;<br>    <span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000</span>;<br>    -webkit-<span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000</span>;<br>    <span class="hljs-attribute">animation-fill-mode</span>:forwards;<br>    -webkit-<span class="hljs-attribute">animation-fill-mode</span>:forwards;<br>    -webkit-<span class="hljs-attribute">animation-iteration-count</span>:<span class="hljs-number">1</span>;<br>    <span class="hljs-attribute">animation-iteration-count</span>:<span class="hljs-number">1</span>;<br>    <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">2rem</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">2rem</span>);-webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-keyword">@keyframes</span>  hcdr_for_top<br>&#123;<br>    <span class="hljs-number">0%</span>  &#123;<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">1rem</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">1rem</span>);-webkit-<span class="hljs-attribute">opacity</span>:.<span class="hljs-number">5</span>;<span class="hljs-attribute">opacity</span>:.<span class="hljs-number">5</span>;&#125;<br>    <span class="hljs-number">100%</span>  &#123;<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);-webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">1</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">1</span>;&#125;<br>&#125;<br><br><span class="hljs-comment">/* 朝左滑出淡入 */</span><br><span class="hljs-selector-class">.hcdr_for_left</span> &#123;<br>  <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>  -webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>  <span class="hljs-attribute">animation</span>:hcdr_for_left <span class="hljs-number">2s</span>;<br>  -webkit-<span class="hljs-attribute">animation</span>:hcdr_for_left <span class="hljs-number">2s</span>;<br>  <span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d;<br>  -webkit-<span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d;<br>  <span class="hljs-attribute">backface-visibility</span>: hidden;<br>  -webkit-<span class="hljs-attribute">backface-visibility</span>: hidden;<br>  <span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000</span>;<br>  -webkit-<span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000</span>;<br>  <span class="hljs-attribute">animation-fill-mode</span>:forwards;<br>  -webkit-<span class="hljs-attribute">animation-fill-mode</span>:forwards;<br>  -webkit-<span class="hljs-attribute">animation-iteration-count</span>:<span class="hljs-number">1</span>;<br>  <span class="hljs-attribute">animation-iteration-count</span>:<span class="hljs-number">1</span>;<br>  <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">2rem</span>,<span class="hljs-number">0</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">2rem</span>,<span class="hljs-number">0</span>);<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;-webkit-<span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-keyword">@keyframes</span>  hcdr_for_left<br>&#123;<br>  <span class="hljs-number">0%</span>  &#123;<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">2rem</span>,<span class="hljs-number">0</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">2rem</span>,<span class="hljs-number">0</span>);<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;-webkit-<span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;&#125;<br>  <span class="hljs-number">50%</span>  &#123;<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">2rem</span>,<span class="hljs-number">0</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">2rem</span>,<span class="hljs-number">0</span>);<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;-webkit-<span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;&#125;<br>  <span class="hljs-number">100%</span>  &#123;<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<span class="hljs-attribute">opacity</span>:<span class="hljs-number">1</span>;-webkit-<span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;&#125;<br>&#125;<br><br><span class="hljs-comment">/* 朝右滑出淡入 */</span><br><span class="hljs-selector-class">.hcdr_for_right</span> &#123;<br>  <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>  -webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>  <span class="hljs-attribute">animation</span>:hcdr_for_right <span class="hljs-number">2s</span>;<br>  -webkit-<span class="hljs-attribute">animation</span>:hcdr_for_right <span class="hljs-number">2s</span>;<br>  <span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d;<br>  -webkit-<span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d;<br>  <span class="hljs-attribute">backface-visibility</span>: hidden;<br>  -webkit-<span class="hljs-attribute">backface-visibility</span>: hidden;<br>  <span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000</span>;<br>  -webkit-<span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000</span>;<br>  <span class="hljs-attribute">animation-fill-mode</span>:forwards;<br>  -webkit-<span class="hljs-attribute">animation-fill-mode</span>:forwards;<br>  -webkit-<span class="hljs-attribute">animation-iteration-count</span>:<span class="hljs-number">1</span>;<br>  <span class="hljs-attribute">animation-iteration-count</span>:<span class="hljs-number">1</span>;<br>  <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(-<span class="hljs-number">2rem</span>,<span class="hljs-number">0</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(-<span class="hljs-number">2rem</span>,<span class="hljs-number">0</span>);-webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-keyword">@keyframes</span>  hcdr_for_right<br>&#123;<br>  <span class="hljs-number">0%</span>  &#123;<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(-<span class="hljs-number">2rem</span>,<span class="hljs-number">0</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(-<span class="hljs-number">2rem</span>,<span class="hljs-number">0</span>);-webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;&#125;<br>  <span class="hljs-number">50%</span>  &#123;<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(-<span class="hljs-number">2rem</span>,<span class="hljs-number">0</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(-<span class="hljs-number">2rem</span>,<span class="hljs-number">0</span>);-webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;&#125;<br>  <span class="hljs-number">100%</span>  &#123;<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);-webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">1</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">1</span>;&#125;<br>&#125;<br><br><span class="hljs-comment">/* 从大到小淡入 */</span><br><span class="hljs-selector-class">.bhdr_for_sm</span> &#123;<br>    <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>    -webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>    <span class="hljs-attribute">animation</span>:bhdr_for_sm <span class="hljs-number">2s</span>;<br>    -webkit-<span class="hljs-attribute">animation</span>:bhdr_for_sm <span class="hljs-number">2s</span>;<br>    <span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d;<br>    -webkit-<span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d ;<br>    <span class="hljs-attribute">backface-visibility</span>: hidden;<br>    -webkit-<span class="hljs-attribute">backface-visibility</span>: hidden;<br>    <span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000</span>;<br>    -webkit-<span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000</span>;<br>    <span class="hljs-attribute">animation-fill-mode</span>:forwards;<br>    -webkit-<span class="hljs-attribute">animation-fill-mode</span>:forwards;<br>    -webkit-<span class="hljs-attribute">animation-iteration-count</span>:<span class="hljs-number">1</span>;<br>    <span class="hljs-attribute">animation-iteration-count</span>:<span class="hljs-number">1</span>;<br>    <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">scale</span>(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>)<span class="hljs-built_in">rotate</span>(-<span class="hljs-number">4deg</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">scale</span>(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>)<span class="hljs-built_in">rotate</span>(-<span class="hljs-number">4deg</span>);-webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-keyword">@keyframes</span>  bhdr_for_sm<br>&#123;<br>    <span class="hljs-number">0%</span>  &#123;<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">scale</span>(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>)<span class="hljs-built_in">rotate</span>(-<span class="hljs-number">4deg</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">scale</span>(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>)<span class="hljs-built_in">rotate</span>(-<span class="hljs-number">4deg</span>);-webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;&#125;<br>    <span class="hljs-number">50%</span>  &#123;<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">scale</span>(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>)<span class="hljs-built_in">rotate</span>(-<span class="hljs-number">4deg</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">scale</span>(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>)<span class="hljs-built_in">rotate</span>(-<span class="hljs-number">4deg</span>);-webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;&#125;<br>    <span class="hljs-number">100%</span>  &#123;<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">scale</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)<span class="hljs-built_in">rotate</span>(-<span class="hljs-number">4deg</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">scale</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)<span class="hljs-built_in">rotate</span>(-<span class="hljs-number">4deg</span>);-webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">1</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">1</span>;&#125;<br>&#125;<br><br><span class="hljs-comment">/* 从小到大淡入 */</span><br><span class="hljs-selector-class">.bhdr_for_big</span>&#123;<br>  <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>  -webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>  <span class="hljs-attribute">animation</span>:bhdr_for_big <span class="hljs-number">2s</span>;<br>  -webkit-<span class="hljs-attribute">animation</span>:bhdr_for_big <span class="hljs-number">2s</span>;<br>  <span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d;<br>  -webkit-<span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d ;<br>  <span class="hljs-attribute">backface-visibility</span>: hidden;<br>  -webkit-<span class="hljs-attribute">backface-visibility</span>: hidden;<br>  <span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000</span>;<br>  -webkit-<span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000</span>;<br>  <span class="hljs-attribute">animation-fill-mode</span>:forwards;<br>  -webkit-<span class="hljs-attribute">animation-fill-mode</span>:forwards;<br>  -webkit-<span class="hljs-attribute">animation-iteration-count</span>:<span class="hljs-number">1</span>;<br>  <span class="hljs-attribute">animation-iteration-count</span>:<span class="hljs-number">1</span>;<br>  <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">scale</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">scale</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);-webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-keyword">@keyframes</span>  bhdr_for_big<br>&#123;<br>  <span class="hljs-number">0%</span>  &#123;<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">scale</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">scale</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);-webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;&#125;<br>  <span class="hljs-number">50%</span>  &#123;<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">scale</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">scale</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);-webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;&#125;<br>  <span class="hljs-number">100%</span>  &#123;<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">scale</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">scale</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>);-webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">1</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">1</span>;&#125;<br>&#125;<br><br><span class="hljs-comment">/* 水平翻转淡入 */</span><br><span class="hljs-selector-class">.fzdr_for_sp</span> &#123;<br>  <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>  -webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>  <span class="hljs-attribute">animation</span>:fzdr_for_sp <span class="hljs-number">2s</span>;<br>  -webkit-<span class="hljs-attribute">animation</span>:fzdr_for_sp <span class="hljs-number">2s</span>;<br>  <span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d;<br>  -webkit-<span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d ;<br>  <span class="hljs-attribute">backface-visibility</span>: hidden;<br>  -webkit-<span class="hljs-attribute">backface-visibility</span>: hidden;<br>  <span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000</span>;<br>  -webkit-<span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000</span>;<br>  <span class="hljs-attribute">animation-fill-mode</span>:forwards;<br>  -webkit-<span class="hljs-attribute">animation-fill-mode</span>:forwards;<br>  -webkit-<span class="hljs-attribute">animation-iteration-count</span>:<span class="hljs-number">1</span>;<br>  <span class="hljs-attribute">animation-iteration-count</span>:<span class="hljs-number">1</span>;<br>  <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">rotateY</span>(<span class="hljs-number">180deg</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">rotateY</span>(<span class="hljs-number">180deg</span>);-webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;-webkit-<span class="hljs-attribute">backface-visibility</span>:visible;<span class="hljs-attribute">backface-visibility</span>:visible;<br>&#125;<br><span class="hljs-keyword">@keyframes</span>  fzdr_for_sp<br>&#123;<br>  <span class="hljs-number">0%</span>  &#123;<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">rotateY</span>(<span class="hljs-number">180deg</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">rotateY</span>(<span class="hljs-number">180deg</span>);-webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;-webkit-<span class="hljs-attribute">backface-visibility</span>:visible;<span class="hljs-attribute">backface-visibility</span>:visible&#125;<br>  <span class="hljs-number">50%</span>  &#123;<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">rotateY</span>(<span class="hljs-number">180deg</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">rotateY</span>(<span class="hljs-number">180deg</span>);-webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;-webkit-<span class="hljs-attribute">backface-visibility</span>:visible;<span class="hljs-attribute">backface-visibility</span>:visible&#125;<br>  <span class="hljs-number">100%</span>  &#123;<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">rotateY</span>(<span class="hljs-number">0deg</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">rotateY</span>(<span class="hljs-number">0deg</span>);-webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">1</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">1</span>;-webkit-<span class="hljs-attribute">backface-visibility</span>:visible;<span class="hljs-attribute">backface-visibility</span>:visible&#125;<br>&#125;<br><span class="hljs-comment">/* 垂直翻转淡入 */</span><br><span class="hljs-selector-class">.fzdr_for_cz</span> &#123;<br>  <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>  -webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>  <span class="hljs-attribute">animation</span>:fzdr_for_cz <span class="hljs-number">2s</span>;<br>  -webkit-<span class="hljs-attribute">animation</span>:fzdr_for_cz <span class="hljs-number">2s</span>;<br>  <span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d;<br>  -webkit-<span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d ;<br>  <span class="hljs-attribute">backface-visibility</span>: hidden;<br>  -webkit-<span class="hljs-attribute">backface-visibility</span>: hidden;<br>  <span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000</span>;<br>  -webkit-<span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000</span>;<br>  <span class="hljs-attribute">animation-fill-mode</span>:forwards;<br>  -webkit-<span class="hljs-attribute">animation-fill-mode</span>:forwards;<br>  -webkit-<span class="hljs-attribute">animation-iteration-count</span>:<span class="hljs-number">1</span>;<br>  <span class="hljs-attribute">animation-iteration-count</span>:<span class="hljs-number">1</span>;<br>  <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">rotateX</span>(<span class="hljs-number">720deg</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">rotateX</span>(<span class="hljs-number">720deg</span>);-webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;-webkit-<span class="hljs-attribute">backface-visibility</span>:visible;<span class="hljs-attribute">backface-visibility</span>:visible;<br>&#125;<br><span class="hljs-keyword">@keyframes</span>  fzdr_for_cz<br>&#123;<br>  <span class="hljs-number">0%</span>  &#123;<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">rotateX</span>(<span class="hljs-number">720deg</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">rotateX</span>(<span class="hljs-number">720deg</span>);-webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;-webkit-<span class="hljs-attribute">backface-visibility</span>:visible;<span class="hljs-attribute">backface-visibility</span>:visible&#125;<br>  <span class="hljs-number">50%</span>  &#123;<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">rotateX</span>(<span class="hljs-number">720deg</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">rotateX</span>(<span class="hljs-number">720deg</span>);-webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;-webkit-<span class="hljs-attribute">backface-visibility</span>:visible;<span class="hljs-attribute">backface-visibility</span>:visible&#125;<br>  <span class="hljs-number">100%</span>  &#123;<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">rotateX</span>(<span class="hljs-number">0deg</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">rotateX</span>(<span class="hljs-number">0deg</span>);-webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">1</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">1</span>;-webkit-<span class="hljs-attribute">backface-visibility</span>:visible;<span class="hljs-attribute">backface-visibility</span>:visible&#125;<br>&#125;<br><br><span class="hljs-comment">/* 首页效果 */</span><br><span class="hljs-selector-class">.index_adm</span>&#123;<br>  <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>  -webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>  <span class="hljs-attribute">animation</span>:index_adm <span class="hljs-number">3s</span>;<br>  -webkit-<span class="hljs-attribute">animation</span>:index_adm <span class="hljs-number">3s</span>;<br>  <span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d;<br>  -webkit-<span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d ;<br>  <span class="hljs-attribute">backface-visibility</span>: hidden;<br>  -webkit-<span class="hljs-attribute">backface-visibility</span>: hidden;<br>  <span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000</span>;<br>  -webkit-<span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000</span>;<br>  <span class="hljs-attribute">animation-fill-mode</span>:forwards;<br>  -webkit-<span class="hljs-attribute">animation-fill-mode</span>:forwards;<br>  -webkit-<span class="hljs-attribute">animation-iteration-count</span>:<span class="hljs-number">1</span>;<br>  <span class="hljs-attribute">animation-iteration-count</span>:<span class="hljs-number">1</span>;<br>  <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">scale</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">scale</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>&#125;<br><span class="hljs-keyword">@keyframes</span> index_adm<br>&#123;<br>  <span class="hljs-number">0%</span>  &#123; <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">scale</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">scale</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)<span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);&#125;<br>  <span class="hljs-number">50%</span>  &#123;<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">scale</span>(<span class="hljs-number">1.3</span>,<span class="hljs-number">1.3</span>)<span class="hljs-built_in">translate</span>(<span class="hljs-number">0.1rem</span>,-<span class="hljs-number">1rem</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">scale</span>(<span class="hljs-number">1.3</span>,<span class="hljs-number">1.3</span>)<span class="hljs-built_in">translate</span>(<span class="hljs-number">0.1rem</span>,-<span class="hljs-number">1rem</span>);-webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">1</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">1</span>;&#125;<br>  <span class="hljs-number">100%</span>  &#123;<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">scale</span>(<span class="hljs-number">100</span>,<span class="hljs-number">100</span>)<span class="hljs-built_in">translate</span>(<span class="hljs-number">0.1rem</span>,-<span class="hljs-number">1rem</span>);-webkit-<span class="hljs-attribute">transform</span>:<span class="hljs-built_in">scale</span>(<span class="hljs-number">100</span>,<span class="hljs-number">100</span>)<span class="hljs-built_in">translate</span>(<span class="hljs-number">0.1rem</span>,-<span class="hljs-number">1rem</span>);-webkit-<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">opacity</span>:<span class="hljs-number">0</span>;&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>echarts地图展示</p><img src="http://i2.bvimg.com/630937/8955b417522eedd3.png"/><p><a href="https://github.com/zhangyingxuan/my2017Demo">源码地址, 喜欢记得star哦</a></p><p><a href="https://github.com/zhangyingxuan/my2017Demo">https://github.com/zhangyingxuan/my2017Demo</a></p><ol start="2"><li><a href="https://zhangyingxuan.github.io/my2017Demo4Vue/dist/">vue-cli + mint-ui + css3</a></li></ol><p>使用mint-ui的轮播swipe组件，结合CSS3动画编写demo</p><p><a href="https://github.com/zhangyingxuan/my2017Demo4Vue">源码地址, 喜欢记得star哦</a></p><p><a href="https://github.com/zhangyingxuan/my2017Demo4Vue">https://github.com/zhangyingxuan/my2017Demo4Vue</a></p>]]></content>
    
    
    <categories>
      
      <category>CSS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vue</tag>
      
      <tag>前端</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2018-02-04-JS梳理</title>
    <link href="/2025/11/28/2018-02-04-JS%E6%A2%B3%E7%90%86/"/>
    <url>/2025/11/28/2018-02-04-JS%E6%A2%B3%E7%90%86/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><blockquote><p>由于项目需要，根据接口返回城市数据，标注国内地图城市点，这里记录实现过程，以备不时之需。</p></blockquote><h2 id="sessionStorage-localStorage"><a href="#sessionStorage-localStorage" class="headerlink" title="sessionStorage &amp;&amp; localStorage"></a>sessionStorage &amp;&amp; localStorage</h2><p>由于<code>sessionStorage &amp;&amp; localStorage</code> 仅能存储字符串类型的数据，对于实际开发中需要<br>常用的json对象的操作及其不变，这里对<code>sessionStorage &amp;&amp; localStorage</code>操作进行封装<br>供参考。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  获取 sessionStorage数据</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> <span class="hljs-variable">key</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span> &#123;<span class="hljs-type">&#123;</span>&#125;&#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getSessionStoreDataObj</span>(<span class="hljs-params">key</span>) &#123;<br>    <span class="hljs-keyword">var</span> responseObj = <span class="hljs-literal">undefined</span>;<br>    <span class="hljs-comment">// 判断浏览器是否支持sessionStorage</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">sessionStorage</span>) &#123;<br>        <span class="hljs-keyword">var</span> responseJson = <span class="hljs-variable language_">window</span>.<span class="hljs-property">sessionStorage</span>.<span class="hljs-title function_">getItem</span>(key);<br>        <span class="hljs-keyword">if</span> (responseJson != <span class="hljs-literal">null</span> &amp;&amp; responseJson != <span class="hljs-literal">undefined</span>) &#123;<br>            responseObj = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(responseJson);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> responseObj;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> <span class="hljs-variable">key</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> <span class="hljs-variable">value</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span> &#123;<span class="hljs-type">*</span>&#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">setSessionStoreData</span>(<span class="hljs-params">key, value</span>) &#123;<br>    <span class="hljs-keyword">var</span> isSuccess = <span class="hljs-literal">false</span>;<br>    <span class="hljs-comment">// 判断浏览器是否支持sessionStorage</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">sessionStorage</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isJSONStr</span>(value)) &#123;<br>            <span class="hljs-variable language_">window</span>.<span class="hljs-property">sessionStorage</span>.<span class="hljs-title function_">setItem</span>(key, value);<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isJsonObj</span>(value)) &#123;<br>            <span class="hljs-variable language_">window</span>.<span class="hljs-property">sessionStorage</span>.<span class="hljs-title function_">setItem</span>(key, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(value));<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">var</span> data = &#123;&#125;;<br>            data.<span class="hljs-property">data</span> = value;<br>            <span class="hljs-variable language_">window</span>.<span class="hljs-property">sessionStorage</span>.<span class="hljs-title function_">setItem</span>(key, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));<br>        &#125;<br>        isSuccess = <span class="hljs-literal">true</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> isSuccess;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  删除sessionStorage某一项item</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> <span class="hljs-variable">key</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">deleteSessionStoreItem</span>(<span class="hljs-params">key</span>) &#123;<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-property">sessionStorage</span>.<span class="hljs-title function_">removeItem</span>(key);<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  清空SessionStore</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">clearSessionStore</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-property">sessionStorage</span>.<span class="hljs-title function_">clear</span>();<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="deepCopy-对象的拷贝"><a href="#deepCopy-对象的拷贝" class="headerlink" title="deepCopy 对象的拷贝"></a>deepCopy 对象的拷贝</h2><p>前端开发过程中，操作对象的引用时，一不留神，会存在意想不到的结果，而<br>这结果往往是致命的。js引擎并未提供类似对象拷贝的方法，这里进行一个较为完善的封装。<br>利用递归对嵌套对象进行处理。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 对象的拷贝</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> <span class="hljs-variable">obj</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span> &#123;<span class="hljs-type">*</span>&#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">let</span> deepCopy = <span class="hljs-keyword">function</span>(<span class="hljs-params">obj</span>)&#123;<br>  <span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> obj !== <span class="hljs-string">&#x27;object&#x27;</span>)&#123;<br>    <span class="hljs-keyword">return</span> obj;<br>  &#125;<br>  <span class="hljs-keyword">var</span> newobj = &#123;&#125;;<br>  <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> attr <span class="hljs-keyword">in</span> obj) &#123;<br>    newobj[attr] = <span class="hljs-title function_">deepCopy</span>(obj[attr]);<br>  &#125;<br>  <span class="hljs-keyword">return</span> newobj;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="正则"><a href="#正则" class="headerlink" title="正则"></a>正则</h2><p>常用正则校验整理：</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-keyword">function</span> <span class="hljs-title function_">checkTempUserName</span>(<span class="hljs-params">name</span>) &#123;<br>    <span class="hljs-comment">//判断纯中文正则</span><br>    <span class="hljs-keyword">var</span> regexCHN = <span class="hljs-keyword">new</span> RegExp(<span class="hljs-string">&quot;^[\\u4E00-\\u9FA5]+$&quot;</span>);<br>    <span class="hljs-comment">//纯英文</span><br>    <span class="hljs-keyword">var</span> regexEN = <span class="hljs-keyword">new</span> RegExp(<span class="hljs-string">&quot;^[a-zA-Z]+$&quot;</span>);<br>    <span class="hljs-comment">//纯英文必须包含/且/在中间,中间可以包含空格</span><br>    <span class="hljs-comment">//如果全英文,则可以带/,最多出现1次/</span><br>    <span class="hljs-keyword">var</span> regexEN1 = <span class="hljs-keyword">new</span> RegExp(<span class="hljs-string">&quot;^[A-Za-z\\s*]+\\s*\\/\\s*[a-zA-Z\\s*]+$&quot;</span>);<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 匹配非特殊字符 包括字母和数字</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">var</span> regexNormal = <span class="hljs-keyword">new</span> RegExp(<span class="hljs-string">&quot;[a-zA-Z /]+$&quot;</span>);<br>    <span class="hljs-comment">//中文加字母</span><br>    <span class="hljs-keyword">var</span> regexEnChnEn = <span class="hljs-keyword">new</span> RegExp(<span class="hljs-string">&quot;^[A-Za-z]+[\\u4E00-\\u9FA5]+[A-Za-z]+$&quot;</span>);<br>    <span class="hljs-keyword">var</span> regexChnEn = <span class="hljs-keyword">new</span> RegExp(<span class="hljs-string">&quot;^[\\u4E00-\\u9FA5]+[A-Za-z]+$&quot;</span>);<br>    <span class="hljs-keyword">var</span> regexEnChn = <span class="hljs-keyword">new</span> RegExp(<span class="hljs-string">&quot;^[A-Za-z]+[\\u4E00-\\u9FA5]+$&quot;</span>);<br><br>    <span class="hljs-keyword">if</span> (name) &#123;<br>        <span class="hljs-keyword">if</span> (regexEnChnEn.test(name)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (regexEN.test(name)) &#123;<br>            <span class="hljs-comment">//纯英文</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (regexEnChn.test(name)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (regexCHN.test(name)) &#123;<br>            <span class="hljs-comment">//中文</span><br>            <span class="hljs-keyword">return</span> !(name.<span class="hljs-built_in">length</span> &lt; <span class="hljs-number">2</span> || name.<span class="hljs-built_in">length</span> &gt; <span class="hljs-number">16</span>);<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (regexChnEn.test(name)) &#123;<br>            <span class="hljs-comment">//中文+英文</span><br>            <span class="hljs-keyword">return</span> !(name.<span class="hljs-built_in">length</span> &lt; <span class="hljs-number">2</span> || name.<span class="hljs-built_in">length</span> &gt; <span class="hljs-number">32</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">//英文带/符合要求</span><br>            <span class="hljs-keyword">return</span> regexNormal.test(name) &amp;&amp; regexEN1.test(name) &amp;&amp; !(name.<span class="hljs-built_in">length</span> &lt; <span class="hljs-number">2</span> || name.<span class="hljs-built_in">length</span> &gt; <span class="hljs-number">32</span>);<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//检查传入内容是否为纯英文</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">checkPrueEnglish</span>(<span class="hljs-params">englishName</span>) &#123;<br>    <span class="hljs-comment">//纯英文</span><br>    <span class="hljs-keyword">var</span> regexEN = <span class="hljs-keyword">new</span> RegExp(<span class="hljs-string">&quot;^[a-zA-Z]+$&quot;</span>);<br>    <span class="hljs-keyword">return</span> regexEN.test(englishName);<br>&#125;<br><br><span class="hljs-comment">//检查手机号</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">checkPhone</span>(<span class="hljs-params">phone</span>) &#123;<br>    <span class="hljs-keyword">var</span> regex = <span class="hljs-keyword">new</span> RegExp(<span class="hljs-string">&quot;^1[0-9]&#123;10,12&#125;$&quot;</span>);<br>    <span class="hljs-keyword">return</span> regex.test(phone);<br>&#125;<br><br><span class="hljs-comment">//检查邮箱</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">checkEmail</span>(<span class="hljs-params">mail</span>) &#123;<br>    <span class="hljs-keyword">var</span> regex = <span class="hljs-keyword">new</span> RegExp(<span class="hljs-string">&quot;^\s*([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9_\-])+\.)+([a-zA-Z0-9]&#123;2,20&#125;)\s*$&quot;</span>);<br>    <span class="hljs-keyword">return</span> regex.test(mail);<br>&#125;<br><br><span class="hljs-comment">//检查护照</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">checkPassport</span>(<span class="hljs-params">pass</span>) &#123;<br>    <span class="hljs-keyword">var</span> regex = <span class="hljs-keyword">new</span> RegExp(<span class="hljs-string">&quot;^[A-Za-z0-9]&#123;1,50&#125;$&quot;</span>);<br>    <span class="hljs-keyword">return</span> regex.test(pass);<br>&#125;<br><br><span class="hljs-comment">//检查身份证</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">checkIdentityCode</span>(<span class="hljs-params">code</span>) &#123;<br>    <span class="hljs-keyword">var</span> city = &#123;<br>        <span class="hljs-number">11</span>: <span class="hljs-string">&quot;北京&quot;</span>,<br>        <span class="hljs-number">12</span>: <span class="hljs-string">&quot;天津&quot;</span>,<br>        <span class="hljs-number">13</span>: <span class="hljs-string">&quot;河北&quot;</span>,<br>        <span class="hljs-number">14</span>: <span class="hljs-string">&quot;山西&quot;</span>,<br>        <span class="hljs-number">15</span>: <span class="hljs-string">&quot;内蒙古&quot;</span>,<br>        <span class="hljs-number">21</span>: <span class="hljs-string">&quot;辽宁&quot;</span>,<br>        <span class="hljs-number">22</span>: <span class="hljs-string">&quot;吉林&quot;</span>,<br>        <span class="hljs-number">23</span>: <span class="hljs-string">&quot;黑龙江 &quot;</span>,<br>        <span class="hljs-number">31</span>: <span class="hljs-string">&quot;上海&quot;</span>,<br>        <span class="hljs-number">32</span>: <span class="hljs-string">&quot;江苏&quot;</span>,<br>        <span class="hljs-number">33</span>: <span class="hljs-string">&quot;浙江&quot;</span>,<br>        <span class="hljs-number">34</span>: <span class="hljs-string">&quot;安徽&quot;</span>,<br>        <span class="hljs-number">35</span>: <span class="hljs-string">&quot;福建&quot;</span>,<br>        <span class="hljs-number">36</span>: <span class="hljs-string">&quot;江西&quot;</span>,<br>        <span class="hljs-number">37</span>: <span class="hljs-string">&quot;山东&quot;</span>,<br>        <span class="hljs-number">41</span>: <span class="hljs-string">&quot;河南&quot;</span>,<br>        <span class="hljs-number">42</span>: <span class="hljs-string">&quot;湖北 &quot;</span>,<br>        <span class="hljs-number">43</span>: <span class="hljs-string">&quot;湖南&quot;</span>,<br>        <span class="hljs-number">44</span>: <span class="hljs-string">&quot;广东&quot;</span>,<br>        <span class="hljs-number">45</span>: <span class="hljs-string">&quot;广西&quot;</span>,<br>        <span class="hljs-number">46</span>: <span class="hljs-string">&quot;海南&quot;</span>,<br>        <span class="hljs-number">50</span>: <span class="hljs-string">&quot;重庆&quot;</span>,<br>        <span class="hljs-number">51</span>: <span class="hljs-string">&quot;四川&quot;</span>,<br>        <span class="hljs-number">52</span>: <span class="hljs-string">&quot;贵州&quot;</span>,<br>        <span class="hljs-number">53</span>: <span class="hljs-string">&quot;云南&quot;</span>,<br>        <span class="hljs-number">54</span>: <span class="hljs-string">&quot;西藏 &quot;</span>,<br>        <span class="hljs-number">61</span>: <span class="hljs-string">&quot;陕西&quot;</span>,<br>        <span class="hljs-number">62</span>: <span class="hljs-string">&quot;甘肃&quot;</span>,<br>        <span class="hljs-number">63</span>: <span class="hljs-string">&quot;青海&quot;</span>,<br>        <span class="hljs-number">64</span>: <span class="hljs-string">&quot;宁夏&quot;</span>,<br>        <span class="hljs-number">65</span>: <span class="hljs-string">&quot;新疆&quot;</span>,<br>        <span class="hljs-number">71</span>: <span class="hljs-string">&quot;台湾&quot;</span>,<br>        <span class="hljs-number">81</span>: <span class="hljs-string">&quot;香港&quot;</span>,<br>        <span class="hljs-number">82</span>: <span class="hljs-string">&quot;澳门&quot;</span>,<br>        <span class="hljs-number">91</span>: <span class="hljs-string">&quot;国外 &quot;</span><br>    &#125;;<br>    <span class="hljs-keyword">var</span> pass = <span class="hljs-literal">true</span>;<br><br>    <span class="hljs-keyword">if</span> (!code || !<span class="hljs-regexp">/^\d&#123;6&#125;(18|19|20)?\d&#123;2&#125;(0[1-9]|1[12])(0[1-9]|[12]\d|3[01])\d&#123;3&#125;(\d|X)$/i</span>.test(code)) &#123;<br>        pass = <span class="hljs-literal">false</span>;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!city[code.substr(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>)]) &#123;<br>        pass = <span class="hljs-literal">false</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">//18位身份证需要验证最后一位校验位</span><br>        <span class="hljs-keyword">if</span> (parseInt(code.<span class="hljs-built_in">length</span>) === <span class="hljs-number">18</span>) &#123;<br>            code = code.<span class="hljs-built_in">split</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>            <span class="hljs-comment">//∑(ai×Wi)(mod 11)</span><br>            <span class="hljs-comment">//加权因子</span><br>            <span class="hljs-keyword">var</span> factor = [<span class="hljs-number">7</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>, <span class="hljs-number">5</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">6</span>, <span class="hljs-number">3</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>, <span class="hljs-number">5</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>];<br>            <span class="hljs-comment">//校验位</span><br>            <span class="hljs-keyword">var</span> parity = [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;X&#x27;</span>, <span class="hljs-number">9</span>, <span class="hljs-number">8</span>, <span class="hljs-number">7</span>, <span class="hljs-number">6</span>, <span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>];<br>            <span class="hljs-keyword">var</span> <span class="hljs-built_in">sum</span> = <span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">var</span> ai = <span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">var</span> wi = <span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">17</span>; i++) &#123;<br>                ai = code[i];<br>                wi = factor[i];<br>                <span class="hljs-built_in">sum</span> += ai * wi;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (parity[<span class="hljs-built_in">sum</span> % <span class="hljs-number">11</span>] != code[<span class="hljs-number">17</span>]) &#123;<br>                pass = <span class="hljs-literal">false</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> pass;<br>&#125;<br><br><span class="hljs-comment">//18位身份证获取生日</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getBirthday</span>(<span class="hljs-params">idCard</span>) &#123;<br>    <span class="hljs-keyword">if</span> (idCard &amp;&amp; idCard.<span class="hljs-built_in">length</span> === <span class="hljs-number">18</span>) &#123;<br>        <span class="hljs-keyword">var</span> bir = idCard.substr(<span class="hljs-number">6</span>, <span class="hljs-number">4</span>);<br>        bir += <span class="hljs-string">&quot;-&quot;</span>;<br>        bir += idCard.substr(<span class="hljs-number">10</span>, <span class="hljs-number">2</span>);<br>        bir += <span class="hljs-string">&quot;-&quot;</span>;<br>        bir += idCard.substr(<span class="hljs-number">12</span>, <span class="hljs-number">2</span>);<br>        <span class="hljs-keyword">return</span> bir;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//身份证获取性别</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getSexFromIDCardMF</span>(<span class="hljs-params">cardId</span>) &#123;<br>    <span class="hljs-comment">//modify by yzhao 解决性别传递出错问题</span><br>    <span class="hljs-keyword">if</span> (cardId) &#123;<br>        <span class="hljs-keyword">var</span> sexCode = <span class="hljs-string">&quot;1&quot;</span>;<br>        <span class="hljs-keyword">if</span> (cardId.<span class="hljs-built_in">length</span> === <span class="hljs-string">&#x27;15&#x27;</span>) &#123;<br>            sexCode = cardId.substr(<span class="hljs-number">14</span>, <span class="hljs-number">15</span>);<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (cardId.<span class="hljs-built_in">length</span> === <span class="hljs-string">&#x27;18&#x27;</span>) &#123;<br>            <span class="hljs-comment">//18位身份证取第17位数</span><br>            sexCode = cardId.substr(<span class="hljs-number">16</span>, <span class="hljs-number">17</span>);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (Math.<span class="hljs-built_in">abs</span>(sexCode) % <span class="hljs-number">2</span> === <span class="hljs-string">&#x27;1&#x27;</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;M&quot;</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;F&quot;</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>&#125;<br><br><span class="hljs-comment">// 加密身份证件号</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">encryptIdInfo</span>(<span class="hljs-params">indenti</span>) &#123;<br>    <span class="hljs-keyword">var</span> result = <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-keyword">if</span> (indenti &amp;&amp; (indenti.<span class="hljs-built_in">length</span> === <span class="hljs-number">18</span> || indenti.<span class="hljs-built_in">length</span> === <span class="hljs-number">15</span>)) &#123;<br>        <span class="hljs-keyword">var</span> last = indenti.<span class="hljs-built_in">slice</span>(indenti.<span class="hljs-built_in">length</span> - <span class="hljs-number">4</span>);<br>        <span class="hljs-keyword">var</span> arr = [];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> m = <span class="hljs-number">0</span>; m &lt; indenti.<span class="hljs-built_in">length</span> - <span class="hljs-number">10</span>; m++) &#123;<br>            arr.<span class="hljs-built_in">push</span>(<span class="hljs-string">&quot;*&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">var</span> <span class="hljs-built_in">mid</span> = arr.join(<span class="hljs-string">&quot;&quot;</span>);<br>        <span class="hljs-keyword">var</span> <span class="hljs-built_in">first</span> = indenti.<span class="hljs-built_in">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">6</span>);<br>        result = <span class="hljs-built_in">first</span> + <span class="hljs-built_in">mid</span> + last;<br>    &#125;<br>    <span class="hljs-keyword">return</span> result;<br>&#125;<br><br><span class="hljs-comment">// 加密护照证件号</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">encryptPassportInfo</span>(<span class="hljs-params">passport</span>) &#123;<br>    <span class="hljs-keyword">var</span> result = <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-keyword">if</span> (passport &amp;&amp; passport.<span class="hljs-built_in">length</span> &gt; <span class="hljs-number">4</span>) &#123;<br>        <span class="hljs-keyword">var</span> lastString = passport.<span class="hljs-built_in">slice</span>(passport.<span class="hljs-built_in">length</span> - <span class="hljs-number">2</span>);<br>        <span class="hljs-keyword">var</span> <span class="hljs-built_in">array</span> = [];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; passport.<span class="hljs-built_in">length</span> - <span class="hljs-number">4</span>; j++) &#123;<br>            <span class="hljs-built_in">array</span>.<span class="hljs-built_in">push</span>(<span class="hljs-string">&quot;*&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">var</span> midString = <span class="hljs-built_in">array</span>.join(<span class="hljs-string">&quot;&quot;</span>);<br>        <span class="hljs-keyword">var</span> firstString = passport.<span class="hljs-built_in">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>);<br>        result = firstString + midString + lastString;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (passport) &#123;<br>        result = passport;<br>    &#125;<br>    <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>JavaScript</category>
      
    </categories>
    
    
    <tags>
      
      <tag>前端</tag>
      
      <tag>JavaScript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2018-01-28-vue-cli爬坑之路2</title>
    <link href="/2025/11/28/2018-02-5-VUE2.0%E6%9F%A5%E6%BC%8F%E8%A1%A5%E7%BC%BA/"/>
    <url>/2025/11/28/2018-02-5-VUE2.0%E6%9F%A5%E6%BC%8F%E8%A1%A5%E7%BC%BA/</url>
    
    <content type="html"><![CDATA[<blockquote></blockquote><span id="more"></span><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p>由于 JavaScript 的限制，Vue 不能检测以下变动的数组：</p><p>1、 当你利用索引直接设置一个项时，例如：vm.items[indexOfItem] &#x3D; newValue</p><p>2、 当你修改数组的长度时，例如：vm.items.length &#x3D; newLength</p><p>为了解决第一类问题，以下两种方式都可以实现和 vm.items[indexOfItem] &#x3D; newValue 相同的效果，同时也将触发状态更新：</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-string">//</span> Vue.<span class="hljs-keyword">set</span><br>Vue.<span class="hljs-keyword">set</span><span class="hljs-params">(example1.items, indexOfItem, newValue)</span><br></code></pre></td></tr></table></figure><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-comment">// Array.prototype.splice</span><br>example1<span class="hljs-selector-class">.items</span><span class="hljs-selector-class">.splice</span>(indexOfItem, <span class="hljs-number">1</span>, newValue)<br></code></pre></td></tr></table></figure><p>为了解决第二类问题，你可以使用 splice：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">example1<span class="hljs-selector-class">.items</span><span class="hljs-selector-class">.splice</span>(newLength)<br></code></pre></td></tr></table></figure><blockquote><p>对象更改检测注意事项</p></blockquote><p>还是由于 JavaScript 的限制，Vue 不能检测对象属性的添加或删除：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-tag">var</span> vm = new <span class="hljs-built_in">Vue</span>(&#123;<br> data: &#123;<br>   <span class="hljs-selector-tag">a</span>: <span class="hljs-number">1</span><br> &#125;<br>&#125;)<br><span class="hljs-comment">// `vm.a` 现在是响应式的</span><br><br>vm<span class="hljs-selector-class">.b</span> = <span class="hljs-number">2</span><br><span class="hljs-comment">// `vm.b` 不是响应式的</span><br></code></pre></td></tr></table></figure><p>对于已经创建的实例，Vue 不能动态添加根级别的响应式属性。但是，可以使用 Vue.set(object, key, value) 方法向嵌套对象添加响应式属性。例如，对于：</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-title">var</span> vm = new <span class="hljs-type">Vue</span>(&#123;<br> <span class="hljs-class"><span class="hljs-keyword">data</span>: &#123;</span><br><span class="hljs-class">   <span class="hljs-title">userProfile</span>: &#123;</span><br><span class="hljs-class">     <span class="hljs-title">name</span>: &#x27;<span class="hljs-type">Anika</span>&#x27;</span><br><span class="hljs-class">   &#125;</span><br> &#125;<br>&#125;)<br></code></pre></td></tr></table></figure><p>你可以添加一个新的 age 属性到嵌套的 userProfile 对象：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">Vue.<span class="hljs-built_in">set</span>(vm.userProfile, <span class="hljs-string">&#x27;age&#x27;</span>, 27)<br></code></pre></td></tr></table></figure><p>你还可以使用 vm.$set 实例方法，它只是全局 Vue.set 的别名：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">vm</span>.$<span class="hljs-keyword">set</span>(<span class="hljs-keyword">vm</span>.userProfile, <span class="hljs-string">&#x27;age&#x27;</span>, <span class="hljs-number">27</span>)<br></code></pre></td></tr></table></figure><h2 id="v-for-with-v-if"><a href="#v-for-with-v-if" class="headerlink" title="v-for with v-if"></a>v-for with v-if</h2><p>当它们处于同一节点，v-for 的优先级比 v-if 更高，这意味着 v-if 将分别重复运行于每个 v-for 循环中。当你想为仅有的一些项渲染节点时，这种优先级的机制会十分有用，如下：</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;todo in todos&quot;</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;!todo.isComplete&quot;</span>&gt;</span></span><br><span class="language-xml">  </span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">todo</span> &#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br></code></pre></td></tr></table></figure><h2 id="v-for-时，key"><a href="#v-for-时，key" class="headerlink" title="v-for 时，key"></a>v-for 时，key</h2><p>2.2.0+ 的版本里，当在组件中使用 v-for 时，key 现在是必须的。</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">v-for</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;(value，index)in obj” :key=&quot;</span>index<span class="hljs-string">&quot;</span><br></code></pre></td></tr></table></figure><h2 id=""><a href="#" class="headerlink" title=""></a></h2><div id="todo-list-example">  <input    v-model="newTodoText"    v-on:keyup.enter="addNewTodo"    placeholder="Add a todo"  >  <ul>    <li      is="todo-item"      v-for="(todo, index) in todos"      v-bind:key="todo.id"      v-bind:title="todo.title"      v-on:remove="todos.splice(index, 1)"    ></li>  </ul></div><h2 id="这个-passive-修饰符尤其能够提升移动端的性能。"><a href="#这个-passive-修饰符尤其能够提升移动端的性能。" class="headerlink" title="这个 .passive 修饰符尤其能够提升移动端的性能。"></a>这个 .passive 修饰符尤其能够提升移动端的性能。</h2><p>Vue 还对应 addEventListener 中的 passive 选项提供了 .passive 修饰符。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 滚动事件的默认行为 (即滚动行为) 将会立即触发 --&gt;</span><br><span class="hljs-comment">&lt;!-- 而不会等待 `onScroll` 完成  --&gt;</span><br><span class="hljs-comment">&lt;!-- 这其中包含 `event.preventDefault()` 的情况 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-on:scroll.passive</span>=<span class="hljs-string">&quot;onScroll&quot;</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="event"><a href="#event" class="headerlink" title="$event"></a>$event</h2><p>有时也需要在内联语句处理器中访问原始的 DOM 事件。可以用特殊变量 $event 把它传入方法：</p><figure class="highlight hsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs hsp">&lt;<span class="hljs-keyword">button</span> v-<span class="hljs-keyword">on</span>:click=<span class="hljs-string">&quot;warn(&#x27;Form cannot be submitted yet.&#x27;, $event)&quot;</span>&gt;<br>  Submit<br>&lt;/<span class="hljs-keyword">button</span>&gt;<br></code></pre></td></tr></table></figure><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-comment">// ...</span><br>methods: &#123;<br>  warn: function (message, event) &#123;<br>    <span class="hljs-comment">// 现在我们可以访问原生事件对象</span><br>    if (event) event<span class="hljs-selector-class">.preventDefault</span>()<br>    <span class="hljs-built_in">alert</span>(message)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vue</tag>
      
      <tag>前端</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2018-01-28-vue-cli爬坑之路2</title>
    <link href="/2025/11/28/2018-02-5-vue-cli%E7%88%AC%E5%9D%91%E4%B9%8B%E8%B7%AF3-%E9%97%AE%E9%A2%98%E9%9B%86/"/>
    <url>/2025/11/28/2018-02-5-vue-cli%E7%88%AC%E5%9D%91%E4%B9%8B%E8%B7%AF3-%E9%97%AE%E9%A2%98%E9%9B%86/</url>
    
    <content type="html"><![CDATA[<blockquote></blockquote><span id="more"></span><h1 id="创建阶段"><a href="#创建阶段" class="headerlink" title="创建阶段"></a>创建阶段</h1><h2 id="1-静态资源引用-图片、字体"><a href="#1-静态资源引用-图片、字体" class="headerlink" title="1. 静态资源引用(图片、字体)"></a>1. 静态资源引用(图片、字体)</h2><h2 id="2-跨域问题"><a href="#2-跨域问题" class="headerlink" title="2. 跨域问题"></a>2. 跨域问题</h2><h2 id="3-打包空白页"><a href="#3-打包空白页" class="headerlink" title="3. 打包空白页"></a>3. 打包空白页</h2><p>1、PC浏览器加载空白<br>【<a href="http://blog.csdn.net/xjlinme/article/details/74783887%E3%80%91">http://blog.csdn.net/xjlinme/article/details/74783887】</a></p><p>history: mode</p><p>2、手机浏览器空白，android、IOS webview加载空白</p><p>情况1.<br>[关键]<br>由于使用了在static文件夹下的js的文件中使用了es6语法 而该目录下是不会被babel转换的 移动端设备有些不支持es6语法 就会出错 无法渲染。</p><p>发现了组件中引入了外部js插件路径不可以在static底下的问题，修改在src底下后就成功访问了。<br>不要再static目录下的文件中写ES6的语法，vue-cli不会编译该目录，不会自动转为ES5支持、</p><p>情况2.</p><p>使用 vue-cli 搭建的项目，PC上火狐和谷歌浏览器打开正常，使用浏览器开发者工具模拟移动端浏览也正常，OPPO 坚果 真机浏览也正常，但老的华为手机和荣耀手机打开是白屏。</p><p>在网上查询一段时间后，使用 babel-polyfill 对ES6语法转成ES5语法，打包后上线问题依旧</p><p>最后使用排除法定位到问题，问题代码如下</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;input <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;noPwd&quot;</span> <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;pwd&quot;</span> <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;base-radio&quot;</span> <span class="hljs-attribute">type</span>=<span class="hljs-string">&quot;radio&quot;</span> :<span class="hljs-attribute">value</span>=<span class="hljs-string">&quot;false&quot;</span> <span class="hljs-attribute">v-model</span>=<span class="hljs-string">&quot;formDatas.serverIsPwd&quot;</span> <span class="hljs-attribute">v-validate</span>=<span class="hljs-string">&quot;&#x27;required&#x27;&quot;</span> /&gt;<br></code></pre></td></tr></table></figure><p>在华为手机和低版本荣耀手机上， input 标签如果有 v-model 属性的情况下，还有 :value 属性，就会出现白屏，如果 input 要使用默认值， 不要动态绑定数据，直接使用 value 属性</p><p>1、排查MUI<br>2、打包路径、配置项变更<br>3、static静态资源<br>4、打包环境<br>5、ES6语法支持</p><h2 id="4-浮层事件穿透"><a href="#4-浮层事件穿透" class="headerlink" title="4. 浮层事件穿透"></a>4. 浮层事件穿透</h2><p>快速点击问题</p><h2 id="5-委托事件解绑，单页多次绑定事件"><a href="#5-委托事件解绑，单页多次绑定事件" class="headerlink" title="5. 委托事件解绑，单页多次绑定事件"></a>5. 委托事件解绑，单页多次绑定事件</h2><h2 id="6、fastclick与mint-ui-loadmore-轻触点击"><a href="#6、fastclick与mint-ui-loadmore-轻触点击" class="headerlink" title="6、fastclick与mint-ui loadmore 轻触点击"></a>6、fastclick与mint-ui loadmore 轻触点击</h2><h2 id="初级错误"><a href="#初级错误" class="headerlink" title="初级错误"></a>初级错误</h2><p>router与route</p><h2 id="vuex误改state"><a href="#vuex误改state" class="headerlink" title="vuex误改state"></a>vuex误改state</h2><p>深拷贝方法：1、Object.asign 2、.json.stringfy JSON.parse 3、递归遍历</p><h2 id="缓存-keep-alive跨父组件模块-失效"><a href="#缓存-keep-alive跨父组件模块-失效" class="headerlink" title="缓存 keep-alive跨父组件模块 失效"></a>缓存 keep-alive跨父组件模块 失效</h2><h2 id="数组元素-为对象，对象属性变更，为渲染界面"><a href="#数组元素-为对象，对象属性变更，为渲染界面" class="headerlink" title="数组元素 为对象，对象属性变更，为渲染界面"></a>数组元素 为对象，对象属性变更，为渲染界面</h2><h2 id="vue中使用sass定义的变量"><a href="#vue中使用sass定义的变量" class="headerlink" title="vue中使用sass定义的变量"></a>vue中使用sass定义的变量</h2><p>安装【 sass-resources-loader】<br><a href="https://www.cnblogs.com/w2xh/p/8196112.html">https://www.cnblogs.com/w2xh/p/8196112.html</a></p>]]></content>
    
    
    <categories>
      
      <category>vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vue</tag>
      
      <tag>前端</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2019-03-28-百度地图接入及使用</title>
    <link href="/2025/11/28/2019-03-28-%E7%99%BE%E5%BA%A6%E5%9C%B0%E5%9B%BEmapv%E6%8E%A5%E5%85%A5%E5%8F%8A%E4%BD%BF%E7%94%A8/"/>
    <url>/2025/11/28/2019-03-28-%E7%99%BE%E5%BA%A6%E5%9C%B0%E5%9B%BEmapv%E6%8E%A5%E5%85%A5%E5%8F%8A%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<blockquote></blockquote><span id="more"></span><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p> 近期工作中涉及大量百度mapv使用。其中包含，汇聚图效果、动态街道路径效果、动态热力图效果。</p><h2 id="百度mapv引入"><a href="#百度mapv引入" class="headerlink" title="百度mapv引入"></a>百度mapv引入</h2><p><a href="https://mapv.baidu.com/examples/#baidu-map-polyline-time.html">mapv示例文档</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://mapv.baidu.com/build/mapv.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="热力图"><a href="#热力图" class="headerlink" title="热力图"></a>热力图</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">/**</span><br><span class="hljs-comment">*  绘制热力图</span><br><span class="hljs-comment">*/</span><br><span class="hljs-title function_">drowHotDary</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">var</span> randomCount = <span class="hljs-number">600</span>;<br>    <span class="hljs-keyword">var</span> data = [];        <span class="hljs-comment">// 清除所有遮盖物</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">clearCurrentBoundCity</span>()<br>    <br>    <span class="hljs-comment">// 构造数据</span><br>    <span class="hljs-keyword">while</span> (randomCount--) &#123;<br>      <span class="hljs-keyword">var</span> cityCenter = mapv.<span class="hljs-property">utilCityCenter</span>.<span class="hljs-title function_">getCenterByCityName</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">hotMapcitys</span>[<span class="hljs-built_in">parseInt</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-variable language_">this</span>.<span class="hljs-property">hotMapcitys</span>.<span class="hljs-property">length</span>)]);<br>      data.<span class="hljs-title function_">push</span>(&#123;<br>        <span class="hljs-attr">geometry</span>: &#123;<br>          <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;Point&#x27;</span>,<br>          <span class="hljs-attr">coordinates</span>: [cityCenter.<span class="hljs-property">lng</span> - <span class="hljs-number">2</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">2</span>, cityCenter.<span class="hljs-property">lat</span> - <span class="hljs-number">2</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">2</span>]<br>        &#125;,<br>        <span class="hljs-attr">count</span>: <span class="hljs-number">30</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>(),<br>        <span class="hljs-attr">time</span>: <span class="hljs-number">100</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()<br>      &#125;);<br>    &#125;<br>    <br>    <span class="hljs-keyword">var</span> dataSet = <span class="hljs-keyword">new</span> mapv.<span class="hljs-title class_">DataSet</span>(data);<br>    <br>    <span class="hljs-keyword">var</span> options = &#123;<br>      <span class="hljs-attr">size</span>: <span class="hljs-number">13</span>,<br>      <span class="hljs-attr">gradient</span>: &#123; <span class="hljs-number">0.25</span>: <span class="hljs-string">&quot;rgb(0,0,255)&quot;</span>, <span class="hljs-number">0.55</span>: <span class="hljs-string">&quot;rgb(0,255,0)&quot;</span>, <span class="hljs-number">0.85</span>: <span class="hljs-string">&quot;yellow&quot;</span>, <span class="hljs-number">1.0</span>: <span class="hljs-string">&quot;rgb(255,0,0)&quot;</span>&#125;,<br>      <span class="hljs-attr">max</span>: <span class="hljs-number">60</span>,<br>      <span class="hljs-attr">animation</span>: &#123;<br>        <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;time&#x27;</span>,<br>        <span class="hljs-attr">stepsRange</span>: &#123;<br>          <span class="hljs-attr">start</span>: <span class="hljs-number">0</span>,<br>          <span class="hljs-attr">end</span>: <span class="hljs-number">100</span><br>        &#125;,<br>        <span class="hljs-attr">trails</span>: <span class="hljs-number">10</span>,<br>        <span class="hljs-attr">duration</span>: <span class="hljs-number">10</span>,<br>      &#125;,<br>      <span class="hljs-attr">draw</span>: <span class="hljs-string">&#x27;heatmap&#x27;</span><br>    &#125;<br>    <br>    <span class="hljs-keyword">var</span> mapvLayer = <span class="hljs-keyword">new</span> mapv.<span class="hljs-title function_">baiduMapLayer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>, dataSet, options);<br>&#125;,<br></code></pre></td></tr></table></figure><h2 id="汇聚图效果"><a href="#汇聚图效果" class="headerlink" title="汇聚图效果"></a>汇聚图效果</h2><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  汇聚图</span><br><span class="hljs-comment"> */</span><br>drawConvergenceMap() &#123;<br>  <span class="hljs-keyword">var</span> randomCount = <span class="hljs-number">100</span>;<br><br>  <span class="hljs-keyword">var</span> node_data = &#123;<br>    <span class="hljs-string">&quot;0&quot;</span>:&#123;<span class="hljs-string">&quot;x&quot;</span>:<span class="hljs-number">116.4136103013</span>, <span class="hljs-string">&quot;y&quot;</span>:<span class="hljs-number">39.9110666857</span>&#125;,<br>    <span class="hljs-string">&quot;1&quot;</span>:&#123;<span class="hljs-string">&quot;x&quot;</span>:<span class="hljs-number">121.485124</span>, <span class="hljs-string">&quot;y&quot;</span>:<span class="hljs-number">31.235317</span>&#125;,<br>  &#125;;<br><br>  <span class="hljs-keyword">var</span> edge_data = [<br>    &#123;<span class="hljs-string">&quot;source&quot;</span>:<span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;target&quot;</span>:<span class="hljs-string">&quot;0&quot;</span>&#125;<br>  ]<br><br>  <span class="hljs-keyword">var</span> citys = [<span class="hljs-string">&quot;承德&quot;</span>, <span class="hljs-string">&quot;莆田&quot;</span>, <span class="hljs-string">&quot;宜昌&quot;</span>,<span class="hljs-string">&quot;重庆&quot;</span>];<br><br>  <span class="hljs-comment">// 构造数据</span><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">1</span>; i &lt; randomCount; i++) &#123;<br>    <span class="hljs-keyword">var</span> cityCenter = mapv.utilCityCenter.getCenterByCityName(citys[parseInt(Math.<span class="hljs-built_in">random</span>() * citys.<span class="hljs-built_in">length</span>)]);<br>    node_data[i] = &#123;<br>      <span class="hljs-attr">x</span>: cityCenter.lng - <span class="hljs-number">5</span> + Math.<span class="hljs-built_in">random</span>() * <span class="hljs-number">10</span>,<br>      <span class="hljs-attr">y</span>: cityCenter.lat - <span class="hljs-number">5</span> + Math.<span class="hljs-built_in">random</span>() * <span class="hljs-number">10</span>,<br>    &#125;<br>    edge_data.<span class="hljs-built_in">push</span>(<br>      &#123;<span class="hljs-string">&quot;source&quot;</span>: ~~(i * Math.<span class="hljs-built_in">random</span>()), <span class="hljs-string">&quot;target&quot;</span>: <span class="hljs-string">&#x27;0&#x27;</span>&#125;<br>    );<br>  &#125;<br><br>  <span class="hljs-keyword">var</span> fbundling = mapv.utilForceEdgeBundling()<br>    .nodes(node_data)<br>    .edges(edge_data);<br><br>  <span class="hljs-keyword">var</span> results = fbundling();<br><br>  <span class="hljs-keyword">var</span> data = [];<br>  <span class="hljs-keyword">var</span> timeData = [];<br><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; results.<span class="hljs-built_in">length</span>; i++) &#123;<br>    <span class="hljs-keyword">var</span> line = results[i];<br>    <span class="hljs-keyword">var</span> coordinates = [];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; line.<span class="hljs-built_in">length</span>; j++) &#123;<br>      coordinates.<span class="hljs-built_in">push</span>([line[j].x, line[j].y]);<br>      timeData.<span class="hljs-built_in">push</span>(&#123;<br>        <span class="hljs-attr">geometry</span>: &#123;<br>          <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;Point&#x27;</span>,<br>          <span class="hljs-attr">coordinates</span>: [line[j].x, line[j].y]<br>        &#125;,<br>        <span class="hljs-attr">count</span>: <span class="hljs-number">1</span>,<br>        <span class="hljs-attr">time</span>: j<br>      &#125;);<br>    &#125;<br>    data.<span class="hljs-built_in">push</span>(&#123;<br>      <span class="hljs-attr">geometry</span>: &#123;<br>        <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;LineString&#x27;</span>,<br>        <span class="hljs-attr">coordinates</span>: coordinates<br>      &#125;<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-keyword">var</span> dataSet = <span class="hljs-keyword">new</span> mapv.DataSet(data);<br><br>  <span class="hljs-keyword">var</span> options = &#123;<br>    <span class="hljs-attr">strokeStyle</span>: <span class="hljs-string">&#x27;rgba(55, 50, 250, 0.3)&#x27;</span>,<br>    <span class="hljs-attr">globalCompositeOperation</span>: <span class="hljs-string">&#x27;lighter&#x27;</span>,<br>    <span class="hljs-attr">shadowColor</span>: <span class="hljs-string">&#x27;rgba(55, 50, 250, 0.5)&#x27;</span>,<br>    <span class="hljs-attr">shadowBlur</span>: <span class="hljs-number">10</span>,<br>    <span class="hljs-attr">methods</span>: &#123;<br>      <span class="hljs-attr">click</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) &#123;<br>      &#125;<br>    &#125;,<br>    <span class="hljs-attr">lineWidth</span>: <span class="hljs-number">1.0</span>,<br>    <span class="hljs-attr">draw</span>: <span class="hljs-string">&#x27;simple&#x27;</span><br>  &#125;<br><br>  <span class="hljs-keyword">var</span> mapvLayer = <span class="hljs-keyword">new</span> mapv.baiduMapLayer(this.<span class="hljs-built_in">map</span>, dataSet, options);<br><br>  <span class="hljs-keyword">var</span> dataSet = <span class="hljs-keyword">new</span> mapv.DataSet(timeData);<br><br>  <span class="hljs-keyword">var</span> options = &#123;<br>    <span class="hljs-attr">fillStyle</span>: <span class="hljs-string">&#x27;rgba(255, 250, 250, 0.9)&#x27;</span>,<br>    <span class="hljs-attr">globalCompositeOperation</span>: <span class="hljs-string">&#x27;lighter&#x27;</span>,<br>    <span class="hljs-attr">size</span>: <span class="hljs-number">1.5</span>,<br>    <span class="hljs-attr">animation</span>: &#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;time&#x27;</span>,<br>      <span class="hljs-attr">stepsRange</span>: &#123;<br>        <span class="hljs-attr">start</span>: <span class="hljs-number">0</span>,<br>        <span class="hljs-attr">end</span>: <span class="hljs-number">100</span><br>      &#125;,<br>      <span class="hljs-attr">trails</span>: <span class="hljs-number">1</span>,<br>      <span class="hljs-attr">duration</span>: <span class="hljs-number">5</span>,<br>    &#125;,<br>    <span class="hljs-attr">draw</span>: <span class="hljs-string">&#x27;simple&#x27;</span><br>  &#125;<br><br>  <span class="hljs-keyword">var</span> mapvLayer = <span class="hljs-keyword">new</span> mapv.baiduMapLayer(this.<span class="hljs-built_in">map</span>, dataSet, options);<br>&#125;,<br></code></pre></td></tr></table></figure><h2 id="航线图"><a href="#航线图" class="headerlink" title="航线图"></a>航线图</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">/**</span><br><span class="hljs-comment">*  绘制航线图</span><br><span class="hljs-comment">*/</span><br><span class="hljs-title function_ invoke__">drawHangxian</span>(scenicSpot) &#123;<br>    <span class="hljs-keyword">var</span> to = <span class="hljs-string">&#x27;重庆&#x27;</span>;<br>     <span class="hljs-keyword">var</span> qianxi = <span class="hljs-keyword">new</span> mapv.<span class="hljs-title function_ invoke__">DataSet</span>(scenicSpot);<br>     <span class="hljs-keyword">var</span> qianxiData = qianxi.<span class="hljs-title function_ invoke__">get</span>();<br>     <br>     <span class="hljs-keyword">var</span> lineData = [];<br>     <span class="hljs-keyword">var</span> pointData = [];<br>     <span class="hljs-keyword">var</span> textData = [];<br>     <span class="hljs-keyword">var</span> timeData = [];<br>     <br>     <span class="hljs-keyword">var</span> citys = &#123;&#125;<br>     <br>     <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; qianxiData.length; i++) &#123;<br>       <span class="hljs-keyword">var</span> fromCenter = mapv.utilCityCenter.<span class="hljs-title function_ invoke__">getCenterByCityName</span>(qianxiData[i].<span class="hljs-keyword">from</span>);<br>       <span class="hljs-keyword">var</span> toCenter = mapv.utilCityCenter.<span class="hljs-title function_ invoke__">getCenterByCityName</span>(to);<br>       <span class="hljs-keyword">if</span> (!fromCenter || !toCenter) &#123;<br>         <span class="hljs-keyword">continue</span>;<br>       &#125;<br>       citys[qianxiData[i].<span class="hljs-keyword">from</span>] = qianxiData[i].count;<br>       citys[to] = <span class="hljs-number">100</span>;<br>       pointData.<span class="hljs-title function_ invoke__">push</span>(<br>         &#123;<br>           <span class="hljs-attr">geometry</span>: &#123;<br>             <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;Point&#x27;</span>,<br>             <span class="hljs-attr">coordinates</span>: [fromCenter.lng, fromCenter.lat]<br>           &#125;<br>         &#125;<br>       );<br>       pointData.<span class="hljs-title function_ invoke__">push</span>(<br>         &#123;<br>           <span class="hljs-attr">geometry</span>: &#123;<br>             <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;Point&#x27;</span>,<br>             <span class="hljs-attr">coordinates</span>: [toCenter.lng, toCenter.lat]<br>           &#125;<br>         &#125;<br>       );<br>       textData.<span class="hljs-title function_ invoke__">push</span>(<br>         &#123;<br>           <span class="hljs-attr">geometry</span>: &#123;<br>             <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;Point&#x27;</span>,<br>             <span class="hljs-attr">coordinates</span>: [fromCenter.lng, fromCenter.lat]<br>           &#125;,<br>           <span class="hljs-attr">text</span>: qianxiData[i].<span class="hljs-keyword">from</span><br>         &#125;<br>       );<br>       textData.<span class="hljs-title function_ invoke__">push</span>(<br>         &#123;<br>           <span class="hljs-attr">geometry</span>: &#123;<br>             <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;Point&#x27;</span>,<br>             <span class="hljs-attr">coordinates</span>: [toCenter.lng, toCenter.lat]<br>           &#125;,<br>           <span class="hljs-attr">text</span>: to<br>         &#125;<br>       );<br>     <br>       <span class="hljs-keyword">var</span> curve = mapv.utilCurve.<span class="hljs-title function_ invoke__">getPoints</span>([fromCenter, toCenter]);<br>     <br>       <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; curve.length; j++) &#123;<br>         timeData.<span class="hljs-title function_ invoke__">push</span>(&#123;<br>           <span class="hljs-attr">geometry</span>: &#123;<br>             <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;Point&#x27;</span>,<br>             <span class="hljs-attr">coordinates</span>: curve[j]<br>           &#125;,<br>           <span class="hljs-attr">count</span>: <span class="hljs-number">1</span>,<br>           <span class="hljs-attr">time</span>: j<br>         &#125;);<br>       &#125;<br>     <br>       lineData.<span class="hljs-title function_ invoke__">push</span>(&#123;<br>         <span class="hljs-attr">geometry</span>: &#123;<br>           <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;LineString&#x27;</span>,<br>           <span class="hljs-attr">coordinates</span>: curve<br>           //<span class="hljs-attr">coordinates</span>: [[fromCenter.lng, fromCenter.lat], [toCenter.lng, toCenter.lat]]<br>         &#125;,<br>         <span class="hljs-attr">count</span>: <span class="hljs-number">30</span> * Math.<span class="hljs-title function_ invoke__">random</span>()<br>       &#125;);<br>     <br>     &#125;<br>     <br>     <span class="hljs-keyword">var</span> textDataSet = <span class="hljs-keyword">new</span> mapv.<span class="hljs-title function_ invoke__">DataSet</span>(textData);<br>     <br>     <span class="hljs-keyword">var</span> textOptions = &#123;<br>       draw: <span class="hljs-string">&#x27;text&#x27;</span>,<br>       font: <span class="hljs-string">&#x27;14px Arial&#x27;</span>,<br>       fillStyle: <span class="hljs-string">&#x27;white&#x27;</span>,<br>       shadowColor: <span class="hljs-string">&#x27;yellow&#x27;</span>,<br>       shadowBlue: <span class="hljs-number">10</span>,<br>       zIndex: <span class="hljs-number">11</span>,<br>       shadowBlur: <span class="hljs-number">10</span><br>     &#125;<br>     <br>     <span class="hljs-keyword">var</span> textMapvLayer = <span class="hljs-keyword">new</span> mapv.<span class="hljs-title function_ invoke__">baiduMapLayer</span>(this.map, textDataSet, textOptions);<br>     <br>     <span class="hljs-keyword">var</span> lineDataSet = <span class="hljs-keyword">new</span> mapv.<span class="hljs-title function_ invoke__">DataSet</span>(lineData);<br>     <br>     <span class="hljs-keyword">var</span> lineOptions = &#123;<br>       strokeStyle: <span class="hljs-string">&#x27;rgba(255, 250, 50, 0.8)&#x27;</span>,<br>       shadowColor: <span class="hljs-string">&#x27;rgba(255, 250, 50, 1)&#x27;</span>,<br>       shadowBlur: <span class="hljs-number">20</span>,<br>       lineWidth: <span class="hljs-number">2</span>,<br>       zIndex: <span class="hljs-number">100</span>,<br>       draw: <span class="hljs-string">&#x27;simple&#x27;</span><br>     &#125;<br>     <br>     <span class="hljs-keyword">var</span> lineLayer = <span class="hljs-keyword">new</span> mapv.<span class="hljs-title function_ invoke__">baiduMapLayer</span>(this.map, lineDataSet, lineOptions);<br>     <br>     <span class="hljs-comment">// 描绘点</span><br>     <span class="hljs-keyword">var</span> pointOptions = &#123;<br>       fillStyle: <span class="hljs-string">&#x27;rgba(254,175,3,0.7)&#x27;</span>,<br>       shadowColor: <span class="hljs-string">&#x27;rgba(55, 50, 250, 0.5)&#x27;</span>,<br>       shadowBlur: <span class="hljs-number">10</span>,<br>       size: <span class="hljs-number">5</span>,<br>       zIndex: <span class="hljs-number">10</span>,<br>       draw: <span class="hljs-string">&#x27;simple&#x27;</span><br>     &#125;<br>     <br>     <span class="hljs-keyword">var</span> pointDataSet = <span class="hljs-keyword">new</span> mapv.<span class="hljs-title function_ invoke__">DataSet</span>(pointData);<br>     <br>     <span class="hljs-keyword">var</span> pointLayer = <span class="hljs-keyword">new</span> mapv.<span class="hljs-title function_ invoke__">baiduMapLayer</span>(this.map, pointDataSet, pointOptions);<br>     <br>     <span class="hljs-comment">// 动态效果</span><br>     <span class="hljs-keyword">var</span> timeDataSet = <span class="hljs-keyword">new</span> mapv.<span class="hljs-title function_ invoke__">DataSet</span>(timeData);<br>     <br>     <span class="hljs-keyword">var</span> timeOptions = &#123;<br>       fillStyle: <span class="hljs-string">&#x27;rgba(255, 250, 250, 0.5)&#x27;</span>,<br>       zIndex: <span class="hljs-number">200</span>,<br>       size: <span class="hljs-number">2.5</span>,<br>       animation: &#123;<br>         type: <span class="hljs-string">&#x27;time&#x27;</span>,<br>         stepsRange: &#123;<br>           start: <span class="hljs-number">0</span>,<br>           end: <span class="hljs-number">50</span><br>         &#125;,<br>         trails: <span class="hljs-number">10</span>,<br>         duration: <span class="hljs-number">2</span>,<br>       &#125;,<br>       draw: <span class="hljs-string">&#x27;simple&#x27;</span><br>     &#125;<br>     <br>     <span class="hljs-keyword">var</span> timeMapvLayer = <span class="hljs-keyword">new</span> mapv.<span class="hljs-title function_ invoke__">baiduMapLayer</span>(this.map, timeDataSet, timeOptions);<br>&#125;,<br></code></pre></td></tr></table></figure><h2 id="动态街道路径效果"><a href="#动态街道路径效果" class="headerlink" title="动态街道路径效果"></a>动态街道路径效果</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">/**</span><br><span class="hljs-comment">*  显示航线图</span><br><span class="hljs-comment">*/</span><br><span class="hljs-title function_">showLinesOnMap</span>(<span class="hljs-params">lines</span>) &#123;<br>    <span class="hljs-comment">// 重置地图样式</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">clearOverlays</span>()<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">centerAndZoom</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BMap</span>.<span class="hljs-title class_">Point</span>(<span class="hljs-number">106.543254</span>,<span class="hljs-number">29.556327</span>), <span class="hljs-number">14</span>);<br>    <br>    <span class="hljs-keyword">var</span> data = [];<br>    <span class="hljs-keyword">var</span> timeData = [];<br>    <span class="hljs-keyword">let</span> rs = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(lines).<span class="hljs-title function_">map</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">key</span>) &#123;<br>      <span class="hljs-keyword">return</span> lines[key]<br>    &#125;)<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; rs.<span class="hljs-property">length</span>; i++) &#123;<br>      <span class="hljs-keyword">var</span> item = rs[i]<br>      <span class="hljs-keyword">var</span> coordinates = [];<br>    <br>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt; item.<span class="hljs-property">length</span>; j++) &#123;<br>        coordinates.<span class="hljs-title function_">push</span>([<span class="hljs-title class_">Number</span>.<span class="hljs-built_in">parseFloat</span>(item[j].<span class="hljs-property">lng</span>), <span class="hljs-title class_">Number</span>.<span class="hljs-built_in">parseFloat</span>(item[j].<span class="hljs-property">lat</span>)]);<br>        timeData.<span class="hljs-title function_">push</span>(&#123;<br>          <span class="hljs-attr">geometry</span>: &#123;<br>            <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;Point&#x27;</span>,<br>            <span class="hljs-attr">coordinates</span>: [<span class="hljs-title class_">Number</span>.<span class="hljs-built_in">parseFloat</span>(item[j].<span class="hljs-property">lng</span>), <span class="hljs-title class_">Number</span>.<span class="hljs-built_in">parseFloat</span>(item[j].<span class="hljs-property">lat</span>)]<br>          &#125;,<br>          <span class="hljs-attr">count</span>: <span class="hljs-number">1</span>,<br>          <span class="hljs-attr">time</span>: j<br>        &#125;);<br>      &#125;<br>      data.<span class="hljs-title function_">push</span>(&#123;<br>        <span class="hljs-attr">geometry</span>: &#123;<br>          <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;LineString&#x27;</span>,<br>          <span class="hljs-attr">coordinates</span>: coordinates<br>        &#125;<br>      &#125;);<br>    <br>    &#125;<br>    <span class="hljs-keyword">var</span> dataSet = <span class="hljs-keyword">new</span> mapv.<span class="hljs-title class_">DataSet</span>(data);<br>    <br>    <span class="hljs-keyword">var</span> options = &#123;<br>      <span class="hljs-attr">strokeStyle</span>: <span class="hljs-string">&#x27;rgba(53,57,255,0.5)&#x27;</span>,<br>      <span class="hljs-attr">coordType</span>: <span class="hljs-string">&#x27;bd09mc&#x27;</span>,<br>      <span class="hljs-comment">// globalCompositeOperation: &#x27;lighter&#x27;,</span><br>      <span class="hljs-attr">shadowColor</span>: <span class="hljs-string">&#x27;rgba(53,57,255,0.2)&#x27;</span>,<br>      <span class="hljs-attr">shadowBlur</span>: <span class="hljs-number">3</span>,<br>      <span class="hljs-attr">lineWidth</span>: <span class="hljs-number">3.0</span>,<br>      <span class="hljs-attr">draw</span>: <span class="hljs-string">&#x27;simple&#x27;</span><br>    &#125;<br>    <br>    <span class="hljs-keyword">var</span> mapvLayer = <span class="hljs-keyword">new</span> mapv.<span class="hljs-title function_">baiduMapLayer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>, dataSet, options);<br>    <span class="hljs-keyword">var</span> dataSet = <span class="hljs-keyword">new</span> mapv.<span class="hljs-title class_">DataSet</span>(timeData);<br>    <br>    <span class="hljs-keyword">var</span> options = &#123;<br>      <span class="hljs-attr">fillStyle</span>: <span class="hljs-string">&#x27;rgba(255, 250, 250, 0.2)&#x27;</span>,<br>      <span class="hljs-attr">coordType</span>: <span class="hljs-string">&#x27;bd09mc&#x27;</span>,<br>      <span class="hljs-attr">globalCompositeOperation</span>: <span class="hljs-string">&quot;lighter&quot;</span>,<br>      <span class="hljs-attr">size</span>: <span class="hljs-number">1.5</span>,<br>      <span class="hljs-attr">animation</span>: &#123;<br>        <span class="hljs-attr">stepsRange</span>: &#123;<br>          <span class="hljs-attr">start</span>: <span class="hljs-number">0</span>,<br>          <span class="hljs-attr">end</span>: <span class="hljs-number">100</span><br>        &#125;,<br>        <span class="hljs-attr">trails</span>: <span class="hljs-number">3</span>,<br>        <span class="hljs-attr">duration</span>: <span class="hljs-number">5</span>,<br>      &#125;,<br>      <span class="hljs-attr">draw</span>: <span class="hljs-string">&#x27;simple&#x27;</span><br>    &#125;<br>    <br>    <span class="hljs-keyword">var</span> mapvLayer = <span class="hljs-keyword">new</span> mapv.<span class="hljs-title function_">baiduMapLayer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>, dataSet, options);<br>&#125;,<br></code></pre></td></tr></table></figure><h2 id="附：经纬度坐标转墨卡托坐标"><a href="#附：经纬度坐标转墨卡托坐标" class="headerlink" title="附：经纬度坐标转墨卡托坐标"></a>附：经纬度坐标转墨卡托坐标</h2><p>在做mapv街道路径图的时候，发现无法直接使用普通经纬度数据，进行街道路径绘制，需要将原有经纬度坐标转换墨卡托坐标。以下附转换函数供参考使用。</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs dns">export default &#123;<br>  x_pi: <span class="hljs-number">3</span>.<span class="hljs-number">14159265358979324</span> * <span class="hljs-number">3000</span>.<span class="hljs-number">0</span> / <span class="hljs-number">180</span>.<span class="hljs-number">0</span>,<br>  LLBAND: [<span class="hljs-number">75</span>, <span class="hljs-number">60</span>, <span class="hljs-number">45</span>, <span class="hljs-number">30</span>, <span class="hljs-number">15</span>, <span class="hljs-number">0</span>],<br>  LL2MC: [<br>    [-<span class="hljs-number">0</span>.<span class="hljs-number">0015702102444</span>, <span class="hljs-number">111320</span>.<span class="hljs-number">7020616939</span>, <span class="hljs-number">1704480524535203</span>, -<span class="hljs-number">10338987376042340</span>, <span class="hljs-number">26112667856603880</span>, -<span class="hljs-number">35149669176653700</span>, <span class="hljs-number">26595700718403920</span>, -<span class="hljs-number">10725012454188240</span>, <span class="hljs-number">1800819912950474</span>, <span class="hljs-number">82</span>.<span class="hljs-number">5</span>],<br>    [<span class="hljs-number">0</span>.<span class="hljs-number">0008277824516172526</span>, <span class="hljs-number">111320</span>.<span class="hljs-number">7020463578</span>, <span class="hljs-number">647795574</span>.<span class="hljs-number">6671607</span>, -<span class="hljs-number">4082003173</span>.<span class="hljs-number">641316</span>, <span class="hljs-number">10774905663</span>.<span class="hljs-number">51142</span>, -<span class="hljs-number">15171875531</span>.<span class="hljs-number">51559</span>, <span class="hljs-number">12053065338</span>.<span class="hljs-number">62167</span>, -<span class="hljs-number">5124939663</span>.<span class="hljs-number">577472</span>, <span class="hljs-number">913311935</span>.<span class="hljs-number">9512032</span>, <span class="hljs-number">67</span>.<span class="hljs-number">5</span>],<br>    [<span class="hljs-number">0</span>.<span class="hljs-number">00337398766765</span>, <span class="hljs-number">111320</span>.<span class="hljs-number">7020202162</span>, <span class="hljs-number">4481351</span>.<span class="hljs-number">045890365</span>, -<span class="hljs-number">23393751</span>.<span class="hljs-number">19931662</span>, <span class="hljs-number">79682215</span>.<span class="hljs-number">47186455</span>, -<span class="hljs-number">115964993</span>.<span class="hljs-number">2797253</span>, <span class="hljs-number">97236711</span>.<span class="hljs-number">15602145</span>, -<span class="hljs-number">43661946</span>.<span class="hljs-number">33752821</span>, <span class="hljs-number">8477230</span>.<span class="hljs-number">501135234</span>, <span class="hljs-number">52</span>.<span class="hljs-number">5</span>],<br>    [<span class="hljs-number">0</span>.<span class="hljs-number">00220636496208</span>, <span class="hljs-number">111320</span>.<span class="hljs-number">7020209128</span>, <span class="hljs-number">51751</span>.<span class="hljs-number">86112841131</span>, <span class="hljs-number">3796837</span>.<span class="hljs-number">749470245</span>, <span class="hljs-number">992013</span>.<span class="hljs-number">7397791013</span>, -<span class="hljs-number">1221952</span>.<span class="hljs-number">21711287</span>, <span class="hljs-number">1340652</span>.<span class="hljs-number">697009075</span>, -<span class="hljs-number">620943</span>.<span class="hljs-number">6990984312</span>, <span class="hljs-number">144416</span>.<span class="hljs-number">9293806241</span>, <span class="hljs-number">37</span>.<span class="hljs-number">5</span>],<br>    [-<span class="hljs-number">0</span>.<span class="hljs-number">0003441963504368392</span>, <span class="hljs-number">111320</span>.<span class="hljs-number">7020576856</span>, <span class="hljs-number">278</span>.<span class="hljs-number">2353980772752</span>, <span class="hljs-number">2485758</span>.<span class="hljs-number">690035394</span>, <span class="hljs-number">6070</span>.<span class="hljs-number">750963243378</span>, <span class="hljs-number">54821</span>.<span class="hljs-number">18345352118</span>, <span class="hljs-number">9540</span>.<span class="hljs-number">606633304236</span>, -<span class="hljs-number">2710</span>.<span class="hljs-number">55326746645</span>, <span class="hljs-number">1405</span>.<span class="hljs-number">483844121726</span>, <span class="hljs-number">22</span>.<span class="hljs-number">5</span>],<br>    [-<span class="hljs-number">0</span>.<span class="hljs-number">0003218135878613132</span>, <span class="hljs-number">111320</span>.<span class="hljs-number">7020701615</span>, <span class="hljs-number">0</span>.<span class="hljs-number">00369383431289</span>, <span class="hljs-number">823725</span>.<span class="hljs-number">6402795718</span>, <span class="hljs-number">0</span>.<span class="hljs-number">46104986909093</span>, <span class="hljs-number">2351</span>.<span class="hljs-number">343141331292</span>, <span class="hljs-number">1</span>.<span class="hljs-number">58060784298199</span>, <span class="hljs-number">8</span>.<span class="hljs-number">77738589078284</span>, <span class="hljs-number">0</span>.<span class="hljs-number">37238884252424</span>, <span class="hljs-number">7</span>.<span class="hljs-number">45</span>]<br>  ],<br>  getRange(cC, cB, T) &#123;<br>    if (cB != null) &#123;<br>      cC = Math.max(cC, cB)<span class="hljs-comment">;</span><br>    &#125;<br>    if (T != null) &#123;<br>      cC = Math.min(cC, T)<span class="hljs-comment">;</span><br>    &#125;<br>    return cC<span class="hljs-comment">;</span><br>  &#125;,<br>  getLoop(cC, cB, T) &#123;<br>    while (cC &gt; T) &#123;<br>      cC -= T - cB<span class="hljs-comment">;</span><br>    &#125;<br>    while (cC &lt; cB) &#123;<br>      cC += T - cB<span class="hljs-comment">;</span><br>    &#125;<br>    return cC<span class="hljs-comment">;</span><br>  &#125;,<br>  convertor(cC, cD) &#123;<br>    if (!cC || !cD) &#123;<br>      return null<span class="hljs-comment">;</span><br>    &#125;<br>    let T = cD[<span class="hljs-number">0</span>] + cD[<span class="hljs-number">1</span>] * Math.abs(cC.x)<span class="hljs-comment">;</span><br>    const cB = Math.abs(cC.y) / cD[<span class="hljs-number">9</span>]<span class="hljs-comment">;</span><br>    let cE = cD[<span class="hljs-number">2</span>] + cD[<span class="hljs-number">3</span>] * cB + cD[<span class="hljs-number">4</span>] * cB * cB +<br>      cD[<span class="hljs-number">5</span>] * cB * cB * cB + cD[<span class="hljs-number">6</span>] * cB * cB * cB * cB +<br>      cD[<span class="hljs-number">7</span>] * cB * cB * cB * cB * cB +<br>      cD[<span class="hljs-number">8</span>] * cB * cB * cB * cB * cB * cB<span class="hljs-comment">;</span><br>    T *= (cC.x &lt; <span class="hljs-number">0</span> ? -<span class="hljs-number">1</span> : <span class="hljs-number">1</span>)<span class="hljs-comment">;</span><br>    cE *= (cC.y &lt; <span class="hljs-number">0</span> ? -<span class="hljs-number">1</span> : <span class="hljs-number">1</span>)<span class="hljs-comment">;</span><br>    return [T, cE]<span class="hljs-comment">;</span><br>  &#125;,<br>  /// 经纬度坐标转墨卡托坐标<br>  convertLL2MC(T) &#123;<br>    let cD, cC, len<span class="hljs-comment">;</span><br>    T.x = this.getLoop(T.x, -<span class="hljs-number">180</span>, <span class="hljs-number">180</span>)<span class="hljs-comment">;</span><br>    T.y = this.getRange(T.y, -<span class="hljs-number">74</span>, <span class="hljs-number">74</span>)<span class="hljs-comment">;</span><br>    const cB = T<span class="hljs-comment">;</span><br>    for (cC = <span class="hljs-number">0</span>, len = this.LLBAND.length<span class="hljs-comment">; cC &lt; len; cC++) &#123;</span><br>      if (cB.y &gt;= this.LLBAND[cC]) &#123;<br>        cD = this.LL2MC[cC]<span class="hljs-comment">;</span><br>        break<span class="hljs-comment">;</span><br>      &#125;<br>    &#125;<br>    if (!cD) &#123;<br>      for (cC = this.LLBAND.length - <span class="hljs-number">1</span><span class="hljs-comment">; cC &gt;= 0; cC--) &#123;</span><br>        if (cB.y &lt;= -this.LLBAND[cC]) &#123;<br>          cD = this.LL2MC[cC]<span class="hljs-comment">;</span><br>          break<span class="hljs-comment">;</span><br>        &#125;<br>      &#125;<br>    &#125;<br>    const cE = this.convertor(T, cD)<span class="hljs-comment">;</span><br>    return cE<span class="hljs-comment">;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>百度地图</tag>
      
      <tag>mapv</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2019-03-28-百度地图接入及使用</title>
    <link href="/2025/11/28/2019-03-28-%E7%99%BE%E5%BA%A6%E5%9C%B0%E5%9B%BE%E6%8E%A5%E5%85%A5%E5%8F%8A%E4%BD%BF%E7%94%A8/"/>
    <url>/2025/11/28/2019-03-28-%E7%99%BE%E5%BA%A6%E5%9C%B0%E5%9B%BE%E6%8E%A5%E5%85%A5%E5%8F%8A%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<blockquote></blockquote><span id="more"></span><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p> 近期工作中涉及大量百度地图的使用，主要用于展示地图效果，少量交互。其中包含，中国地图边界绘制，自定义地图样式，自定义描点。</p><h1 id="百度地图接入"><a href="#百度地图接入" class="headerlink" title="百度地图接入"></a>百度地图接入</h1><p>1.<a href="https://passport.baidu.com/v2/?reg&tt=1494238640555&gid=E85D052-3B8B-45D0-9412-D0B861D79A5D&tpl=pp&u=https://passport.baidu.com/">注册百度账号</a><br>2.<a href="http://lbsyun.baidu.com/apiconsole/key">申请成为百度开发者</a><br>3.<a href="http://lbsyun.baidu.com/apiconsole/key/create">获取密钥（AK）</a><br>4.<a href="http://lbsyun.baidu.com/index.php?title=webapi/direction-api-v2">发送请求，使用服务</a>  </p><h2 id="坐标类型分类"><a href="#坐标类型分类" class="headerlink" title="坐标类型分类"></a>坐标类型分类</h2><p>WGS84：为一种大地坐标系，也是目前广泛使用的GPS全球卫星定位系统使用的坐标系。<br>GCJ02：是由中国国家测绘局制订的地理信息系统的坐标系统。由WGS84坐标系经加密后的坐标系。<br>BD09：为百度坐标系，在GCJ02坐标系基础上再次加密。其中bd09ll表示百度经纬度坐标，bd09mc表示百度墨卡托米制坐标。<br>RouteMatrix API v2.0的输入参数支持以上三种坐标系，开发者无需进行任何坐标转换，只需通过输入参数”coord_type”指明所使用的坐标系即可。</p><h1 id="百度地图控制台"><a href="#百度地图控制台" class="headerlink" title="百度地图控制台"></a>百度地图控制台</h1><p><a href="http://lbsyun.baidu.com/apiconsole/center">百度地图控制台地址</a></p><hr><hr><hr><h1 id="开始撸码"><a href="#开始撸码" class="headerlink" title="开始撸码"></a>开始撸码</h1><h2 id="百度地图引入"><a href="#百度地图引入" class="headerlink" title="百度地图引入"></a>百度地图引入</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://api.map.baidu.com/api?v=2.0&amp;ak=你的AK&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="禁止拖拽、禁止双击缩放、开启拖拽、开启鼠标滚轮缩放"><a href="#禁止拖拽、禁止双击缩放、开启拖拽、开启鼠标滚轮缩放" class="headerlink" title="禁止拖拽、禁止双击缩放、开启拖拽、开启鼠标滚轮缩放"></a>禁止拖拽、禁止双击缩放、开启拖拽、开启鼠标滚轮缩放</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">// 百度地图API功能， 初始化地图</span><br><span class="hljs-keyword">this</span>.map = new BMap.Map(<span class="hljs-string">&quot;container&quot;</span>, &#123;<br>  enableMapClick: <span class="hljs-literal">false</span><br>&#125;);<br><span class="hljs-keyword">this</span>.map.centerAndZoom(new BMap.Point(<span class="hljs-number">105.403119</span>, <span class="hljs-number">36.028658</span>), <span class="hljs-keyword">this</span>.countryLevel);  <span class="hljs-comment">// 初始化地图,设置中心点坐标和地图级别</span><br><span class="hljs-keyword">this</span>.map.disableDragging();     <span class="hljs-comment">//禁止拖拽</span><br><span class="hljs-comment">// this.map.enableDragging();     //开启拖拽</span><br><span class="hljs-keyword">this</span>.map.disableDoubleClickZoom()  <span class="hljs-comment">// 禁止双击缩放</span><br><span class="hljs-comment">// this.map.enableScrollWheelZoom(true); // 开启鼠标滚轮缩放</span><br><span class="hljs-comment">// 添加插件</span><br><span class="hljs-comment">// this.map.addControl(new BMap.NavigationControl());</span><br><span class="hljs-comment">// this.map.addControl(new BMap.ScaleControl());</span><br><span class="hljs-comment">// this.map.addControl(new BMap.OverviewMapControl());</span><br><span class="hljs-comment">// this.map.addControl(new BMap.MapTypeControl());</span><br><span class="hljs-keyword">this</span>.map.setCurrentCity(<span class="hljs-keyword">this</span>.currentCity);<br><span class="hljs-comment">// var traffic = new BMap.TrafficLayer();        // 创建交通流量图层实例</span><br><span class="hljs-comment">// this.map.addTileLayer(traffic);                    // 将图层添加到地图上</span><br><br><span class="hljs-comment">// this.setMapStyleNormal()</span><br><span class="hljs-keyword">this</span>.setMapStyleCountry()<br></code></pre></td></tr></table></figure><h2 id="设置地图样式"><a href="#设置地图样式" class="headerlink" title="设置地图样式"></a>设置地图样式</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><code class="hljs css">// 设置自带样式<br>setMapStyleNormal() &#123;<br>    this<span class="hljs-selector-class">.map</span><span class="hljs-selector-class">.setMapStyle</span>(&#123;<br>      style: <span class="hljs-string">&#x27;midnight&#x27;</span><br>    &#125;)<br>&#125;,<br><br>// 设置自定义样式<br>setMapStyleCountry() &#123;<br>// 地图自定义样式<br>this<span class="hljs-selector-class">.map</span><span class="hljs-selector-class">.setMapStyle</span>(&#123;<br>  styleJson: [&#123;<br>    &quot;featureType&quot;: <span class="hljs-string">&quot;water&quot;</span>,<br>    <span class="hljs-string">&quot;elementType&quot;</span>: <span class="hljs-string">&quot;all&quot;</span>,<br>    <span class="hljs-string">&quot;stylers&quot;</span>: &#123;<br>      &quot;<span class="hljs-attribute">color</span>&quot;: <span class="hljs-string">&quot;#044161&quot;</span><br>    &#125;<br>  &#125;, &#123;<br>    &quot;featureType&quot;: <span class="hljs-string">&quot;land&quot;</span>,<br>    <span class="hljs-string">&quot;elementType&quot;</span>: <span class="hljs-string">&quot;all&quot;</span>,<br>    <span class="hljs-string">&quot;stylers&quot;</span>: &#123;<br>      &quot;<span class="hljs-attribute">color</span>&quot;: <span class="hljs-string">&quot;#091934&quot;</span><br>    &#125;<br>  &#125;, &#123;<br>    &quot;featureType&quot;: <span class="hljs-string">&quot;boundary&quot;</span>,<br>    <span class="hljs-string">&quot;elementType&quot;</span>: <span class="hljs-string">&quot;geometry&quot;</span>,<br>    <span class="hljs-string">&quot;stylers&quot;</span>: &#123;<br>      &quot;<span class="hljs-attribute">color</span>&quot;: <span class="hljs-string">&quot;#064f85&quot;</span><br>    &#125;<br>  &#125;, &#123;<br>    &quot;featureType&quot;: <span class="hljs-string">&quot;railway&quot;</span>,<br>    <span class="hljs-string">&quot;elementType&quot;</span>: <span class="hljs-string">&quot;all&quot;</span>,<br>    <span class="hljs-string">&quot;stylers&quot;</span>: &#123;<br>      &quot;<span class="hljs-attribute">visibility</span>&quot;: <span class="hljs-string">&quot;off&quot;</span><br>    &#125;<br>  &#125;, &#123;<br>    &quot;featureType&quot;: <span class="hljs-string">&quot;highway&quot;</span>,<br>    <span class="hljs-string">&quot;elementType&quot;</span>: <span class="hljs-string">&quot;geometry&quot;</span>,<br>    <span class="hljs-string">&quot;stylers&quot;</span>: &#123;<br>      &quot;<span class="hljs-attribute">color</span>&quot;: <span class="hljs-string">&quot;#004981&quot;</span>,<br>      <span class="hljs-string">&quot;visibility&quot;</span>: <span class="hljs-string">&quot;off&quot;</span><br>    &#125;<br>  &#125;, &#123;<br>    &quot;featureType&quot;: <span class="hljs-string">&quot;highway&quot;</span>,<br>    <span class="hljs-string">&quot;elementType&quot;</span>: <span class="hljs-string">&quot;geometry.fill&quot;</span>,<br>    <span class="hljs-string">&quot;stylers&quot;</span>: &#123;<br>      &quot;<span class="hljs-attribute">color</span>&quot;: <span class="hljs-string">&quot;#005b96&quot;</span>,<br>      <span class="hljs-string">&quot;lightness&quot;</span>: <span class="hljs-number">1</span><br>    &#125;<br>  &#125;, &#123;<br>    &quot;featureType&quot;: <span class="hljs-string">&quot;highway&quot;</span>,<br>    <span class="hljs-string">&quot;elementType&quot;</span>: <span class="hljs-string">&quot;labels&quot;</span>,<br>    <span class="hljs-string">&quot;stylers&quot;</span>: &#123;<br>      &quot;<span class="hljs-attribute">visibility</span>&quot;: <span class="hljs-string">&quot;on&quot;</span><br>    &#125;<br>  &#125;, &#123;<br>    &quot;featureType&quot;: <span class="hljs-string">&quot;arterial&quot;</span>,<br>    <span class="hljs-string">&quot;elementType&quot;</span>: <span class="hljs-string">&quot;geometry&quot;</span>,<br>    <span class="hljs-string">&quot;stylers&quot;</span>: &#123;<br>      &quot;<span class="hljs-attribute">color</span>&quot;: <span class="hljs-string">&quot;#004981&quot;</span>,<br>      <span class="hljs-string">&quot;lightness&quot;</span>: -<span class="hljs-number">39</span><br>    &#125;<br>  &#125;, &#123;<br>    &quot;featureType&quot;: <span class="hljs-string">&quot;arterial&quot;</span>,<br>    <span class="hljs-string">&quot;elementType&quot;</span>: <span class="hljs-string">&quot;geometry.fill&quot;</span>,<br>    <span class="hljs-string">&quot;stylers&quot;</span>: &#123;<br>      &quot;<span class="hljs-attribute">color</span>&quot;: <span class="hljs-string">&quot;#00508b&quot;</span><br>    &#125;<br>  &#125;, &#123;<br>    &quot;featureType&quot;: <span class="hljs-string">&quot;poi&quot;</span>,<br>    <span class="hljs-string">&quot;elementType&quot;</span>: <span class="hljs-string">&quot;all&quot;</span>,<br>    <span class="hljs-string">&quot;stylers&quot;</span>: &#123;<br>      &quot;<span class="hljs-attribute">visibility</span>&quot;: <span class="hljs-string">&quot;off&quot;</span><br>    &#125;<br>  &#125;, &#123;<br>    &quot;featureType&quot;: <span class="hljs-string">&quot;green&quot;</span>,<br>    <span class="hljs-string">&quot;elementType&quot;</span>: <span class="hljs-string">&quot;all&quot;</span>,<br>    <span class="hljs-string">&quot;stylers&quot;</span>: &#123;<br>      &quot;<span class="hljs-attribute">color</span>&quot;: <span class="hljs-string">&quot;#056197&quot;</span>,<br><br>      // <span class="hljs-string">&quot;visibility&quot;</span>: <span class="hljs-string">&quot;off&quot;</span><br>    &#125;<br>  &#125;, &#123;<br>    &quot;featureType&quot;: <span class="hljs-string">&quot;subway&quot;</span>,<br>    <span class="hljs-string">&quot;elementType&quot;</span>: <span class="hljs-string">&quot;all&quot;</span>,<br>    <span class="hljs-string">&quot;stylers&quot;</span>: &#123;<br>      &quot;<span class="hljs-attribute">visibility</span>&quot;: <span class="hljs-string">&quot;off&quot;</span><br>    &#125;<br>  &#125;, &#123;<br>    &quot;featureType&quot;: <span class="hljs-string">&quot;manmade&quot;</span>,<br>    <span class="hljs-string">&quot;elementType&quot;</span>: <span class="hljs-string">&quot;all&quot;</span>,<br>    <span class="hljs-string">&quot;stylers&quot;</span>: &#123;<br>      &quot;<span class="hljs-attribute">visibility</span>&quot;: <span class="hljs-string">&quot;off&quot;</span><br>    &#125;<br>  &#125;, &#123;<br>    &quot;featureType&quot;: <span class="hljs-string">&quot;local&quot;</span>,<br>    <span class="hljs-string">&quot;elementType&quot;</span>: <span class="hljs-string">&quot;all&quot;</span>,<br>    <span class="hljs-string">&quot;stylers&quot;</span>: &#123;<br>      &quot;<span class="hljs-attribute">visibility</span>&quot;: <span class="hljs-string">&quot;off&quot;</span><br>    &#125;<br>  &#125;, &#123;<br>    &quot;featureType&quot;: <span class="hljs-string">&quot;arterial&quot;</span>,<br>    <span class="hljs-string">&quot;elementType&quot;</span>: <span class="hljs-string">&quot;labels&quot;</span>,<br>    <span class="hljs-string">&quot;stylers&quot;</span>: &#123;<br>      &quot;<span class="hljs-attribute">visibility</span>&quot;: <span class="hljs-string">&quot;off&quot;</span><br>    &#125;<br>  &#125;, &#123;<br>    &quot;featureType&quot;: <span class="hljs-string">&quot;boundary&quot;</span>,<br>    <span class="hljs-string">&quot;elementType&quot;</span>: <span class="hljs-string">&quot;geometry.fill&quot;</span>,<br>    <span class="hljs-string">&quot;stylers&quot;</span>: &#123;<br>      &quot;<span class="hljs-attribute">color</span>&quot;: <span class="hljs-string">&quot;#029fd4&quot;</span><br>    &#125;<br>  &#125;, &#123;<br>    &quot;featureType&quot;: <span class="hljs-string">&quot;building&quot;</span>,<br>    <span class="hljs-string">&quot;elementType&quot;</span>: <span class="hljs-string">&quot;all&quot;</span>,<br>    <span class="hljs-string">&quot;stylers&quot;</span>: &#123;<br>      &quot;<span class="hljs-attribute">color</span>&quot;: <span class="hljs-string">&quot;#1a5787&quot;</span><br>    &#125;<br>  &#125;, &#123;<br>    &quot;featureType&quot;: <span class="hljs-string">&quot;label&quot;</span>,<br>    <span class="hljs-string">&quot;elementType&quot;</span>: <span class="hljs-string">&quot;all&quot;</span>,<br>    <span class="hljs-string">&quot;stylers&quot;</span>: &#123;<br>      &quot;<span class="hljs-attribute">visibility</span>&quot;: <span class="hljs-string">&quot;off&quot;</span><br>    &#125;<br>  &#125;, &#123;<br>    &quot;featureType&quot;: <span class="hljs-string">&quot;poi&quot;</span>,<br>    <span class="hljs-string">&quot;elementType&quot;</span>: <span class="hljs-string">&quot;labels.text.fill&quot;</span>,<br>    <span class="hljs-string">&quot;stylers&quot;</span>: &#123;<br>      &quot;<span class="hljs-attribute">color</span>&quot;: <span class="hljs-string">&quot;#ffffff&quot;</span><br>    &#125;<br>  &#125;, &#123;<br>    &quot;featureType&quot;: <span class="hljs-string">&quot;poi&quot;</span>,<br>    <span class="hljs-string">&quot;elementType&quot;</span>: <span class="hljs-string">&quot;labels.text.stroke&quot;</span>,<br>    <span class="hljs-string">&quot;stylers&quot;</span>: &#123;<br>      &quot;<span class="hljs-attribute">color</span>&quot;: <span class="hljs-string">&quot;#1e1c1c&quot;</span><br>    &#125;<br>  &#125;, &#123;<br>    &quot;featureType&quot;: <span class="hljs-string">&quot;administrative&quot;</span>,<br>    <span class="hljs-string">&quot;elementType&quot;</span>: <span class="hljs-string">&quot;labels&quot;</span>,<br>    <span class="hljs-string">&quot;stylers&quot;</span>: &#123;<br>      &quot;<span class="hljs-attribute">visibility</span>&quot;: <span class="hljs-string">&quot;off&quot;</span><br>    &#125;<br>  &#125;, &#123;<br>    &quot;featureType&quot;: <span class="hljs-string">&quot;road&quot;</span>,<br>    <span class="hljs-string">&quot;elementType&quot;</span>: <span class="hljs-string">&quot;labels&quot;</span>,<br>    <span class="hljs-string">&quot;stylers&quot;</span>: &#123;<br>      &quot;<span class="hljs-attribute">visibility</span>&quot;: <span class="hljs-string">&quot;off&quot;</span><br>    &#125;<br>  &#125;]<br>&#125;)<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="监听省份点击"><a href="#监听省份点击" class="headerlink" title="监听省份点击"></a>监听省份点击</h2><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs arcade">this.<span class="hljs-built_in">map</span>.addEventListener(<span class="hljs-string">&quot;click&quot;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) &#123;<br>  <span class="hljs-keyword">var</span> pt = e.<span class="hljs-built_in">point</span>;<br>  geoc.getLocation(pt, <span class="hljs-keyword">function</span> (<span class="hljs-params">rs</span>) &#123;<br>    <span class="hljs-keyword">var</span> addComp = rs.addressComponents;<br>    <span class="hljs-comment">// alert(addComp.province + &quot;, &quot; + addComp.city + &quot;, &quot; + addComp.district + &quot;, &quot; + addComp.street + &quot;, &quot; + addComp.streetNumber);</span><br><br>    <span class="hljs-keyword">if</span> (self.usebleCity.<span class="hljs-built_in">indexOf</span>(addComp.province) &gt; <span class="hljs-number">-1</span>) &#123;<br>      <span class="hljs-comment">// 修改当前城市</span><br>      self.currentCity = addComp.province<br>    &#125;<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><h2 id="绘制中国地图边界"><a href="#绘制中国地图边界" class="headerlink" title="绘制中国地图边界"></a>绘制中国地图边界</h2><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br></pre></td><td class="code"><pre><code class="hljs dns">/**<br>*  绘制中国地图周边蒙层<br>*/<br>drawBoundary() &#123;<br>/*画遮蔽层的相关方法<br>*思路: 首先在中国地图最外画一圈，圈住理论上所有的中国领土，然后再将每个闭合区域合并进来，并全部连到西北角。<br>*      这样就做出了一个经过多次西北角的闭合多边形*/<br>//定义中国东南西北端点，作为第一层<br>//向数组中添加一次闭合多边形，并将西北角再加一次作为之后画闭合区域的起点<br>var pStart = new BMap.Point(<span class="hljs-number">180</span>, <span class="hljs-number">90</span>)<span class="hljs-comment">;</span><br>var pEnd = new BMap.Point(<span class="hljs-number">0</span>, -<span class="hljs-number">90</span>)<span class="hljs-comment">;</span><br>var pArray = [<br>  new BMap.Point(pStart.lng, pStart.lat),<br>  new BMap.Point(pEnd.lng, pStart.lat),<br>  new BMap.Point(pEnd.lng, pEnd.lat),<br>  new BMap.Point(pStart.lng, pEnd.lat)]<span class="hljs-comment">;</span><br>//循环添加各闭合区域<br>pArray.push(new BMap.Point(<span class="hljs-number">135.077218</span>, <span class="hljs-number">48.544352</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">134.92218</span>, <span class="hljs-number">48.584352</span>))<br>pArray.push(new BMap.Point(<span class="hljs-number">134.827218</span>, <span class="hljs-number">48.534352</span>))<br>pArray.push(new BMap.Point(<span class="hljs-number">134.727669</span>, <span class="hljs-number">48.495377</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">134.304531</span>, <span class="hljs-number">48.394091</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">133.513447</span>, <span class="hljs-number">48.177476</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">132.832747</span>, <span class="hljs-number">48.054205</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">132.519993</span>, <span class="hljs-number">47.789172</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">131.765704</span>, <span class="hljs-number">47.813962</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">131.103402</span>, <span class="hljs-number">47.776772</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">130.919429</span>, <span class="hljs-number">48.331824</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">130.77225</span>, <span class="hljs-number">48.868729</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">129.907577</span>, <span class="hljs-number">49.351849</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">128.73015</span>, <span class="hljs-number">49.699156</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">127.791888</span>, <span class="hljs-number">49.85404</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">127.791888</span>, <span class="hljs-number">50.492084</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">126.927215</span>, <span class="hljs-number">51.616759</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">126.467283</span>, <span class="hljs-number">52.579818</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">125.952158</span>, <span class="hljs-number">53.059077</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">124.701142</span>, <span class="hljs-number">53.313247</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">123.56051</span>, <span class="hljs-number">53.664362</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">121.555204</span>, <span class="hljs-number">53.46722</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">120.340983</span>, <span class="hljs-number">53.125528</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">119.95464</span>, <span class="hljs-number">52.579818</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">120.616942</span>, <span class="hljs-number">52.523746</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">120.506559</span>, <span class="hljs-number">52.095236</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">119.862653</span>, <span class="hljs-number">51.616759</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">119.365926</span>, <span class="hljs-number">50.959196</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">119.089967</span>, <span class="hljs-number">50.362806</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">119.108364</span>, <span class="hljs-number">50.05583</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">118.133307</span>, <span class="hljs-number">49.925357</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">117.471005</span>, <span class="hljs-number">49.794528</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">116.808702</span>, <span class="hljs-number">49.889712</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">116.385564</span>, <span class="hljs-number">49.758785</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">115.962426</span>, <span class="hljs-number">48.953617</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">115.520891</span>, <span class="hljs-number">48.147476</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">115.796851</span>, <span class="hljs-number">47.677465</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">116.27518</span>, <span class="hljs-number">47.652609</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">117.103059</span>, <span class="hljs-number">47.652609</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">118.004526</span>, <span class="hljs-number">47.801568</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">118.887596</span>, <span class="hljs-number">47.577968</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">119.402721</span>, <span class="hljs-number">47.127871</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">119.402721</span>, <span class="hljs-number">46.800397</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">118.464459</span>, <span class="hljs-number">46.825659</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">117.103059</span>, <span class="hljs-number">46.648575</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">115.980824</span>, <span class="hljs-number">46.088213</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">115.226534</span>, <span class="hljs-number">45.702829</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">114.159491</span>, <span class="hljs-number">45.275796</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">112.761297</span>, <span class="hljs-number">45.171782</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">111.639061</span>, <span class="hljs-number">45.132727</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">111.436691</span>, <span class="hljs-number">44.55683</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">111.51028</span>, <span class="hljs-number">44.001703</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">110.682402</span>, <span class="hljs-number">43.387647</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">108.897864</span>, <span class="hljs-number">42.658724</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">106.892559</span>, <span class="hljs-number">42.522781</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">103.82021</span>, <span class="hljs-number">42.140555</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">102.422016</span>, <span class="hljs-number">42.536389</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">101.336575</span>, <span class="hljs-number">42.82146</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">99.478448</span>, <span class="hljs-number">42.929712</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">97.601924</span>, <span class="hljs-number">42.997272</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">96.019756</span>, <span class="hljs-number">43.815487</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">92.72664</span>, <span class="hljs-number">45.288784</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">91.144473</span>, <span class="hljs-number">45.599605</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">91.457227</span>, <span class="hljs-number">46.483616</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">90.794924</span>, <span class="hljs-number">47.553064</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">89.562305</span>, <span class="hljs-number">48.221295</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">88</span>.<span class="hljs-number">2377</span>, <span class="hljs-number">48.953617</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">87.722576</span>, <span class="hljs-number">49.279683</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">87.097067</span>, <span class="hljs-number">49.255604</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">86.60034</span>, <span class="hljs-number">49.122957</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">86.177203</span>, <span class="hljs-number">48.710696</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">85.533297</span>, <span class="hljs-number">48.344091</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">85.404516</span>, <span class="hljs-number">47.875888</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">85.349324</span>, <span class="hljs-number">47.390897</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">84.926186</span>, <span class="hljs-number">47.215692</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">83.233635</span>, <span class="hljs-number">47.315881</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">82.865689</span>, <span class="hljs-number">47.328391</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">82.258578</span>, <span class="hljs-number">45.844449</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">82.368962</span>, <span class="hljs-number">45.366651</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">82.093003</span>, <span class="hljs-number">45.30177</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">80.989165</span>, <span class="hljs-number">45.275796</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">79.903724</span>, <span class="hljs-number">45.015402</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">80.326862</span>, <span class="hljs-number">44.332772</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">80.510835</span>, <span class="hljs-number">43.642047</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">80.621219</span>, <span class="hljs-number">43.186043</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">80.27167</span>, <span class="hljs-number">43.010775</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">79.885327</span>, <span class="hljs-number">42.304653</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">79.259819</span>, <span class="hljs-number">41.838593</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">78.487133</span>, <span class="hljs-number">41.576647</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">77.916816</span>, <span class="hljs-number">41.341363</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">77.272911</span>, <span class="hljs-number">41.16086</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">76.739389</span>, <span class="hljs-number">41.02167</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">76.26106</span>, <span class="hljs-number">40.546202</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">75.672346</span>, <span class="hljs-number">40.75639</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">74.881262</span>, <span class="hljs-number">40.630357</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">74.255754</span>, <span class="hljs-number">40.293095</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">73.777425</span>, <span class="hljs-number">39.939968</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">73.74063</span>, <span class="hljs-number">39.556517</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">73.53826</span>, <span class="hljs-number">39.34256</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">73.685438</span>, <span class="hljs-number">38.725549</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">74.034987</span>, <span class="hljs-number">38.407771</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">74.458125</span>, <span class="hljs-number">38.335352</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">74.734084</span>, <span class="hljs-number">38.074036</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">74.844468</span>, <span class="hljs-number">37.577865</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">74.678892</span>, <span class="hljs-number">37.21089</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">74</span>.<span class="hljs-number">6237</span>, <span class="hljs-number">36.975076</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">75.414784</span>, <span class="hljs-number">36.501232</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">75.801127</span>, <span class="hljs-number">35.934721</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">76.518622</span>, <span class="hljs-number">35.379154</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">77.309706</span>, <span class="hljs-number">35.137703</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">77.972008</span>, <span class="hljs-number">34.758986</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">78.376749</span>, <span class="hljs-number">34.241106</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">78.523927</span>, <span class="hljs-number">33.473647</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">78</span>.<span class="hljs-number">7079</span>, <span class="hljs-number">32.978834</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">78.450338</span>, <span class="hljs-number">32.745921</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">78.30316</span>, <span class="hljs-number">32.340745</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">78.431941</span>, <span class="hljs-number">32.04349</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">78.671106</span>, <span class="hljs-number">31.572152</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">78.855079</span>, <span class="hljs-number">31.145879</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">79.425395</span>, <span class="hljs-number">30.797108</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">80.087697</span>, <span class="hljs-number">30.447053</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">81.301919</span>, <span class="hljs-number">29.855455</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">81.90903</span>, <span class="hljs-number">30</span>.<span class="hljs-number">0157</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">82</span>.<span class="hljs-number">7921</span>, <span class="hljs-number">29.485907</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">84.539843</span>, <span class="hljs-number">28.661613</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">85.71727</span>, <span class="hljs-number">28.124721</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">86.821108</span>, <span class="hljs-number">27.732537</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">87.998535</span>, <span class="hljs-number">27.69979</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">88.568851</span>, <span class="hljs-number">27.716165</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">88.863208</span>, <span class="hljs-number">27.108656</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">89.580703</span>, <span class="hljs-number">27.190949</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">89.654292</span>, <span class="hljs-number">27.765274</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">90.923705</span>, <span class="hljs-number">27.650651</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">91.751584</span>, <span class="hljs-number">27.223849</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">92.04594</span>, <span class="hljs-number">26.778874</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">92.965805</span>, <span class="hljs-number">26.646689</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">93.830478</span>, <span class="hljs-number">26.960375</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">94.860727</span>, <span class="hljs-number">27.453873</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">96.185332</span>, <span class="hljs-number">27.798001</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">97.123594</span>, <span class="hljs-number">27.503101</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">97.620321</span>, <span class="hljs-number">27.896122</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">97.675513</span>, <span class="hljs-number">28.059457</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">98.080254</span>, <span class="hljs-number">27.306056</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">98.595378</span>, <span class="hljs-number">27.009824</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">98.393008</span>, <span class="hljs-number">26.066566</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">97.804294</span>, <span class="hljs-number">25.483523</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">97.528335</span>, <span class="hljs-number">24.847254</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">97.417951</span>, <span class="hljs-number">24.10637</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">97.804294</span>, <span class="hljs-number">23.717348</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">98.595378</span>, <span class="hljs-number">23.886634</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">98.834543</span>, <span class="hljs-number">23.123105</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">99.239283</span>, <span class="hljs-number">22.697005</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">99.165694</span>, <span class="hljs-number">22.303805</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">99.386462</span>, <span class="hljs-number">21.857966</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">100.251135</span>, <span class="hljs-number">21.445169</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">100.839848</span>, <span class="hljs-number">21.290063</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">101.704521</span>, <span class="hljs-number">21.031186</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">102.05407</span>, <span class="hljs-number">21.152053</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">101.998878</span>, <span class="hljs-number">21.582901</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">101.962083</span>, <span class="hljs-number">22.132497</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">102.587591</span>, <span class="hljs-number">22.355156</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">103.599443</span>, <span class="hljs-number">22.338041</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">104.482513</span>, <span class="hljs-number">22.560368</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">105.383981</span>, <span class="hljs-number">22.799392</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">106.083078</span>, <span class="hljs-number">22.59454</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">106.469421</span>, <span class="hljs-number">22.286683</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">106.874162</span>, <span class="hljs-number">21.754879</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">107.315697</span>, <span class="hljs-number">21.514051</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">107.812424</span>, <span class="hljs-number">21.410715</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">107.775629</span>, <span class="hljs-number">21.134792</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">106.929353</span>, <span class="hljs-number">20.269201</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">106.175064</span>, <span class="hljs-number">19.17158</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">106.377435</span>, <span class="hljs-number">18.470789</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">107.297299</span>, <span class="hljs-number">17.23746</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">109.008248</span>, <span class="hljs-number">15.675143</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">109.688948</span>, <span class="hljs-number">13.705222</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">109.652153</span>, <span class="hljs-number">11.664031</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">108.750686</span>, <span class="hljs-number">9.571001</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">108.198767</span>, <span class="hljs-number">6.876803</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">108.493124</span>, <span class="hljs-number">5.090099</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">109.817729</span>, <span class="hljs-number">3.612656</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">111.10554</span>, <span class="hljs-number">3.298351</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">114.71141</span>, <span class="hljs-number">5.514272</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">116.256783</span>, <span class="hljs-number">7.556636</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">118.758815</span>, <span class="hljs-number">10.883133</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">119.531502</span>, <span class="hljs-number">13.669242</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">119.494707</span>, <span class="hljs-number">16.617614</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">120.414572</span>, <span class="hljs-number">18.961654</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">121.51841</span>, <span class="hljs-number">20.633358</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">122.751029</span>, <span class="hljs-number">22.303805</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">123.247756</span>, <span class="hljs-number">23.378111</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">124.811526</span>, <span class="hljs-number">25.68375</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">126.577667</span>, <span class="hljs-number">25.900278</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">127.479134</span>, <span class="hljs-number">26.67975</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">128.454191</span>, <span class="hljs-number">28.189945</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">128.766945</span>, <span class="hljs-number">29.93561</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">128.73015</span>, <span class="hljs-number">31.650877</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">127.957464</span>, <span class="hljs-number">32.153119</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">127.221572</span>, <span class="hljs-number">32.745921</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">127.019202</span>, <span class="hljs-number">33.596907</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">125.988953</span>, <span class="hljs-number">33.827543</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">125.731391</span>, <span class="hljs-number">34.546135</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">125.878569</span>, <span class="hljs-number">35.454458</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">125.731391</span>, <span class="hljs-number">36.634799</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">125.80498</span>, <span class="hljs-number">37.51927</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">124.425183</span>, <span class="hljs-number">37.972159</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">124.498772</span>, <span class="hljs-number">38.58128</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">125.013896</span>, <span class="hljs-number">39.242487</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">124.590758</span>, <span class="hljs-number">39.471014</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">124.296402</span>, <span class="hljs-number">39.840762</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">124.388388</span>, <span class="hljs-number">40.081441</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">124.940307</span>, <span class="hljs-number">40.335346</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">125.731391</span>, <span class="hljs-number">40.630357</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">126.448885</span>, <span class="hljs-number">40.96591</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">126.798434</span>, <span class="hljs-number">41.493704</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">127.111188</span>, <span class="hljs-number">41.410654</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">127.883875</span>, <span class="hljs-number">41.271998</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">128.490985</span>, <span class="hljs-number">41.452192</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">128.307012</span>, <span class="hljs-number">41.879854</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">128.950918</span>, <span class="hljs-number">41.921089</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">129.484439</span>, <span class="hljs-number">42.12686</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">129.999564</span>, <span class="hljs-number">42.549994</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">130.073153</span>, <span class="hljs-number">42.807915</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">130.404304</span>, <span class="hljs-number">42.495557</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">130.77225</span>, <span class="hljs-number">42.359256</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">130.698661</span>, <span class="hljs-number">42.726583</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">131.195388</span>, <span class="hljs-number">42.848541</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">131.360964</span>, <span class="hljs-number">43.494895</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">131.342566</span>, <span class="hljs-number">44.491021</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">131.820896</span>, <span class="hljs-number">45.002351</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">132.998323</span>, <span class="hljs-number">44.976239</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">133.623831</span>, <span class="hljs-number">45.599605</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">134.102161</span>, <span class="hljs-number">46.394582</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">134.37812</span>, <span class="hljs-number">47.228226</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">134.874847</span>, <span class="hljs-number">47.851127</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">134.985231</span>, <span class="hljs-number">48.233588</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">135.13241</span>, <span class="hljs-number">48.454352</span>))<span class="hljs-comment">;</span><br>pArray.push(new BMap.Point(<span class="hljs-number">135.077218</span>, <span class="hljs-number">48.474352</span>))<span class="hljs-comment">;</span><br><br>//添加遮蔽层<br>var plyall = new BMap.Polygon(pArray,<br>  &#123;<br>    strokeOpacity: <span class="hljs-number">1</span>, strokeColor: &quot;#<span class="hljs-number">08304</span><span class="hljs-keyword">A</span>&quot;,<br>    // strokeOpacity: <span class="hljs-number">1</span>, strokeColor: &quot;#<span class="hljs-number">091934</span>&quot;,<br>    strokeWeight: <span class="hljs-number">1</span>, fillColor: &quot;#<span class="hljs-number">08304</span><span class="hljs-keyword">A</span>&quot;, fillOpacity: <span class="hljs-number">1</span><br>  &#125;)<span class="hljs-comment">; //建立多边形覆盖物</span><br>this.map.addOverlay(plyall)<span class="hljs-comment">;</span><br><br>pStart = new BMap.Point(<span class="hljs-number">180</span>, <span class="hljs-number">90</span>)<span class="hljs-comment">;</span><br>pEnd = new BMap.Point(<span class="hljs-number">0</span>, -<span class="hljs-number">90</span>)<span class="hljs-comment">;</span><br>pArray = [<br>  new BMap.Point(<span class="hljs-number">135.077218</span>, <span class="hljs-number">48.454352</span>),<br>  new BMap.Point(pStart.lng, pStart.lat),<br>  new BMap.Point(pStart.lng, pEnd.lat),<br>  new BMap.Point(<span class="hljs-number">135.077218</span>, <span class="hljs-number">48.454352</span>)]<span class="hljs-comment">;</span><br>var sanjiaoxing = new BMap.Polygon(pArray,<br>  &#123;<br>    strokeOpacity: <span class="hljs-number">1</span>, strokeColor: &quot;#<span class="hljs-number">08304</span><span class="hljs-keyword">A</span>&quot;,<br>    // strokeOpacity: <span class="hljs-number">1</span>, strokeColor: &quot;#<span class="hljs-number">091934</span>&quot;,<br>    strokeWeight: <span class="hljs-number">1</span>, fillColor: &quot;#<span class="hljs-number">08304</span><span class="hljs-keyword">A</span>&quot;, fillOpacity: <span class="hljs-number">1</span><br>  &#125;)<span class="hljs-comment">; //建立多边形覆盖物</span><br>this.map.addOverlay(sanjiaoxing)<span class="hljs-comment">;</span><br>&#125;,<br></code></pre></td></tr></table></figure><h2 id="根据省份名称绘制边界"><a href="#根据省份名称绘制边界" class="headerlink" title="根据省份名称绘制边界"></a>根据省份名称绘制边界</h2><figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs zephir"><span class="hljs-comment">/**</span><br><span class="hljs-comment">*  获取边界</span><br><span class="hljs-comment">*/</span><br>getBoundary(name) &#123;<br><span class="hljs-keyword">let</span> <span class="hljs-keyword">self</span> = this<br><span class="hljs-keyword">var</span> bdary = <span class="hljs-keyword">new</span> BMap.Boundary();<br>bdary.get(name, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(rs)</span> </span>&#123;<br>  <span class="hljs-keyword">self</span>.clearCurrentBoundCity()<br>  <span class="hljs-keyword">var</span> count = rs.boundaries.length; <span class="hljs-comment">//行政区域的点有多少个</span><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; count; i++) &#123;<br>    <span class="hljs-keyword">self</span>.currentCityPly = <span class="hljs-keyword">new</span> BMap.Polygon(rs.boundaries[i],<br>      &#123;<br>        strokeWeight: <span class="hljs-number">2</span>, <span class="hljs-comment">//设置多边形边线线粗</span><br>        strokeOpacity: <span class="hljs-number">1</span>, <span class="hljs-comment">//设置多边形边线透明度0-1</span><br>        StrokeStyle: <span class="hljs-string">&quot;solid&quot;</span>, <span class="hljs-comment">//设置多边形边线样式为实线或虚线，取值 solid 或 dashed</span><br>        strokeColor: <span class="hljs-string">&quot;#ff0000&quot;</span>, <span class="hljs-comment">//设置多边形边线颜色</span><br>        fillColor: <span class="hljs-string">&quot;#00ffff&quot;</span>, <span class="hljs-comment">//设置多边形填充颜色</span><br>        fillOpacity: <span class="hljs-number">0.1</span> <span class="hljs-comment">//设置多边形填充颜色透明度0-1  注：标红的地放你们可以去掉看一下效果，自己体验一下</span><br><br>      &#125;); <span class="hljs-comment">//建立多边形覆盖物</span><br>    <span class="hljs-keyword">self</span>.map.addOverlay(<span class="hljs-keyword">self</span>.currentCityPly);  <span class="hljs-comment">//添加覆盖物</span><br>    <span class="hljs-keyword">self</span>.map.setViewport(<span class="hljs-keyword">self</span>.currentCityPly.getPath());    <span class="hljs-comment">//调整视野</span><br>  &#125;<br>&#125;);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="地图标注，描点"><a href="#地图标注，描点" class="headerlink" title="地图标注，描点"></a>地图标注，描点</h2><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-comment">/**</span><br><span class="hljs-comment">*  在地图中显示点标注</span><br><span class="hljs-comment">*/</span><br>showPointOnMap(data_info) &#123;<br>    this.clearStatusPly()<br>    this.resetCityCenterPoint()<br>    <span class="hljs-keyword">if</span>(this.currentMapType !== <span class="hljs-string">&#x27;point&#x27;</span>) &#123;<br>      this.currentMapType = <span class="hljs-string">&#x27;point&#x27;</span><br>      this.setMapStyleCity()<br>      <span class="hljs-comment">// 获取城市边界</span><br>      this.getBoundary(this.currentCity)<br>      <span class="hljs-comment">// this.map.enableDragging();</span><br>      <span class="hljs-comment">// this.map.enableScrollWheelZoom(true); // 开启鼠标滚轮缩放</span><br>      this.<span class="hljs-built_in">map</span>.clearOverlays()<br>    &#125;<br>    <br>    let self = this<br>    <br>    <span class="hljs-keyword">var</span> opts = &#123;<br>      <span class="hljs-attr">width</span> : <span class="hljs-number">250</span>,     <span class="hljs-comment">// 信息窗口宽度</span><br>      height: <span class="hljs-number">80</span>,     <span class="hljs-comment">// 信息窗口高度</span><br>      title : (data_info.type ==<span class="hljs-string">&#x27;rfid&#x27;</span> ? <span class="hljs-string">&#x27;RFID&#x27;</span> : <span class="hljs-string">&#x27;抓拍设备&#x27;</span>) + <span class="hljs-string">&#x27;状态[&#x27;</span> + data_info.status + <span class="hljs-string">&#x27;]&#x27;</span> , <span class="hljs-comment">// 信息窗口标题</span><br>      enableMessage:<span class="hljs-literal">true</span><span class="hljs-comment">//设置允许信息窗发送短息</span><br>    &#125;;<br>    <br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>;i&lt;data_info.items.<span class="hljs-built_in">length</span>;i++)&#123;<br>      <span class="hljs-keyword">var</span> marker = <span class="hljs-keyword">new</span> BMap.Marker(<span class="hljs-keyword">new</span> BMap.<span class="hljs-built_in">Point</span>(data_info.items[i].lng,data_info.items[i].lat));  <span class="hljs-comment">// 创建标注</span><br>      <span class="hljs-keyword">var</span> content = data_info.items[i].name;<br>      self.<span class="hljs-built_in">map</span>.addOverlay(marker);               <span class="hljs-comment">// 将标注添加到地图中</span><br>      self.currentStatusPly.<span class="hljs-built_in">push</span>(marker)<br>      addClickHandler(content,marker);<br>    &#125;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">addClickHandler</span>(<span class="hljs-params">content,marker</span>)&#123;<br>      marker.addEventListener(<span class="hljs-string">&quot;click&quot;</span>,<span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)&#123;<br>        openInfo(content,e)&#125;<br>      );<br>    &#125;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">openInfo</span>(<span class="hljs-params">content,e</span>)&#123;<br>      <span class="hljs-keyword">var</span> p = e.target;<br>      <span class="hljs-keyword">var</span> <span class="hljs-built_in">point</span> = <span class="hljs-keyword">new</span> BMap.<span class="hljs-built_in">Point</span>(p.getPosition().lng, p.getPosition().lat);<br>      <span class="hljs-keyword">var</span> infoWindow = <span class="hljs-keyword">new</span> BMap.InfoWindow(content,opts);  <span class="hljs-comment">// 创建信息窗口对象</span><br>      self.<span class="hljs-built_in">map</span>.openInfoWindow(infoWindow,<span class="hljs-built_in">point</span>); <span class="hljs-comment">//开启信息窗口</span><br>    &#125;<br>&#125;,<br></code></pre></td></tr></table></figure><h2 id="清除地图图层，标注-边界等"><a href="#清除地图图层，标注-边界等" class="headerlink" title="清除地图图层，标注&#x2F;边界等"></a>清除地图图层，标注&#x2F;边界等</h2><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs lasso"><span class="hljs-comment">// 清除所有遮罩</span><br>    this.<span class="hljs-built_in">map</span>.clearOverlays()<br>    <br><span class="hljs-comment">// 清除指定遮罩</span><br>clearStatusPly() &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-built_in">self</span> = this<br>    <span class="hljs-comment">// 关闭弹窗信息</span><br>    <span class="hljs-built_in">self</span>.<span class="hljs-built_in">map</span>.closeInfoWindow()<br>    <span class="hljs-comment">// 清除标注点</span><br>    <span class="hljs-built_in">self</span>.currentStatusPly.forEach(item =&gt; &#123;<br>      <span class="hljs-built_in">self</span>.<span class="hljs-built_in">map</span>.removeOverlay(item);<br>    &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>百度地图</tag>
      
      <tag>mapv</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2019-04-16-echart3使用技巧</title>
    <link href="/2025/11/28/2019-04-16-echart3%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/"/>
    <url>/2025/11/28/2019-04-16-echart3%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/</url>
    
    <content type="html"><![CDATA[<blockquote></blockquote><span id="more"></span><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>近期开发工作中涉及到大量的图表展示功能，主要使用echart3绘图应用于大屏展示中，总的来说echart3还是比较容易上手的，本文整理几个实用用法，如饼图三环，线形图，柱状图渐变色，作为网上笔记，以备后用。</p><h2 id="饼图三环效果"><a href="#饼图三环效果" class="headerlink" title="饼图三环效果"></a>饼图三环效果</h2><p>效果图：</p><p>实现难点：</p><ol><li><p>标题居中； 2.三环效果</p></li><li><p>标题居中比较简单，为了达到文字放于饼图中心效果，我们将title调整显示位置来达到目的。title: {x: ‘center’, y: ‘37%’…}</p></li></ol><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs less">title: &#123;<br>    text: &#x27;性别分布&#x27;,<br>    // subtext: &#x27;纯属虚构&#x27;,<br>    <span class="hljs-attribute">x</span>: <span class="hljs-string">&#x27;center&#x27;</span>, <span class="hljs-comment">// 标题X轴位置</span><br>    <span class="hljs-attribute">y</span>: <span class="hljs-string">&#x27;37%&#x27;</span>,    <span class="hljs-comment">// 标题Y轴位置</span><br>    <span class="hljs-attribute">textStyle</span>: &#123;<br>      <span class="hljs-attribute">fontWeight</span>: <span class="hljs-string">&#x27;normal&#x27;</span>,              <span class="hljs-comment">//标题颜色</span><br>      <span class="hljs-attribute">color</span>: <span class="hljs-string">&#x27;#FFFFFF&#x27;</span>,<br>      <span class="hljs-attribute">fontSize</span>: echartConfig.fontSize<br>    &#125;<br>  &#125;<br></code></pre></td></tr></table></figure><ol start="2"><li>三环效果，echart3本身支持内外两环设置，如下:</li></ol><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sqf"> series: [&#123;<br>          <span class="hljs-built_in">name</span>: <span class="hljs-string">&#x27;性别分布&#x27;</span>,<br>          <span class="hljs-built_in">type</span>: <span class="hljs-string">&#x27;pie&#x27;</span>,<br>          radius: [<span class="hljs-string">&#x27;50%&#x27;</span>,<span class="hljs-string">&#x27;60%&#x27;</span>],    <span class="hljs-comment">// 设置内环/外环大小</span><br>          center: [<span class="hljs-string">&#x27;50%&#x27;</span>, <span class="hljs-string">&#x27;42%&#x27;</span>],<br></code></pre></td></tr></table></figure><p>…<br>第三环由UI出图仅做展示用途。利用position: absolute;     z-index: 10; 巧妙堆叠至echart报表之下，注意 z-index一定要低于图表。</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-operator">&lt;</span>div class<span class="hljs-operator">=</span><span class="hljs-string">&quot;pie-echart-mask&quot;</span><span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>div<span class="hljs-operator">&gt;</span><br>.pie-echart-mask &#123;<br>    <span class="hljs-params">position:</span> absolute;<br>    <span class="hljs-params">left:</span> <span class="hljs-number">135</span>px;<br>    <span class="hljs-params">top:</span> <span class="hljs-number">33</span>px;<br>    <span class="hljs-params">z-index:</span> <span class="hljs-number">1001</span>;<br>    <span class="hljs-params">width:</span> <span class="hljs-number">115</span>px;<br>    <span class="hljs-params">height:</span> <span class="hljs-number">115</span>px;<br>    <span class="hljs-params">background:</span> url(..<span class="hljs-operator">/</span>img<span class="hljs-operator">/</span>big<span class="hljs-operator">/</span>pie-bg-<span class="hljs-number">9</span>c88e322cf.png);<br>    <span class="hljs-params">background-size:</span> <span class="hljs-number">115</span>px <span class="hljs-number">115</span>px;<br>&#125;<br></code></pre></td></tr></table></figure><p>坐标轴图表问题总结</p><p>1.柱状图&#x2F;线形图 x&#x2F;y轴数据未显示完全，通过设宽宽度，缩放图例</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-id">#div_chajian_yuanzhu</span> &#123;<br>    <span class="hljs-attribute">height</span>: <span class="hljs-number">120px</span>;<br>    <span class="hljs-attribute">width</span>: <span class="hljs-number">480px</span>;<br>    <span class="hljs-attribute">position</span>: absolute;<br>    <span class="hljs-attribute">left</span>: -<span class="hljs-number">63px</span>;<br>    <span class="hljs-attribute">bottom</span>: <span class="hljs-number">15px</span>;<br>    -webkit-<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(.<span class="hljs-number">7</span>,<span class="hljs-number">1</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>2.删除网格</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nix"> <span class="hljs-params">xAxis:</span> [<br>                &#123;<br>                    <span class="hljs-params">splitLine:</span> &#123;<span class="hljs-params">show:</span> <span class="hljs-literal">false</span>&#125;,<span class="hljs-operator">//</span>去除网格线<br>...<br></code></pre></td></tr></table></figure><p>3.轴线文字竖排</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs arcade"> xAxis: [<br>                &#123;<br>                    <span class="hljs-attr">splitLine</span>: &#123;<span class="hljs-attr">show</span>: <span class="hljs-literal">false</span>&#125;,<span class="hljs-comment">//去除网格线                    </span><br>                    axisLabel: &#123; <span class="hljs-comment">//调整x轴的lable</span><br>                        interval: <span class="hljs-number">0</span>,   <span class="hljs-comment">//X轴信息全部显示;</span><br>                        textStyle: &#123;<br>                            <span class="hljs-attr">fontSize</span>: <span class="hljs-number">12</span>,<br>                            <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;#fff&#x27;</span>,<br>                        &#125;,<br>                        <span class="hljs-attr">formatter</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) &#123;<br>                            <span class="hljs-comment">//x轴的文字改为竖版显示</span><br>                            <span class="hljs-keyword">var</span> str = value.<span class="hljs-built_in">split</span>(<span class="hljs-string">&quot;&quot;</span>);<br>                            <span class="hljs-keyword">return</span> str.join(<span class="hljs-string">&quot;\n&quot;</span>);<br>                            <span class="hljs-comment">// return &#x27;&#123;a|&#x27; + value + &#x27;&#125;&#x27;;</span><br>                        &#125;<br>                    &#125;,<br>...<br></code></pre></td></tr></table></figure><p>4.网格内容位置调整，（实际图表内容）</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-attribute">grid</span>: &#123;<br>    <span class="hljs-attribute">left</span>: <span class="hljs-string">&#x27;1%&#x27;</span>,<br>    <span class="hljs-attribute">right</span>: <span class="hljs-string">&#x27;1%&#x27;</span>,<br>    <span class="hljs-attribute">top</span>: <span class="hljs-string">&#x27;10%&#x27;</span>,<br>    <span class="hljs-attribute">bottom</span>: <span class="hljs-string">&#x27;14%&#x27;</span>,<br>    <span class="hljs-attribute">containLabel</span>: true<br>&#125;,<br></code></pre></td></tr></table></figure><p>5.渐变色</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-attribute">color</span>: new echarts.graphic.<span class="hljs-built_in">LinearGradient</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, [&#123;<br>           <span class="hljs-attribute">offset</span>: <span class="hljs-number">0</span>,<br>           color: <span class="hljs-string">&#x27;#0E92A1&#x27;</span><br>       &#125;, &#123;<br>           <span class="hljs-attribute">offset</span>: <span class="hljs-number">1</span>,<br>           color: <span class="hljs-string">&#x27;#0A5B94&#x27;</span><br>       &#125;])<br></code></pre></td></tr></table></figure><p>附：完整饼图示例</p><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs xl">var demoOption = &#123;<br>            <span class="hljs-built_in">title</span>: &#123;<br>                <span class="hljs-keyword">text</span>: <span class="hljs-string">&#x27;demo&#x27;</span>,<br>                <span class="hljs-comment">// subtext: &#x27;纯属虚构&#x27;,</span><br>                x: <span class="hljs-string">&#x27;center&#x27;</span>,<br>                y: <span class="hljs-string">&#x27;44%&#x27;</span>,<br>                textStyle: &#123;<br>                    fontWeight: <span class="hljs-string">&#x27;normal&#x27;</span>,              <span class="hljs-comment">//标题颜色</span><br>                    <span class="hljs-built_in">color</span>: <span class="hljs-string">&#x27;#FFFFFF&#x27;</span>,<br>                    fontSize: <span class="hljs-number">14</span><br>                &#125;<br>            &#125;,<br>            series: [<br>                &#123;<br>                    <span class="hljs-keyword">name</span>: <span class="hljs-string">&#x27;消费用途&#x27;</span>,<br>                    type: <span class="hljs-string">&#x27;pie&#x27;</span>,<br>                    radius: [<span class="hljs-string">&#x27;39%&#x27;</span>, <span class="hljs-string">&#x27;47%&#x27;</span>],<br>                    center: [<span class="hljs-string">&#x27;50%&#x27;</span>, <span class="hljs-string">&#x27;50%&#x27;</span>],<br>                    <span class="hljs-comment">// label: &#123;</span><br>                    <span class="hljs-comment">//     normal: &#123;</span><br>                    <span class="hljs-comment">//         //formatter: &#x27;&#123;b&#125;:&#123;c&#125;: (&#123;d&#125;%)&#x27;,</span><br>                    <span class="hljs-comment">//         textStyle: &#123;</span><br>                    <span class="hljs-comment">//             fontWeight: &#x27;normal&#x27;,</span><br>                    <span class="hljs-comment">//             fontSize: 10,</span><br>                    <span class="hljs-comment">//             color: echartConfig.commonEchartColor</span><br>                    <span class="hljs-comment">//         &#125;</span><br>                    <span class="hljs-comment">//     &#125;</span><br>                    <span class="hljs-comment">// &#125;,</span><br>                    labelLine: &#123;<br>                        normal: &#123;<br>                            length: <span class="hljs-number">25</span><br>                        &#125;<br>                    &#125;,<br>                    <span class="hljs-keyword">data</span>: [&#123;value: <span class="hljs-string">&quot;80%&quot;</span>, <span class="hljs-keyword">name</span>: <span class="hljs-string">&quot;男&quot;</span>&#125;, &#123;value: <span class="hljs-string">&quot;20%&quot;</span>, <span class="hljs-keyword">name</span>: <span class="hljs-string">&quot;女&quot;</span>&#125;],    <span class="hljs-comment">// 实际饼图</span><br>                    itemStyle: &#123;<br>                        emphasis: &#123;<br>                            shadowBlur: <span class="hljs-number">10</span>,<br>                            shadowOffsetX: <span class="hljs-number">0</span>,<br>                            shadowColor: <span class="hljs-string">&#x27;rgba(0, 0, 0, 0.5)&#x27;</span><br>                        &#125;<br>                    &#125;,<br>                    <span class="hljs-built_in">color</span>: [<span class="hljs-string">&#x27;#5E86EB&#x27;</span>, <span class="hljs-string">&#x27;#3764D1&#x27;</span>, <span class="hljs-string">&#x27;#1740AB&#x27;</span>, <span class="hljs-string">&#x27;#3462D8&#x27;</span>, <span class="hljs-string">&#x27;#2759D5&#x27;</span>, <span class="hljs-string">&#x27;#1945B4&#x27;</span>, <span class="hljs-string">&#x27;#3655CE&#x27;</span>, <span class="hljs-string">&#x27;#183FA9&#x27;</span>, <span class="hljs-string">&#x27;#1D46AC&#x27;</span>, <span class="hljs-string">&#x27;#224396&#x27;</span>]<br>                &#125;<br>            ],<br>        &#125;;<br></code></pre></td></tr></table></figure><p>附2：柱状图</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><code class="hljs nix">var zhuzhuangDemo<span class="hljs-operator">=</span> &#123;<br>            <span class="hljs-params">title:</span> &#123;<br>                <span class="hljs-params">text:</span> &#x27;柱状图demo&#x27;,<br>                <span class="hljs-operator">//</span> <span class="hljs-params">subtext:</span> &#x27;纯属虚构&#x27;,<br>                <span class="hljs-params">x:</span> &#x27;right&#x27;,<br>                <span class="hljs-params">y:</span> &#x27;bottom&#x27;,<br>                <span class="hljs-params">textStyle:</span> &#123;<br>                    <span class="hljs-params">fontWeight:</span> &#x27;normal&#x27;,              <span class="hljs-operator">//</span>标题颜色<br>                    <span class="hljs-params">color:</span> <span class="hljs-string">&quot;#fff&quot;</span>,<br>                    <span class="hljs-params">fontSize:</span> <span class="hljs-number">10</span><br>                &#125;<br>            &#125;,<br>            <span class="hljs-params">tooltip:</span> &#123;<br>                <span class="hljs-params">formatter:</span> function (params, vals) &#123;<br>                    var val <span class="hljs-operator">=</span> params[<span class="hljs-number">0</span>].name <span class="hljs-operator">+</span> &#x27; : \n&#x27; <span class="hljs-operator">+</span> params[<span class="hljs-number">0</span>].data <span class="hljs-operator">*</span> <span class="hljs-number">1000000</span><br>                    return val<br>                &#125;,<br>                <span class="hljs-params">trigger:</span> &#x27;axis&#x27;,<br>                <span class="hljs-params">axisPointer:</span> &#123;            <span class="hljs-operator">//</span> 坐标轴指示器，坐标轴触发有效<br>                    <span class="hljs-params">type:</span> &#x27;shadow&#x27;        <span class="hljs-operator">//</span> 默认为直线，可选为：&#x27;line&#x27; | &#x27;shadow&#x27;<br>                &#125;<br>            &#125;,<br>            <span class="hljs-params">grid:</span> &#123;<br>                <span class="hljs-params">left:</span> &#x27;<span class="hljs-number">1</span>%&#x27;,<br>                <span class="hljs-params">right:</span> &#x27;<span class="hljs-number">1</span>%&#x27;,<br>                <span class="hljs-params">top:</span> &#x27;<span class="hljs-number">10</span>%&#x27;,<br>                <span class="hljs-params">bottom:</span> &#x27;<span class="hljs-number">14</span>%&#x27;,<br>                <span class="hljs-params">containLabel:</span> <span class="hljs-literal">true</span><br>            &#125;,<br>            <span class="hljs-params">xAxis:</span> [<br>                &#123;<br>                    <span class="hljs-params">splitLine:</span> &#123;<span class="hljs-params">show:</span> <span class="hljs-literal">false</span>&#125;,<span class="hljs-operator">//</span>去除网格线<br>                    <span class="hljs-params">axisLine:</span> &#123;<br>                        <span class="hljs-params">lineStyle:</span> &#123;<br>                            <span class="hljs-params">color:</span> &#x27;rgba(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)&#x27;<br>                        &#125;<br>                    &#125;,<br>                    <span class="hljs-params">label:</span> &#123;<br>                        <span class="hljs-params">position:</span> &#x27;insideRight&#x27;<br>                    &#125;,<br>                    <span class="hljs-params">type:</span> &#x27;category&#x27;,<br>                    <span class="hljs-params">axisLabel:</span> &#123; <span class="hljs-operator">//</span>调整x轴的lable<br>                        <span class="hljs-params">interval:</span> <span class="hljs-number">0</span>,   <span class="hljs-operator">//</span>X轴信息全部显示;<br>                        <span class="hljs-params">textStyle:</span> &#123;<br>                            <span class="hljs-params">fontSize:</span> <span class="hljs-number">12</span>,<br>                            <span class="hljs-params">color:</span> <span class="hljs-string">&quot;#fff&quot;</span><br>                        &#125;,<br>                        <span class="hljs-params">formatter:</span> function (value) &#123;<br>                            <span class="hljs-operator">//</span>x轴的文字改为竖版显示<br>                            var str <span class="hljs-operator">=</span> value.split(<span class="hljs-string">&quot;&quot;</span>);<br>                            return str.join(<span class="hljs-string">&quot;<span class="hljs-char escape_">\n</span>&quot;</span>);<br>                            <span class="hljs-operator">//</span> return &#x27;&#123;a|&#x27; <span class="hljs-operator">+</span> value <span class="hljs-operator">+</span> &#x27;&#125;&#x27;;<br>                        &#125;<br>                    &#125;,<br>                    <span class="hljs-params">data:</span> num1,<br>                    <span class="hljs-params">axisTick:</span> &#123;<br>                        <span class="hljs-params">alignWithLabel:</span> <span class="hljs-literal">false</span><br>                    &#125;<br>                &#125;<br>            ],<br>            <span class="hljs-params">yAxis:</span> [<br>                &#123;<br>                    <span class="hljs-params">splitLine:</span> &#123;<span class="hljs-params">show:</span> <span class="hljs-literal">false</span>&#125;,<span class="hljs-operator">//</span>去除网格线<br>                    <span class="hljs-params">axisLine:</span> &#123;<br>                        <span class="hljs-params">lineStyle:</span> &#123;<br>                            <span class="hljs-params">color:</span> &#x27;rgba(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)&#x27;<br>                        &#125;<br>                    &#125;,<br>                    <span class="hljs-params">type:</span> &#x27;value&#x27;,<br>                    <span class="hljs-params">axisLabel:</span> &#123; <span class="hljs-operator">//</span>调整x轴的lable<br>                        <span class="hljs-params">formatter:</span> &#x27;&#123;value&#125; 百万&#x27;,<br>                        <span class="hljs-operator">//</span> <span class="hljs-params">rotate:</span> <span class="hljs-operator">-</span><span class="hljs-number">45</span>,     <span class="hljs-operator">//</span>文字逆时针旋转<span class="hljs-number">45</span>°<br>                        <span class="hljs-params">textStyle:</span> &#123;<br>                            <span class="hljs-params">fontSize:</span> <span class="hljs-number">10</span>,<br>                            <span class="hljs-params">color:</span> <span class="hljs-string">&quot;#fff&quot;</span><br>                        &#125;<br>                    &#125;,<br>                &#125;<br>            ],<br>            <span class="hljs-params">series:</span> [<br>                &#123;<br>                    <span class="hljs-params">name:</span> &#x27;分布&#x27;,<br>                    <span class="hljs-params">type:</span> &#x27;bar&#x27;,<br>                    <span class="hljs-params">barWidth:</span> &#x27;<span class="hljs-number">50</span>%&#x27;,<br>                    <span class="hljs-params">data:</span> [&#123;<span class="hljs-params">name:</span> &#x27;北京&#x27;, <span class="hljs-params">value:</span> &#x27;<span class="hljs-number">232144789</span>&#x27;&#125;,&#123;<span class="hljs-params">name:</span> &#x27;上海&#x27;, <span class="hljs-params">value:</span> &#x27;<span class="hljs-number">789124823</span>&#x27;&#125;,&#123;<span class="hljs-params">name:</span> &#x27;南京&#x27;, <span class="hljs-params">value:</span> &#x27;<span class="hljs-number">123478789123</span>&#x27;&#125;],<br>                    <span class="hljs-params">itemStyle:</span> &#123;<br>                        <span class="hljs-params">normal:</span> &#123;<br>                            <span class="hljs-params">fontSize:</span> <span class="hljs-number">8</span>,<br>                            <span class="hljs-operator">//</span>颜色渐变<br>                            <span class="hljs-params">color:</span> &#x27;<span class="hljs-comment">#215ADD&#x27;</span><br>                        &#125;<br>                    &#125;<br>                &#125;<br>            ]<br>        &#125;;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>echart3</tag>
      
      <tag>饼图</tag>
      
      <tag>柱状图</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2019-04-04-echart3中国地图（重庆地图）</title>
    <link href="/2025/11/28/2019-04-04-echart3%E4%B8%AD%E5%9B%BD%E5%9C%B0%E5%9B%BE%EF%BC%88%E9%87%8D%E5%BA%86%E5%9C%B0%E5%9B%BE%EF%BC%89/"/>
    <url>/2025/11/28/2019-04-04-echart3%E4%B8%AD%E5%9B%BD%E5%9C%B0%E5%9B%BE%EF%BC%88%E9%87%8D%E5%BA%86%E5%9C%B0%E5%9B%BE%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<blockquote></blockquote><span id="more"></span><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>近期开发中涉及echart3地图标注涟漪特效展示，及简单的点击操作，这里做下记录，包含自己整理的中国地图、重庆地图经纬度数据。</p><h2 id="html标签"><a href="#html标签" class="headerlink" title="html标签"></a>html标签</h2><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">&lt;<span class="hljs-keyword">div</span> <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;main&quot;</span> style=<span class="hljs-string">&quot;width: 812px;height: 550px; &quot;</span>&gt;&lt;/<span class="hljs-keyword">div</span>&gt;<br></code></pre></td></tr></table></figure><h2 id="大屏适配"><a href="#大屏适配" class="headerlink" title="大屏适配"></a>大屏适配</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;link <span class="hljs-attribute">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attribute">media</span>=<span class="hljs-string">&quot;mediatype and|not|only (media feature)&quot;</span> <span class="hljs-attribute">href</span>=<span class="hljs-string">&quot;mystylesheet.css&quot;</span>&gt;<br>&lt;link <span class="hljs-attribute">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attribute">media</span>=<span class="hljs-string">&quot;@media screen and (min-width: 1080px) and (max-width: 1281px)&quot;</span> <span class="hljs-attribute">href</span>=<span class="hljs-string">&quot;demo1280.css&quot;</span>&gt;<br>&lt;link <span class="hljs-attribute">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attribute">media</span>=<span class="hljs-string">&quot;@media screen and (min-width: 1281px) and (max-width: 1440px)&quot;</span> <span class="hljs-attribute">href</span>=<span class="hljs-string">&quot;demo1366.css&quot;</span>&gt;<br></code></pre></td></tr></table></figure><h2 id="echart3百度地图"><a href="#echart3百度地图" class="headerlink" title="echart3百度地图"></a>echart3百度地图</h2><h3 id="重庆地图、中国地图数据（包含两组经纬度数据，兼容1920-768-及-1366-768）"><a href="#重庆地图、中国地图数据（包含两组经纬度数据，兼容1920-768-及-1366-768）" class="headerlink" title="重庆地图、中国地图数据（包含两组经纬度数据，兼容1920*768 及 1366 * 768）"></a>重庆地图、中国地图数据（包含两组经纬度数据，兼容1920*768 及 1366 * 768）</h3><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br></pre></td><td class="code"><pre><code class="hljs prolog">var myChart = null;<br>var showMapChina = true;<br>var levelArr = null;<br>var convertData = function (geoCoordMap, mapData) &#123;<br>    var res = [];<br>    if (<span class="hljs-symbol">Array</span>.isArray(mapData)) &#123;<br>        for (var i = <span class="hljs-number">0</span>; i &lt; mapData.length; i++) &#123;<br>            var geoCoord = geoCoordMap[mapData[i].name];<br>            if (geoCoord) &#123;<br>                res.push(&#123;<br>                    name: mapData[i].name,<br>                    value: geoCoord.concat(mapData[i].value)<br>                &#125;);<br>            &#125;<br>        &#125;<br>    &#125; else &#123;<br>        for (var key in mapData) &#123;<br>            // console.log(<span class="hljs-string">&quot;属性：&quot;</span> + key + <span class="hljs-string">&quot;,值：&quot;</span> + mapData[key] + <span class="hljs-string">&#x27;,geo：&#x27;</span> + geoCoordMap[key]);<br>            var geoCoord = geoCoordMap[key];<br>            if (geoCoord) &#123;<br>                var data = &#123;<br>                    name: key,<br>                    value: geoCoord.concat(mapData[key]),<br>                &#125;<br>                if (showMapChina) &#123;<br>                    data.level = levelArr[key]<br>                &#125;<br>                res.push(data);<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    return res;<br>&#125;;<br>// 中国地图省市经纬度<br>var geoCoordMap = null<br>// 大屏下 中国地图经纬度<br>const geoCoordMapBig = &#123;<br>    <span class="hljs-string">&#x27;北京市&#x27;</span>: [<span class="hljs-number">116.46</span>, <span class="hljs-number">39.92</span>],<br>    <span class="hljs-string">&#x27;重庆市&#x27;</span>: [<span class="hljs-number">106.54</span>, <span class="hljs-number">29.59</span>],<br>    <span class="hljs-string">&#x27;上海市&#x27;</span>: [<span class="hljs-number">121.48</span>, <span class="hljs-number">31.22</span>],<br>    <span class="hljs-string">&#x27;天津市&#x27;</span>: [<span class="hljs-number">117.5</span>, <span class="hljs-number">39.13</span>],<br>    <span class="hljs-string">&#x27;河北省&#x27;</span>: [<span class="hljs-number">114.48</span>, <span class="hljs-number">37.03</span>],<br>    <span class="hljs-string">&#x27;山西省&#x27;</span>: [<span class="hljs-number">111.73</span>, <span class="hljs-number">37.87</span>],<br>    <span class="hljs-string">&#x27;辽宁省&#x27;</span>: [<span class="hljs-number">122.18</span>, <span class="hljs-number">41.8</span>],<br>    <span class="hljs-string">&#x27;吉林省&#x27;</span>: [<span class="hljs-number">125.35</span>, <span class="hljs-number">43.88</span>],<br>    <span class="hljs-string">&#x27;黑龙江省&#x27;</span>: [<span class="hljs-number">126.63</span>, <span class="hljs-number">46.75</span>],<br>    <span class="hljs-string">&#x27;江苏省&#x27;</span>: [<span class="hljs-number">120.18</span>, <span class="hljs-number">32.54</span>],<br>    <span class="hljs-string">&#x27;浙江省&#x27;</span>: [<span class="hljs-number">120.19</span>, <span class="hljs-number">28.66</span>],<br>    <span class="hljs-string">&#x27;安徽省&#x27;</span>: [<span class="hljs-number">117.27</span>, <span class="hljs-number">31.86</span>],<br>    <span class="hljs-string">&#x27;福建省&#x27;</span>: [<span class="hljs-number">119.3</span>, <span class="hljs-number">26.08</span>],<br>    <span class="hljs-string">&#x27;江西省&#x27;</span>: [<span class="hljs-number">115.89</span>, <span class="hljs-number">28.68</span>],<br>    <span class="hljs-string">&#x27;山东省&#x27;</span>: [<span class="hljs-number">118</span>, <span class="hljs-number">36.15</span>],<br>    <span class="hljs-string">&#x27;河南省&#x27;</span>: [<span class="hljs-number">113.65</span>, <span class="hljs-number">33.76</span>],<br>    <span class="hljs-string">&#x27;湖北省&#x27;</span>: [<span class="hljs-number">114.31</span>, <span class="hljs-number">30.52</span>],<br>    <span class="hljs-string">&#x27;湖南省&#x27;</span>: [<span class="hljs-number">110.8</span>, <span class="hljs-number">28.21</span>],<br>    <span class="hljs-string">&#x27;广东省&#x27;</span>: [<span class="hljs-number">113.23</span>, <span class="hljs-number">23.16</span>],<br>    <span class="hljs-string">&#x27;海南省&#x27;</span>: [<span class="hljs-number">109.511909</span>, <span class="hljs-number">18.852847</span>],<br>    <span class="hljs-string">&#x27;四川省&#x27;</span>: [<span class="hljs-number">104.06</span>, <span class="hljs-number">30.67</span>],<br>    <span class="hljs-string">&#x27;贵州省&#x27;</span>: [<span class="hljs-number">106.71</span>, <span class="hljs-number">26.57</span>],<br>    <span class="hljs-string">&#x27;云南省&#x27;</span>: [<span class="hljs-number">102.72</span>, <span class="hljs-number">25.04</span>],<br>    <span class="hljs-string">&#x27;陕西省&#x27;</span>: [<span class="hljs-number">108.95</span>, <span class="hljs-number">34.27</span>],<br>    <span class="hljs-string">&#x27;甘肃省&#x27;</span>: [<span class="hljs-number">103.73</span>, <span class="hljs-number">36.03</span>],<br>    <span class="hljs-string">&#x27;青海省&#x27;</span>: [<span class="hljs-number">97.74</span>, <span class="hljs-number">36.56</span>],<br>    <span class="hljs-string">&#x27;台湾省&#x27;</span>: [<span class="hljs-number">121.5365</span>, <span class="hljs-number">25.0192</span>],<br>    <span class="hljs-string">&#x27;内蒙古自治区&#x27;</span>: [<span class="hljs-number">111.65</span>, <span class="hljs-number">41.82</span>],<br>    <span class="hljs-string">&#x27;广西壮族自治区&#x27;</span>: [<span class="hljs-number">108.33</span>, <span class="hljs-number">22.84</span>],<br>    <span class="hljs-string">&#x27;西藏自治区&#x27;</span>: [<span class="hljs-number">91.11</span>, <span class="hljs-number">29.97</span>],<br>    <span class="hljs-string">&#x27;宁夏回族自治区&#x27;</span>: [<span class="hljs-number">106.27</span>, <span class="hljs-number">38.47</span>],<br>    <span class="hljs-string">&#x27;新疆维吾尔自治区&#x27;</span>: [<span class="hljs-number">87.68</span>, <span class="hljs-number">43.77</span>],<br>    <span class="hljs-string">&#x27;香港特别行政区&#x27;</span>: [<span class="hljs-number">113.35</span>, <span class="hljs-number">22.14</span>],<br>    <span class="hljs-string">&#x27;澳门特别行政区&#x27;</span>: [<span class="hljs-number">113.5</span>, <span class="hljs-number">22.2</span>]<br>&#125;;<br>// <span class="hljs-number">1366</span>下 中国地图经纬度<br>const geoCoordMapSmall = &#123;<br>    <span class="hljs-string">&#x27;北京市&#x27;</span>: [<span class="hljs-number">116.46</span>, <span class="hljs-number">40.92</span>],<br>    <span class="hljs-string">&#x27;重庆市&#x27;</span>: [<span class="hljs-number">107.54</span>, <span class="hljs-number">29.59</span>],<br>    <span class="hljs-string">&#x27;上海市&#x27;</span>: [<span class="hljs-number">121.48</span>, <span class="hljs-number">31.22</span>],<br>    <span class="hljs-string">&#x27;天津市&#x27;</span>: [<span class="hljs-number">117.5</span>, <span class="hljs-number">39.13</span>],<br>    <span class="hljs-string">&#x27;河北省&#x27;</span>: [<span class="hljs-number">114.48</span>, <span class="hljs-number">37.03</span>],<br>    <span class="hljs-string">&#x27;山西省&#x27;</span>: [<span class="hljs-number">111.73</span>, <span class="hljs-number">37.87</span>],<br>    <span class="hljs-string">&#x27;辽宁省&#x27;</span>: [<span class="hljs-number">122.18</span>, <span class="hljs-number">41.8</span>],<br>    <span class="hljs-string">&#x27;吉林省&#x27;</span>: [<span class="hljs-number">125.35</span>, <span class="hljs-number">43.88</span>],<br>    <span class="hljs-string">&#x27;黑龙江省&#x27;</span>: [<span class="hljs-number">127.63</span>, <span class="hljs-number">47.75</span>],<br>    <span class="hljs-string">&#x27;江苏省&#x27;</span>: [<span class="hljs-number">120.18</span>, <span class="hljs-number">32.54</span>],<br>    <span class="hljs-string">&#x27;浙江省&#x27;</span>: [<span class="hljs-number">120.19</span>, <span class="hljs-number">28.66</span>],<br>    <span class="hljs-string">&#x27;安徽省&#x27;</span>: [<span class="hljs-number">117.27</span>, <span class="hljs-number">31.86</span>],<br>    <span class="hljs-string">&#x27;福建省&#x27;</span>: [<span class="hljs-number">117.3</span>, <span class="hljs-number">25.28</span>],<br>    <span class="hljs-string">&#x27;江西省&#x27;</span>: [<span class="hljs-number">115.89</span>, <span class="hljs-number">28.68</span>],<br>    <span class="hljs-string">&#x27;山东省&#x27;</span>: [<span class="hljs-number">118</span>, <span class="hljs-number">35.55</span>],<br>    <span class="hljs-string">&#x27;河南省&#x27;</span>: [<span class="hljs-number">113.65</span>, <span class="hljs-number">33.76</span>],<br>    <span class="hljs-string">&#x27;湖北省&#x27;</span>: [<span class="hljs-number">114.31</span>, <span class="hljs-number">30.52</span>],<br>    <span class="hljs-string">&#x27;湖南省&#x27;</span>: [<span class="hljs-number">110.8</span>, <span class="hljs-number">28.21</span>],<br>    <span class="hljs-string">&#x27;广东省&#x27;</span>: [<span class="hljs-number">113.23</span>, <span class="hljs-number">23.16</span>],<br>    <span class="hljs-string">&#x27;海南省&#x27;</span>: [<span class="hljs-number">109.511909</span>, <span class="hljs-number">18.852847</span>],<br>    <span class="hljs-string">&#x27;四川省&#x27;</span>: [<span class="hljs-number">104.06</span>, <span class="hljs-number">30.67</span>],<br>    <span class="hljs-string">&#x27;贵州省&#x27;</span>: [<span class="hljs-number">106.31</span>, <span class="hljs-number">25.57</span>],<br>    <span class="hljs-string">&#x27;云南省&#x27;</span>: [<span class="hljs-number">102.72</span>, <span class="hljs-number">25.04</span>],<br>    <span class="hljs-string">&#x27;陕西省&#x27;</span>: [<span class="hljs-number">108.95</span>, <span class="hljs-number">34.27</span>],<br>    <span class="hljs-string">&#x27;甘肃省&#x27;</span>: [<span class="hljs-number">103.73</span>, <span class="hljs-number">34.63</span>],<br>    <span class="hljs-string">&#x27;青海省&#x27;</span>: [<span class="hljs-number">97.74</span>, <span class="hljs-number">36.56</span>],<br>    <span class="hljs-string">&#x27;台湾省&#x27;</span>: [<span class="hljs-number">121.5365</span>, <span class="hljs-number">25.0192</span>],<br>    <span class="hljs-string">&#x27;内蒙古自治区&#x27;</span>: [<span class="hljs-number">111.65</span>, <span class="hljs-number">41.82</span>],<br>    <span class="hljs-string">&#x27;广西壮族自治区&#x27;</span>: [<span class="hljs-number">108.33</span>, <span class="hljs-number">22.84</span>],<br>    <span class="hljs-string">&#x27;西藏自治区&#x27;</span>: [<span class="hljs-number">91.11</span>, <span class="hljs-number">29.97</span>],<br>    <span class="hljs-string">&#x27;宁夏回族自治区&#x27;</span>: [<span class="hljs-number">106.27</span>, <span class="hljs-number">38.47</span>],<br>    <span class="hljs-string">&#x27;新疆维吾尔自治区&#x27;</span>: [<span class="hljs-number">87.68</span>, <span class="hljs-number">43.77</span>],<br>    <span class="hljs-string">&#x27;香港特别行政区&#x27;</span>: [<span class="hljs-number">113.35</span>, <span class="hljs-number">22.14</span>],<br>    <span class="hljs-string">&#x27;澳门特别行政区&#x27;</span>: [<span class="hljs-number">113.5</span>, <span class="hljs-number">22.2</span>]<br>&#125;;<br><br>//重庆地图区县经纬度<br>var geoCoordMapOfCq = null<br>// 大屏下 重庆地图经纬度<br>var geoCoordMapOfCqBig = &#123;<br>    <span class="hljs-string">&#x27;主城&#x27;</span>: [<span class="hljs-number">106.55</span>, <span class="hljs-number">29.57</span>],<br>    <span class="hljs-string">&#x27;綦江&#x27;</span>: [<span class="hljs-number">106.65</span>, <span class="hljs-number">29.03</span>],<br>    <span class="hljs-string">&#x27;长寿&#x27;</span>: [<span class="hljs-number">107.08</span>, <span class="hljs-number">29.87</span>],<br>    <span class="hljs-string">&#x27;合川&#x27;</span>: [<span class="hljs-number">106.15</span>, <span class="hljs-number">30.12</span>],<br>    <span class="hljs-string">&#x27;潼南&#x27;</span>: [<span class="hljs-number">105.83</span>, <span class="hljs-number">30.18</span>],<br>    <span class="hljs-string">&#x27;铜梁&#x27;</span>: [<span class="hljs-number">106.05</span>, <span class="hljs-number">29.85</span>],<br>    <span class="hljs-string">&#x27;壁山&#x27;</span>: [<span class="hljs-number">106.22</span>, <span class="hljs-number">29.60</span>],<br>    <span class="hljs-string">&#x27;荣昌&#x27;</span>: [<span class="hljs-number">105.58</span>, <span class="hljs-number">29.40</span>],<br>    <span class="hljs-string">&#x27;大足&#x27;</span>: [<span class="hljs-number">105.72</span>, <span class="hljs-number">29.70</span>],<br>    <span class="hljs-string">&#x27;永川&#x27;</span>: [<span class="hljs-number">105.78</span>, <span class="hljs-number">29.23</span>],<br>    <span class="hljs-string">&#x27;万盛&#x27;</span>: [<span class="hljs-number">106.92</span>, <span class="hljs-number">28.97</span>],<br>    <span class="hljs-string">&#x27;城口&#x27;</span>: [<span class="hljs-number">108.67</span>, <span class="hljs-number">31.95</span>],<br>    <span class="hljs-string">&#x27;开州&#x27;</span>: [<span class="hljs-number">108.42</span>, <span class="hljs-number">31.18</span>],<br>    <span class="hljs-string">&#x27;巫溪&#x27;</span>: [<span class="hljs-number">109.63</span>, <span class="hljs-number">31.40</span>],<br>    <span class="hljs-string">&#x27;巫山&#x27;</span>: [<span class="hljs-number">109.88</span>, <span class="hljs-number">31.08</span>],<br>    <span class="hljs-string">&#x27;云阳&#x27;</span>: [<span class="hljs-number">108.97</span>, <span class="hljs-number">30.95</span>],<br>    <span class="hljs-string">&#x27;忠县&#x27;</span>: [<span class="hljs-number">108.02</span>, <span class="hljs-number">30.30</span>],<br>    <span class="hljs-string">&#x27;垫江&#x27;</span>: [<span class="hljs-number">107.35</span>, <span class="hljs-number">30.33</span>],<br>    <span class="hljs-string">&#x27;奉节&#x27;</span>: [<span class="hljs-number">109.47</span>, <span class="hljs-number">31.02</span>],<br>    <span class="hljs-string">&#x27;梁平&#x27;</span>: [<span class="hljs-number">107.80</span>, <span class="hljs-number">30.68</span>],<br>    <span class="hljs-string">&#x27;彭水&#x27;</span>: [<span class="hljs-number">108.17</span>, <span class="hljs-number">29.30</span>],<br>    <span class="hljs-string">&#x27;酉阳&#x27;</span>: [<span class="hljs-number">108.77</span>, <span class="hljs-number">28.85</span>],<br>    <span class="hljs-string">&#x27;武隆&#x27;</span>: [<span class="hljs-number">107.75</span>, <span class="hljs-number">29.33</span>],<br>    <span class="hljs-string">&#x27;秀山&#x27;</span>: [<span class="hljs-number">108.98</span>, <span class="hljs-number">28.45</span>],<br>    <span class="hljs-string">&#x27;黔江&#x27;</span>: [<span class="hljs-number">108.77</span>, <span class="hljs-number">29.53</span>],<br>    <span class="hljs-string">&#x27;涪陵&#x27;</span>: [<span class="hljs-number">107.40</span>, <span class="hljs-number">29.72</span>],<br>    <span class="hljs-string">&#x27;石柱&#x27;</span>: [<span class="hljs-number">108.12</span>, <span class="hljs-number">30.00</span>],<br>    <span class="hljs-string">&#x27;丰都&#x27;</span>: [<span class="hljs-number">107.73</span>, <span class="hljs-number">29.87</span>],<br>    <span class="hljs-string">&#x27;北碚&#x27;</span>: [<span class="hljs-number">106.50</span>, <span class="hljs-number">29.90</span>],<br>    <span class="hljs-string">&#x27;璧山&#x27;</span>: [<span class="hljs-number">106.22</span>, <span class="hljs-number">29.60</span>],<br>    <span class="hljs-string">&#x27;渝北&#x27;</span>: [<span class="hljs-number">106.73</span>, <span class="hljs-number">29.92</span>],<br>    <span class="hljs-string">&#x27;巴南&#x27;</span>: [<span class="hljs-number">106.78</span>, <span class="hljs-number">29.38</span>],<br>    <span class="hljs-string">&#x27;南川&#x27;</span>: [<span class="hljs-number">107.15</span>, <span class="hljs-number">29.10</span>],<br>    <span class="hljs-string">&#x27;江津&#x27;</span>: [<span class="hljs-number">106.16</span>, <span class="hljs-number">29.18</span>],<br>    <span class="hljs-string">&#x27;万州&#x27;</span>: [<span class="hljs-number">108.40</span>, <span class="hljs-number">30.82</span>],<br>&#125;;<br>// <span class="hljs-number">1366</span>下 重庆地图经纬度<br>var geoCoordMapOfCqSmall = &#123;<br>    <span class="hljs-string">&#x27;主城&#x27;</span>: [<span class="hljs-number">106.55</span>, <span class="hljs-number">29.47</span>],<br>    <span class="hljs-string">&#x27;綦江&#x27;</span>: [<span class="hljs-number">106.65</span>, <span class="hljs-number">28.83</span>],<br>    <span class="hljs-string">&#x27;长寿&#x27;</span>: [<span class="hljs-number">107.18</span>, <span class="hljs-number">29.87</span>],<br>    <span class="hljs-string">&#x27;合川&#x27;</span>: [<span class="hljs-number">106.35</span>, <span class="hljs-number">30.12</span>],<br>    <span class="hljs-string">&#x27;潼南&#x27;</span>: [<span class="hljs-number">105.83</span>, <span class="hljs-number">30.18</span>],<br>    <span class="hljs-string">&#x27;铜梁&#x27;</span>: [<span class="hljs-number">106.05</span>, <span class="hljs-number">29.85</span>],<br>    <span class="hljs-string">&#x27;壁山&#x27;</span>: [<span class="hljs-number">106.22</span>, <span class="hljs-number">29.60</span>],<br>    <span class="hljs-string">&#x27;荣昌&#x27;</span>: [<span class="hljs-number">105.48</span>, <span class="hljs-number">29.40</span>],<br>    <span class="hljs-string">&#x27;大足&#x27;</span>: [<span class="hljs-number">105.72</span>, <span class="hljs-number">29.70</span>],<br>    <span class="hljs-string">&#x27;永川&#x27;</span>: [<span class="hljs-number">105.78</span>, <span class="hljs-number">29.23</span>],<br>    <span class="hljs-string">&#x27;万盛&#x27;</span>: [<span class="hljs-number">106.92</span>, <span class="hljs-number">28.97</span>],<br>    <span class="hljs-string">&#x27;城口&#x27;</span>: [<span class="hljs-number">108.67</span>, <span class="hljs-number">31.95</span>],<br>    <span class="hljs-string">&#x27;开州&#x27;</span>: [<span class="hljs-number">108.42</span>, <span class="hljs-number">31.18</span>],<br>    <span class="hljs-string">&#x27;巫溪&#x27;</span>: [<span class="hljs-number">109.63</span>, <span class="hljs-number">31.40</span>],<br>    <span class="hljs-string">&#x27;巫山&#x27;</span>: [<span class="hljs-number">109.88</span>, <span class="hljs-number">31.08</span>],<br>    <span class="hljs-string">&#x27;云阳&#x27;</span>: [<span class="hljs-number">108.97</span>, <span class="hljs-number">30.95</span>],<br>    <span class="hljs-string">&#x27;忠县&#x27;</span>: [<span class="hljs-number">108.02</span>, <span class="hljs-number">30.30</span>],<br>    <span class="hljs-string">&#x27;垫江&#x27;</span>: [<span class="hljs-number">107.35</span>, <span class="hljs-number">30.33</span>],<br>    <span class="hljs-string">&#x27;奉节&#x27;</span>: [<span class="hljs-number">109.47</span>, <span class="hljs-number">31.02</span>],<br>    <span class="hljs-string">&#x27;梁平&#x27;</span>: [<span class="hljs-number">107.80</span>, <span class="hljs-number">30.68</span>],<br>    <span class="hljs-string">&#x27;彭水&#x27;</span>: [<span class="hljs-number">108.17</span>, <span class="hljs-number">29.30</span>],<br>    <span class="hljs-string">&#x27;酉阳&#x27;</span>: [<span class="hljs-number">108.77</span>, <span class="hljs-number">28.85</span>],<br>    <span class="hljs-string">&#x27;武隆&#x27;</span>: [<span class="hljs-number">107.75</span>, <span class="hljs-number">29.33</span>],<br>    <span class="hljs-string">&#x27;秀山&#x27;</span>: [<span class="hljs-number">108.98</span>, <span class="hljs-number">28.45</span>],<br>    <span class="hljs-string">&#x27;黔江&#x27;</span>: [<span class="hljs-number">108.77</span>, <span class="hljs-number">29.53</span>],<br>    <span class="hljs-string">&#x27;涪陵&#x27;</span>: [<span class="hljs-number">107.40</span>, <span class="hljs-number">29.72</span>],<br>    <span class="hljs-string">&#x27;石柱&#x27;</span>: [<span class="hljs-number">108.32</span>, <span class="hljs-number">30.00</span>],<br>    <span class="hljs-string">&#x27;丰都&#x27;</span>: [<span class="hljs-number">107.86</span>, <span class="hljs-number">29.87</span>],<br>    <span class="hljs-string">&#x27;北碚&#x27;</span>: [<span class="hljs-number">106.50</span>, <span class="hljs-number">29.90</span>],<br>    <span class="hljs-string">&#x27;璧山&#x27;</span>: [<span class="hljs-number">106.22</span>, <span class="hljs-number">29.60</span>],<br>    <span class="hljs-string">&#x27;渝北&#x27;</span>: [<span class="hljs-number">106.83</span>, <span class="hljs-number">29.92</span>],<br>    <span class="hljs-string">&#x27;巴南&#x27;</span>: [<span class="hljs-number">106.78</span>, <span class="hljs-number">29.38</span>],<br>    <span class="hljs-string">&#x27;南川&#x27;</span>: [<span class="hljs-number">107.15</span>, <span class="hljs-number">29.10</span>],<br>    <span class="hljs-string">&#x27;江津&#x27;</span>: [<span class="hljs-number">106.16</span>, <span class="hljs-number">29.18</span>],<br>    <span class="hljs-string">&#x27;万州&#x27;</span>: [<span class="hljs-number">108.40</span>, <span class="hljs-number">30.62</span>],<br>&#125;;<br><br>//地图插件 mapData:地图数据<br>function initChinaMap(mapData) &#123;<br>    var mapData = mapData;<br><br>    if (!myChart) &#123;<br>        myChart = echarts.init(document.getElementById(<span class="hljs-string">&#x27;main&#x27;</span>));<br>        // 点击省份功能<br>        myChart.on(<span class="hljs-string">&#x27;click&#x27;</span>, function (params) &#123;<br>            if (params.name == <span class="hljs-string">&#x27;重庆&#x27;</span> || params.name == <span class="hljs-string">&#x27;重庆市&#x27;</span>) &#123;<br>                // console.log(<span class="hljs-string">&quot;map重庆:&quot;</span> + params.data.name)<br>                showMapChina = false;<br>                getMapDate();<br>            &#125;<br>        &#125;);<br>    &#125;<br>    var mapOption = &#123;<br>        backgroundColor: <span class="hljs-string">&#x27;rgb(3,19,48)&#x27;</span>,<br>        title: &#123;<br>            text: <span class="hljs-string">&#x27;放款额地域分布图&#x27;</span>,<br>            left: <span class="hljs-string">&#x27;center&#x27;</span>,<br>            show: false,<br>            textStyle: &#123;<br>                color: <span class="hljs-string">&#x27;#fff&#x27;</span><br>            &#125;<br>        &#125;,<br>        tooltip: &#123;<br>            trigger: <span class="hljs-string">&#x27;item&#x27;</span><br>        &#125;,<br>        // visualMap: &#123;<br>        //     min: <span class="hljs-number">0</span>,<br>        //     max: <span class="hljs-number">2500</span>,<br>        //     left: <span class="hljs-string">&#x27;left&#x27;</span>,<br>        //     top: <span class="hljs-string">&#x27;bottom&#x27;</span>,<br>        //     text: [<span class="hljs-string">&#x27;高&#x27;</span>, <span class="hljs-string">&#x27;低&#x27;</span>],           // 文本，默认为数值文本<br>        //     calculable: true<br>        // &#125;,<br>        geo: &#123;<br>            map: <span class="hljs-string">&#x27;china&#x27;</span>,<br>            label: &#123;<br>                emphasis: &#123;<br>                    show: false<br>                &#125;<br>            &#125;,<br>            scaleLimit: [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>],<br>            zoom: <span class="hljs-number">1.2</span>,<br>            top: <span class="hljs-string">&#x27;9%&#x27;</span>,<br>            // 缩放和移动<br>            roam: false,<br>            aspectScale: <span class="hljs-number">0.85</span>,<br>            itemStyle: &#123;<br>                normal: &#123;<br>                    areaColor: <span class="hljs-string">&#x27;#063eba&#x27;</span>,<br>                    borderColor: <span class="hljs-string">&#x27;#031330&#x27;</span><br>                &#125;,<br>                emphasis: &#123;<br>                    areaColor: <span class="hljs-string">&#x27;#6896FF&#x27;</span><br>                &#125;<br>            &#125;<br>        &#125;,<br>        series: [<br>            &#123;<br>                name: <span class="hljs-string">&#x27;总交易额&#x27;</span>,<br>                type: <span class="hljs-string">&#x27;effectScatter&#x27;</span>,<br>                coordinateSystem: <span class="hljs-string">&#x27;geo&#x27;</span>,<br>                data: convertData(geoCoordMap, mapData),<br><br>                symbolSize: function (val, params) &#123;<br>                    // 根据数值大小展示不同，维度 （万）<br>                    var totalMoney = val[<span class="hljs-number">2</span>] / <span class="hljs-number">10000</span><br>                    if (totalMoney &lt; <span class="hljs-number">10000</span>) &#123;<br>                        return [<span class="hljs-number">3</span>, <span class="hljs-number">2</span>];<br>                    &#125; else if (totalMoney &gt; <span class="hljs-number">10000</span> &amp;&amp; totalMoney &lt; <span class="hljs-number">100000</span>) &#123;<br>                        return [<span class="hljs-number">5</span>, <span class="hljs-number">3</span>];<br>                    &#125; else if (totalMoney &gt; <span class="hljs-number">100000</span> &amp;&amp; totalMoney &lt; <span class="hljs-number">1000000</span>) &#123;<br>                        return [<span class="hljs-number">8</span>, <span class="hljs-number">5</span>];<br>                    &#125; else &#123;<br>                        return [<span class="hljs-number">10</span>, <span class="hljs-number">7</span>]<br>                    &#125;<br>                    // return  parseInt(val[<span class="hljs-number">2</span>] * <span class="hljs-number">40</span>);<br>                &#125;,<br>                //配置何时显示特效<span class="hljs-string">&#x27;render&#x27;</span> 绘制完成后显示特效。<span class="hljs-string">&#x27;emphasis&#x27;</span> 高亮（hover）的时候显示特效。<br>                showEffectOn: <span class="hljs-string">&#x27;render&#x27;</span>,<br>                //目前只有ripple这一种<br>                effectType: <span class="hljs-string">&#x27;ripple&#x27;</span>,<br>                animation: true,<br>                rippleEffect: &#123;<br>                    //动画的时间<br>                    period: <span class="hljs-number">4</span>,<br>                    //动画中波纹的最大缩放比例<br>                    scale: <span class="hljs-number">8</span>,<br>                    //波纹的绘制方式可选 <span class="hljs-string">&#x27;stroke&#x27;</span> 和 <span class="hljs-string">&#x27;fill&#x27;</span><br>                    brushType: <span class="hljs-string">&#x27;stroke&#x27;</span><br>                &#125;,<br>                //<span class="hljs-symbol">Scatter</span>才有这个属性,是否开启鼠标 hover 的提示动画效果<br>                hoverAnimation: true,<br><br>                tooltip: &#123;<br>                    formatter: function (params, ticket, callback) &#123;<br>                        return params.seriesName + <span class="hljs-string">&quot;&lt;br&gt;&quot;</span> + params.name + <span class="hljs-string">&quot;：&quot;</span> + params.value[<span class="hljs-number">2</span>];<br>                    &#125;,<br>                &#125;,<br>                label: &#123;<br>                    normal: &#123;<br>                        // 格式化省份名称，去除后缀<br>                        formatter: function (params, ticket, callback) &#123;<br>                            var splitArray = [<span class="hljs-string">&#x27;特别行政区&#x27;</span>, <span class="hljs-string">&#x27;回族自治区&#x27;</span>, <span class="hljs-string">&#x27;壮族自治区&#x27;</span>, <span class="hljs-string">&#x27;维吾尔自治区&#x27;</span>, <span class="hljs-string">&#x27;自治区&#x27;</span>, <span class="hljs-string">&#x27;省&#x27;</span>, <span class="hljs-string">&#x27;市&#x27;</span>];<br>                            var value = (params.value[<span class="hljs-number">2</span>] / <span class="hljs-number">10000</span>).toFixed(<span class="hljs-number">0</span>);<br>                            var name = params.name;<br>                            var lenth = splitArray.length;<br>                            for (var i = <span class="hljs-number">0</span>; i &lt; lenth; i++) &#123;<br>                                var index = name.indexOf(splitArray[i]);<br>                                if (index &gt; <span class="hljs-number">0</span>) &#123;<br>                                    name = name.substring(<span class="hljs-number">0</span>, index);<br>                                &#125;<br><br>                            &#125;<br>                            return <span class="hljs-string">&#x27;&#123;a|&#x27;</span> + value + <span class="hljs-string">&#x27;&#125;&#x27;</span> + <span class="hljs-string">&#x27;\n\n&#x27;</span> + <span class="hljs-string">&#x27;&#123;b|&#x27;</span> + name + <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>                        &#125;,<br>                        rich: &#123;<br>                            a: &#123;<br>                                color: <span class="hljs-string">&#x27;#fff&#x27;</span>,<br>                                fontSize: <span class="hljs-number">9</span>,<br>                                fontWeight: <span class="hljs-number">500</span><br>                            &#125;,<br>                            b: &#123;<br>                                color: <span class="hljs-string">&#x27;#fff&#x27;</span>,<br>                                fontSize: <span class="hljs-number">8</span>,<br>                            &#125;,<br>                        &#125;,<br>                        fontSize: <span class="hljs-number">14</span>,<br>                        align: <span class="hljs-string">&#x27;left&#x27;</span>,<br>                        position: <span class="hljs-string">&#x27;left&#x27;</span>,<br>                        offset: [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>],<br>                        show: true<br>                    &#125;,<br>                    emphasis: &#123;<br>                        show: false<br>                    &#125;<br>                &#125;,<br>                itemStyle: &#123;<br>                    normal: &#123;<br>                        color: function (params) &#123;<br>                            var level = params.data.level<br>                            // <span class="hljs-number">0</span> 无效<br>                            var colorList = [<span class="hljs-string">&#x27;#B5C334&#x27;</span>, <span class="hljs-string">&#x27;#50B3DA&#x27;</span>, <span class="hljs-string">&#x27;#7DD299&#x27;</span>, <span class="hljs-string">&#x27;#289DA3&#x27;</span>, <span class="hljs-string">&#x27;#F5B146&#x27;</span>];<br>                            return colorList[level]<br>                        &#125;,<br>                        shadowBlur: <span class="hljs-number">10</span>,<br>                        shadowColor: <span class="hljs-string">&#x27;#ffffff&#x27;</span>,<br>                        position: [<span class="hljs-string">&#x27;50%&#x27;</span>, <span class="hljs-string">&#x27;50%&#x27;</span>],<br>                    &#125;<br>                &#125;<br>            &#125;<br>        ]<br>    &#125;;<br>    myChart.setOption(mapOption);<br>&#125;<br><br>//重庆地图<br>function initCQMap(data) &#123;<br>    var totalData = data;<br>    var cqMapData = [<br>        &#123;name: <span class="hljs-string">&#x27;奉节&#x27;</span>, value: totalData * <span class="hljs-number">0.065</span>&#125;,<br>        &#123;name: <span class="hljs-string">&#x27;巫溪&#x27;</span>, value: totalData * <span class="hljs-number">0.045</span>&#125;,<br>        &#123;name: <span class="hljs-string">&#x27;开州&#x27;</span>, value: totalData * <span class="hljs-number">0.0375</span>&#125;,<br>        &#123;name: <span class="hljs-string">&#x27;酉阳&#x27;</span>, value: totalData * <span class="hljs-number">0.025</span>&#125;,<br>        &#123;name: <span class="hljs-string">&#x27;彭水&#x27;</span>, value: totalData * <span class="hljs-number">0.035</span>&#125;,<br>        &#123;name: <span class="hljs-string">&#x27;云阳&#x27;</span>, value: totalData * <span class="hljs-number">0.015</span>&#125;,<br>        &#123;name: <span class="hljs-string">&#x27;万州&#x27;</span>, value: totalData * <span class="hljs-number">0.0015</span>&#125;,<br>        &#123;name: <span class="hljs-string">&#x27;城口&#x27;</span>, value: totalData * <span class="hljs-number">0.008</span>&#125;,<br>        &#123;name: <span class="hljs-string">&#x27;江津&#x27;</span>, value: totalData * <span class="hljs-number">0.012</span>&#125;,<br>        &#123;name: <span class="hljs-string">&#x27;石柱&#x27;</span>, value: totalData * <span class="hljs-number">0.0035</span>&#125;,<br>        &#123;name: <span class="hljs-string">&#x27;巫山&#x27;</span>, value: totalData * <span class="hljs-number">0.0004</span>&#125;,<br>        &#123;name: <span class="hljs-string">&#x27;涪陵&#x27;</span>, value: totalData * <span class="hljs-number">0.0625</span>&#125;,<br>        &#123;name: <span class="hljs-string">&#x27;丰都&#x27;</span>, value: totalData * <span class="hljs-number">0.0225</span>&#125;,<br>        &#123;name: <span class="hljs-string">&#x27;武隆&#x27;</span>, value: totalData * <span class="hljs-number">0.0125</span>&#125;,<br>        &#123;name: <span class="hljs-string">&#x27;南川&#x27;</span>, value: totalData * <span class="hljs-number">0.0172</span>&#125;,<br>        &#123;name: <span class="hljs-string">&#x27;秀山&#x27;</span>, value: totalData * <span class="hljs-number">0.0228</span>&#125;,<br>        &#123;name: <span class="hljs-string">&#x27;黔江&#x27;</span>, value: totalData * <span class="hljs-number">0.018</span>&#125;,<br>        &#123;name: <span class="hljs-string">&#x27;合川&#x27;</span>, value: totalData * <span class="hljs-number">0.0039</span>&#125;,<br>        &#123;name: <span class="hljs-string">&#x27;綦江&#x27;</span>, value: totalData * <span class="hljs-number">0.0022</span>&#125;,<br>        &#123;name: <span class="hljs-string">&#x27;忠县&#x27;</span>, value: totalData * <span class="hljs-number">0.0013</span>&#125;,<br>        &#123;name: <span class="hljs-string">&#x27;梁平&#x27;</span>, value: totalData * <span class="hljs-number">0.006</span>&#125;,<br>        &#123;name: <span class="hljs-string">&#x27;巴南&#x27;</span>, value: totalData * <span class="hljs-number">0.01</span>&#125;,<br>        &#123;name: <span class="hljs-string">&#x27;潼南&#x27;</span>, value: totalData * <span class="hljs-number">0.032</span>&#125;,<br>        &#123;name: <span class="hljs-string">&#x27;永川&#x27;</span>, value: totalData * <span class="hljs-number">0.055</span>&#125;,<br>        &#123;name: <span class="hljs-string">&#x27;垫江&#x27;</span>, value: totalData * <span class="hljs-number">0.018</span>&#125;,<br>        &#123;name: <span class="hljs-string">&#x27;渝北&#x27;</span>, value: totalData * <span class="hljs-number">0.004</span>&#125;,<br>        &#123;name: <span class="hljs-string">&#x27;长寿&#x27;</span>, value: totalData * <span class="hljs-number">0.05</span>&#125;,<br>        &#123;name: <span class="hljs-string">&#x27;大足&#x27;</span>, value: totalData * <span class="hljs-number">0.02</span>&#125;,<br>        &#123;name: <span class="hljs-string">&#x27;铜梁&#x27;</span>, value: totalData * <span class="hljs-number">0.0017</span>&#125;,<br>        &#123;name: <span class="hljs-string">&#x27;荣昌&#x27;</span>, value: totalData * <span class="hljs-number">0.003</span>&#125;,<br>        &#123;name: <span class="hljs-string">&#x27;璧山&#x27;</span>, value: totalData * <span class="hljs-number">0.0041</span>&#125;,<br>        &#123;name: <span class="hljs-string">&#x27;北碚&#x27;</span>, value: totalData * <span class="hljs-number">0.007</span>&#125;,<br>        &#123;name: <span class="hljs-string">&#x27;万盛&#x27;</span>, value: totalData * <span class="hljs-number">0.0006</span>&#125;,<br>        &#123;name: <span class="hljs-string">&#x27;主城&#x27;</span>, value: totalData * <span class="hljs-number">0.1</span>&#125;,<br>    ];<br>    if (!myChart) &#123;<br>        myChart = echarts.init(document.getElementById(<span class="hljs-string">&#x27;main&#x27;</span>));<br>    &#125;<br>    var mapOption = &#123;<br>        backgroundColor: <span class="hljs-string">&#x27;rgb(3,19,48)&#x27;</span>,<br>        title: &#123;<br>            text: <span class="hljs-string">&#x27;放款额地域分布图&#x27;</span>,<br>            left: <span class="hljs-string">&#x27;center&#x27;</span>,<br>            show: false,<br>            textStyle: &#123;<br>                color: <span class="hljs-string">&#x27;#fff&#x27;</span><br>            &#125;<br>        &#125;,<br>        tooltip: &#123;<br>            trigger: <span class="hljs-string">&#x27;item&#x27;</span><br>        &#125;,<br>        geo: &#123;<br>            map: <span class="hljs-string">&#x27;重庆&#x27;</span>,<br>            label: &#123;<br>                emphasis: &#123;<br>                    show: false<br>                &#125;<br>            &#125;,<br>            scaleLimit: [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>],<br>            zoom: <span class="hljs-number">1.2</span>,<br>            top: <span class="hljs-string">&#x27;9%&#x27;</span>,<br>            roam: false,<br>            aspectScale: <span class="hljs-number">0.85</span>,<br>            itemStyle: &#123;<br>                normal: &#123;<br>                    areaColor: <span class="hljs-string">&#x27;#063eba&#x27;</span>,<br>                    borderColor: <span class="hljs-string">&#x27;#031330&#x27;</span><br>                &#125;,<br>                emphasis: &#123;<br>                    areaColor: <span class="hljs-string">&#x27;#6896FF&#x27;</span><br>                &#125;<br>            &#125;<br>        &#125;,<br>        series: [<br>            &#123;<br>                name: <span class="hljs-string">&#x27;销售额&#x27;</span>,<br>                type: <span class="hljs-string">&#x27;effectScatter&#x27;</span>,<br>                coordinateSystem: <span class="hljs-string">&#x27;geo&#x27;</span>,<br>                data: convertData(geoCoordMapOfCq, cqMapData),<br><br>                symbolSize: function (val, params) &#123;<br>                    // 根据数值大小展示不同，维度 （万）<br>                    var totalMoney = val[<span class="hljs-number">2</span>] / <span class="hljs-number">10000</span><br>                    if (totalMoney &lt; <span class="hljs-number">10000</span>) &#123;<br>                        return [<span class="hljs-number">3</span>, <span class="hljs-number">2</span>];<br>                    &#125; else if (totalMoney &gt; <span class="hljs-number">10000</span> &amp;&amp; totalMoney &lt; <span class="hljs-number">100000</span>) &#123;<br>                        return [<span class="hljs-number">5</span>, <span class="hljs-number">3</span>];<br>                    &#125; else if (totalMoney &gt; <span class="hljs-number">100000</span> &amp;&amp; totalMoney &lt; <span class="hljs-number">1000000</span>) &#123;<br>                        return [<span class="hljs-number">8</span>, <span class="hljs-number">5</span>];<br>                    &#125; else &#123;<br>                        return [<span class="hljs-number">10</span>, <span class="hljs-number">7</span>]<br>                    &#125;<br>                    // return  parseInt(val[<span class="hljs-number">2</span>] * <span class="hljs-number">40</span>);<br>                &#125;,<br>                //配置何时显示特效<span class="hljs-string">&#x27;render&#x27;</span> 绘制完成后显示特效。<span class="hljs-string">&#x27;emphasis&#x27;</span> 高亮（hover）的时候显示特效。<br>                showEffectOn: <span class="hljs-string">&#x27;render&#x27;</span>,<br>                //目前只有ripple这一种<br>                effectType: <span class="hljs-string">&#x27;ripple&#x27;</span>,<br>                animation: true,<br>                rippleEffect: &#123;<br>                    //动画的时间<br>                    period: <span class="hljs-number">4</span>,<br>                    //动画中波纹的最大缩放比例<br>                    scale: <span class="hljs-number">8</span>,<br>                    //波纹的绘制方式可选 <span class="hljs-string">&#x27;stroke&#x27;</span> 和 <span class="hljs-string">&#x27;fill&#x27;</span><br>                    brushType: <span class="hljs-string">&#x27;stroke&#x27;</span><br>                &#125;,<br>                //<span class="hljs-symbol">Scatter</span>才有这个属性,是否开启鼠标 hover 的提示动画效果<br>                hoverAnimation: true,<br><br>                tooltip: &#123;<br>                    formatter: function (params, ticket, callback) &#123;<br>                        return params.seriesName + <span class="hljs-string">&quot;&lt;br&gt;&quot;</span> + params.name + <span class="hljs-string">&quot;：&quot;</span> + params.value[<span class="hljs-number">2</span>];<br>                    &#125;,<br>                &#125;,<br>                label: &#123;<br>                    normal: &#123;<br>                        formatter: function (params, ticket, callback) &#123;<br>                            var splitArray = [<span class="hljs-string">&#x27;特别行政区&#x27;</span>, <span class="hljs-string">&#x27;回族自治区&#x27;</span>, <span class="hljs-string">&#x27;壮族自治区&#x27;</span>, <span class="hljs-string">&#x27;维吾尔自治区&#x27;</span>, <span class="hljs-string">&#x27;自治区&#x27;</span>, <span class="hljs-string">&#x27;省&#x27;</span>, <span class="hljs-string">&#x27;市&#x27;</span>];<br>                            var value = (params.value[<span class="hljs-number">2</span>] / <span class="hljs-number">10000</span>).toFixed(<span class="hljs-number">0</span>);<br>                            var name = params.name;<br>                            var lenth = splitArray.length;<br>                            for (var i = <span class="hljs-number">0</span>; i &lt; lenth; i++) &#123;<br>                                var index = name.indexOf(splitArray[i]);<br>                                if (index &gt; <span class="hljs-number">0</span>) &#123;<br>                                    name = name.substring(<span class="hljs-number">0</span>, index);<br>                                &#125;<br><br>                            &#125;<br>                            return <span class="hljs-string">&#x27;&#123;a|&#x27;</span> + value + <span class="hljs-string">&#x27;&#125;&#x27;</span> + <span class="hljs-string">&#x27;\n\n&#x27;</span> + <span class="hljs-string">&#x27;&#123;b|&#x27;</span> + name + <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>                        &#125;,<br>                        rich: &#123;<br>                            a: &#123;<br>                                color: <span class="hljs-string">&#x27;#fff&#x27;</span>,<br>                                fontSize: <span class="hljs-number">9</span>,<br>                                fontWeight: <span class="hljs-number">500</span><br>                            &#125;,<br>                            b: &#123;<br>                                color: <span class="hljs-string">&#x27;#fff&#x27;</span>,<br>                                fontSize: <span class="hljs-number">8</span>,<br>                            &#125;,<br>                        &#125;,<br>                        fontSize: <span class="hljs-number">14</span>,<br>                        align: <span class="hljs-string">&#x27;left&#x27;</span>,<br>                        position: <span class="hljs-string">&#x27;left&#x27;</span>,<br>                        offset: [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>],<br>                        show: true<br>                    &#125;,<br>                    emphasis: &#123;<br>                        show: false<br>                    &#125;<br>                &#125;,<br>                itemStyle: &#123;<br>                    normal: &#123;<br>                        color: <span class="hljs-string">&#x27;#fff&#x27;</span>,<br>                        position: [<span class="hljs-string">&#x27;50%&#x27;</span>, <span class="hljs-string">&#x27;50%&#x27;</span>],<br>                    &#125;<br>                &#125;<br>            &#125;<br>        ]<br>    &#125;;<br>    myChart.setOption(mapOption);<br>&#125;<br><br>//获取各省市交易数据<br>function getMapDate() &#123;<br>    if (showMapChina == true) &#123;<br>        levelArr = data.data.level;<br>        initChinaMap(loadDistribution)<br>    &#125; else &#123;<br>        initCQMap(loadDistribution[<span class="hljs-string">&#x27;重庆市&#x27;</span>])<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  获取屏幕类型</span><br><span class="hljs-comment"> */</span><br>function getScreenType() &#123;<br>    var screenWidth = <span class="hljs-symbol">Number</span>.parseInt(window.innerWidth)<br>    var screenType = <span class="hljs-string">&#x27;&#x27;</span><br>    if(screenWidth &gt;= <span class="hljs-number">1280</span> &amp;&amp; screenWidth &lt; <span class="hljs-number">1366</span>) &#123;<br>        screenType = <span class="hljs-string">&#x27;screen1280&#x27;</span><br>    &#125; else if(screenWidth &gt;= <span class="hljs-number">1366</span> &amp;&amp; screenWidth &lt; <span class="hljs-number">1920</span>) &#123;<br>        screenType = <span class="hljs-string">&#x27;screen1366&#x27;</span><br>    &#125; else if(screenWidth &gt;= <span class="hljs-number">1920</span>) &#123;<br>        screenType = <span class="hljs-string">&#x27;screen1920&#x27;</span><br>    &#125; else &#123;<br>        screenType = <span class="hljs-string">&#x27;screen1280&#x27;</span><br>    &#125;<br>    return screenType<br>&#125;<br>$(function () &#123;<br>    var screenType = getScreenType()<br>    console.log(screenType)<br>    // 设置地图大小<br>    switch (screenType) &#123;<br>        case <span class="hljs-string">&#x27;screen1280&#x27;</span>:<br>            $(<span class="hljs-string">&quot;#main&quot;</span>).width(<span class="hljs-number">546</span>)<br>            $(<span class="hljs-string">&quot;#main&quot;</span>).height(<span class="hljs-number">385</span>)<br>            geoCoordMap = geoCoordMapSmall<br>            geoCoordMapOfCq = geoCoordMapOfCqSmall<br>            break<br>        case <span class="hljs-string">&#x27;screen1366&#x27;</span>:<br>            $(<span class="hljs-string">&quot;#main&quot;</span>).width(<span class="hljs-number">583</span>)<br>            $(<span class="hljs-string">&quot;#main&quot;</span>).height(<span class="hljs-number">385</span>)<br>            geoCoordMap = geoCoordMapSmall<br>            geoCoordMapOfCq = geoCoordMapOfCqSmall<br>            break<br>        case <span class="hljs-string">&#x27;screen1920&#x27;</span>:<br>            $(<span class="hljs-string">&quot;#main&quot;</span>).width(<span class="hljs-number">812</span>)<br>            $(<span class="hljs-string">&quot;#main&quot;</span>).height(<span class="hljs-number">550</span>)<br>            geoCoordMap = geoCoordMapBig<br>            geoCoordMapOfCq = geoCoordMapOfCqBig<br>            break<br>    &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>nodejs</category>
      
    </categories>
    
    
    <tags>
      
      <tag>echart3</tag>
      
      <tag>饼图</tag>
      
      <tag>柱状图</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025-04-02- 【大模型】创建和编排AI智能体工作流</title>
    <link href="/2025/04/02/2025-04-02-%E3%80%90%E5%A4%A7%E6%A8%A1%E5%9E%8B%E3%80%91%E5%88%9B%E5%BB%BA%E5%92%8C%E7%BC%96%E6%8E%92AI%E6%99%BA%E8%83%BD%E4%BD%93%E5%B7%A5%E4%BD%9C%E6%B5%81/"/>
    <url>/2025/04/02/2025-04-02-%E3%80%90%E5%A4%A7%E6%A8%A1%E5%9E%8B%E3%80%91%E5%88%9B%E5%BB%BA%E5%92%8C%E7%BC%96%E6%8E%92AI%E6%99%BA%E8%83%BD%E4%BD%93%E5%B7%A5%E4%BD%9C%E6%B5%81/</url>
    
    <content type="html"><![CDATA[<h2 id="什么是大模型-Agent？"><a href="#什么是大模型-Agent？" class="headerlink" title="什么是大模型 Agent？"></a>什么是大模型 Agent？</h2><p>大模型 Agent，作为一种人工智能体，是具备环境感知能力、自主理解、决策制定及执行行动能力的智能实体。简而言之，它是构建于大模型之上的计算机程序，能够模拟独立思考过程，灵活调用各类工具，逐步达成预设目标的智能存在。</p><h2 id="Agent-架构设计"><a href="#Agent-架构设计" class="headerlink" title="Agent 架构设计"></a>Agent 架构设计</h2><p>大模型虽作为智能体的核心“大脑”，负责思维与决策，但仅凭此并不足以胜任复杂任务的执行。为了全面实现智能体的功能，还需融入类似“神经感官系统”以感知环境，以及“肢体”以执行实际动作的元素。这正是构建 Agent 技术架构的初衷，旨在通过这一框架，将感知、思考与行动三者紧密结合，共同作用于复杂任务的完成。</p><p>Agent 共由 4 个关键部分组成：规划（Planning）、记忆（Memory）、工具（Tools）、行动（Action），下面详细剖析。</p><h3 id="1、规划（Planning）"><a href="#1、规划（Planning）" class="headerlink" title="1、规划（Planning）"></a>1、规划（Planning）</h3><p>“规划”是智能体的思维模型。类比人类，面对任务，我们先构思解决方案，拆解为子任务，评估工具，执行中反思调整，并考量终止时机。通过大模型提示工程，比如：ReAct、CoT 推理模式，可赋予智能体类似思维模式，精准拆解复杂任务，分步解决。</p><h3 id="2、记忆（Memory）"><a href="#2、记忆（Memory）" class="headerlink" title="2、记忆（Memory）"></a>2、记忆（Memory）</h3><p>记忆，即信息存储与回忆。智能体模拟人类，设短期记忆存会话上下文，助多轮对话，任务毕则清；长期记忆存用户特征、业务数据，向量数据库速存速查。</p><h3 id="3、工具（Tools）"><a href="#3、工具（Tools）" class="headerlink" title="3、工具（Tools）"></a>3、工具（Tools）</h3><p>智能体依据“工具”感知环境、执行决策。工具比如：神经感官，助其获取信息、执行任务。配备多样工具并赋权，比如：API 调用业务信息，插件扩展大模型能力，比如：ChatPDF 解析文档、Midjourey 文生图。</p><h3 id="4、行动（Action）"><a href="#4、行动（Action）" class="headerlink" title="4、行动（Action）"></a>4、行动（Action）</h3><p>智能体依规划与记忆，执行具体行动，包括与外部互动或工具调用，实现输入至输出的转化。比如：智能客服回复、查询天气预报、AI 机器人抓起物体等等。</p><h2 id="1、什么是智能体工作流"><a href="#1、什么是智能体工作流" class="headerlink" title="1、什么是智能体工作流"></a>1、什么是智能体工作流</h2><p>是一种利用人工智能智能体（AI Agent）来自动化和优化业务流程的技术。AI 智能体通过理解和分析数据，执行任务，并根据需要与人类协作提升工作效率、减少错误，帮助企业更快速地响应市场需求。</p><p>“智能体”可以有多种定义，有些客户将智能体定义为完全自主的系统，这些系统能够在较长时间内独立运行，使用各种工具完成复杂任务。而另一些客户则将智能体描述为遵循预定义工作流的更具指导性的实现。</p><p>智能体 Agents：是指 LLM 动态指挥其自身的流程和工具使用的系统，并保持对任务完成方式的控制权。工作流 Workflows：是指通过预定义的代码路径对 LLM 和工具进行编排的系统。</p><h2 id="2、-智能体设计的五种模式"><a href="#2、-智能体设计的五种模式" class="headerlink" title="2、 智能体设计的五种模式"></a>2、 智能体设计的五种模式</h2><p>在生产中见到的智能体设计模式有五种。下面从我们的基础构建块——增强型 LLM——开始，并逐步增加复杂性，从简单的组合工作流程到自治代理。</p><h3 id="2-1-增强型-LLM（实际上就是-RAG）"><a href="#2-1-增强型-LLM（实际上就是-RAG）" class="headerlink" title="2.1. 增强型 LLM（实际上就是 RAG）"></a>2.1. 增强型 LLM（实际上就是 RAG）</h3><h3 id="2-2-提示链-Prompt-chaining-（类似管道-过滤器模式）"><a href="#2-2-提示链-Prompt-chaining-（类似管道-过滤器模式）" class="headerlink" title="2.2. 提示链 Prompt chaining （类似管道-过滤器模式）"></a>2.2. 提示链 Prompt chaining （类似管道-过滤器模式）</h3><h3 id="2-3-路由器"><a href="#2-3-路由器" class="headerlink" title="2.3. 路由器"></a>2.3. 路由器</h3><h3 id="2-4-并行化"><a href="#2-4-并行化" class="headerlink" title="2.4. 并行化"></a>2.4. 并行化</h3><h3 id="2-5-协调器-工作者"><a href="#2-5-协调器-工作者" class="headerlink" title="2.5. 协调器-工作者"></a>2.5. 协调器-工作者</h3><h3 id="2-6-评估-优化器"><a href="#2-6-评估-优化器" class="headerlink" title="2.6. 评估-优化器"></a>2.6. 评估-优化器</h3><h2 id="3、-工作流的优势和构建过程"><a href="#3、-工作流的优势和构建过程" class="headerlink" title="3、 工作流的优势和构建过程"></a>3、 工作流的优势和构建过程</h2><p>工作流提高了智能体的稳定性和可复现性。通过精细控制每一步的逻辑和输出，开发者可以更高质量地处理复杂任务。同时，工作流还支持多种节点类型和丰富的功能扩展选项，为开发者提供了极大的灵活性和便利性。</p><ol><li><p>创建工作流：开发者可以在文心智能体平台的首页或零代码智能体的高级配置中创建工作流。工作流名称需要以英文字母开头，并支持英文、下划线和数字。同时，需要清晰描述工作流的使用场景与能力运行逻辑。</p></li><li><p>编排工作流：在编排页面，开发者可以通过拖拽和连接节点来构建工作流。他们需要明确每个节点的输入和输出参数，并配置相应的逻辑和流程设计。</p></li><li><p>测试工作流：在创建和编排完成后，开发者需要对工作流进行测试。这包括测试工作流的调用稳定性、输入准确性和输出过程与结果等。只有试运行成功的工作流才可以发布。</p></li><li><p>发布工作流：经过测试并确认无误后，开发者可以将工作流发布到文心智能体平台。这样，其他开发者或用户就可以在需要时调用该工作流。</p></li><li><p>为智能体配置工作流：在零代码智能体的高级配置中，开发者可以为智能体添加工作流。他们需要在智能体的思考路径中描述在什么样的场景下调用工作流，并通过模拟用户需求指令来测试工作流的运行效果。</p></li></ol><h2 id="4、智能体工作流的应用场景"><a href="#4、智能体工作流的应用场景" class="headerlink" title="4、智能体工作流的应用场景"></a>4、智能体工作流的应用场景</h2><p>应用场景：工作流适用于需要处理多个步骤且对最后结果要求很严格的任务场景。例如，在智能客服系统中，可以使用工作流来处理用户的复杂问题或请求；在内容创作系统中，可以使用工作流来生成符合特定风格和要求的文章或图片等。</p><p>传统工作流程虽然能够按预定规则执行，但这些规则通常非常复杂，需要人工干预和即时决策。企业必须投入大量时间、资源和精力，以确保流程按照预期执行。</p><p>而在智能体工作流中，任务由可以采取行动、做出决策并与人类或其他系统交互的 AI 智能体或智能系统自动执行或协助执行。这些智能体与人类一起工作或者代替人类，根据预定义的规则或学习到的模式做出决策。</p><h2 id="5、-总结"><a href="#5、-总结" class="headerlink" title="5、 总结"></a>5、 总结</h2><p>智能体工作流特别适合需要灵活性和响应能力的多步骤复杂任务，能够提升业务效率，降低运营复杂性。 与传统基于预定义规则和静态执行路径的工作流不同，智能体工作流全面融合智能高效性，能实时调整以达到最佳效果。</p><p>通过 DeepSeek、ChatGPT 这样的生成式大模型，AI 智能体能够快速处理任务，而无需事先计划或查看其他信息。通过使用多样本提示和检索增强生成（RAG）等技术，AI 智能体的表现可以显著提升，更好地适应复杂任务和实时决策。</p><p>随着 AI 技术的发展，智能体工作流将在多个行业中发挥越来越重要的作用，帮助企业提高效率、节省成本并增强竞争力。</p>]]></content>
    
    
    <categories>
      
      <category>大模型</category>
      
    </categories>
    
    
    <tags>
      
      <tag>AI</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025-03-18- 【大模型】ai客服</title>
    <link href="/2025/03/18/2025-03-18-%20%E3%80%90%E5%A4%A7%E6%A8%A1%E5%9E%8B%E3%80%91ai%E5%AE%A2%E6%9C%8D/"/>
    <url>/2025/03/18/2025-03-18-%20%E3%80%90%E5%A4%A7%E6%A8%A1%E5%9E%8B%E3%80%91ai%E5%AE%A2%E6%9C%8D/</url>
    
    <content type="html"><![CDATA[<h2 id="小程序客服"><a href="#小程序客服" class="headerlink" title="小程序客服"></a>小程序客服</h2><blockquote><p>使用腾讯云开发平台，ai+能力，基于 deepseek-r1 满血版或混元模型，提供 ai 智能客服能力，</p></blockquote><p>方案一： 云开发平台，个人版 29&#x2F;月<br>问题：转 人工 功能卡点（未找到合理转接人工方式） 云平台的云函数！</p><ol><li><a href="https://mp.weixin.qq.com/wxamp/wakf?token=1233368754&lang=zh_CN">设置客服人员-微信账号</a></li><li>ai 客服<a href="https://ccnk05wgo092.feishu.cn/wiki/CQEvwEqFMivOSwkZUtJcv31HnzM">指引文档</a></li><li><a href="https://docs.cloudbase.net/ai/agent/integration-mp">对接小程序客服</a></li><li></li></ol><p>方案二：自建对话通道 + 混元模型</p><h2 id="微信客服"><a href="#微信客服" class="headerlink" title="微信客服"></a>微信客服</h2><p>搭建过程大概分为四步骤：创建售前问答库、创建智能库、创建智能体、调试智能体；</p><ol><li>创建售前问答库</li></ol><p>首先，通过 deepseek.com 生成一份 SaaS 软件售前问答 30 条，表格展示，表头包含问题、答案、关键词，然后复制到 excel 上备用；</p><p><a href="https://www.deepseek.com/">https://www.deepseek.com/</a></p><ol start="2"><li>创建智能体<br>在创建智能体后，选择单 Agent 的工作流模式，工作流模式是由多个节点构成的标准化步骤，用来完成特定的任务和达到预期的目标。</li></ol><p>通过将复杂的任务拆成多个子任务，可以避免单个模型能力的限制，确保内容输出的准确性，同时整个流程会更加可控。</p>]]></content>
    
    
    <categories>
      
      <category>大模型</category>
      
    </categories>
    
    
    <tags>
      
      <tag>AI</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025-03-18- 【大模型】工具归集</title>
    <link href="/2025/03/18/2025-03-18-%20%E3%80%90%E5%A4%A7%E6%A8%A1%E5%9E%8B%E3%80%91%E5%B7%A5%E5%85%B7%E5%BD%92%E9%9B%86/"/>
    <url>/2025/03/18/2025-03-18-%20%E3%80%90%E5%A4%A7%E6%A8%A1%E5%9E%8B%E3%80%91%E5%B7%A5%E5%85%B7%E5%BD%92%E9%9B%86/</url>
    
    <content type="html"><![CDATA[<h2 id="知识库私有化搭建-macos"><a href="#知识库私有化搭建-macos" class="headerlink" title="知识库私有化搭建 - macos"></a>知识库私有化搭建 - macos</h2><h3 id="使用-Cherry-Studio-ollama-结合-deepseek、bge-m3-打造个人知识库"><a href="#使用-Cherry-Studio-ollama-结合-deepseek、bge-m3-打造个人知识库" class="headerlink" title="使用 Cherry Studio + ollama 结合 deepseek、bge-m3 打造个人知识库"></a>使用 Cherry Studio + ollama 结合 deepseek、bge-m3 打造个人知识库</h3><blockquote><p>对于任何本地知识库问答的过程，都需要经历文本切割、词向量化、词向量存储、词向量检索与问答几个基本环节。</p></blockquote><h4 id="第一步：模型准备"><a href="#第一步：模型准备" class="headerlink" title="第一步：模型准备"></a>第一步：模型准备</h4><ol><li>下载 ollama 地址<a href="https://ollama.com/">https://ollama.com/</a></li><li>本地化部署 deepseek-r1</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">下载LLM模型</span><br>ollama pull deepseek-r1:1.5b<br><span class="hljs-meta prompt_"># </span><span class="language-bash">下载嵌入模型</span><br>ollama pull bge-m3<br><span class="hljs-meta prompt_"># </span><span class="language-bash">运行LLM模型（非必须）本地运行使用</span><br>ollama run deepseek-r1:1.5b<br></code></pre></td></tr></table></figure><ol start="3"><li>开启远程访问</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">1. 打开配置文件</span><br>vi /etc/systemd/system/ollama.service<br><span class="hljs-meta prompt_"># </span><span class="language-bash">2. 在Service中增加下面两行</span><br>Environment=&quot;OLLAMA_HOST=0.0.0.0&quot;<br>Environment=&quot;OLLAMA_ORIGINS=*&quot;<br><span class="hljs-meta prompt_"># </span><span class="language-bash">3. 重启ollama服务</span><br>systemctl daemon-reload<br>systemctl restart ollama<br></code></pre></td></tr></table></figure><h4 id="第二步：模型配置"><a href="#第二步：模型配置" class="headerlink" title="第二步：模型配置"></a>第二步：模型配置</h4><ol><li>下载<a href="https://cherry-ai.com/">CherryStudio</a><blockquote><p>CherryStudio 是一个支持多平台的 AI 客户端，支持 Win、macOS、Linux 平台,未来也会支持移动端。项目自 24 年 7 月至今已迭代数百个版本,我们致力于打造一个更加高效、安全、易用的客户端，让更多人能够享受到 AI 带来的便利。</p></blockquote></li></ol><h4 id="第三步：web-端-ai-助手"><a href="#第三步：web-端-ai-助手" class="headerlink" title="第三步：web 端 ai 助手"></a>第三步：web 端 ai 助手</h4><ol><li>Page Assist 通过浏览器插件来访问本地部署的大模型，这个插件还支持本地&#x2F;远程知识库搭建。仅支持 ollama 体系， 安装插件 Page Assist，搜索插件后添加至 Chrome。</li><li>chatboxai，chatboxai 仅支持本地知识库，无法链接远程服务器，且功能单一只能作为日常问答使用，<a href="https://web.chatboxai.app/">https://web.chatboxai.app/</a></li></ol><h4 id="第四步：工作流编排"><a href="#第四步：工作流编排" class="headerlink" title="第四步：工作流编排"></a>第四步：工作流编排</h4><ol><li>工作流工具平台选择，n8n、Dify、coze，选用开源工具 n8n</li><li>安装 n8n 并运行</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">创建名为n8n_data的持久存储（卷）</span><br>docker volume create n8n_data<br><span class="hljs-meta prompt_"># </span><span class="language-bash">生成名为n8n的Docker容器和镜像</span><br>docker run -it --rm --name n8n -p 5678:5678 -v n8n_data:/home/node/.n8n docker.n8n.io/n8nio/n8n<br></code></pre></td></tr></table></figure><h4 id="安装-MCP-n8n-社区节点"><a href="#安装-MCP-n8n-社区节点" class="headerlink" title="安装 MCP n8n 社区节点"></a>安装 MCP n8n 社区节点</h4><h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><h3 id="常用工具"><a href="#常用工具" class="headerlink" title="常用工具"></a>常用工具</h3><ul><li><p>Ollama<br>Ollama 是一个本地化的机器学习框架，专注于自然语言处理（NLP）任务，如模型加载、推理和生成。它允许用户在本地部署和运行大型预训练模型，从而实现高效的文本生成、翻译、问答等功能。</p></li><li><p>硅基流动（Siliconflow）<br>硅基流动（Siliconflow）是一个大模型 API 聚合平台，提供了多种大语言模型（LLM）的 API 接口服务。它支持多种模型，如 DeepSeek R1 和 DeepSeek V3 等。用户可以通过注册获取 API 密钥，并在不同的客户端（如 Cherry Studio）中使用这些模型。</p></li><li><p>Cherry Studio<br>Cherry Studio 是一款集多模型对话、知识库管理、AI 绘画、翻译等功能于一体的全能 AI 助手平台。它支持多种大型语言模型（LLM）提供商的服务，包括 OpenAI、Gemini、Anthropic、DeepSeek 等，并且可以与 Ollama 集成，实现本地模型的部署和使用</p></li><li><p>Anything LLM<br>Anything LLM 是一款集成度非常高、且功能非常稳定的大模型前端产品，虽无法进行二次开发，但是功能实现便捷，适合小白使用。下载地址<br><a href="https://anythingllm.com/">https://anythingllm.com</a></p></li></ul><h4 id="智能体工具"><a href="#智能体工具" class="headerlink" title="智能体工具"></a>智能体工具</h4><ol><li>coze<br>coze（中文名称：扣子）是一个 AI 应用开发平台，字节跳动旗下的 AI 产品。coze 提供了友好的可视化设计和编排工具，无论你是否具备编程能力，都可以通过低代码方式拖拖拽拽，然后基于自己业务或者需求快速搭建出基于大模型的各类 AI 项目；</li></ol><p>同时支持将 AI 应用发布到各个社交平台、通讯软件，也可以通过 API 或 SDK 将 AI 应用集成到你的业务系统中。 2. Dify</p><h3 id="模型分类"><a href="#模型分类" class="headerlink" title="模型分类"></a>模型分类</h3><ul><li><p>对话模型<br>对话模型就是能和人聊天的模型。由 ollama 调度 DeepSeek 完成对话；比如你问一个聊天机器人“今天天气怎么样？”它会回答“今天天气很好，适合出门。”它的任务就是根据你的问题，生成一个合适的回答。</p></li><li><p>Embedding 模型：负责进行词向量化的模型</p></li><li><p>词向量数据库：用于存储词向量化后的对象，默认为 LancelotDB</p></li><li><p>嵌入模型<br>嵌入模型是把文字变成数字向量的模型。这是生成知识库的内核</p></li><li><p>文生图<br>Cherry Studio 自带多种文生图模型，比如 Stable Diffusion，Janus Pro 等，省去了你在本地搭建服务的繁琐成本，太省力了有木有！</p></li><li><p>RAG（Retrieval-Augmented Generation，检索增强生成）<br>是一种结合检索和生成的先进自然语言处理（NLP）技术，用于提升生成模型的能力。它通过引入外部知识库或文档检索机制，增强了生成模型的准确性和信息丰富性，特别适用于需要结合外部知识的任务，比如问答、对话系统和知识密集型文本生成。</p></li></ul><h4 id="为什么-RAG"><a href="#为什么-RAG" class="headerlink" title="为什么 RAG"></a>为什么 RAG</h4><table><thead><tr><th>问题</th><th>传统 LLM</th><th>RAG 知识库</th></tr></thead><tbody><tr><td>知识更新</td><td>训练后固定，无法访问新数据</td><td>实时检索，获取最新信息</td></tr><tr><td>私有知识</td><td>只能访问公开数据</td><td>可接入企业&#x2F;个人数据</td></tr><tr><td>回答可信度</td><td>可能出现幻觉，无法追溯来源</td><td>结合检索，提供真实依据</td></tr><tr><td>搜索能力</td><td>依赖关键字，无法理解语义</td><td>语义搜索，提高精确度</td></tr><tr><td>数据格式</td><td>仅限文本输入</td><td>支持 PDF、数据库、API</td></tr></tbody></table><p>🚀 RAG 是未来 AI 知识库的核心技术，它让 AI 更聪明、更精准、更可信！如果你希望 AI 高效管理知识、精准回答问题、提升业务效率，RAG 绝对是值得采用的方案。</p><h4 id="模型类型对比"><a href="#模型类型对比" class="headerlink" title="模型类型对比"></a>模型类型对比</h4><table><thead><tr><th>类型</th><th>特点</th><th>DeepSeek</th><th>OpenAI</th><th>Zhipu</th><th>Alicloud</th></tr></thead><tbody><tr><td>大语言模型 LLM</td><td>只能文本输入和输出，通用任务能力较强，同时具有很好的工具调用能力。这是所有其他模型的基础。</td><td>DeepSeek V3</td><td>GPT-4⁺</td><td>glm-4-plus</td><td>Qwen-Max⁺</td></tr><tr><td>多模态模型 VLLM⁺</td><td>除了文字外，能够理解图片或者视频，能够输出文本。</td><td>DeepSeek VL</td><td>GPT-4o</td><td>glm-4v-plus</td><td>Qwen-VL-Max</td></tr><tr><td>推理模型 Reasoning</td><td>擅长处理复杂问题，具有较强的推理能力</td><td>DeepSeek R1</td><td>OpenAI-o1</td><td>glm-zero-preview</td><td>n&#x2F;a</td></tr><tr><td>代码模型 CodeGen⁺</td><td>擅长生成代码</td><td>DeepSeek Coder V2</td><td>OpenAI Codex</td><td>CodeGeeX</td><td>通义灵码</td></tr></tbody></table><h3 id="知识库对比"><a href="#知识库对比" class="headerlink" title="知识库对比"></a>知识库对比</h3><table><thead><tr><th>特性&#x2F;平台</th><th>MaxKb</th><th>AnythingLLM</th><th>Dify</th><th>FastGPT</th><th>RagFlow</th><th>其他</th></tr></thead><tbody><tr><td>主要用途</td><td>知识库管理与检索</td><td>大规模语言模型的应用开发</td><td>AI 应用快速开发与部署</td><td>快速构建和部署 GPT 模型</td><td>基于检索增强生成（RAG）的工作流</td><td>LlamaIndex、OpenWebUI</td></tr><tr><td>支持的模型</td><td>自定义</td><td>支持多种开源及私有 LLMs</td><td>主要支持轻量级本地运行的模型</td><td>GPT 系列模型</td><td>支持通过 API 集成的各种模型</td><td>-</td></tr><tr><td>硬件要求</td><td>适中，根据模型大小变化</td><td>高，特别是对于大型模型</td><td>较低，优化用于本地部署</td><td>根据模型大小变化，可能较高</td><td>中等到高，取决于使用的模型</td><td>-</td></tr><tr><td>用户友好度</td><td>提供图形界面（GUI），易于使用</td><td>对开发者友好，但需要一定的技术背景</td><td>提供 CLI 和 API 接口，相对易用</td><td>提供简化工具，适合快速原型设计</td><td>需要一定的配置和技术知识</td><td>-</td></tr><tr><td>集成能力</td><td>可以与其他系统集成</td><td>强大的集成能力，支持多环境</td><td>良好的集成能力</td><td>专注于 GPT 模型的快速集成</td><td>强调与外部数据源和模型的集成</td><td>-</td></tr><tr><td>扩展性</td><td>支持扩展，但有限</td><td>高度可扩展</td><td>具有一定的扩展性</td><td>适用于快速扩展的小型到中型项目</td><td>设计为高度可扩展</td><td>-</td></tr><tr><td>适用场景</td><td>知识管理、文档检索</td><td>复杂的语言处理任务，如对话系统</td><td>快速开发 AI 应用，适合初创公司和个人开发者</td><td>快速原型设计和小项目的 GPT 模型部署</td><td>需要深度文本理解和检索的场景</td><td>-</td></tr><tr><td>社区和支持</td><td>社区较小，官方支持有限</td><td>活跃的开源社区</td><td>新兴平台，社区正在增长</td><td>相关资源丰富，尤其是关于 GPT 的内容</td><td>开源项目，有一定活跃度</td><td>-</td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>大模型</category>
      
    </categories>
    
    
    <tags>
      
      <tag>AI</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025-03-18- 【大模型】n8n工作流</title>
    <link href="/2025/03/18/2025-03-18-%20%E3%80%90%E5%A4%A7%E6%A8%A1%E5%9E%8B%E3%80%91n8n%E5%B7%A5%E4%BD%9C%E6%B5%81/"/>
    <url>/2025/03/18/2025-03-18-%20%E3%80%90%E5%A4%A7%E6%A8%A1%E5%9E%8B%E3%80%91n8n%E5%B7%A5%E4%BD%9C%E6%B5%81/</url>
    
    <content type="html"><![CDATA[<h2 id="AI-自动化"><a href="#AI-自动化" class="headerlink" title="AI 自动化"></a>AI 自动化</h2><ol><li><p>什么是</p></li><li><p>应用<br>客服系统，聊天机器人<br>智能邮件助手<br>内容生产：营销文案<br>客户关系管理：跟进文件、安排会议<br>数据分析</p></li><li><p>如何实现 ai 自动化<br>编程<br>工作流：可视化、快速部署</p></li><li><p>有哪些自动化工具<br>zapier&#x2F;make&#x2F;n8n</p></li><li><p>如何用 n8n 搭建 ai 工作流<br>触发器</p></li></ol><h4 id="第四步：工作流编排"><a href="#第四步：工作流编排" class="headerlink" title="第四步：工作流编排"></a>第四步：工作流编排</h4><ol><li>工作流工具平台选择，n8n、Dify、coze，选用开源工具 n8n</li><li>安装 n8n 并运行</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">创建名为n8n_data的持久存储（卷）</span><br>docker volume create n8n_data<br><span class="hljs-meta prompt_"># </span><span class="language-bash">生成名为n8n的Docker容器和镜像</span><br>docker run -it --rm --name n8n -p 5678:5678 -v n8n_data:/home/node/.n8n docker.n8n.io/n8nio/n8n<br></code></pre></td></tr></table></figure><h4 id="社区可用的工作流"><a href="#社区可用的工作流" class="headerlink" title="社区可用的工作流"></a>社区可用的工作流</h4><p><a href="https://n8n.io/workflows/">https://n8n.io/workflows/</a></p><h4 id="安装-MCP-n8n-社区节点"><a href="#安装-MCP-n8n-社区节点" class="headerlink" title="安装 MCP n8n 社区节点"></a>安装 MCP n8n 社区节点</h4><p>MCP 的全称是 Model Context Protocol（模型上下文协议），由 Anthropic 提出，是一个 开放协议。它就像一个 USB 接口，能够将 AI 模型与 网络、本地文件、数据库、GitHub 等资源互联。</p><p>MCP 采用了 C&#x2F;S 架构设计，包括 Client（客户端） 和 Server（服务器） 两部分。</p><p>Client 从 Server 获取 功能列表，了解可用的 MCP Server 服务。<br>客户端根据功能列表调用对应的服务。</p><p>MCP 使 AI 更强大，能够 自动执行复杂任务，并连接各类资源。</p><h4 id="openroouter-注册"><a href="#openroouter-注册" class="headerlink" title="openroouter 注册"></a>openroouter 注册</h4><blockquote><p><a href="https://openrouter.ai/settings/keys">https://openrouter.ai/settings/keys</a></p></blockquote><h4 id="notion-注册"><a href="#notion-注册" class="headerlink" title="notion 注册"></a>notion 注册</h4><blockquote><p><a href="https://www.notion.so/profile/integrations">https://www.notion.so/profile/integrations</a></p></blockquote><h4 id="telegram-机器人创建"><a href="#telegram-机器人创建" class="headerlink" title="telegram 机器人创建"></a>telegram 机器人创建</h4><p>获取 chat_id<br><a href="https://api.telegram.org/bot">https://api.telegram.org/bot</a><token>&#x2F;getUpdates</p><h4 id="crawl4ai"><a href="#crawl4ai" class="headerlink" title="crawl4ai"></a>crawl4ai</h4><p><code> docker run --rm -it -e CRAWL4AI_API_TOKEN=12345 -p 11235:11235 unclecode/crawl4ai:latest</code></p><h3 id="知识库对比"><a href="#知识库对比" class="headerlink" title="知识库对比"></a>知识库对比</h3><table><thead><tr><th>特性&#x2F;平台</th><th>MaxKb</th><th>AnythingLLM</th><th>Dify</th><th>FastGPT</th><th>RagFlow</th><th>其他</th></tr></thead><tbody><tr><td>主要用途</td><td>知识库管理与检索</td><td>大规模语言模型的应用开发</td><td>AI 应用快速开发与部署</td><td>快速构建和部署 GPT 模型</td><td>基于检索增强生成（RAG）的工作流</td><td>LlamaIndex、OpenWebUI</td></tr><tr><td>支持的模型</td><td>自定义</td><td>支持多种开源及私有 LLMs</td><td>主要支持轻量级本地运行的模型</td><td>GPT 系列模型</td><td>支持通过 API 集成的各种模型</td><td>-</td></tr><tr><td>硬件要求</td><td>适中，根据模型大小变化</td><td>高，特别是对于大型模型</td><td>较低，优化用于本地部署</td><td>根据模型大小变化，可能较高</td><td>中等到高，取决于使用的模型</td><td>-</td></tr><tr><td>用户友好度</td><td>提供图形界面（GUI），易于使用</td><td>对开发者友好，但需要一定的技术背景</td><td>提供 CLI 和 API 接口，相对易用</td><td>提供简化工具，适合快速原型设计</td><td>需要一定的配置和技术知识</td><td>-</td></tr><tr><td>集成能力</td><td>可以与其他系统集成</td><td>强大的集成能力，支持多环境</td><td>良好的集成能力</td><td>专注于 GPT 模型的快速集成</td><td>强调与外部数据源和模型的集成</td><td>-</td></tr><tr><td>扩展性</td><td>支持扩展，但有限</td><td>高度可扩展</td><td>具有一定的扩展性</td><td>适用于快速扩展的小型到中型项目</td><td>设计为高度可扩展</td><td>-</td></tr><tr><td>适用场景</td><td>知识管理、文档检索</td><td>复杂的语言处理任务，如对话系统</td><td>快速开发 AI 应用，适合初创公司和个人开发者</td><td>快速原型设计和小项目的 GPT 模型部署</td><td>需要深度文本理解和检索的场景</td><td>-</td></tr><tr><td>社区和支持</td><td>社区较小，官方支持有限</td><td>活跃的开源社区</td><td>新兴平台，社区正在增长</td><td>相关资源丰富，尤其是关于 GPT 的内容</td><td>开源项目，有一定活跃度</td><td>-</td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>大模型</category>
      
    </categories>
    
    
    <tags>
      
      <tag>AI</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025-03-03- 开发相关工具调研</title>
    <link href="/2025/03/03/2025-03-03-%20%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7%E8%B0%83%E7%A0%94/"/>
    <url>/2025/03/03/2025-03-03-%20%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7%E8%B0%83%E7%A0%94/</url>
    
    <content type="html"><![CDATA[<p>开发相关工具调研<br>微服务开发框架<br>开源开发框架：<br><a href="https://github.com/zeromicro/go-zero">https://github.com/zeromicro/go-zero</a> ：一个带有 cli 工具的云原生 Go 微服务框架</p><h2 id="微服务平台"><a href="#微服务平台" class="headerlink" title="微服务平台"></a>微服务平台</h2><p>服务治理、配置中心。</p><p>consul 和 etcd 都比较合适，偏应用开发可以选择 consul，偏云原生体系可以选择 etcd</p><p>1.Consul<br>适用于需要服务发现和健康检查的场景，特别是在构建微服务架构时。<br>适用于需要跨多个数据中心进行部署的场景，Consul 支持多数据中心，可以在不同地理区域中部署 Consul 集群。<br>2.Etcd<br>适用于需要强一致性数据存储的场景，Etcd 提供了高可用、强一致性的键值存储。<br>适用于 Kubernetes 和云原生项目的场景，Etcd 是 Kubernetes 的核心组件之一，也被广泛应用于其他云原生项目中。<br>适用于需要与其他云原生工具和框架集成的场景</p><h2 id="API-网关"><a href="#API-网关" class="headerlink" title="API 网关"></a>API 网关</h2><p>1.开源云原生 API 网关：Kong：<a href="https://github.com/Kong/kong">https://github.com/Kong/kong</a> 。Kong 是一个云原生、快速、可扩展的微服务 API 网关。Kong 提供了丰富的插件，用于实现认证、限流、日志记录等功能。Kong 支持多种语言，包括 Go。 2.腾讯云 API 网关：<a href="https://cloud.tencent.com/document/product/1364/89294">https://cloud.tencent.com/document/product/1364/89294</a></p><h2 id="中间件-插件"><a href="#中间件-插件" class="headerlink" title="中间件&#x2F;插件"></a>中间件&#x2F;插件</h2><h3 id="HTTP-客户端"><a href="#HTTP-客户端" class="headerlink" title="HTTP 客户端"></a>HTTP 客户端</h3><p>Go 语言的标准库 net&#x2F;http 就提供了 HTTP 客户端的实现，非常方便使用。如果需要更多的功能，如超时控制、重试策略等，可以使用第三方库，如 go-resty。</p><p>示例代码：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;io/ioutil&quot;</span><br><span class="hljs-string">&quot;net/http&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>resp, err := http.Get(<span class="hljs-string">&quot;http://example.com/&quot;</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-comment">// handle error</span><br>&#125;<br><span class="hljs-keyword">defer</span> resp.Body.Close()<br>body, err := ioutil.ReadAll(resp.Body)<br><span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="MySQL-客户端"><a href="#MySQL-客户端" class="headerlink" title="MySQL 客户端"></a>MySQL 客户端</h3><p>sqlx 是一个 Go 语言的库，它扩展了标准库中的 database&#x2F;sql，提供了更方便的 API 和额外的功能。sqlx 的目标是提供一种简洁、安全且高性能的方式来操作 SQL 数据库</p><p>官方文档：<a href="https://jmoiron.github.io/sqlx/">https://jmoiron.github.io/sqlx/</a></p><p>安装：<br>go get -u github.com&#x2F;jmoiron&#x2F;sqlx<br>go get -u github.com&#x2F;go-sql-driver&#x2F;mysql</p><ul><li>示例代码：</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;github.com/jmoiron/sqlx&quot;</span><br>_ <span class="hljs-string">&quot;github.com/go-sql-driver/mysql&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;<br>ID   <span class="hljs-type">int</span>    <span class="hljs-string">`db:&quot;id&quot;`</span><br>Name <span class="hljs-type">string</span> <span class="hljs-string">`db:&quot;name&quot;`</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>dsn := <span class="hljs-string">&quot;user:password@tcp(127.0.0.1:3306)/dbname?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span><br>db, err := sqlx.Connect(<span class="hljs-string">&quot;mysql&quot;</span>, dsn)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(<span class="hljs-string">&quot;failed to connect database&quot;</span>)<br>&#125;<br><br><span class="hljs-comment">// Create</span><br>_, err = db.Exec(<span class="hljs-string">&quot;INSERT INTO users (name) VALUES (?)&quot;</span>, <span class="hljs-string">&quot;John Doe&quot;</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(err)<br>&#125;<br><br><span class="hljs-comment">// Read</span><br><span class="hljs-keyword">var</span> user User<br>err = db.Get(&amp;user, <span class="hljs-string">&quot;SELECT * FROM users WHERE id=?&quot;</span>, <span class="hljs-number">1</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(err)<br>&#125;<br>fmt.Println(<span class="hljs-string">&quot;User:&quot;</span>, user.Name)<br><br><span class="hljs-comment">// Update</span><br>_, err = db.Exec(<span class="hljs-string">&quot;UPDATE users SET name=? WHERE id=?&quot;</span>, <span class="hljs-string">&quot;Jane Doe&quot;</span>, <span class="hljs-number">1</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(err)<br>&#125;<br><br><span class="hljs-comment">// Delete</span><br>_, err = db.Exec(<span class="hljs-string">&quot;DELETE FROM users WHERE id=?&quot;</span>, <span class="hljs-number">1</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(err)<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>Redis 客户端<br>Go 语言中有多个 Redis 客户端库，如 go-redis 和 redigo。其中 go-redis 提供了丰富的功能和良好的性能。</p><p>示例代码：<br>package main</p><p>import (<br>“fmt”<br>“github.com&#x2F;go-redis&#x2F;redis”<br>)</p><p>func main() {<br>client :&#x3D; redis.NewClient(&amp;redis.Options{<br>Addr: “localhost:6379”,<br>Password: “”,<br>DB: 0,<br> })</p><pre><code class="hljs">pong, err := client.Ping().Result()fmt.Println(pong, err)</code></pre><p>}</p><p>ES（Elasticsearch）客户端<br>Elasticsearch 官方提供了 Go 语言的客户端库，名为 go-elasticsearch。</p><p>示例代码：</p><p>package main</p><p>import (<br>“fmt”<br>“github.com&#x2F;elastic&#x2F;go-elasticsearch&#x2F;v7”<br>)</p><p>func main() {<br>cfg :&#x3D; elasticsearch.Config{<br>Addresses: []string{<br>“<a href="http://localhost:9200/">http://localhost:9200</a>“,<br>},<br>}</p><pre><code class="hljs">es, err := elasticsearch.NewClient(cfg)if err != nil {// Handle errorpanic(err)}res, err := es.Info()if err != nil {// Handle errorpanic(err)}fmt.Println(res)</code></pre><p>}</p><p>对象存储 COS 客户端<br>腾讯云提供了 COS（Cloud Object Storage）的 Go 语言 SDK，可以在 Go 代码中直接调用。</p><p>示例代码：<br>package main</p><p>import (<br>“context”<br>“fmt”<br>“net&#x2F;http”<br>“net&#x2F;url”<br>“os”<br>“time”</p><pre><code class="hljs">&quot;github.com/tencentyun/cos-go-sdk-v5&quot;</code></pre><p>)</p><p>func main() {<br>u, _ :&#x3D; url.Parse(“https:&#x2F;&#x2F;<bucket>.cos.<region>.myqcloud.com”)<br>b :&#x3D; &amp;cos.BaseURL{BucketURL: u}<br>c :&#x3D; cos.NewClient(b, &amp;http.Client{<br>Transport: &amp;cos.AuthorizationTransport{<br>SecretID: os.Getenv(“COS_SECRETID”),<br>SecretKey: os.Getenv(“COS_SECRETKEY”),<br>},<br>})</p><pre><code class="hljs">_, err := c.Bucket.Put(context.Background(), nil)if err != nil {panic(err)}</code></pre><p>}</p><p>Kafka 客户端<br>Go 语言中有多个 Kafka 客户端库，如 sarama 和 confluent-kafka-go。sarama 是一个纯 Go 语言实现的 Kafka 客户端库，功能丰富，使用广泛。</p><p>示例代码：<br>package main</p><p>import (<br>“fmt”<br>“github.com&#x2F;Shopify&#x2F;sarama”<br>)</p><p>func main() {<br>config :&#x3D; sarama.NewConfig()<br>config.Producer.Return.Successes &#x3D; true<br>producer, err :&#x3D; sarama.NewSyncProducer([]string{“localhost:9092”}, config)<br>if err !&#x3D; nil {<br>&#x2F;&#x2F; handle error<br>}<br>defer func() {<br>if err :&#x3D; producer.Close(); err !&#x3D; nil {<br>&#x2F;&#x2F; handle error<br>}<br>}()</p><pre><code class="hljs">msg := &amp;sarama.ProducerMessage{Topic: &quot;test&quot;,Value: sarama.StringEncoder(&quot;Hello World&quot;),}partition, offset, err := producer.SendMessage(msg)if err != nil {// handle error}fmt.Printf(&quot;Message is stored in topic(%s)/partition(%d)/offset(%d)\n&quot;, &quot;test&quot;, partition, offset)</code></pre><p>}</p><p>Faiss 客户端<br>Faiss 是一个 C++ 库，因此在 Go 语言中调用 Faiss 需要借助 cgo。目前没有官方的 Faiss Go 客户端，但有一些第三方库封装了 Faiss 的 C++ 接口，例如 go-faiss。以下是一个简单的 go-faiss 使用示例：<br>首先，确保已经安装了 Faiss 和 go-faiss。安装 Faiss 的说明可以在官方文档中找到：<a href="https://github.com/facebookresearch/faiss/blob/main/INSTALL.md">https://github.com/facebookresearch/faiss/blob/main/INSTALL.md</a><br>然后，安装 go-faiss：<br>go get -u github.com&#x2F;ondralukes&#x2F;go-faiss</p><p>简单的 Go 代码示例：</p><p>package main</p><p>import (<br>“fmt”<br>“github.com&#x2F;ondralukes&#x2F;go-faiss”<br>)</p><p>func main() {<br>&#x2F;&#x2F; 创建一个 2D 向量的索引<br>index :&#x3D; faiss.NewIndexFlatL2(2)</p><pre><code class="hljs">// 添加一些向量到索引vectors := []float32{1.0, 1.0,2.0, 2.0,3.0, 3.0,}index.Add(vectors)// 查询最近的向量query := []float32{1.1, 1.1}ids, dists := index.Search(query, 1)// 输出查询结果fmt.Printf(&quot;Nearest vector id: %d, distance: %f\n&quot;, ids[0], dists[0])</code></pre><p>}</p><p>注，这个示例仅用于演示 go-faiss 的基本用法。在实际项目中，你可能需要根据具体需求对 Faiss 的参数和功能进行更详细的配置。更多关于 go-faiss 的信息和示例可以在其 GitHub 仓库中找到：<a href="https://github.com/ondralukes/go-faiss">https://github.com/ondralukes/go-faiss</a></p><p>Chroma 客户端<br>Chroma 是一个高维向量相似性搜索引擎，它可以对大量高维向量进行快速、准确的相似性检索。然而，Chroma 并没有提供官方的 Go 语言客户端。但是在官方文档：中给出了开源的解决方案：<a href="https://github.com/amikos-tech/chroma-go">https://github.com/amikos-tech/chroma-go</a></p><p>使用方式：<br>安装：<br>go get github.com&#x2F;amikos-tech&#x2F;chroma-go</p><p>引用：<br>import (<br>chroma “github.com&#x2F;amikos-tech&#x2F;chroma-go”<br>)</p><p>示例代码：<br>package main</p><p>import (<br>“fmt”<br>“log”<br>“os”</p><pre><code class="hljs">chroma &quot;github.com/amikos-tech/chroma-go&quot;openai &quot;github.com/amikos-tech/chroma-go/openai&quot;godotenv &quot;github.com/joho/godotenv&quot;</code></pre><p>)</p><p>func main() {<br>client :&#x3D; chroma.NewClient(“<a href="http://localhost:8000/">http://localhost:8000</a>“)<br>collectionName :&#x3D; “test-collection”<br>metadata :&#x3D; map[string]interface{}{}<br>err :&#x3D; godotenv.Load(“.env”)<br>if err !&#x3D; nil {<br>fmt.Printf(“Error loading .env file: %s”, err)<br>return<br>}<br>embeddingFunction :&#x3D; openai.NewOpenAIEmbeddingFunction(os.Getenv(“OPENAI*API_KEY”)) &#x2F;&#x2F;create a new OpenAI Embedding function<br>distanceFunction :&#x3D; chroma.L2<br>*, errRest :&#x3D; client.Reset() &#x2F;&#x2F;reset the database<br>if errRest !&#x3D; nil {<br>log.Fatalf(“Error resetting database: %s \n”, errRest.Error())<br>}<br>col, err :&#x3D; client.CreateCollection(collectionName, metadata, true, embeddingFunction, distanceFunction)<br>if err !&#x3D; nil {<br>fmt.Printf(“Error create collection: %s \n”, err.Error())<br>return<br>}<br>documents :&#x3D; []string{<br>“This is a document about cats. Cats are great.”,<br>“this is a document about dogs. Dogs are great.”,<br>}<br>ids :&#x3D; []string{<br>“ID1”,<br>“ID2”,<br>}</p><pre><code class="hljs">metadatas := []map[string]interface{}{{&quot;key1&quot;: &quot;value1&quot;},{&quot;key2&quot;: &quot;value2&quot;},}_, addError := col.Add(nil, metadatas, documents, ids)if addError != nil {log.Fatalf(&quot;Error adding documents: %s \n&quot;, addError)}countDocs, qrerr := col.Count()if qrerr != nil {log.Fatalf(&quot;Error counting documents: %s \n&quot;, qrerr)}fmt.Printf(&quot;countDocs: %v\n&quot;, countDocs) //this should result in 2qr, qrerr := col.Query([]string{&quot;I love dogs&quot;}, 5, nil, nil, nil)if qrerr != nil {log.Fatalf(&quot;Error querying documents: %s \n&quot;, qrerr)}fmt.Printf(&quot;qr: %v\n&quot;, qr.Documents[0][0]) //this should result in the document about dogs</code></pre><p>}</p><p>LLM 客户端（大语言模型客户端）</p><p>不同大模型的接入方式可能会有区别，所以需要参考大模型提供的官方文档。不过一般都是提供的 http api。具体模型的使用参考下面的例子。</p><p>清华大学 ChatGLM2-6B 模型<br><a href="https://github.com/THUDM/ChatGLM2-6B">https://github.com/THUDM/ChatGLM2-6B</a><br>参考官方文档部署好模型后，用 api 的模式运行<br>python api.py</p><p>使用 api 的方式调用大模型：<br>curl -X POST “<a href="http://127.0.0.1:8000/">http://127.0.0.1:8000</a>“ <br> -H ‘Content-Type: application&#x2F;json’ <br> -d ‘{“prompt”: “你好”, “history”: []}’</p><p>返回为：<br>{<br>“response”:”你好 👋！我是人工智能助手 ChatGLM2-6B，很高兴见到你，欢迎问我任何问题。”,<br>“history”:[[“你好”,”你好👋！我是人工智能助手 ChatGLM2-6B，很高兴见到你，欢迎问我任何问题。”]],<br>“status”:200,<br>“time”:”2023-03-23 21:38:40”<br>}</p>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>2024-10-28-【研发】nestjs多节点部署微服务</title>
    <link href="/2024/10/28/2024-10-28-%E3%80%90%E7%A0%94%E5%8F%91%E3%80%91nestjs%E5%A4%9A%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    <url>/2024/10/28/2024-10-28-%E3%80%90%E7%A0%94%E5%8F%91%E3%80%91nestjs%E5%A4%9A%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>在 nestjs 微服务开发过程中，本地开发机启动一个主服务，以及多个微服务时，是能够直接访问主服务的端口访问到各个微服务的接口；但我们将微服务部署到多台服务器上后，微服务的注册地址即使改为公网 ip 仍然无法直接访问到各个微服务的接口，这时就需要使用 Consul 来进行服务发现与注册，实现高效的微服务节点管理。</p><p>示例中，假定一个主服务 MAIN_SERVER，一个微服务 PUSH_SERVER 部署在两台服务器上，分别为 SERVER1 和 SERVER2。consul 服务部署在另一台服务器 SERVER3 上。</p><h2 id="第一步-consul-服务搭建"><a href="#第一步-consul-服务搭建" class="headerlink" title="第一步 consul 服务搭建"></a>第一步 consul 服务搭建</h2><h3 id="安装-consul-1-x（服务器中安装）"><a href="#安装-consul-1-x（服务器中安装）" class="headerlink" title="安装 consul 1.x（服务器中安装）"></a>安装 consul 1.x（服务器中安装）</h3><p>1.1 通过 docker-compose 安装 consul <code>curl -L &quot;https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose</code><br>1.2 设置 docker-compose 执行权限 <code>sudo chmod +x /usr/local/bin/docker-compose</code><br>1.3 创建 docker-compose.yml 文件 <code>vi docker-compose.yml</code><br>1.4 写入以下内容：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3&quot;</span><br><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">consul:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">consul:1.10.1</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">consul_dev</span><br>    <span class="hljs-attr">command:</span> <span class="hljs-string">agent</span> <span class="hljs-string">-server</span> <span class="hljs-string">-node=consul_dev</span> <span class="hljs-string">-bootstrap-expect=1</span> <span class="hljs-string">-bind=127.0.0.1</span> <span class="hljs-string">-client=0.0.0.0</span> <span class="hljs-string">-datacenter=dc1</span> <span class="hljs-string">-ui</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;18500:8500&quot;</span><br>    <span class="hljs-attr">network_mode:</span> <span class="hljs-string">bridge</span><br></code></pre></td></tr></table></figure><p>2.5 启动 consul <code>docker-compose up -d</code><br>2.6 验证 consul 运行状态 <code>docker ps</code></p><h2 id="第二步-创建-consul-module"><a href="#第二步-创建-consul-module" class="headerlink" title="第二步 创建 consul module"></a>第二步 创建 consul module</h2><ul><li><ol><li>创建 <code>consul/consul.service.ts</code> 文件，内容如下：</li></ol></li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Inject</span>, <span class="hljs-title class_">Injectable</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@nestjs/common&quot;</span>;<br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-title class_">Consul</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;consul&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ConsulServiceNode</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./consul.interface&quot;</span>;<br><br><span class="hljs-meta">@Injectable</span>()<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConsulService</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-meta">@Inject</span>(<span class="hljs-string">&quot;CONSUL&quot;</span>) <span class="hljs-keyword">private</span> <span class="hljs-attr">consul</span>: <span class="hljs-title class_">Consul</span>.<span class="hljs-title class_">Consul</span></span>) &#123;&#125;<br><br>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">register</span>(<span class="hljs-params"><span class="hljs-attr">options</span>: <span class="hljs-title class_">Consul</span>.<span class="hljs-title class_">Agent</span>.<span class="hljs-title class_">Service</span>.<span class="hljs-title class_">RegisterOptions</span></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">consul</span>.<span class="hljs-property">agent</span>.<span class="hljs-property">service</span>.<span class="hljs-title function_">register</span>(options);<br>  &#125;<br><br>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">deregister</span>(<span class="hljs-params"><span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">consul</span>.<span class="hljs-property">agent</span>.<span class="hljs-property">service</span>.<span class="hljs-title function_">deregister</span>(id);<br>  &#125;<br><br>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">maintenance</span>(<span class="hljs-params"><span class="hljs-attr">options</span>: <span class="hljs-title class_">Consul</span>.<span class="hljs-title class_">Agent</span>.<span class="hljs-title class_">Service</span>.<span class="hljs-title class_">MaintenanceOptions</span></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">consul</span>.<span class="hljs-property">agent</span>.<span class="hljs-property">service</span>.<span class="hljs-title function_">maintenance</span>(options);<br>  &#125;<br><br>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">findService</span>(<br>    <span class="hljs-attr">serviceName</span>: <span class="hljs-built_in">string</span><br>  ): <span class="hljs-title class_">Promise</span>&lt;&#123; <span class="hljs-attr">host</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">port</span>: <span class="hljs-built_in">number</span> &#125;&gt; &#123;<br>    <span class="hljs-keyword">const</span> services = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">consul</span>.<span class="hljs-property">catalog</span>.<span class="hljs-property">service</span>.<span class="hljs-property">nodes</span>&lt;<br>      <span class="hljs-title class_">ConsulServiceNode</span>[]<br>    &gt;(serviceName);<br>    <span class="hljs-keyword">if</span> (!services.<span class="hljs-property">length</span>) &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Service <span class="hljs-subst">$&#123;serviceName&#125;</span> not found`</span>);<br>    &#125;<br>    <span class="hljs-keyword">const</span> service = services[<span class="hljs-number">0</span>];<br>    <span class="hljs-keyword">return</span> &#123;<br>      <span class="hljs-attr">host</span>: service.<span class="hljs-property">ServiceAddress</span>,<br>      <span class="hljs-attr">port</span>: service.<span class="hljs-property">ServicePort</span>,<br>    &#125;;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="2"><li>创建 <code>consul/consul.module.ts</code> 文件，内容如下：</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Global</span>, <span class="hljs-title class_">Module</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@nestjs/common&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ConsulService</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./consul.service&quot;</span>;<br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-title class_">Consul</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;consul&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ConfigService</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@nestjs/config&quot;</span>;<br><br><span class="hljs-meta">@Global</span>()<br><span class="hljs-meta">@Module</span>(&#123;&#125;)<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConsulModule</span> &#123;<br>  <span class="hljs-keyword">static</span> <span class="hljs-title function_">forRoot</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> provider = &#123;<br>      <span class="hljs-attr">provide</span>: <span class="hljs-string">&quot;CONSUL&quot;</span>,<br>      <span class="hljs-attr">inject</span>: [<span class="hljs-title class_">ConfigService</span>],<br>      <span class="hljs-attr">useFactory</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">config</span>: <span class="hljs-title class_">ConfigService</span></span>) =&gt;</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Consul</span>(&#123;<br>          <span class="hljs-comment">// 也可以直接写死 consul 地址</span><br>          <span class="hljs-attr">host</span>: config.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;CONSUL_HOST&quot;</span>),<br>          <span class="hljs-attr">port</span>: config.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;CONSUL_PORT&quot;</span>),<br>          <span class="hljs-attr">promisify</span>: <span class="hljs-literal">true</span>,<br>        &#125;);<br>      &#125;,<br>    &#125;;<br><br>    <span class="hljs-keyword">return</span> &#123;<br>      <span class="hljs-attr">module</span>: <span class="hljs-title class_">ConsulModule</span>,<br>      <span class="hljs-attr">providers</span>: [provider, <span class="hljs-title class_">ConsulService</span>],<br>      <span class="hljs-attr">exports</span>: [provider, <span class="hljs-title class_">ConsulService</span>],<br>    &#125;;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="第三步：nestjs-微服务注册"><a href="#第三步：nestjs-微服务注册" class="headerlink" title="第三步：nestjs 微服务注册"></a>第三步：nestjs 微服务注册</h2><blockquote><p>借助 onModuleInit 生命周期，在主服务启动时，注册微服务到 consul<br>在 app.module.ts 中注入微服务</p></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Module</span>, <span class="hljs-title class_">OnModuleInit</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@nestjs/common&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">AppController</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./app.controller&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">AppService</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./app.service&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">NewsModule</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./news/news.module&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ConsulModule</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./consul/consul.module&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ConsulService</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./consul/consul.service&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ConfigModule</span>, <span class="hljs-title class_">ConfigService</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@nestjs/config&quot;</span>;<br><br><span class="hljs-keyword">const</span> envFilePath = <span class="hljs-string">`.env.<span class="hljs-subst">$&#123;process.env.NODE_ENV || <span class="hljs-string">&quot;prod&quot;</span>&#125;</span>`</span>;<br><br><span class="hljs-meta">@Module</span>(&#123;<br>  <span class="hljs-attr">imports</span>: [<br>    <span class="hljs-title class_">ConfigModule</span>.<span class="hljs-title function_">forRoot</span>(&#123;<br>      <span class="hljs-attr">isGlobal</span>: <span class="hljs-literal">true</span>,<br>      envFilePath,<br>    &#125;),<br>    <span class="hljs-title class_">NewsModule</span>,<br>    <span class="hljs-title class_">ConsulModule</span>.<span class="hljs-title function_">forRoot</span>(),<br>  ],<br>  <span class="hljs-attr">controllers</span>: [<span class="hljs-title class_">AppController</span>],<br>  <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">AppService</span>],<br>&#125;)<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppModule</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">OnModuleInit</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span><br><span class="hljs-params">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-attr">consulService</span>: <span class="hljs-title class_">ConsulService</span>,</span><br><span class="hljs-params">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-attr">config</span>: <span class="hljs-title class_">ConfigService</span></span><br><span class="hljs-params">  </span>) &#123;&#125;<br><br>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onModuleInit</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> config = <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>;<br>    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">consulService</span>.<span class="hljs-title function_">register</span>(&#123;<br>      <span class="hljs-comment">// 可以直接写死ip；如果服务器间组网可内网 ip 互联则写内网 ip，否则写公网 ip</span><br>      <span class="hljs-attr">name</span>: config.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;APP_NAME&quot;</span>),<br>      <span class="hljs-attr">address</span>: config.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;APP_HOST&quot;</span>),<br>      <span class="hljs-attr">port</span>: <span class="hljs-title class_">Number</span>(config.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;APP_PORT&quot;</span>) || <span class="hljs-number">3001</span>),<br>    &#125;);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="第四步-nestjs-主服务-网关-微服务发现"><a href="#第四步-nestjs-主服务-网关-微服务发现" class="headerlink" title="第四步 nestjs 主服务(网关)微服务发现"></a>第四步 nestjs 主服务(网关)微服务发现</h2><blockquote><p><code>app.module.ts</code> 中注入微服务</p></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 全局注册</span><br><span class="hljs-meta">@Global</span>()<br><span class="hljs-meta">@Module</span>(&#123;<br>  <span class="hljs-attr">imports</span>: [<br>    <span class="hljs-title class_">ClientsModule</span>.<span class="hljs-title function_">registerAsync</span>([<br>      &#123;<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;PUSH_SERVER&#x27;</span>,<br>        <span class="hljs-attr">useFactory</span>: <span class="hljs-title function_">async</span> (<span class="hljs-attr">consulService</span>: <span class="hljs-title class_">ConsulService</span>) =&gt; &#123;<br>          <span class="hljs-keyword">const</span> serverName = <span class="hljs-string">&#x27;pushServer_&#x27;</span> + process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> || <span class="hljs-string">&#x27;prod&#x27;</span>;<br>          <span class="hljs-keyword">const</span> &#123; host, port &#125; = <span class="hljs-keyword">await</span> consulService.<span class="hljs-title function_">findService</span>(serverName);<br>          <span class="hljs-keyword">return</span> &#123;<br>            <span class="hljs-attr">transport</span>: <span class="hljs-title class_">Transport</span>.<span class="hljs-property">TCP</span>,<br>            <span class="hljs-attr">options</span>: &#123;<br>              host,<br>              port,<br>            &#125;,<br>          &#125;;<br>        &#125;,<br>        <span class="hljs-attr">inject</span>: [<span class="hljs-title class_">ConsulService</span>],<br>      &#125;,<br>    ]),<br>  ],<br>&#125;)<br></code></pre></td></tr></table></figure><h2 id="第五步-主服务-网关-微服务调用"><a href="#第五步-主服务-网关-微服务调用" class="headerlink" title="第五步 主服务(网关)微服务调用"></a>第五步 主服务(网关)微服务调用</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ClientProxy</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@nestjs/microservices&quot;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppController</span> &#123;<br>  <span class="hljs-comment">// 注入微服务</span><br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-meta">@Inject</span>(<span class="hljs-string">&quot;PUSH_SERVER&quot;</span>) <span class="hljs-keyword">private</span> <span class="hljs-attr">pushServer</span>: <span class="hljs-title class_">ClientProxy</span></span>) &#123;&#125;<br><br>  <span class="hljs-comment">// 调用方 - 主服务（网关）send</span><br>  <span class="hljs-meta">@Get</span>(<span class="hljs-string">&quot;fetchLatestNews&quot;</span>)<br>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">fetchLatestNews</span>(<span class="hljs-params"><span class="hljs-meta">@Query</span>() query</span>) &#123;<br>    <span class="hljs-keyword">const</span> latestTime = query.<span class="hljs-property">latestTime</span> || <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>();<br>    <span class="hljs-comment">// this.pushServer.emit(&#x27;fetchNewsTask&#x27;, &#123;&#125;);</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">pushServer</span>.<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;fetchLatestNews&quot;</span>, latestTime);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><ol><li>无法连接微服务<blockquote><p>自检防火墙是否放开端口<br>检查微服务是否正常启动</p></blockquote></li></ol><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs subunit">[Nest] 356351  - 2024<span class="hljs-string">-11</span><span class="hljs-string">-09</span> 21:20:11 AM   ERROR [ExceptionsHandler] connect ECONNREFUSED xx.xx.xx.xx:3001<br><span class="hljs-keyword">Error: </span>connect ECONNREFUSED xx.xx.xx.xx:3001<br> at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1278:16)<br></code></pre></td></tr></table></figure><ul><li><p>1.1 微服务自检端口</p></li><li><p>lsof -i:3001 （如果为 TCP localhost:3001 则需要将微服务启动监听 0.0.0.0）</p></li><li><p>node\x20&#x2F; 158029 root 19u IPv4 901314 0t0 TCP *:3001 (LISTEN)</p></li><li><p>1.2 主服务访问微服务端口</p></li><li><p>nmap -p 3001 10.0.0.4</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs 失败示例">PORT     STATE SERVICE<br>3001/tcp closed  nessus<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs 成功示例"><br>PORT     STATE SERVICE<br>3001/tcp open  nessus<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>工程化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nestjs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025-04-02- 【工具】前端工具</title>
    <link href="/2024/10/28/2025-04-02-%E3%80%90%E5%B7%A5%E5%85%B7%E3%80%91%E5%89%8D%E7%AB%AF%E5%B7%A5%E5%85%B7/"/>
    <url>/2024/10/28/2025-04-02-%E3%80%90%E5%B7%A5%E5%85%B7%E3%80%91%E5%89%8D%E7%AB%AF%E5%B7%A5%E5%85%B7/</url>
    
    <content type="html"><![CDATA[<h3 id="vscode-拓展"><a href="#vscode-拓展" class="headerlink" title="vscode 拓展"></a>vscode 拓展</h3><p>vue 语法支持：Vetur<br>点击 css 类名跳到定义处：CSS Navigation<br>点击 template、script 中的变量、方法名跳到定义处：vue-helper<br>点击组件名跳到文件处：Vue Peek</p><p>彩虹括号：Rainbow Brackets<br>git 历史记录：Git History、GitLens</p><h3 id="谷歌浏览器插件"><a href="#谷歌浏览器插件" class="headerlink" title="谷歌浏览器插件"></a>谷歌浏览器插件</h3><p>去广告 AdGuard<br>前端助手 FeHelper<br>页面翻译 沉浸式翻译<br>本地 AI 助手 page assist<br>网站代理 whistle<br>网站优化 pageSpeed Insights</p>]]></content>
    
    
    <categories>
      
      <category>工具</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nestjs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2024-06-23 【架构】Axios请求&amp;返回大小写转换</title>
    <link href="/2024/06/23/2024-06-23%20%E3%80%90%E6%9E%B6%E6%9E%84%E3%80%91Axios%E8%AF%B7%E6%B1%82&amp;%E8%BF%94%E5%9B%9E%E5%A4%A7%E5%B0%8F%E5%86%99%E8%BD%AC%E6%8D%A2/"/>
    <url>/2024/06/23/2024-06-23%20%E3%80%90%E6%9E%B6%E6%9E%84%E3%80%91Axios%E8%AF%B7%E6%B1%82&amp;%E8%BF%94%E5%9B%9E%E5%A4%A7%E5%B0%8F%E5%86%99%E8%BD%AC%E6%8D%A2/</url>
    
    <content type="html"><![CDATA[<h1 id="需求背景"><a href="#需求背景" class="headerlink" title="需求背景"></a>需求背景</h1><h1 id="方案"><a href="#方案" class="headerlink" title="方案"></a>方案</h1><h1 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h1><ol><li>大小写</li><li>失败重试</li><li>防止重复请求（取消重复请求）</li></ol>]]></content>
    
    
    <categories>
      
      <category>架构</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>2023-11-18 【架构】lerna开发README</title>
    <link href="/2023/11/18/2023-11-18%20%E3%80%90%E6%9E%B6%E6%9E%84%E3%80%91lerna%E5%BC%80%E5%8F%91README/"/>
    <url>/2023/11/18/2023-11-18%20%E3%80%90%E6%9E%B6%E6%9E%84%E3%80%91lerna%E5%BC%80%E5%8F%91README/</url>
    
    <content type="html"><![CDATA[<h1 id="应用中枢代码基于-lerna-的-monorepo-开发模式管理"><a href="#应用中枢代码基于-lerna-的-monorepo-开发模式管理" class="headerlink" title="应用中枢代码基于 lerna 的 monorepo 开发模式管理"></a>应用中枢代码基于 lerna 的 monorepo 开发模式管理</h1><h2 id="目录介绍"><a href="#目录介绍" class="headerlink" title="目录介绍"></a>目录介绍</h2><ul><li>packages&#x2F;tgac-web-common:一网通办公共组件仓库</li></ul><h2 id="环境依赖"><a href="#环境依赖" class="headerlink" title="环境依赖"></a>环境依赖</h2><ul><li>node 12.16.3</li><li>yarn 1.22.4</li><li>gsm (<a href="https://www.npmjs.com/package/git-submodule-management">https://www.npmjs.com/package/git-submodule-management</a>)</li></ul><h2 id="项目仓库本地初始化"><a href="#项目仓库本地初始化" class="headerlink" title="项目仓库本地初始化"></a>项目仓库本地初始化</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># 从仓库clone最新代码</span><br>git <span class="hljs-built_in">clone</span> git@git.code.tencent.com:gasc/tgac-web-lerna.git<br><br><span class="hljs-comment"># 进入项目根目录</span><br><span class="hljs-built_in">cd</span> tgac-web-lerna<br><br><span class="hljs-comment"># 对子模块进行初始化操作</span><br>git submodule init<br><br><span class="hljs-comment"># 更新子模块最新代码</span><br>git submodule update<br></code></pre></td></tr></table></figure><h2 id="本地开发前准备"><a href="#本地开发前准备" class="headerlink" title="本地开发前准备"></a>本地开发前准备</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># 进入项目根目录</span><br><span class="hljs-built_in">cd</span> tgac-web-lerna<br><br><span class="hljs-comment"># 切换到目标分支</span><br>git checkout <span class="hljs-variable">$TARGET_BRANCH</span><br><br><span class="hljs-comment"># 检查子模块是否与当前分支的submodule记录一致</span><br>git status<br><br><span class="hljs-comment"># 如果发现有差异，则需执行</span><br>git submodule update<br></code></pre></td></tr></table></figure><h2 id="本地开发流程"><a href="#本地开发流程" class="headerlink" title="本地开发流程"></a>本地开发流程</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># 进入项目根目录</span><br><span class="hljs-built_in">cd</span> tgac-web-lerna<br><br><span class="hljs-comment"># 构建依赖包</span><br>yarn bootstrap<br><br><span class="hljs-comment"># 新增某个子应用所需的依赖</span><br>lerna add &lt;package_name&gt; --scope=&lt;package_name&gt;<br><br><span class="hljs-comment"># 给所有子应用新增依赖</span><br>lerna add &lt;package_name&gt;<br><br><span class="hljs-comment"># 新增公用开发工具，比如eslint</span><br>yarn add -W -D eslint<br><br><span class="hljs-comment"># 清除所有依赖</span><br>yarn clean<br></code></pre></td></tr></table></figure><h2 id="公用包发布流程（一般先发布-next-版本验证后没问题再发布-latest-版本）"><a href="#公用包发布流程（一般先发布-next-版本验证后没问题再发布-latest-版本）" class="headerlink" title="公用包发布流程（一般先发布 next 版本验证后没问题再发布 latest 版本）"></a>公用包发布流程（一般先发布 next 版本验证后没问题再发布 latest 版本）</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># 进入项目根目录</span><br><span class="hljs-built_in">cd</span> tgac-web-lerna<br><br><span class="hljs-comment"># 构建公用包</span><br>yarn build<br><br><span class="hljs-comment"># 发布公用包（预览版）</span><br>yarn publish:next<br><br><span class="hljs-comment"># 发布公用包（正式版）</span><br>yarn publish:latest<br><br><span class="hljs-comment"># 统一更新git提交记录</span><br>gsm ac <span class="hljs-string">&#x27;feat: publish common&#x27;</span><br><br><span class="hljs-comment"># 统一推送git仓库到当前分支</span><br>gsm push<br></code></pre></td></tr></table></figure><h2 id="lerna-yarn-workspaces-模式下，子应用开发注意点"><a href="#lerna-yarn-workspaces-模式下，子应用开发注意点" class="headerlink" title="lerna + yarn workspaces 模式下，子应用开发注意点"></a>lerna + yarn workspaces 模式下，子应用开发注意点</h2><ul><li>别直接在子应用中通过<code>npm</code>或者<code>yarn</code>进行新增包操作</li><li>不需要发布到<code>gnpm</code>的包，必须在<code>package.json</code>加<code>&quot;private&quot;: true</code></li></ul><h2 id="其他，待完善"><a href="#其他，待完善" class="headerlink" title="其他，待完善"></a>其他，待完善</h2>]]></content>
    
    
    <categories>
      
      <category>架构</category>
      
    </categories>
    
    
    <tags>
      
      <tag>lerna</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2018-4-8周报</title>
    <link href="/2018/04/08/%E5%91%A8%E6%8A%A5/2018-4-8%E5%91%A8%E6%8A%A5/"/>
    <url>/2018/04/08/%E5%91%A8%E6%8A%A5/2018-4-8%E5%91%A8%E6%8A%A5/</url>
    
    <content type="html"><![CDATA[<h1 id="一、主要工作"><a href="#一、主要工作" class="headerlink" title="一、主要工作"></a>一、主要工作</h1><h2 id="行啊"><a href="#行啊" class="headerlink" title="行啊"></a>行啊</h2><p>1、和 Web 对接，审批详情功能开发<br>2、H5 缺陷修复<br>3、H5-先查航班后选乘客模块开发<br>4、散客 B2C 框架设计、框架搭建</p><h1 id="二、心得体会"><a href="#二、心得体会" class="headerlink" title="二、心得体会"></a>二、心得体会</h1><h2 id="新员工培养"><a href="#新员工培养" class="headerlink" title="新员工培养"></a>新员工培养</h2><pre><code class="hljs">3月底入职H5前端新同事一名-孙力，通过两周的培养。* 1、已完成课程7门，未完成3门；* 2、已完成行啊中台配置阶段一验收，剩余2次中台业务学习验收；* 3、参与行啊webapp 1.0.4版本兼容问题缺陷修复，2个；* 4、参与行啊B2C UI框架选型，UI示例库（VUX、mint-ui），完成情况较好总体结论，前端基础较扎实，vue方面上手能力强，可培养，但工作还欠缺主动性，在工作项的进度反馈方面意识还有待提高，从最开始较为浮躁，工作项的优先级、重要性的不明确，到渐渐进入工作状态，分清工作主次，进步明显。接下来的工作中，我将辅助培养其自我驱动能力，针对性地进行有效的成长计划制定，尽快帮助他进入团队需要的工作状态。</code></pre><h2 id="工作总结"><a href="#工作总结" class="headerlink" title="工作总结"></a>工作总结</h2><p>1、H5 对接问题<br>此次与 web 团队合作完成的领导审批功能的实现并不理想，虽然功能界面简单，<br>但从实现过程来看物非所值，由于两端所用框架不同，开发阶段联调无法实现，<br>导致自测不充分，且由于部署环境为预投产环境，每次修复问题后部署耗时较长。<br>问题原因：1、功能点划分不明确。2、测试范围未事先确定。3、框架结核性上缺少沟通</p><p>2、H5 缺陷过多问题（重复打开关闭）<br>此次 H5 版本的开发虽然告一段落，但留下的数据令人惊叹，前所未有的缺陷数。<br>1、前期由于工时较短，直接参照原生 app 逻辑进行开发，且安卓 IOS 逻辑不一致，导致界面串接问题较多。<br>2、编码不规范，约束不足，代码难以维护，缺陷的重复打开多存在于此。<br>3、尝试与 web 团队’合作编程‘，过程中沟通不足，功能交叉时也并未及时跟进。<br>4、缺陷修复时，部分功能点改动影响其他功能。</p><p>3、欠缺东西<br>以下为上版本中做的不足急需改进的地方，目前已开展，约束规范及推荐写法的方式去规避</p><p>#三、下两周工作计划</p><h2 id="行啊-H5"><a href="#行啊-H5" class="headerlink" title="行啊 H5"></a>行啊 H5</h2><p>1、项目优化，主要针对首屏加载慢问题<br>2、散客 B2C 需求开发<br>3、着手 vue 版本基于（Mocha&#x2F;Karma)单元测试方案的预研</p>]]></content>
    
    
    <categories>
      
      <category>Foo</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>2018-01-30-H5方向总结</title>
    <link href="/2018/01/30/h5/2018-01-30-H5%E6%96%B9%E5%90%91%E6%80%BB%E7%BB%93/"/>
    <url>/2018/01/30/h5/2018-01-30-H5%E6%96%B9%E5%90%91%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h2 id="一、主要工作"><a href="#一、主要工作" class="headerlink" title="一、主要工作"></a>一、主要工作</h2><h3 id="行啊-H5"><a href="#行啊-H5" class="headerlink" title="行啊 H5"></a>行啊 H5</h3><p>1、框架搭建（sass、jquery、axios、mui、mint-ui 整合）<br>2、城市列表和日历控件<br>3、机票查询（单程和往返）<br>4、选择成本中心<br>5、机票查询（多程）<br>6、舱位列表 1</p><h3 id="行啊-android"><a href="#行啊-android" class="headerlink" title="行啊 android"></a>行啊 android</h3><p>1、送审模块网络框架优化<br>2、我的 2017 开发</p><h2 id="二、H5-方向总结"><a href="#二、H5-方向总结" class="headerlink" title="二、H5 方向总结"></a>二、H5 方向总结</h2><p>1、 人力投入情况</p><ul><li>通过 2 周的预研，3 周的实施，于 2.2 日完成 H5 框架迁移工作，虽然过程中存在人员请假、框架迁移时限不断提前等情况，但最终通过调整迁移方案、加班加点完成了整个迁移工作，体现出大家应对困难的能力、以及奉献的精神值得鼓励。</li></ul><p>2、进度与问题</p><ul><li><p>进度：2 月 2 日完成机票模块的迁移，</p></li><li><p>计划：3 月主要跟进缺陷修复，新功能开发：审批单、酒店等功能。</p></li><li><p>问题：</p></li><li><p>1、并未完全转换为 vue 组件，后续可能存在未知问题需跟踪解决。</p></li><li><p>2、开发过程中暴露的问题：H5 开发成员接触前端 H5 开发时间较短，基础知识掌握不牢靠，解决问题的能力待提高。</p></li></ul><p>3、改进项和待办项<br>（1）优化加载效率：随着代码量增大，包越大加载越慢。（计划 2 季度进行）<br>（1.1）界面优化<br>（1.2）性能优化<br>（2）寻求高效的调试方案（2 月）<br>（3）接口数据 mock 方案（计划 2 季度进行）<br>（4）打包检查单、上线操作流程表。（2 月）<br>（5）安全方向：补全完善应急预案（故障恢复流程）中故障的识别（计划 2 季度进行）<br>（6）H5 方向移动安全方案（计划 2 季度进行）</p><h2 id="三、下两周工作计划"><a href="#三、下两周工作计划" class="headerlink" title="三、下两周工作计划"></a>三、下两周工作计划</h2><h3 id="“行啊”项目"><a href="#“行啊”项目" class="headerlink" title="“行啊”项目"></a>“行啊”项目</h3><p>1、行啊 H5 开发<br>2、行啊 android 开发</p><p>你的站点上动态渲染的任意 HTML 可能会非常危险，因为它很容易导致 XSS 攻击。请只对可信内容使用 HTML 插值，绝不要对用户提供的内容使用插值。</p><h2 id="为什么要换框架，为什么要选-vue。"><a href="#为什么要换框架，为什么要选-vue。" class="headerlink" title="为什么要换框架，为什么要选 vue。"></a>为什么要换框架，为什么要选 vue。</h2><p>(一方面加强大家学习的动力，加强团队对她的重视程度)</p><h3 id="【为什么要换框架】"><a href="#【为什么要换框架】" class="headerlink" title="【为什么要换框架】"></a>【为什么要换框架】</h3><ol><li>为将来做打算：</li></ol><p>这是一种前端技术使用的趋势，<code>（随着手机设备的普及和性能的提升，移动端的web需求越来越多，产生了一种叫webapp的东西，也就是移动端的网页应用。它们功能越来越复杂，交互也越来越酷炫，功能与效果越来越接近于原生的APP。）</code><br>对于团队来说，算是一种突破，一种技术革新，也是一种积累与沉淀。</p><p>混合开发从我最早接触前后端分离，angular 纯 webapp，到 MUI，再到 react native，都是为了让我们能够跟上时代的潮流，能够提高我们移动团队的竞争力。<br><code>（说白了，硬要换框架是想提高团队接活的信心。让俊哥、让园哥能够有更多的谈资去为我们针取更多的项目。）</code></p><ol start="2"><li>提高产品实现的效率以及质量：</li></ol><p>相比之前的 用 jquery+sass+gulp 弄得一套框架，在处理界面交付逻辑时，我们不仅要关注数据的走向，而且需要手动的操作界面的交互响应。这不很麻烦吗。<br>用成熟的框架，能让我们省去操作 dom 这一环节，仅关注数据，省了不少事。<br>&#96;（当然，这是一个过程，不是一开始都用的得心应手，我们都知道，做行啊 APP 的实现并不难，难得只是他的业务）</p><p>【为什么要选 vue】<br>1、首先，是为了锻炼大家组件化开发的思想，用好了 VUE 掌握了组件化开发的方式，再学习其他的前端框架都将得心应手。<br>2、那么为什么要选 vue 呢，因为他好上手，设计的也比较简单，起点低。</p><p>让大家明白这样做是值得的，对团队对个人都是利好的。加油吧，骚年们。</p><!-- more --><h2 id="上月已完成"><a href="#上月已完成" class="headerlink" title="上月已完成"></a>上月已完成</h2><p>1、打包检查单、上线操作流程<br>2、补全完善应急预案故障恢复流程中的内容<br>3、mockJs（web 帮忙解决）</p><h2 id="H5-方向问题总结"><a href="#H5-方向问题总结" class="headerlink" title="H5 方向问题总结"></a>H5 方向问题总结</h2><p>1、问题较多，难改<br>部分缺陷不好修复：<br>1、路由返回（缓存问题）<br>2、兼容类 android&#x2F;ios 交互不一致（安卓能不能封装一个个性化的浏览器内核）<br>3、json 数据，与 APP 数据不一致问题。（数据库&#x3D;》json 数据）</p><p>2、上线问题：<br>访问地址与上版本不一致<br>现在的解决办法是手动添加打包目录。<br>测试环境与生产环境打包不同。<br>待改进，通过配置项设置打包路径，区分生产包与测试包</p><p>3、约束性不够</p><p>生产环境下月会改</p><p>部署版本缓存问题，版本号添加<br>自动化部署问题，找韦毅。</p><h2 id="下月计划"><a href="#下月计划" class="headerlink" title="下月计划"></a>下月计划</h2><p>1、安全方向：vuex 加密安全方案<br>2、单元测试<br>3、webpack 生产配置方案</p>]]></content>
    
    
    <categories>
      
      <category>echart</category>
      
    </categories>
    
    
    <tags>
      
      <tag>前端</tag>
      
      <tag>echart</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
