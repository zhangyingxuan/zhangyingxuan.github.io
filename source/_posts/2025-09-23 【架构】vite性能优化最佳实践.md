---
title: 2025-09-23 ã€æ¶æ„ã€‘viteæ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ
description:
categories:
  - æ¶æ„è®¾è®¡
tags:
  - vite
  - RUM
---

Vite çš„ä¼˜åŒ–ä¸»è¦åˆ†ä¸º **å¼€å‘ä½“éªŒï¼ˆDev Speedï¼‰**ã€**æ„å»ºæ€§èƒ½ï¼ˆBuild Speedï¼‰** å’Œ **äº§ç‰©è´¨é‡ï¼ˆBundle Qualityï¼‰** ä¸‰ä¸ªç»´åº¦ã€‚

å¯¹äºä¸€ä¸ªæ ‡å‡†çš„ Vite é¡¹ç›®ï¼Œå¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒå±‚é¢è¿›è¡Œæ·±åº¦ä¼˜åŒ–ï¼š

---

## ä¸€ã€ æ„å»ºäº§ç‰©ä¼˜åŒ–ï¼ˆBundle Qualityï¼‰

è¿™æ˜¯ä¼˜åŒ–æœ€æœ‰æ„Ÿçš„éƒ¨åˆ†ï¼Œç›´æ¥å½±å“ç”¨æˆ·è®¿é—®ä½ çš„ç½‘ç«™æ—¶çš„é¦–å­—èŠ‚æ—¶é—´ï¼ˆTTFBï¼‰å’Œé¡µé¢åŠ è½½é€Ÿåº¦ã€‚

### 1. åˆ†åŒ…ç­–ç•¥ (Manual Chunks)

é»˜è®¤æƒ…å†µä¸‹ï¼ŒVite ä¼šå°†æ‰€æœ‰ JS æ‰“åŒ…åœ¨ä¸€èµ·ã€‚åˆ©ç”¨ `rollupOptions` å°†å¤§å‹ç¬¬ä¸‰æ–¹åº“æ‹†åˆ†å‡ºæ¥ï¼Œå¯ä»¥æœ‰æ•ˆåˆ©ç”¨æµè§ˆå™¨ç¼“å­˜ã€‚

```javascript
// vite.config.js
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          "vue-vendor": ["vue", "vue-router", "pinia"],
          "ui-vendor": ["element-plus", "antd"], // è¾ƒå¤§çš„ UI åº“å•ç‹¬æ‰“åŒ…
        },
      },
    },
  },
});
```

### 2. å¯ç”¨é¢„å‹ç¼© (Gzip & Brotli)

å‰ç«¯éœ€è¦åœ¨æ„å»ºæ—¶ï¼ŒåŒæ—¶ç”Ÿæˆ `.gz` åŠ `.br` æ–‡ä»¶ã€‚ä½¿ç”¨ `vite-plugin-compression`ã€‚

```javascript
import compress from "vite-plugin-compression";

plugins: [
  // 1. ç”Ÿæˆ .gz æ–‡ä»¶
  compress({
    algorithm: "gzip",
    ext: ".gz",
    threshold: 10240, // è¶…è¿‡ 10kb æ‰å‹ç¼©
    deleteOriginFile: false, // åˆ‡è®°ï¼šä¸è¦åˆ é™¤æºæ–‡ä»¶ï¼
  }),
  // 2. ç”Ÿæˆ .br æ–‡ä»¶
  compress({
    algorithm: "brotliCompress",
    ext: ".br",
    threshold: 10240,
    deleteOriginFile: false,
  }),
];
```

> æè‡´æ€§èƒ½ä¸ä¿åº•å…¼å®¹çš„å®Œç¾å¹³è¡¡ï¼›è¿™æ˜¯â€œæ€§èƒ½ä¸Šé™â€ä¸â€œå…¼å®¹ä¸‹é™â€çš„åšå¼ˆï¼š
> Brotli (br) æ˜¯ä¸Šé™ï¼šå®ƒçš„å‹ç¼©ç‡æ¯” Gzip é«˜å‡º 17%-25%ã€‚è¿™æ„å‘³ç€åŒæ ·çš„ JS æ–‡ä»¶ï¼Œç”¨ br ä¼ è¾“ä¼šæ›´å°ï¼Œç”¨æˆ·æ‰“å¼€ä½ çš„â€œå­¦ä¹ ç±»ç½‘ç«™â€é€Ÿåº¦æ›´å¿«ã€‚
> Gzip (gz) æ˜¯ä¸‹é™ï¼šè™½ç„¶ br å·²ç»è¦†ç›–äº† 95% ä»¥ä¸Šçš„ç°ä»£æµè§ˆå™¨ï¼Œä½†ä»æœ‰æå°‘æ•°åœºæ™¯ï¼ˆå¦‚æ—§ç‰ˆ Android æµè§ˆå™¨ã€æŸäº›å…¬å¸å†…ç½‘çš„è¿‡æ—¶ä»£ç†æœåŠ¡å™¨ã€æˆ–è€…ç‰¹å®šçš„çˆ¬è™«ï¼‰ä¸æ”¯æŒ brã€‚æ­¤æ—¶ï¼ŒGzip å°±æ˜¯æœ€ç¨³å¦¥çš„ä¿åº•æ–¹æ¡ˆã€‚

---

## äºŒã€ é™æ€èµ„æºä¸å›¾ç‰‡ä¼˜åŒ–

å›¾ç‰‡é€šå¸¸å é¡µé¢ä½“ç§¯çš„ 70% ä»¥ä¸Šã€‚

### 1. å›¾ç‰‡å‹ç¼©ä¸è½¬ç 

ä½¿ç”¨ `vite-plugin-imagemin` åœ¨æ‰“åŒ…æ—¶è‡ªåŠ¨å‹ç¼©å›¾ç‰‡ï¼Œæˆ–è€…ä½¿ç”¨ `vite-plugin-webp` å°†å›¾ç‰‡è½¬æ¢ä¸ºä¸‹ä¸€ä»£ WebP æ ¼å¼ã€‚

### 2. èµ„æºå†…è”é™åˆ¶

é€šè¿‡ `assetsInlineLimit` æ§åˆ¶ Base64 å†…è”ã€‚å¤ªå¤§çš„å›¾ç‰‡å†…è”ä¼šå¯¼è‡´ JS ä½“ç§¯è¿‡å¤§ï¼Œè¿‡å°çš„å›¾ç‰‡å†…è”å¯ä»¥å‡å°‘ HTTP è¯·æ±‚ã€‚

```javascript
build: {
  assetsInlineLimit: 4096, // 4kb ä»¥ä¸‹çš„èµ„æºå†…è”ä¸º base64
}

```

---

## ä¸‰ã€ å¼€å‘ç¯å¢ƒä½“éªŒä¼˜åŒ–

### 1. é¢„æ„å»ºä¾èµ– (Dependency Pre-Bundling)

å¦‚æœä½ çš„é¡¹ç›®æœ‰å¾ˆå¤š CommonJS çš„ä¾èµ–ï¼ŒVite å¯åŠ¨æ—¶ä¼šæ…¢ã€‚å¯ä»¥åœ¨ `optimizeDeps` ä¸­å¼ºåˆ¶é¢„æ„å»ºæŸäº›åŒ…ã€‚

```javascript
optimizeDeps: {
  include: ['axios', 'echarts', '@antfu/utils'],
}

```

### 2. å¼€å¯ç¼“å­˜

ç¡®ä¿ Vite çš„ `.vite` ç¼“å­˜ç›®å½•æ²¡æœ‰è¢«è¯¯åˆ ã€‚Vite ä¼šå°†é¢„æ„å»ºçš„ä¾èµ–ç¼“å­˜ï¼Œç¬¬äºŒæ¬¡å¯åŠ¨å‡ ä¹æ˜¯ç¬é—´å®Œæˆã€‚

---

## å››ã€ è¿›é˜¶ï¼šæŒ‰éœ€å¼•å…¥ä¸ Tree Shaking

### 1. è‡ªåŠ¨å¯¼å…¥æ’ä»¶

ä½¿ç”¨ `unplugin-auto-import` å’Œ `unplugin-vue-components`ã€‚è¿™ä¸ä»…èƒ½å‡å°‘ `import` è¯­å¥ï¼Œæ›´é‡è¦çš„æ˜¯å®ƒæ”¯æŒ **ç»„ä»¶çº§åˆ«çš„ Tree Shaking**ï¼Œåªæ‰“åŒ…ä½ ç”¨åˆ°çš„ç»„ä»¶ã€‚

```javascript
import AutoImport from "unplugin-auto-import/vite";
import Components from "unplugin-vue-components/vite";

plugins: [
  AutoImport({ resolvers: [ElementPlusResolver()] }),
  Components({ resolvers: [ElementPlusResolver()] }),
];
```

### 2. è§†è§‰åˆ†æå·¥å…·

å®‰è£… `rollup-plugin-visualizer`ï¼Œæ‰“åŒ…åå®ƒä¼šç”Ÿæˆä¸€ä¸ª HTML é¡µé¢ï¼Œé€šè¿‡çŸ©å½¢æ ‘å›¾æ¸…æ™°å±•ç¤ºæ¯ä¸ªä¾èµ–å ç”¨çš„ç©ºé—´ï¼Œå¸®åŠ©ä½ â€œé’ˆå¯¹æ€§å‡è‚¥â€ã€‚

---

## äº”ã€ ç»¼åˆä¼˜åŒ–é…ç½®æ¨¡æ¿

```javascript
import { defineConfig } from "vite";
import vue from "@vitejs/plugin-vue";
import { visualizer } from "rollup-plugin-visualizer";

export default defineConfig({
  plugins: [
    vue(),
    visualizer({ open: true, brotliSize: true, filename: "report.html" }),
  ],
  build: {
    target: "esnext", // ç°ä»£æµè§ˆå™¨ï¼Œäº§ç‰©æ›´å°
    minify: "esbuild", // esbuild æ¯” terser å¿« 10-40 å€
    cssCodeSplit: true, // CSS æ‹†åˆ†
    sourcemap: false, // ç”Ÿäº§ç¯å¢ƒå…³é—­ sourcemap å‡å°ä½“ç§¯
    chunkSizeWarningLimit: 1000, // æé«˜å¤§åŒ…è­¦å‘Šé˜ˆå€¼
  },
});
```

---

### ğŸ’¡ å…³é”®å»ºè®®ï¼š

- **ä¸è¦è¿‡åº¦ä¼˜åŒ–**ï¼šå¦‚æœé¡¹ç›®ä¸å¤§ï¼Œé»˜è®¤é…ç½®å·²ç»è¶³å¤Ÿã€‚
- **ä¼˜å…ˆ Brotli**ï¼šæ—¢ç„¶ä½ å·²ç»æŠ˜è…¾å¥½äº† Nginx çš„ Brotli æ¨¡å—ï¼Œå‰ç«¯æ„å»ºåŠ¡å¿…äº§å‡º `.br` æ–‡ä»¶ï¼Œè¿™æ˜¯æ”¶ç›Šæœ€é«˜çš„ä¸€é¡¹ã€‚
- **CDN åŠ é€Ÿ**ï¼šå¯¹äºæå¤§çš„åº“ï¼ˆå¦‚ Echarts, Three.jsï¼‰ï¼Œè€ƒè™‘ä½¿ç”¨ `vite-plugin-cdn-import` ä» CDN åŠ è½½ï¼Œè€Œä¸æ˜¯æ‰“å…¥æœ¬åœ°åŒ…ã€‚
