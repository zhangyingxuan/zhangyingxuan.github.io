---
title: 2025-03-03-å¼€å‘ç›¸å…³å·¥å…·è°ƒç ”
date: 2025-03-03 21:39:00
description:
categories:
  - å·¥ç¨‹åŒ–
tags:
  -
---

å¼€å‘ç›¸å…³å·¥å…·è°ƒç ”
å¾®æœåŠ¡å¼€å‘æ¡†æ¶
å¼€æºå¼€å‘æ¡†æ¶ï¼š
https://github.com/zeromicro/go-zero ï¼šä¸€ä¸ªå¸¦æœ‰ cli å·¥å…·çš„äº‘åŸç”Ÿ Go å¾®æœåŠ¡æ¡†æ¶

## å¾®æœåŠ¡å¹³å°

æœåŠ¡æ²»ç†ã€é…ç½®ä¸­å¿ƒã€‚

consul å’Œ etcd éƒ½æ¯”è¾ƒåˆé€‚ï¼Œååº”ç”¨å¼€å‘å¯ä»¥é€‰æ‹© consulï¼Œåäº‘åŸç”Ÿä½“ç³»å¯ä»¥é€‰æ‹© etcd

1.Consul
é€‚ç”¨äºéœ€è¦æœåŠ¡å‘ç°å’Œå¥åº·æ£€æŸ¥çš„åœºæ™¯ï¼Œç‰¹åˆ«æ˜¯åœ¨æ„å»ºå¾®æœåŠ¡æ¶æ„æ—¶ã€‚
é€‚ç”¨äºéœ€è¦è·¨å¤šä¸ªæ•°æ®ä¸­å¿ƒè¿›è¡Œéƒ¨ç½²çš„åœºæ™¯ï¼ŒConsul æ”¯æŒå¤šæ•°æ®ä¸­å¿ƒï¼Œå¯ä»¥åœ¨ä¸åŒåœ°ç†åŒºåŸŸä¸­éƒ¨ç½² Consul é›†ç¾¤ã€‚
2.Etcd
é€‚ç”¨äºéœ€è¦å¼ºä¸€è‡´æ€§æ•°æ®å­˜å‚¨çš„åœºæ™¯ï¼ŒEtcd æä¾›äº†é«˜å¯ç”¨ã€å¼ºä¸€è‡´æ€§çš„é”®å€¼å­˜å‚¨ã€‚
é€‚ç”¨äº Kubernetes å’Œäº‘åŸç”Ÿé¡¹ç›®çš„åœºæ™¯ï¼ŒEtcd æ˜¯ Kubernetes çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œä¹Ÿè¢«å¹¿æ³›åº”ç”¨äºå…¶ä»–äº‘åŸç”Ÿé¡¹ç›®ä¸­ã€‚
é€‚ç”¨äºéœ€è¦ä¸å…¶ä»–äº‘åŸç”Ÿå·¥å…·å’Œæ¡†æ¶é›†æˆçš„åœºæ™¯

## API ç½‘å…³

1.å¼€æºäº‘åŸç”Ÿ API ç½‘å…³ï¼šKongï¼šhttps://github.com/Kong/kong ã€‚Kong æ˜¯ä¸€ä¸ªäº‘åŸç”Ÿã€å¿«é€Ÿã€å¯æ‰©å±•çš„å¾®æœåŠ¡ API ç½‘å…³ã€‚Kong æä¾›äº†ä¸°å¯Œçš„æ’ä»¶ï¼Œç”¨äºå®ç°è®¤è¯ã€é™æµã€æ—¥å¿—è®°å½•ç­‰åŠŸèƒ½ã€‚Kong æ”¯æŒå¤šç§è¯­è¨€ï¼ŒåŒ…æ‹¬ Goã€‚ 2.è…¾è®¯äº‘ API ç½‘å…³ï¼šhttps://cloud.tencent.com/document/product/1364/89294

## ä¸­é—´ä»¶/æ’ä»¶

### HTTP å®¢æˆ·ç«¯

Go è¯­è¨€çš„æ ‡å‡†åº“ net/http å°±æä¾›äº† HTTP å®¢æˆ·ç«¯çš„å®ç°ï¼Œéå¸¸æ–¹ä¾¿ä½¿ç”¨ã€‚å¦‚æœéœ€è¦æ›´å¤šçš„åŠŸèƒ½ï¼Œå¦‚è¶…æ—¶æ§åˆ¶ã€é‡è¯•ç­–ç•¥ç­‰ï¼Œå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ï¼Œå¦‚ go-restyã€‚

ç¤ºä¾‹ä»£ç ï¼š

```
package main

import (
	"io/ioutil"
	"net/http"
)

func main() {
	resp, err := http.Get("http://example.com/")
	if err != nil {
		// handle error
	}
	defer resp.Body.Close()
	body, err := ioutil.ReadAll(resp.Body)
	// ...
}
```

### MySQL å®¢æˆ·ç«¯

sqlx æ˜¯ä¸€ä¸ª Go è¯­è¨€çš„åº“ï¼Œå®ƒæ‰©å±•äº†æ ‡å‡†åº“ä¸­çš„ database/sqlï¼Œæä¾›äº†æ›´æ–¹ä¾¿çš„ API å’Œé¢å¤–çš„åŠŸèƒ½ã€‚sqlx çš„ç›®æ ‡æ˜¯æä¾›ä¸€ç§ç®€æ´ã€å®‰å…¨ä¸”é«˜æ€§èƒ½çš„æ–¹å¼æ¥æ“ä½œ SQL æ•°æ®åº“

å®˜æ–¹æ–‡æ¡£ï¼šhttps://jmoiron.github.io/sqlx/

å®‰è£…ï¼š
go get -u github.com/jmoiron/sqlx
go get -u github.com/go-sql-driver/mysql

- ç¤ºä¾‹ä»£ç ï¼š

```
package main

import (
	"fmt"
	"github.com/jmoiron/sqlx"
	_ "github.com/go-sql-driver/mysql"
)

type User struct {
	ID   int    `db:"id"`
	Name string `db:"name"`
}

func main() {
	dsn := "user:password@tcp(127.0.0.1:3306)/dbname?charset=utf8mb4&parseTime=True&loc=Local"
	db, err := sqlx.Connect("mysql", dsn)
	if err != nil {
		panic("failed to connect database")
	}

	// Create
	_, err = db.Exec("INSERT INTO users (name) VALUES (?)", "John Doe")
	if err != nil {
		panic(err)
	}

	// Read
	var user User
	err = db.Get(&user, "SELECT * FROM users WHERE id=?", 1)
	if err != nil {
		panic(err)
	}
	fmt.Println("User:", user.Name)

	// Update
	_, err = db.Exec("UPDATE users SET name=? WHERE id=?", "Jane Doe", 1)
	if err != nil {
		panic(err)
	}

	// Delete
	_, err = db.Exec("DELETE FROM users WHERE id=?", 1)
	if err != nil {
		panic(err)
	}
}
```

Redis å®¢æˆ·ç«¯
Go è¯­è¨€ä¸­æœ‰å¤šä¸ª Redis å®¢æˆ·ç«¯åº“ï¼Œå¦‚ go-redis å’Œ redigoã€‚å…¶ä¸­ go-redis æä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½å’Œè‰¯å¥½çš„æ€§èƒ½ã€‚

ç¤ºä¾‹ä»£ç ï¼š
package main

import (
"fmt"
"github.com/go-redis/redis"
)

func main() {
client := redis.NewClient(&redis.Options{
Addr: "localhost:6379",
Password: "",
DB: 0,  
 })

    pong, err := client.Ping().Result()
    fmt.Println(pong, err)

}

ESï¼ˆElasticsearchï¼‰å®¢æˆ·ç«¯
Elasticsearch å®˜æ–¹æä¾›äº† Go è¯­è¨€çš„å®¢æˆ·ç«¯åº“ï¼Œåä¸º go-elasticsearchã€‚

ç¤ºä¾‹ä»£ç ï¼š

package main

import (
"fmt"
"github.com/elastic/go-elasticsearch/v7"
)

func main() {
cfg := elasticsearch.Config{
Addresses: []string{
"http://localhost:9200",
},
}

    es, err := elasticsearch.NewClient(cfg)
    if err != nil {
    	// Handle error
    	panic(err)
    }

    res, err := es.Info()
    if err != nil {
    	// Handle error
    	panic(err)
    }

    fmt.Println(res)

}

å¯¹è±¡å­˜å‚¨ COS å®¢æˆ·ç«¯
è…¾è®¯äº‘æä¾›äº† COSï¼ˆCloud Object Storageï¼‰çš„ Go è¯­è¨€ SDKï¼Œå¯ä»¥åœ¨ Go ä»£ç ä¸­ç›´æ¥è°ƒç”¨ã€‚

ç¤ºä¾‹ä»£ç ï¼š
package main

import (
"context"
"fmt"
"net/http"
"net/url"
"os"
"time"

    "github.com/tencentyun/cos-go-sdk-v5"

)

func main() {
u, \_ := url.Parse("https://<bucket>.cos.<region>.myqcloud.com")
b := &cos.BaseURL{BucketURL: u}
c := cos.NewClient(b, &http.Client{
Transport: &cos.AuthorizationTransport{
SecretID: os.Getenv("COS_SECRETID"),
SecretKey: os.Getenv("COS_SECRETKEY"),
},
})

    _, err := c.Bucket.Put(context.Background(), nil)
    if err != nil {
    	panic(err)
    }

}

Kafka å®¢æˆ·ç«¯
Go è¯­è¨€ä¸­æœ‰å¤šä¸ª Kafka å®¢æˆ·ç«¯åº“ï¼Œå¦‚ sarama å’Œ confluent-kafka-goã€‚sarama æ˜¯ä¸€ä¸ªçº¯ Go è¯­è¨€å®ç°çš„ Kafka å®¢æˆ·ç«¯åº“ï¼ŒåŠŸèƒ½ä¸°å¯Œï¼Œä½¿ç”¨å¹¿æ³›ã€‚

ç¤ºä¾‹ä»£ç ï¼š
package main

import (
"fmt"
"github.com/Shopify/sarama"
)

func main() {
config := sarama.NewConfig()
config.Producer.Return.Successes = true
producer, err := sarama.NewSyncProducer([]string{"localhost:9092"}, config)
if err != nil {
// handle error
}
defer func() {
if err := producer.Close(); err != nil {
// handle error
}
}()

    msg := &sarama.ProducerMessage{
    	Topic: "test",
    	Value: sarama.StringEncoder("Hello World"),
    }

    partition, offset, err := producer.SendMessage(msg)
    if err != nil {
    	// handle error
    }

    fmt.Printf("Message is stored in topic(%s)/partition(%d)/offset(%d)\n", "test", partition, offset)

}

Faiss å®¢æˆ·ç«¯
Faiss æ˜¯ä¸€ä¸ª C++ åº“ï¼Œå› æ­¤åœ¨ Go è¯­è¨€ä¸­è°ƒç”¨ Faiss éœ€è¦å€ŸåŠ© cgoã€‚ç›®å‰æ²¡æœ‰å®˜æ–¹çš„ Faiss Go å®¢æˆ·ç«¯ï¼Œä½†æœ‰ä¸€äº›ç¬¬ä¸‰æ–¹åº“å°è£…äº† Faiss çš„ C++ æ¥å£ï¼Œä¾‹å¦‚ go-faissã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ go-faiss ä½¿ç”¨ç¤ºä¾‹ï¼š
é¦–å…ˆï¼Œç¡®ä¿å·²ç»å®‰è£…äº† Faiss å’Œ go-faissã€‚å®‰è£… Faiss çš„è¯´æ˜å¯ä»¥åœ¨å®˜æ–¹æ–‡æ¡£ä¸­æ‰¾åˆ°ï¼šhttps://github.com/facebookresearch/faiss/blob/main/INSTALL.md
ç„¶åï¼Œå®‰è£… go-faissï¼š
go get -u github.com/ondralukes/go-faiss

ç®€å•çš„ Go ä»£ç ç¤ºä¾‹ï¼š

package main

import (
"fmt"
"github.com/ondralukes/go-faiss"
)

func main() {
// åˆ›å»ºä¸€ä¸ª 2D å‘é‡çš„ç´¢å¼•
index := faiss.NewIndexFlatL2(2)

    // æ·»åŠ ä¸€äº›å‘é‡åˆ°ç´¢å¼•
    vectors := []float32{
    	1.0, 1.0,
    	2.0, 2.0,
    	3.0, 3.0,
    }
    index.Add(vectors)

    // æŸ¥è¯¢æœ€è¿‘çš„å‘é‡
    query := []float32{1.1, 1.1}
    ids, dists := index.Search(query, 1)

    // è¾“å‡ºæŸ¥è¯¢ç»“æœ
    fmt.Printf("Nearest vector id: %d, distance: %f\n", ids[0], dists[0])

}

æ³¨ï¼Œè¿™ä¸ªç¤ºä¾‹ä»…ç”¨äºæ¼”ç¤º go-faiss çš„åŸºæœ¬ç”¨æ³•ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä½ å¯èƒ½éœ€è¦æ ¹æ®å…·ä½“éœ€æ±‚å¯¹ Faiss çš„å‚æ•°å’ŒåŠŸèƒ½è¿›è¡Œæ›´è¯¦ç»†çš„é…ç½®ã€‚æ›´å¤šå…³äº go-faiss çš„ä¿¡æ¯å’Œç¤ºä¾‹å¯ä»¥åœ¨å…¶ GitHub ä»“åº“ä¸­æ‰¾åˆ°ï¼šhttps://github.com/ondralukes/go-faiss

Chroma å®¢æˆ·ç«¯
Chroma æ˜¯ä¸€ä¸ªé«˜ç»´å‘é‡ç›¸ä¼¼æ€§æœç´¢å¼•æ“ï¼Œå®ƒå¯ä»¥å¯¹å¤§é‡é«˜ç»´å‘é‡è¿›è¡Œå¿«é€Ÿã€å‡†ç¡®çš„ç›¸ä¼¼æ€§æ£€ç´¢ã€‚ç„¶è€Œï¼ŒChroma å¹¶æ²¡æœ‰æä¾›å®˜æ–¹çš„ Go è¯­è¨€å®¢æˆ·ç«¯ã€‚ä½†æ˜¯åœ¨å®˜æ–¹æ–‡æ¡£ï¼šä¸­ç»™å‡ºäº†å¼€æºçš„è§£å†³æ–¹æ¡ˆï¼šhttps://github.com/amikos-tech/chroma-go

ä½¿ç”¨æ–¹å¼ï¼š
å®‰è£…ï¼š
go get github.com/amikos-tech/chroma-go

å¼•ç”¨ï¼š
import (
chroma "github.com/amikos-tech/chroma-go"
)

ç¤ºä¾‹ä»£ç ï¼š
package main

import (
"fmt"
"log"
"os"

    chroma "github.com/amikos-tech/chroma-go"
    openai "github.com/amikos-tech/chroma-go/openai"
    godotenv "github.com/joho/godotenv"

)

func main() {
client := chroma.NewClient("http://localhost:8000")
collectionName := "test-collection"
metadata := map[string]interface{}{}
err := godotenv.Load(".env")
if err != nil {
fmt.Printf("Error loading .env file: %s", err)
return
}
embeddingFunction := openai.NewOpenAIEmbeddingFunction(os.Getenv("OPENAI*API_KEY")) //create a new OpenAI Embedding function
distanceFunction := chroma.L2
*, errRest := client.Reset() //reset the database
if errRest != nil {
log.Fatalf("Error resetting database: %s \n", errRest.Error())
}
col, err := client.CreateCollection(collectionName, metadata, true, embeddingFunction, distanceFunction)
if err != nil {
fmt.Printf("Error create collection: %s \n", err.Error())
return
}
documents := []string{
"This is a document about cats. Cats are great.",
"this is a document about dogs. Dogs are great.",
}
ids := []string{
"ID1",
"ID2",
}

    metadatas := []map[string]interface{}{
    	{"key1": "value1"},
    	{"key2": "value2"},
    }
    _, addError := col.Add(nil, metadatas, documents, ids)
    if addError != nil {
    	log.Fatalf("Error adding documents: %s \n", addError)
    }
    countDocs, qrerr := col.Count()
    if qrerr != nil {
    	log.Fatalf("Error counting documents: %s \n", qrerr)
    }
    fmt.Printf("countDocs: %v\n", countDocs) //this should result in 2
    qr, qrerr := col.Query([]string{"I love dogs"}, 5, nil, nil, nil)
    if qrerr != nil {
    	log.Fatalf("Error querying documents: %s \n", qrerr)
    }
    fmt.Printf("qr: %v\n", qr.Documents[0][0]) //this should result in the document about dogs

}

LLM å®¢æˆ·ç«¯ï¼ˆå¤§è¯­è¨€æ¨¡å‹å®¢æˆ·ç«¯ï¼‰

ä¸åŒå¤§æ¨¡å‹çš„æ¥å…¥æ–¹å¼å¯èƒ½ä¼šæœ‰åŒºåˆ«ï¼Œæ‰€ä»¥éœ€è¦å‚è€ƒå¤§æ¨¡å‹æä¾›çš„å®˜æ–¹æ–‡æ¡£ã€‚ä¸è¿‡ä¸€èˆ¬éƒ½æ˜¯æä¾›çš„ http apiã€‚å…·ä½“æ¨¡å‹çš„ä½¿ç”¨å‚è€ƒä¸‹é¢çš„ä¾‹å­ã€‚

æ¸…åå¤§å­¦ ChatGLM2-6B æ¨¡å‹
https://github.com/THUDM/ChatGLM2-6B
å‚è€ƒå®˜æ–¹æ–‡æ¡£éƒ¨ç½²å¥½æ¨¡å‹åï¼Œç”¨ api çš„æ¨¡å¼è¿è¡Œ
python api.py

ä½¿ç”¨ api çš„æ–¹å¼è°ƒç”¨å¤§æ¨¡å‹ï¼š
curl -X POST "http://127.0.0.1:8000" \
 -H 'Content-Type: application/json' \
 -d '{"prompt": "ä½ å¥½", "history": []}'

è¿”å›ä¸ºï¼š
{
"response":"ä½ å¥½ ğŸ‘‹ï¼æˆ‘æ˜¯äººå·¥æ™ºèƒ½åŠ©æ‰‹ ChatGLM2-6Bï¼Œå¾ˆé«˜å…´è§åˆ°ä½ ï¼Œæ¬¢è¿é—®æˆ‘ä»»ä½•é—®é¢˜ã€‚",
"history":[["ä½ å¥½","ä½ å¥½ğŸ‘‹ï¼æˆ‘æ˜¯äººå·¥æ™ºèƒ½åŠ©æ‰‹ ChatGLM2-6Bï¼Œå¾ˆé«˜å…´è§åˆ°ä½ ï¼Œæ¬¢è¿é—®æˆ‘ä»»ä½•é—®é¢˜ã€‚"]],
"status":200,
"time":"2023-03-23 21:38:40"
}
