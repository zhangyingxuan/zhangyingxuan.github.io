---
title: 2025-04-02-【大模型】创建和编排AI智能体工作流
date: 2025-04-02 19:39:00
description: 深入解析 AI Agent 核心架构、五大设计模式，对比 MCP 协议，并提供可落地的智能体工作流构建实战指南。
categories:
  - 大模型
tags:
  - AI
  - Agent
  - Workflow
  - MCP
---

## 1. 核心概念解析

### 1.1 什么是 AI Agent (智能体)？

大模型 Agent 是具备**环境感知**、**自主理解**、**决策制定**及**执行行动**能力的智能实体。如果说 LLM（大语言模型）是“大脑”，那么 Agent 就是给大脑装上了“五官”和“四肢”。

**核心公式：**

> **Agent = LLM（大脑）+ Planning（规划）+ Memory（记忆）+ Tools（工具）**

- **规划 (Planning)**：任务拆解（CoT）、自我反思（Reflection）。
- **记忆 (Memory)**：短期记忆（上下文）、长期记忆（向量数据库）。
- **工具 (Tools)**：API 调用、联网搜索、代码执行器。
- **行动 (Action)**：输出结果、操作软件、控制硬件。

### 1.2 什么是智能体工作流 (Agentic Workflow)？

智能体工作流是指通过预定义的流程路径，将 LLM 的自主能力与确定性的逻辑编排结合起来的系统。

- **传统工作流**：A -> B -> C，路径固定，僵化。
- **智能体工作流**：A -> (LLM 判断) -> B 或 C，具备灵活性和容错性。

---

## 2. 智能体设计模式 (Design Patterns)

吴恩达教授及业界总结了五种主流的 Agent 设计模式，从简单到复杂：

### 2.1 增强型 LLM (Zero-shot / Few-shot)

最基础的模式。通过 Prompt Engineering 激发模型能力，结合 RAG（检索增强生成）引入外部知识。

- **场景**：简单问答、文档摘要。

### 2.2 提示链 (Prompt Chaining)

将一个复杂任务拆解为多个顺序执行的 LLM 调用。上一步的输出作为下一步的输入。

- **场景**：先生成大纲，再生成正文，最后润色。

### 2.3 路由 (Routing)

LLM 作为一个分类器，根据用户意图将请求分发给不同的下游处理模块（或不同的模型）。

- **场景**：客服系统（售后问题 -> 售后 Agent；售前咨询 -> 销售 Agent）。

### 2.4 并行化 (Parallelization)

同时运行多个 LLM 实例处理任务的不同部分，最后汇总结果。

- **Sectioning**：将长文档切片处理。
- **Voting**：让多个模型给出答案，通过投票选出最佳结果。

### 2.5 协调器-工作者 (Orchestrator-Workers)

一个中心化的“协调器”LLM 负责分解任务并分发给不同的“工作者”LLM，最后收集结果。

- **场景**：编写软件（协调器规划架构，工作者 A 写前端，工作者 B 写后端）。

---

## 3. MCP vs Agent：理解新协议

### 3.1 什么是 MCP (Model Context Protocol)？

MCP 是由 Anthropic 推出的开放标准，旨在解决 LLM 连接外部数据（本地文件、数据库、API）的标准化问题。它就像 AI 时代的 **USB 协议**。

### 3.2 核心对比

| 维度         | 传统 Agent 工具调用                     | MCP (Model Context Protocol)    |
| :----------- | :-------------------------------------- | :------------------------------ |
| **连接方式** | 针对每个工具单独编写适配代码 (Hardcode) | 标准化接口，一次开发，处处运行  |
| **扩展性**   | 低，每加一个工具都要改代码              | 高，只需安装对应的 MCP Server   |
| **维护成本** | 高，API 变动需同步修改 Agent            | 低，由 MCP Server 维护方更新    |
| **角色定位** | Agent 是工具的**使用者**和**集成者**    | MCP 是 Agent 的**通用外设接口** |

**结论**：MCP 不是 Agent 的替代品，而是 Agent 的**基础设施**。未来的 Agent 将通过 MCP 协议即插即用海量的外部工具。

---

## 4. 实战：构建“AI 研报助手”工作流

我们以构建一个**自动化行业研究报告生成器**为例，展示如何编排工作流。

### 4.1 需求分析

用户输入一个行业关键词（如“低空经济”），Agent 自动搜索最新资讯，阅读前 5 篇文章，生成一份 1000 字的行业分析报告。

### 4.2 架构设计 (基于 Dify / n8n)

1.  **Start 节点**：接收用户输入 `query`。
2.  **规划节点 (LLM)**：将 `query` 扩展为 3 个具体的搜索关键词（例如：“低空经济 市场规模”、“低空经济 政策 2025”、“低空经济 龙头企业”）。
3.  **执行节点 (Parallel)**：
    - **分支 A/B/C**：并行调用搜索工具 (Tavily/SerpApi)。
4.  **阅读节点 (Tool)**：调用网页抓取工具 (Jina/Crawl4AI) 获取搜索结果的全文内容。
5.  **思考节点 (LLM - Map)**：分别对每篇抓取的内容进行摘要，提取关键数据。
6.  **写作节点 (LLM - Reduce)**：汇总所有摘要，按照“市场概况-政策环境-竞争格局-未来趋势”的结构生成最终报告。
7.  **End 节点**：输出 Markdown 格式报告。

### 4.3 关键 Prompt 技巧

- **角色设定**：你是一名资深的行业分析师，擅长从碎片化信息中提炼洞见。
- **输出约束**：必须包含数据支撑，引用来源，保持客观中立。

---

## 5. 总结与展望

智能体工作流（Agentic Workflow）标志着 AI 应用从“对话框”走向“生产力后台”。

- **从 Chat 到 Work**：不再只是陪聊，而是通过工具和流程解决实际问题。
- **从 Blackbox 到 Whitebox**：通过工作流编排，让 AI 的决策过程可控、可调试、可复现。
- **未来趋势**：随着 MCP 等协议的普及，Agent 将像搭积木一样轻松连接万物，成为个人和企业的“数字员工”。
