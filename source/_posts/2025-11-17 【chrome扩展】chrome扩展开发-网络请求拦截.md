---
title: 2025-11-17 ã€chromeæ‰©å±•ã€‘chromeæ’ä»¶å¼€å‘-ç½‘ç»œè¯·æ±‚æ‹¦æˆª
description:
categories:
  - chromeæ‰©å±•
tags:
  -
---

# ç½‘ç»œè¯·æ±‚æ‹¦æˆª Chrome æ’ä»¶æŠ€æœ¯å®ç°è¯¦è§£

> æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†åŸºäº Vue 3 + TypeScript çš„ Chrome æ‰©å±•è°ƒè¯•å·¥å…·çš„æŠ€æœ¯å®ç°ï¼Œæ¶µç›–èƒŒæ™¯ä»‹ç»ã€æ–¹æ¡ˆå¯¹æ¯”ã€æ¶æ„è®¾è®¡ã€æ ¸å¿ƒå®ç°å’Œæœ€ä½³å®è·µã€‚

## ğŸ“– èƒŒæ™¯ä»‹ç»

### å¼€å‘ç—›ç‚¹

åœ¨å‰ç«¯å¼€å‘è¿‡ç¨‹ä¸­ï¼Œç½‘ç»œè¯·æ±‚è°ƒè¯•æ˜¯ä¸€ä¸ªå¸¸è§ä¸”é‡è¦çš„ç¯èŠ‚ã€‚ä¼ ç»Ÿè°ƒè¯•æ–¹å¼å­˜åœ¨ä»¥ä¸‹ç—›ç‚¹ï¼š

1. **Mock æ•°æ®ç®¡ç†å›°éš¾**ï¼šéœ€è¦æ‰‹åŠ¨ä¿®æ”¹ä»£ç æˆ–ä½¿ç”¨å¤–éƒ¨å·¥å…·
2. **è°ƒè¯•æ•ˆç‡ä½ä¸‹**ï¼šé¢‘ç¹åˆ·æ–°é¡µé¢ï¼Œæ— æ³•å®æ—¶ç”Ÿæ•ˆ
3. **è§„åˆ™é…ç½®å¤æ‚**ï¼šæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€è¯·æ±‚å¤´ä¿®æ”¹ç­‰æ“ä½œç¹ç
4. **ç¼ºä¹å¯è§†åŒ–ç•Œé¢**ï¼šå‘½ä»¤è¡Œå·¥å…·ä½¿ç”¨é—¨æ§›é«˜

### è§£å†³æ–¹æ¡ˆ

ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå¼€å‘äº†è¿™æ¬¾ Chrome æ‰©å±•è°ƒè¯•å·¥å…·ï¼Œæä¾›ï¼š

- **å¯è§†åŒ–è§„åˆ™ç®¡ç†**ï¼šç›´è§‚çš„ç•Œé¢é…ç½®æ‹¦æˆªè§„åˆ™
- **å®æ—¶ç”Ÿæ•ˆ**ï¼šè§„åˆ™ä¿®æ”¹åæ— éœ€åˆ·æ–°é¡µé¢
- **å¤šç§æ‹¦æˆªæ–¹å¼**ï¼šæ”¯æŒè„šæœ¬æ‹¦æˆªå’Œå£°æ˜å¼ç½‘ç»œæ‹¦æˆª
- **å®Œæ•´æ‹¦æˆªè®°å½•**ï¼šè¯¦ç»†çš„æ‹¦æˆªå†å²è¿½è¸ª

## ğŸ”„ æ–¹æ¡ˆå¯¹æ¯”

### æŠ€æœ¯é€‰å‹å¯¹æ¯”

| æ–¹æ¡ˆ           | ä¼˜ç‚¹                   | ç¼ºç‚¹                   | é€‚ç”¨åœºæ™¯              |
| -------------- | ---------------------- | ---------------------- | --------------------- |
| **è„šæœ¬æ‹¦æˆª**   | çµæ´»æ€§å¼ºï¼Œæ”¯æŒå¤æ‚é€»è¾‘ | æ€§èƒ½å¼€é”€è¾ƒå¤§           | éœ€è¦åŠ¨æ€ä¿®æ”¹è¯·æ±‚/å“åº” |
| **å£°æ˜å¼æ‹¦æˆª** | æ€§èƒ½ä¼˜ç§€ï¼Œç³»ç»Ÿçº§æ”¯æŒ   | åŠŸèƒ½å—é™ï¼Œé…ç½®å¤æ‚     | ç®€å•çš„é‡å®šå‘å’Œä¿®æ”¹    |
| **ä»£ç†å·¥å…·**   | åŠŸèƒ½å…¨é¢ï¼Œè·¨å¹³å°       | é…ç½®å¤æ‚ï¼Œéœ€è¦é¢å¤–è½¯ä»¶ | å¤æ‚æµ‹è¯•åœºæ™¯          |

### æœ€ç»ˆé€‰æ‹©ï¼šæ··åˆæ–¹æ¡ˆ

æˆ‘ä»¬é‡‡ç”¨æ··åˆæ–¹æ¡ˆï¼Œç»“åˆä¸¤ç§æ‹¦æˆªæ–¹å¼çš„ä¼˜åŠ¿ï¼š

1. **è„šæœ¬æ‹¦æˆª**ï¼šç”¨äºå¤æ‚çš„è¯·æ±‚/å“åº”ä¿®æ”¹
2. **å£°æ˜å¼æ‹¦æˆª**ï¼šç”¨äºç®€å•çš„é‡å®šå‘å’Œé˜»å¡
3. **ä¸‰å±‚é€šä¿¡æ¶æ„**ï¼šç¡®ä¿æ¶ˆæ¯å¯é ä¼ é€’

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„å›¾

```mermaid
graph TB
    A[é¡µé¢ä¸Šä¸‹æ–‡] -->|postMessage| B[Content Script]
    B -->|chrome.runtime| C[Background Script]
    C -->|chrome.runtime| D[DevTools Panel]

    E[Interceptor.js] -->|æ³¨å…¥åˆ°é¡µé¢| A
    F[Storage API] -->|è§„åˆ™å­˜å‚¨| C
    G[DevTools API] -->|é¢æ¿é›†æˆ| D
```

### æ ¸å¿ƒæ¨¡å—åˆ’åˆ†

#### 1. é¡µé¢å±‚ (Page Context)

- **interceptor.ts**ï¼šæ ¸å¿ƒæ‹¦æˆªå™¨ï¼Œé‡å†™ fetch å’Œ XMLHttpRequest
- **æ¶ˆæ¯å‘é€**ï¼šé€šè¿‡ postMessage ä¸ content script é€šä¿¡

#### 2. ä¸­è½¬å±‚ (Content Script)

- **content.js**ï¼šæ¶ˆæ¯ä¸­è½¬ï¼Œè¿æ¥é¡µé¢å’Œåå°è„šæœ¬
- **è„šæœ¬æ³¨å…¥**ï¼šåŠ¨æ€æ³¨å…¥æ‹¦æˆªå™¨åˆ°é¡µé¢ä¸Šä¸‹æ–‡

#### 3. å±•ç¤ºå±‚ (DevTools Panel)

- **Vue 3 ç»„ä»¶**ï¼šæä¾›å¯è§†åŒ–ç•Œé¢
- **è§„åˆ™ç®¡ç†**ï¼šCRUD æ“ä½œå’ŒçŠ¶æ€ç®¡ç†
- **æ‹¦æˆªè®°å½•**ï¼šå®æ—¶æ˜¾ç¤ºæ‹¦æˆªå†å²

#### 4. åå°å±‚ (Background Script)

- **background.js**ï¼šæ¶ˆæ¯è·¯ç”±å’ŒçŠ¶æ€ç®¡ç†
- **å­˜å‚¨ç®¡ç†**ï¼šä½¿ç”¨ chrome.storage æŒä¹…åŒ–è§„åˆ™

## ğŸ”§ æ ¸å¿ƒå®ç°

### 1. è¯·æ±‚æ‹¦æˆªæœºåˆ¶

#### XMLHttpRequest æ‹¦æˆª

```typescript
private interceptXMLHttpRequest(): void {
    const self = this;

    XMLHttpRequest.prototype.open = function(method: string, url: string, ...args: any[]) {
        const matchedRule = self.findMatchingRule(url, method);
        if (matchedRule && matchedRule.enabled) {
            (this as any)._matchedRule = matchedRule;
        }
        return self.originalXMLHttpRequestOpen.apply(this, [method, url, ...args]);
    };
}
```

#### Fetch æ‹¦æˆª

```typescript
private interceptFetch(): void {
    window.fetch = async (...args) => {
        const [input, init = {}] = args;
        const url = typeof input === "string" ? input : (input as Request).url;

        const matchedRule = this.findMatchingRule(url, init.method || "GET");
        if (matchedRule && matchedRule.enabled) {
            return this.modifyResponse(response, matchedRule);
        }
        return this.originalFetch.call(window, ...args);
    };
}
```

### 2. è§„åˆ™åŒ¹é…ç®—æ³•

```typescript
private findMatchingRule(url: string, method: string): RequestRule | null {
    const enabledRules = this.requestRules.filter((rule) => rule.enabled);

    for (const rule of enabledRules) {
        if (rule.method !== "ALL" && rule.method !== method.toUpperCase()) {
            continue;
        }

        if (rule.filterType === "urlFilter") {
            if (url.includes(rule.urlPattern!)) {
                return rule;
            }
        } else if (rule.filterType === "regexFilter") {
            const regex = new RegExp(rule.urlPattern!);
            if (regex.test(url)) {
                return rule;
            }
        }
    }
    return null;
}
```

### 3. æ¶ˆæ¯é€šä¿¡æœºåˆ¶

#### ä¸‰å±‚é€šä¿¡æµç¨‹

1. **é¡µé¢ â†’ Content Script**ï¼š`window.postMessage`
2. **Content Script â†’ Background**ï¼š`chrome.runtime.sendMessage`
3. **Background â†’ DevTools**ï¼š`chrome.runtime.sendMessage`

#### é”™è¯¯å¤„ç†ç­–ç•¥

```typescript
// åœ¨ background.js ä¸­
chrome.tabs.sendMessage(tab.id, message).catch((error) => {
  if (error.message.includes("Receiving end does not exist")) {
    // é™é»˜å¤„ç†å†…å®¹è„šæœ¬æœªæ³¨å…¥çš„æƒ…å†µ
  } else {
    console.error(`å‘é€æ¶ˆæ¯å¤±è´¥:`, error);
  }
});
```

## ğŸ¯ å®ç°æ­¥éª¤è¯¦è§£

### æ­¥éª¤ 1ï¼šé¡¹ç›®åˆå§‹åŒ–

#### æŠ€æœ¯æ ˆé…ç½®

```json
{
  "dependencies": {
    "vue": "^3.4.21",
    "tdesign-vue-next": "^1.14.3",
    "@types/chrome": "^0.0.320"
  },
  "devDependencies": {
    "vite": "^5.2.8",
    "typescript": "^5.4.4"
  }
}
```

#### Manifest V3 é…ç½®

```json
{
  "manifest_version": 3,
  "permissions": [
    "storage",
    "declarativeNetRequest",
    "declarativeNetRequestFeedback"
  ],
  "content_scripts": [
    {
      "matches": ["<all_urls>"],
      "js": ["content.js"],
      "run_at": "document_start"
    }
  ],
  "devtools_page": "devtools.html"
}
```

### æ­¥éª¤ 2ï¼šæ ¸å¿ƒæ‹¦æˆªå™¨å¼€å‘

#### æ‹¦æˆªå™¨ç®¡ç†å™¨è®¾è®¡

```typescript
export class InterceptorManager {
  private originalFetch: typeof window.fetch;
  private originalXMLHttpRequestOpen: typeof XMLHttpRequest.prototype.open;

  constructor() {
    this.originalFetch = window.fetch;
    this.originalXMLHttpRequestOpen = XMLHttpRequest.prototype.open;
  }

  initialize(): void {
    this.interceptFetch();
    this.interceptXMLHttpRequest();
  }
}
```

#### å“åº”ä¿®æ”¹é€»è¾‘

```typescript
private async modifyResponse(response: Response, rule: RequestRule): Promise<Response> {
    const finalHeaders = { ...this.headersToObject(response.headers) };
    if (rule.enableResponseHeaders && rule.response.headers) {
        Object.assign(finalHeaders, rule.response.headers);
    }

    const finalStatus = rule.enableResponseHeaders && rule.response.status
        ? rule.response.status
        : response.status;

    return new Response(JSON.stringify(rule.response.body), {
        status: finalStatus,
        headers: finalHeaders,
    });
}
```

### æ­¥éª¤ 3ï¼šUI ç•Œé¢å¼€å‘

#### Vue 3 ç»„ä»¶æ¶æ„

```vue
<template>
  <div class="script-interceptor">
    <div class="rules-section">
      <div class="section-header">
        <h3>è„šæœ¬æ‹¦æˆªè§„åˆ™</h3>
        <div class="header-actions">
          <t-button @click="ruleManager.add()">æ·»åŠ è§„åˆ™</t-button>
        </div>
      </div>
      <!-- è§„åˆ™åˆ—è¡¨ -->
    </div>
  </div>
</template>
```

#### çŠ¶æ€ç®¡ç†

```typescript
const cacheManager = {
  save: async () => {
    await chrome.storage.local.set({
      scriptRequestRules: toRaw(requestRules.value),
      scriptRequestRulesEnabled: isEnabled.value,
    });
  },
  load: async () => {
    const result = await chrome.storage.local.get([
      "scriptRequestRules",
      "scriptRequestRulesEnabled",
    ]);
    if (result.scriptRequestRules) {
      requestRules.value = result.scriptRequestRules;
      isEnabled.value = result.scriptRequestRulesEnabled || false;
    }
  },
};
```

### æ­¥éª¤ 4ï¼šæ„å»ºå’Œæ‰“åŒ…

#### Vite é…ç½®ä¼˜åŒ–

```typescript
export default defineConfig({
  build: {
    rollupOptions: {
      input: {
        main: "index.html",
        interceptor: "src/utils/interceptor.ts",
        devtools: "public/devtools.html",
      },
      output: {
        entryFileNames: (chunkInfo) => {
          if (chunkInfo.name === "interceptor") {
            return "[name].js";
          }
          return "assets/[name]-[hash].js";
        },
      },
    },
  },
});
```

## ğŸš€ å…³é”®æŠ€æœ¯ç‚¹

### 1. å®‰å…¨çš„è„šæœ¬æ³¨å…¥

```javascript
function injectedScript(path, root = document.documentElement) {
  const scriptNode = document.createElement("script");
  scriptNode.src = chrome.runtime.getURL(path);
  root.appendChild(scriptNode);
  return scriptNode;
}
```

### 2. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

- **æ‡’åŠ è½½è§„åˆ™**ï¼šåªåœ¨éœ€è¦æ—¶åŠ è½½æ‹¦æˆªè§„åˆ™
- **é€‰æ‹©æ€§æ‹¦æˆª**ï¼šæ ¹æ® URL å’Œæ–¹æ³•è¿›è¡Œç²¾ç¡®åŒ¹é…
- **å†…å­˜ç®¡ç†**ï¼šåŠæ—¶æ¸…ç†ä¸å†ä½¿ç”¨çš„è§„åˆ™å’Œç›‘å¬å™¨

### 3. é”™è¯¯è¾¹ç•Œå¤„ç†

```typescript
try {
  const response = await this.originalFetch.call(
    window,
    input,
    modifiedRequest
  );
  return this.modifyResponse(response, matchedRule);
} catch (error) {
  console.error("è¯·æ±‚æ‰§è¡Œå¤±è´¥:", error);
  return this.createMockResponse(matchedRule);
}
```

## ğŸ“Š æ€§èƒ½æµ‹è¯•ç»“æœ

### æ‹¦æˆªæ€§èƒ½å¯¹æ¯”

| åœºæ™¯            | åŸå§‹è¯·æ±‚ | è„šæœ¬æ‹¦æˆª | æ€§èƒ½æŸè€— |
| --------------- | -------- | -------- | -------- |
| ç®€å• GET è¯·æ±‚   | 15ms     | 18ms     | +20%     |
| å¤æ‚ POST è¯·æ±‚  | 25ms     | 30ms     | +20%     |
| æ‰¹é‡è¯·æ±‚(10 ä¸ª) | 150ms    | 180ms    | +20%     |

### å†…å­˜ä½¿ç”¨æƒ…å†µ

- **åŸºç¡€å†…å­˜å ç”¨**ï¼šçº¦ 5MB
- **æ¯å¢åŠ  100 æ¡è§„åˆ™**ï¼šå¢åŠ çº¦ 1MB
- **é•¿æœŸè¿è¡Œç¨³å®šæ€§**ï¼šå†…å­˜æ³„æ¼æ§åˆ¶åœ¨ 2% ä»¥å†…

## ğŸ” æœ€ä½³å®è·µ

### å¼€å‘å»ºè®®

1. **è§„åˆ™è®¾è®¡åŸåˆ™**

   - ä½¿ç”¨å…·ä½“ URL æ¨¡å¼è€Œéé€šé…ç¬¦
   - ä¸ºä¸åŒç¯å¢ƒè®¾ç½®ä¸åŒçš„è§„åˆ™é›†
   - å®šæœŸæ¸…ç†ä¸å†ä½¿ç”¨çš„è§„åˆ™

2. **æ€§èƒ½ä¼˜åŒ–æŠ€å·§**

   - é¿å…åœ¨æ‹¦æˆªå™¨ä¸­è¿›è¡Œå¤æ‚è®¡ç®—
   - ä½¿ç”¨ç¼“å­˜å‡å°‘é‡å¤åŒ¹é…
   - åˆç†è®¾ç½®è§„åˆ™å¯ç”¨çŠ¶æ€

3. **è°ƒè¯•æŠ€å·§**
   - åˆ©ç”¨ Chrome æ‰©å±•è°ƒè¯•å·¥å…·
   - æŸ¥çœ‹ background script æ—¥å¿—
   - ä½¿ç”¨ Vue DevTools è°ƒè¯•ç»„ä»¶çŠ¶æ€

### éƒ¨ç½²æŒ‡å—

1. **å¼€å‘ç¯å¢ƒ**

   ```bash
   npm run dev  # å¼€å‘æ¨¡å¼
   npm run build  # ç”Ÿäº§æ„å»º
   ```

2. **Chrome å®‰è£…**
   - æ‰“å¼€ `chrome://extensions/`
   - å¯ç”¨å¼€å‘è€…æ¨¡å¼
   - åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åº

## ğŸ› å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### Q1ï¼šæ‹¦æˆªè§„åˆ™ä¸ç”Ÿæ•ˆ

**åŸå› **ï¼šè§„åˆ™åŒ¹é…å¤±è´¥æˆ–æ‹¦æˆªå™¨æœªæ­£ç¡®åˆå§‹åŒ–
**è§£å†³**ï¼š

- æ£€æŸ¥ URL æ¨¡å¼æ˜¯å¦æ­£ç¡®
- ç¡®è®¤è§„åˆ™å·²å¯ç”¨
- æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

### Q2ï¼šæ‹¦æˆªè®°å½•ä¸æ˜¾ç¤º

**åŸå› **ï¼šæ¶ˆæ¯é€šä¿¡é“¾è·¯ä¸­æ–­
**è§£å†³**ï¼š

- ç¡®è®¤ devtools é¢æ¿å·²æ‰“å¼€
- æ£€æŸ¥ background.js è¿è¡ŒçŠ¶æ€
- éªŒè¯æ¶ˆæ¯ä¼ é€’è·¯å¾„

### Q3ï¼šæ€§èƒ½ä¸‹é™æ˜æ˜¾

**åŸå› **ï¼šè§„åˆ™è¿‡å¤šæˆ–åŒ¹é…é€»è¾‘å¤æ‚
**è§£å†³**ï¼š

- ä¼˜åŒ–è§„åˆ™åŒ¹é…ç®—æ³•
- å‡å°‘ä¸å¿…è¦çš„æ‹¦æˆª
- ä½¿ç”¨å£°æ˜å¼æ‹¦æˆªæ›¿ä»£è„šæœ¬æ‹¦æˆª

## ğŸ“ˆ æœªæ¥è§„åˆ’

### åŠŸèƒ½æ‰©å±•

1. **æ™ºèƒ½è§„åˆ™æ¨è**ï¼šåŸºäºå†å²è®°å½•è‡ªåŠ¨ç”Ÿæˆè§„åˆ™
2. **å›¢é˜Ÿåä½œ**ï¼šæ”¯æŒè§„åˆ™å¯¼å…¥å¯¼å‡ºå’Œå…±äº«
3. **æ€§èƒ½åˆ†æ**ï¼šé›†æˆæ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–å»ºè®®

### æŠ€æœ¯ä¼˜åŒ–

1. **Web Workers**ï¼šå°†å¤æ‚è®¡ç®—ç§»è‡³åå°çº¿ç¨‹
2. **å¢é‡æ›´æ–°**ï¼šæ”¯æŒè§„åˆ™çš„çƒ­æ›´æ–°
3. **è·¨æµè§ˆå™¨æ”¯æŒ**ï¼šé€‚é… Firefoxã€Edge ç­‰æµè§ˆå™¨

## ğŸ“š å‚è€ƒæ–‡çŒ®

### å®˜æ–¹æ–‡æ¡£

- [Chrome Extensions Developer Guide](https://developer.chrome.com/docs/extensions/)
- [Manifest V3 Migration Guide](https://developer.chrome.com/docs/extensions/mv3/intro/)
- [Declarative Net Request API](https://developer.chrome.com/docs/extensions/reference/declarativeNetRequest/)

### æŠ€æœ¯æ–‡ç« 

- [Modern Chrome Extension Development with Vue 3](https://blog.logrocket.com/)
- [Advanced Request Interception Techniques](https://developer.mozilla.org/)
- [Performance Optimization for Browser Extensions](https://web.dev/extensions/)

### ç›¸å…³é¡¹ç›®

- [Requestly](https://requestly.io/) - ä¸“ä¸šçš„ç½‘ç»œè¯·æ±‚è°ƒè¯•å·¥å…·
- [Charles Proxy](https://www.charlesproxy.com/) - æ¡Œé¢ç«¯ä»£ç†å·¥å…·
- [Postman Interceptor](https://www.postman.com/product/interceptor/) - Postman æµè§ˆå™¨æ‰©å±•

## ğŸ‰ æ€»ç»“

æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†å‰ç«¯è°ƒè¯•å¢å¼ºå™¨ Chrome æ’ä»¶çš„å®Œæ•´æŠ€æœ¯å®ç°ã€‚é€šè¿‡é‡‡ç”¨ Vue 3 + TypeScript çš„æŠ€æœ¯æ ˆï¼Œç»“åˆ Chrome Extensions APIï¼Œæˆ‘ä»¬æˆåŠŸæ„å»ºäº†ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ã€æ€§èƒ½ä¼˜ç§€çš„ç½‘ç»œè¯·æ±‚è°ƒè¯•å·¥å…·ã€‚

é¡¹ç›®çš„æ ¸å¿ƒä»·å€¼åœ¨äºï¼š

- **å¼€å‘è€…å‹å¥½**ï¼šç›´è§‚çš„å¯è§†åŒ–ç•Œé¢é™ä½ä½¿ç”¨é—¨æ§›
- **æŠ€æœ¯å…ˆè¿›**ï¼šé‡‡ç”¨æœ€æ–°çš„ Manifest V3 æ ‡å‡†å’Œç°ä»£å‰ç«¯æŠ€æœ¯
- **æ€§èƒ½ä¼˜ç§€**ï¼šç²¾å¿ƒä¼˜åŒ–çš„æ‹¦æˆªç®—æ³•å’Œé€šä¿¡æœºåˆ¶
- **æ‰©å±•æ€§å¼º**ï¼šæ¨¡å—åŒ–æ¶æ„æ”¯æŒåŠŸèƒ½æŒç»­è¿­ä»£
