---
title: 2024-09-18-ã€æ¶æ„ã€‘Vue3ç»„ä»¶åº“è®¾è®¡å¼€å‘
description:
categories:
  - æ¶æ„è®¾è®¡
tags:
  - vue3
---

## ä¸€ã€UI ç»„ä»¶åº“è®¾è®¡

åœ¨ Vue ç”Ÿæ€ä¸­å®ç° UI ç»„ä»¶åº“æ¶æ„è®¾è®¡ï¼Œæœ¬è´¨ä¸Šæ˜¯æ„å»ºä¸€å¥—**å¯ç»´æŠ¤ã€å¯æ‰©å±•ä¸”é«˜æ€§èƒ½çš„èµ„äº§ç”Ÿäº§çº¿**ã€‚

ä¸€ä¸ªæˆç†Ÿçš„ UI æ¡†æ¶æ¶æ„é€šå¸¸åˆ†ä¸ºï¼š**æ ¸å¿ƒé©±åŠ¨å±‚ï¼ˆCoreï¼‰ã€ç»„ä»¶å®ç°å±‚ï¼ˆComponentsï¼‰ã€æ„å»ºå·¥å…·é“¾ï¼ˆToolingï¼‰å’Œæ–‡æ¡£/ç¤ºä¾‹å±‚ï¼ˆDocsï¼‰**ã€‚

---

### 1. æ•´ä½“æ¶æ„è®¾è®¡å›¾

```mermaid
graph TB

    subgraph A [æ ¸å¿ƒé©±åŠ¨å±‚ Core]
        A1[è®¾è®¡ä»¤ç‰Œ Design Tokens]
        A2[ä¸»é¢˜ç³»ç»Ÿ Theme System]
        A3[å·¥å…·å‡½æ•° Utilities]
        A4[ç±»å‹å®šä¹‰ Type Definitions]
    end

    subgraph B [ç»„ä»¶å®ç°å±‚ Components]
        B1[åŸå­ç»„ä»¶ Atoms]
        B2[åˆ†å­ç»„ä»¶ Molecules]
        B3[æœ‰æœºä½“ Organisms]
        B4[ä¸šåŠ¡ç»„ä»¶ Business]
    end

    subgraph C [æ„å»ºå·¥å…·é“¾ Tooling]
        C1[Vite + Rollup]
        C2[Tree-shaking]
        C3[TypeScriptç¼–è¯‘]
        C4[æ ·å¼é¢„å¤„ç†]
    end

    subgraph D [æ–‡æ¡£/ç¤ºä¾‹å±‚ Docs]
        D1[VitePressæ–‡æ¡£]
        D2[Storybookç¤ºä¾‹]
        D3[Playgroundæ¼”ç¤º]
        D4[è‡ªåŠ¨åŒ–æµ‹è¯•]
    end

    A --> B
    A --> C
    A --> D
    B --> D2
    C --> D1
    C --> D3
```

---

### 2. æ ¸å¿ƒæ¶æ„åˆ†å±‚

```mermaid
graph TD
    A[åŸºç¡€é…ç½®å±‚ Core/Tokens] --> B[ç»„ä»¶å®ç°å±‚ Components]
    B --> C[é€»è¾‘æŠ½ç¦»å±‚ Headless & Composables]

    subgraph A [åŸºç¡€é…ç½®å±‚]
        A1[CSSå˜é‡ç³»ç»Ÿ]
        A2[è®¾è®¡ä»¤ç‰Œ Design Tokens]
        A3[ä¸»é¢˜é…ç½® Theme Config]
        A4[é—´è·/é¢œè‰²è§„èŒƒ]
    end

    subgraph B [ç»„ä»¶å®ç°å±‚]
        B1[åŸå­ç»„ä»¶ Atoms<br/>Button, Input, Icon]
        B2[åˆ†å­ç»„ä»¶ Molecules<br/>SearchBox, Select]
        B3[æœ‰æœºä½“ Organisms<br/>Table, DatePicker]
    end

    subgraph C [é€»è¾‘æŠ½ç¦»å±‚]
        C1[useSelect Hook]
        C2[usePagination Hook]
        C3[useTable Hook]
        C4[ä¸šåŠ¡é€»è¾‘ Composables]
    end

    A1 --> B1
    A2 --> B2
    A3 --> B3
    C1 --> B2
    C2 --> B3
    C3 --> B3
```

#### A. åŸºç¡€é…ç½®å±‚ (Core / Tokens)

ä¸è¦åœ¨ç»„ä»¶é‡Œå†™æ­»é¢œè‰²æˆ–é—´è·ã€‚ä½¿ç”¨ **Design Tokens**ï¼ˆè®¾è®¡ä»¤ç‰Œï¼‰æ¥ç®¡ç†è§†è§‰è§„èŒƒã€‚

- **å®ç°æ–¹å¼**ï¼šå®šä¹‰ä¸€å¥—å…¨å±€ CSS å˜é‡æˆ– SCSS/Less å˜é‡ã€‚
- **åŠŸèƒ½**ï¼šæ”¯æŒ**ä¸»é¢˜åˆ‡æ¢**ï¼ˆæ·±è‰²æ¨¡å¼ï¼‰ã€ç»Ÿä¸€çš„åœ†è§’ã€é˜´å½±å’Œé—´è·æ ‡å‡†ã€‚

#### B. ç»„ä»¶å®ç°å±‚ (Components)

é‡‡ç”¨"åŸå­åŒ–"è®¾è®¡æ€è·¯ï¼š

- **åŸå­ç»„ä»¶ (Atoms)**ï¼šButton, Input, Icon, Tagã€‚
- **åˆ†å­ç»„ä»¶ (Molecules)**ï¼šSearchBoxï¼ˆInput + Buttonï¼‰, Selectã€‚
- **æœ‰æœºä½“ (Organisms)**ï¼šTableï¼ˆåŒ…å« Checkbox, Pagination, Loadingï¼‰, DatePickerã€‚

#### C. é€»è¾‘æŠ½ç¦» (Headless & Composables)

åˆ©ç”¨ Vue 3 çš„ **Composition API** å®ç°"æ— å¤´ï¼ˆHeadlessï¼‰"é€»è¾‘ã€‚

- **æ€è·¯**ï¼šå°†å¤æ‚çš„é€»è¾‘ï¼ˆå¦‚ Select çš„é€‰ä¸­ã€é”®ç›˜å¯¼èˆªã€åˆ†é¡µç®—æ³•ï¼‰æŠ½ç¦»æˆç‹¬ç«‹çš„ `useSelect` æˆ– `usePagination`ã€‚
- **ä¼˜ç‚¹**ï¼šå¦‚æœæœªæ¥è¦æ”¹ UI æ ·å¼ï¼Œé€»è¾‘é€»è¾‘å±‚å¯ä»¥ 100% å¤ç”¨ã€‚

---

### 3. ç»„ä»¶åº“çš„ç›®å½•ç»“æ„ (Monorepo)

```mermaid
graph TD
    Root[é¡¹ç›®æ ¹ç›®å½•] --> Packages[packages/]
    Root --> Docs[docs/]
    Root --> Playground[playground/]

    Packages --> Components[components/]
    Packages --> Theme[theme-chalk/]
    Packages --> Utils[utils/]
    Packages --> Constants[constants/]

    Components --> Button[button/]
    Components --> Input[input/]
    Components --> Table[table/]
    Components --> ...[...]

    Button --> Src[src/]
    Button --> Index[index.ts]

    Src --> VueFile[Button.vue]
    Src --> Test[Button.test.ts]
    Src --> Style[Button.scss]

    Docs --> Config[é…ç½®æ–‡æ¡£]
    Docs --> Examples[ä½¿ç”¨ç¤ºä¾‹]
    Docs --> API[APIæ–‡æ¡£]

    Playground --> Demo[æ¼”ç¤ºé¡µé¢]
    Playground --> Dev[å¼€å‘ç¯å¢ƒ]
    Playground --> TestEnv[æµ‹è¯•ç¯å¢ƒ]
```

æ¨èä½¿ç”¨ **pnpm + Monorepo** æ¶æ„ï¼Œè¿™æ ·å¯ä»¥å°†æ ·å¼ã€å·¥å…·ç±»ã€ç»„ä»¶ã€æ–‡æ¡£æ‹†åˆ†ä¸ºç‹¬ç«‹çš„åŒ…ã€‚

```text
â”œâ”€â”€ packages
â”‚   â”œâ”€â”€ components      # æ‰€æœ‰ UI ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ button
â”‚   â”‚   â”‚   â”œâ”€â”€ src     # æºç  (.vue)
â”‚   â”‚   â”‚   â””â”€â”€ index.ts # å¯¼å‡º
â”‚   â”œâ”€â”€ theme-chalk     # ç‹¬ç«‹çš„æ ·å¼åŒ…ï¼ˆCSS/SCSSï¼‰
â”‚   â”œâ”€â”€ utils           # å…±äº«çš„é€»è¾‘å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ constants       # å…±äº«çš„å¸¸é‡ã€æšä¸¾
â”œâ”€â”€ docs                # åŸºäº VitePress çš„æ–‡æ¡£ç³»ç»Ÿ
â””â”€â”€ playground          # æœ¬åœ°æµ‹è¯•ç”¨çš„æ¼”ç¤ºé¡µ

```

---

### 4. å…³é”®æŠ€æœ¯é€‰å‹

| ç»´åº¦             | æ¨èæ–¹æ¡ˆ                       | ç†ç”±                                                                         |
| ---------------- | ------------------------------ | ---------------------------------------------------------------------------- |
| **æ„å»ºå·¥å…·**     | **Vite + Rollup**              | Vite å¼€å‘å¿«ï¼ŒRollup æ‰“åŒ…ä½“ç§¯å°ä¸” Tree-shaking å¼ºã€‚                           |
| **æ ·å¼ç®¡ç†**     | **SCSS / Tailwind**            | SCSS é€‚åˆç¼–å†™ç»“æ„åŒ–å˜é‡ï¼›Tailwind é€‚åˆå¿«é€ŸåŸå‹ã€‚                             |
| **æ–‡æ¡£å·¥å…·**     | **VitePress**                  | Vue å®˜æ–¹æ”¯æŒï¼Œæ¸²æŸ“é€Ÿåº¦å¿«ï¼Œç›´æ¥åœ¨ Markdown é‡Œå†™ Vueã€‚                         |
| **ç»„ä»¶å¼€å‘æ²™ç›’** | **Storybook**                  | ç»„ä»¶å­¤ç«‹å¼€å‘ã€è§†è§‰æµ‹è¯•ã€çŠ¶æ€æšä¸¾ï¼›æ¡†æ¶æ— å…³ (React/Vue/Angular/WebComponents) |
| **åœ¨çº¿è¿è¡Œç¯å¢ƒ** | **Playground (å¦‚ StackBlitz)** | Bug é‡ç°ã€ç¤ºä¾‹æ¼”ç¤ºã€é›¶ç¯å¢ƒä¸Šæ‰‹ï¼Œæµè§ˆå™¨ç«¯ WASM / è¿œç¨‹ Container               |
| **ç±»å‹æ£€æŸ¥**     | **TypeScript**                 | æä¾›å®Œæ•´çš„ IDE è‡ªåŠ¨è¡¥å…¨ï¼Œé™ä½åº“ä½¿ç”¨è€…çš„å‡ºé”™ç‡ã€‚                              |
| **æŒ‰éœ€å¼•å…¥**     | **unplugin-vue-components**    | ç”¨æˆ·æ— éœ€æ‰‹åŠ¨ importï¼Œæ’ä»¶è‡ªåŠ¨æ‰«æå¹¶å¼•å…¥å¯¹åº”ç»„ä»¶ã€‚                            |

---

### 5. æ¶æ„è®¾è®¡çš„"é¿å‘"å‡†åˆ™

1. **æ’æ§½ï¼ˆSlotsï¼‰å¤§äº å±æ€§ï¼ˆPropsï¼‰**ï¼š

- ä¸è¦é€šè¿‡ Props ä¼ å¤ªå¤šçš„é…ç½®ï¼Œå°½å¯èƒ½é€šè¿‡ `slot` ç»™ç”¨æˆ·æ‰©å±•ç©ºé—´ã€‚

2. **æ ·å¼éš”ç¦»**ï¼š

- ä½¿ç”¨ BEM å‘½åè§„èŒƒï¼ˆå¦‚ `.s-button--primary`ï¼‰æˆ– CSS Modulesï¼Œé˜²æ­¢ç»„ä»¶æ ·å¼æ±¡æŸ“ç”¨æˆ·å…¨å±€ç¯å¢ƒã€‚

3. **å•å‘æ•°æ®æµä¸ `v-model**`ï¼š

- ç¡®ä¿æ‰€æœ‰ç»„ä»¶æ”¯æŒ Vue 3 æ ‡å‡†çš„ `v-model`ï¼Œå¹¶åœ¨å†…éƒ¨ä¸¥æ ¼éµå¾ª"Props Down, Events Up"ã€‚

4. **Tree-shaking å‹å¥½**ï¼š

- å¯¼å‡ºæ ¼å¼åº”åŒ…å« **ESM**ï¼Œå¹¶ç¡®ä¿æ¯ä¸ªç»„ä»¶å¯ä»¥ç‹¬ç«‹æ‰“åŒ…ï¼Œé…åˆ `sideEffects: false` é…ç½®ã€‚

---

### 6. ç»„ä»¶è‡ªåŠ¨åŒ–äº§çº¿ (The Workflow)

ä¸€ä¸ªæ ‡å‡†çš„å¼€å‘æµåº”è¯¥æ˜¯ï¼š

1. **å‘½ä»¤åˆ›å»º**ï¼š`pnpm gen:component <name>` è‡ªåŠ¨ç”Ÿæˆç»„ä»¶æ¨¡æ¿ä»£ç ã€‚
2. **ç»„ä»¶æµ‹è¯•**ï¼šä½¿ç”¨ **Vitest** æˆ– **Cypress** è¿›è¡Œå•å…ƒæµ‹è¯•å’Œäº¤äº’æµ‹è¯•ã€‚
3. **è§†è§‰å·¡æ£€**ï¼šé›†æˆ **Storybook**ï¼Œåœ¨ä¸åŒå±å¹•å°ºå¯¸å’Œä¸»é¢˜ä¸‹æŸ¥çœ‹ç»„ä»¶è¡¨ç°ã€‚
4. **å‘å¸ƒæµç¨‹**ï¼šè‡ªåŠ¨ç”Ÿæˆ Changelogï¼Œå¹¶åŒæ­¥æ¨é€åˆ° npm å’Œæ–‡æ¡£ç«™ç‚¹ã€‚

## äºŒã€ä¸šåŠ¡ç»„ä»¶åº“å»ºè®¾

åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼ŒåŸºäºåŸºç¡€ UI åº“ï¼ˆå¦‚ Element Plus, TDesign-vue-nextã€Ant Design Vueï¼‰å°è£…**ä¸šåŠ¡ç»„ä»¶åº“**ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯**ä¸šåŠ¡è§£è€¦ã€é€»è¾‘æ²‰æ·€ã€è§†è§‰é«˜åº¦ç»Ÿä¸€**ã€‚

è¿™ç§æ¶æ„è®¾è®¡é€šå¸¸è¢«ç§°ä¸º **"Second-layer Component Library"ï¼ˆäºŒæ¬¡å°è£…ç»„ä»¶åº“ï¼‰**ã€‚ä»¥ä¸‹æ˜¯æ·±åº¦è½åœ°çš„æ¶æ„è®¾è®¡æ–¹æ¡ˆï¼š

---

### 1. æ ¸å¿ƒåˆ†å±‚æ¶æ„è®¾è®¡

```mermaid
graph TB
    A --> B
    B --> C
    C --> D

    subgraph A [åŸºç¡€ UI å±‚ Base UI]
        A1[Element Plus]
        A2[Ant Design Vue]
        A3[å…¶ä»–ç¬¬ä¸‰æ–¹åº“]
    end

    subgraph B [ä¸šåŠ¡æŠ½è±¡å±‚ Service Abstract]
        B1[æƒé™æ§åˆ¶é€»è¾‘]
        B2[æ•°æ®æ ¼å¼åŒ–]
        B3[é”™è¯¯å¤„ç†æœºåˆ¶]
        B4[ç»Ÿä¸€åŸ‹ç‚¹]
    end

    subgraph C [ä¸šåŠ¡ç»„ä»¶å±‚Business Components]
        C1[UserSelect ç”¨æˆ·é€‰æ‹©å™¨]
        C2[OrderTable è®¢å•è¡¨æ ¼]
        C3[SearchForm æœç´¢è¡¨å•]
        C4[å…¶ä»–ä¸šåŠ¡ç»„ä»¶]
    end

    subgraph D [åº”ç”¨å±‚ Application]
        D1[ä¸šåŠ¡é¡µé¢]
        D2[ç®¡ç†åå°]
        D3[ç§»åŠ¨ç«¯åº”ç”¨]
    end

    A1 --> C1
    A2 --> C2
    B1 --> C1
    B2 --> C2
    B3 --> C3
    B4 --> C3

    style A fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    style B fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    style C fill:#fff3e0,stroke:#e65100,stroke-width:2px
    style D fill:#e3f2fd,stroke:#0d47a1,stroke-width:2px
```

ä¸šåŠ¡ç»„ä»¶åº“ä¸åº”åªæ˜¯ç®€å•çš„æ ·å¼ä¿®é¥°ï¼Œè€Œåº”æ˜¯å…·æœ‰"ä¸šåŠ¡çµé­‚"çš„ç»„åˆã€‚

- **åŸºç¡€ UI å±‚ (Base UI)**ï¼šå¤–éƒ¨ä¾èµ–ï¼ˆå¦‚ Element Plusï¼‰ï¼Œæä¾›åŸå­èƒ½åŠ›ã€‚
- **ä¸šåŠ¡æŠ½è±¡å±‚ (Service Abstract)**ï¼šå°è£…é€šç”¨çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¦‚æƒé™æ§åˆ¶ã€æ•°æ®æ ¼å¼åŒ–ã€ç»Ÿä¸€çš„é”™è¯¯å¤„ç†ã€‚
- **ä¸šåŠ¡ç»„ä»¶å±‚ (Business Components)**ï¼šåŸºäº Base UI å’Œä¸šåŠ¡é€»è¾‘ç»„åˆè€Œæˆçš„å¤åˆç»„ä»¶ã€‚

---

### 2. å…³é”®è®¾è®¡æ¨¡å¼

#### A. å±æ€§é€ä¼ ä¸æ’æ§½è½¬å‘ (Attribute & Slot Forwarding)

è¿™æ˜¯å°è£…æœ€æ ¸å¿ƒçš„åŸåˆ™ï¼š**ä¸è¦ç ´ååŸºç¡€ç»„ä»¶çš„åŸæœ‰èƒ½åŠ›**ã€‚

- **$attrs**ï¼šä½¿ç”¨ `v-bind="$attrs"\` å°†ç”¨æˆ·ä¼ ç»™ä¸šåŠ¡ç»„ä»¶çš„æ‰€æœ‰å±æ€§ç›´æ¥é€ä¼ ç»™å†…éƒ¨çš„ Base UI ç»„ä»¶ã€‚
- **Slots**ï¼šåŠ¨æ€è½¬å‘æ‰€æœ‰æ’æ§½ï¼Œç¡®ä¿ç”¨æˆ·ä¾ç„¶å¯ä»¥ä½¿ç”¨åŸºç¡€ç»„ä»¶æä¾›çš„è‡ªå®šä¹‰èƒ½åŠ›ã€‚

#### B. é…ç½®åŒ–é©±åŠ¨ (Schema Driven)

å¯¹äºå¤æ‚çš„ä¸šåŠ¡ç»„ä»¶ï¼ˆå¦‚æŸ¥è¯¢è¡¨æ ¼ã€åŠ¨æ€è¡¨å•ï¼‰ï¼Œé‡‡ç”¨é…ç½®åŒ–è€Œéå£°æ˜å¼ã€‚

- **å®ç°**ï¼šå®šä¹‰ä¸€ä¸ª `columns` æˆ– `schemas` æ•°ç»„ï¼Œå†…éƒ¨é€šè¿‡ `v-for` é…åˆæ¸²æŸ“å‡½æ•°ï¼ˆh å‡½æ•°ï¼‰æˆ– `resolveComponent` åŠ¨æ€æ¸²æŸ“åŸºç¡€ç»„ä»¶ã€‚
- **ä¼˜ç‚¹**ï¼šæ˜¾è‘—å‡å°‘ä¸šåŠ¡é¡µé¢çš„æ¨¡æ¿ä»£ç é‡ï¼Œæ–¹ä¾¿ç»Ÿä¸€åŸ‹ç‚¹å’Œæƒé™è¿‡æ»¤ã€‚

#### C. Headless Logic (é€»è¾‘æŠ½ç¦»)

å°†ä¸šåŠ¡é€»è¾‘å†™æˆ **Composables (Hook)**ã€‚

- ä¾‹å¦‚ï¼šå°è£…ä¸€ä¸ª `useTableSearch`ï¼Œå¤„ç†åˆ†é¡µã€æŸ¥è¯¢ã€é‡ç½®é€»è¾‘ã€‚
- ä¸šåŠ¡ç»„ä»¶åº“åªè´Ÿè´£å°†è¿™äº› Hook ä¸ Base UI çš„ UI ç»“åˆã€‚

---

### 3. å·¥ç¨‹åŒ–æ¶æ„ (Monorepo)

æ¨èä½¿ç”¨ **pnpm + Turborepo/Lerna** çš„ Monorepo æ¨¡å¼ï¼Œå°†ä»“åº“æ‹†åˆ†ä¸ºå¤šä¸ªå­åŒ…ï¼š

```text
â”œâ”€â”€ packages
â”‚   â”œâ”€â”€ ui-base        # åŸºç¡€ UI åº“çš„äºŒæ¬¡å°è£…ï¼ˆå…¨å±€æ ·å¼ã€é»˜è®¤é…ç½®ï¼‰
â”‚   â”œâ”€â”€ ui-business    # æ ¸å¿ƒä¸šåŠ¡ç»„ä»¶ï¼ˆå¦‚ UserSelect, OrderTableï¼‰
â”‚   â”œâ”€â”€ ui-hooks       # ä¸šåŠ¡é€»è¾‘ Hooks (useAuth, useDictionary)
â”‚   â”œâ”€â”€ ui-utils       # æ ¼å¼åŒ–ã€éªŒè¯ç­‰å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ theme          # ä¸šåŠ¡ä¸»é¢˜åŒ… (CSS Variables / Design Tokens)
â”œâ”€â”€ apps
â”‚   â”œâ”€â”€ docs           # åŸºäº VitePress çš„ç»„ä»¶åº“æ–‡æ¡£
â”‚   â””â”€â”€ demo-project   # ç”¨äºè”è°ƒçš„ç¤ºä¾‹é¡¹ç›®

```

---

### 4. æ ·å¼ç®¡ç†ç­–ç•¥

åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œæœ€å¿Œè®³çš„æ˜¯ `!important` æ»¡å¤©é£ã€‚

- **Design Tokens**ï¼šåœ¨åŸºç¡€ UI çš„å˜é‡ä¹‹ä¸Šï¼Œå®šä¹‰ä¸€å±‚ä¸šåŠ¡å˜é‡ï¼ˆå¦‚ `--brand-color-primary`ï¼‰ã€‚
- **BEM è§„èŒƒ**ï¼šä½¿ç”¨ç»Ÿä¸€çš„å‰ç¼€ï¼ˆå¦‚ `s-user-card`ï¼‰ï¼Œé¿å…ä¸åŸºç¡€åº“æˆ–ä¸»åº”ç”¨å†²çªã€‚
- **CSS Variable æ³¨å…¥**ï¼šé€šè¿‡ä¸€ä¸ª `ThemeProvider` ç»„ä»¶ï¼Œåœ¨æ ¹éƒ¨æ³¨å…¥ä¸šåŠ¡ä¸»é¢˜å˜é‡ï¼Œå®ç°åŠ¨æ€æ¢è‚¤å’Œä¸šåŠ¡é£æ ¼ç»Ÿä¸€ã€‚

---

### 5. è§£å†³"ç‰ˆæœ¬å…¼å®¹"ä¸"ä¾èµ–"çš„ç­–ç•¥

å½“åŸºäºåŸºç¡€åº“å°è£…æ—¶ï¼Œä¾èµ–ç®¡ç†æ˜¯æˆè´¥å…³é”®ï¼š

| ç­–ç•¥                  | å®ç°æ–¹å¼                                 | é€‚ç”¨åœºæ™¯                                           |
| --------------------- | ---------------------------------------- | -------------------------------------------------- |
| **Peer Dependencies** | å£°æ˜åŸºç¡€ UI åº“ç‰ˆæœ¬å·ã€‚                   | æ’ä»¶å¼ç»„ä»¶åº“ï¼Œè¦æ±‚ä¸»åº”ç”¨å¿…é¡»å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„ UI åº“ã€‚ |
| **Bundle Externals**  | æ‰“åŒ…æ—¶ä¸æ‰“åŒ…åŸºç¡€ UI åº“ä»£ç ï¼Œä»…ä¿ç•™å¼•ç”¨ã€‚ | ä¿æŒäº§ç‰©ä½“ç§¯è½»é‡ï¼Œä¾èµ–ä¸»åº”ç”¨æä¾›çš„è¿è¡Œæ—¶ã€‚         |
| **Version Mapping**   | åœ¨ `package.json` ä¸­é…ç½®åˆ«åã€‚           | è§£å†³ä¸»åº”ç”¨ä¸ä¸šåŠ¡åº“ UI ç‰ˆæœ¬å†²çªçš„ç´§æ€¥æ–¹æ¡ˆã€‚         |

---

### 6. è‡ªåŠ¨åŒ–ç”Ÿäº§åŠ›å·¥å…·

1. **è„šæ‰‹æ¶å·¥å…·**ï¼šä¸€é”®ç”Ÿæˆç»„ä»¶ç›®å½•ã€æµ‹è¯•æ–‡ä»¶ã€æ–‡æ¡£å…¥å£ï¼ˆå¦‚ `pnpm gen:comp`ï¼‰ã€‚
2. **è§†è§‰å›å½’æµ‹è¯•**ï¼šåˆ©ç”¨ **Loki** æˆ– **Chromatic**ï¼Œåœ¨ CI é˜¶æ®µè‡ªåŠ¨æ¯”å¯¹ç»„ä»¶å°è£…åçš„æ ·å¼æ˜¯å¦å‘ç”Ÿæ„å¤–åç§»ã€‚
3. **è‡ªåŠ¨æ–‡æ¡£æå–**ï¼šåˆ©ç”¨ `vue-component-meta` è‡ªåŠ¨ä» TypeScript å®šä¹‰ä¸­æå–ç»„ä»¶çš„ Props å’Œ Eventsï¼Œç”Ÿæˆ API æ–‡æ¡£ã€‚

---

## ä¸‰ã€åŒ…å‘å¸ƒ

åœ¨åŸºäº **Turborepo** çš„ Monorepo æ¶æ„ä¸­ï¼Œå‘å¸ƒå­åŒ…çš„æ ¸å¿ƒé€»è¾‘æ˜¯ï¼šåˆ©ç”¨ **Changesets** ç®¡ç†ç‰ˆæœ¬ä¸æ—¥å¿—ï¼Œå¹¶é€šè¿‡ **pnpm workspace** å¤„ç†å†…éƒ¨ä¾èµ–ï¼Œæœ€åé€šè¿‡ CI/CD è‡ªåŠ¨åŒ–æ¨é€åˆ° npm ä»“åº“ã€‚

ä»¥ä¸‹æ˜¯æ ‡å‡†åŒ–çš„å‘å¸ƒæµæ°´çº¿è½åœ°æ–¹æ¡ˆï¼š

---

### 1. æ ¸å¿ƒå·¥å…·é“¾é€‰å‹

åœ¨ Turbo é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¸ç›´æ¥ä½¿ç”¨ `npm publish`ï¼Œè€Œæ˜¯é‡‡ç”¨ä»¥ä¸‹ç»„åˆï¼š

- **Changesets (æ¨è)**ï¼šè´Ÿè´£ç‰ˆæœ¬æ§åˆ¶ã€ç”Ÿæˆ Changelogã€å¤„ç†å­åŒ…é—´çš„è”åŠ¨æ›´æ–°ã€‚
- **pnpm workspace**ï¼šç®¡ç†å­åŒ…é—´çš„ä¾èµ–å¼•ç”¨ï¼ˆå¦‚ `workspace:*`ï¼‰ã€‚
- **GitHub Actions / CI**ï¼šå®ç°å…¨è‡ªåŠ¨åŒ–å‘å¸ƒã€‚

---

### 2. å‘å¸ƒæµæ°´çº¿æµç¨‹å›¾

```mermaid
flowchart TD
    A[ä»£ç å˜æ›´å®Œæˆ] --> B[è¿è¡Œ pnpm changeset]
    B --> C[é€‰æ‹©åŒ…ä¸ç‰ˆæœ¬ç±»å‹<br/>patch/minor/major]
    C --> D[ç”Ÿæˆå˜æ›´è®°å½•æ–‡ä»¶]
    D --> E[æäº¤å˜æ›´åˆ°Git]
    E --> F[CI/CDè§¦å‘å‘å¸ƒæµç¨‹]

    subgraph F [è‡ªåŠ¨åŒ–å‘å¸ƒæµç¨‹]
        F1[GitHub Actionsè¿è¡Œ]
        F2[è¯»å–å˜æ›´è®°å½•]
        F3[è‡ªåŠ¨æ›´æ–°ç‰ˆæœ¬å·]
        F4[å¤„ç†å†…éƒ¨ä¾èµ–è”åŠ¨]
        F5[ç”ŸæˆCHANGELOG.md]
        F6[turbo buildæ„å»º]
        F7[å‘å¸ƒåˆ°npmä»“åº“]
        F8[æ¸…ç†ä¸´æ—¶æ–‡ä»¶]
    end

    F1 --> F2
    F2 --> F3
    F3 --> F4
    F4 --> F5
    F5 --> F6
    F6 --> F7
    F7 --> F8

    F --> G[å‘å¸ƒå®Œæˆ]

    style F fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    style G fill:#c8e6c9,stroke:#2e7d32,stroke-width:2px
```

### 3. ç¬¬ä¸€é˜¶æ®µï¼šåˆå§‹åŒ– Changesets

é¦–å…ˆåœ¨æ ¹ç›®å½•é…ç½®å‘å¸ƒå·¥ä½œæµï¼š

1. **å®‰è£…ä¾èµ–**ï¼š

```bash
pnpm add -wD @changesets/cli
pnpm changeset init

```

2. **é…ç½® `.changeset/config.json**`ï¼š
ç¡®ä¿ `access`è®¾ç½®ä¸º`public`ï¼ˆå¦‚æœæ˜¯å…¬å¼€åŒ…ï¼‰ï¼Œå¹¶é…ç½®å¥½éœ€è¦å‘å¸ƒçš„åŒ…è·¯å¾„ã€‚

---

### 3. ç¬¬äºŒé˜¶æ®µï¼šå¼€å‘ä¸ç‰ˆæœ¬æ ‡è®° (å¼€å‘è€…æµç¨‹)

å½“ä½ å®Œæˆäº†ä¸€ä¸ªå­åŒ…ï¼ˆå¦‚ `packages/ui-business`ï¼‰çš„ä¿®æ”¹ï¼Œéœ€è¦å‘å¸ƒæ—¶ï¼š

1. **è¿è¡Œæ ‡è®°å‘½ä»¤**ï¼š

```bash
pnpm changeset

```

2. **é€‰æ‹©åŒ…ä¸ç±»å‹**ï¼šäº¤äº’å¼é€‰æ‹©å“ªä¸ªåŒ…æ›´æ–°äº†ï¼Œæ˜¯ `patch`ï¼ˆä¿®å¤ï¼‰ã€`minor`ï¼ˆæ–°åŠŸèƒ½ï¼‰è¿˜æ˜¯ `major`ï¼ˆç ´åæ€§æ”¹åŠ¨ï¼‰ã€‚
3. **æäº¤ç”Ÿæˆçš„ Markdown**ï¼šChangeset ä¼šç”Ÿæˆä¸€ä¸ªä¸´æ—¶æ–‡ä»¶è®°å½•å˜æ›´ï¼Œå°†å…¶æäº¤åˆ° Gitã€‚

---

### 4. ç¬¬ä¸‰é˜¶æ®µï¼šå‘å¸ƒæµæ°´çº¿ (CI/CD æµç¨‹)

è¿™æ˜¯è‡ªåŠ¨åŒ–å‘å¸ƒçš„å…³é”®ï¼Œé€šå¸¸åœ¨æ ¹ç›®å½•çš„ `package.json` ä¸­å®šä¹‰ä¸¤ä¸ªå…³é”®è„šæœ¬ï¼š

```json
{
  "scripts": {
    "version-packages": "changeset version",
    "release": "turbo build && changeset publish"
  }
}
```

#### è‡ªåŠ¨åŒ–å‘å¸ƒé€»è¾‘ï¼š

1. **ç‰ˆæœ¬æ›´æ–° (`version-packages`)**ï¼š

- è¯»å– `.changeset/*.md`ã€‚
- æ ¹æ®æ ‡è®°è‡ªåŠ¨æ›´æ–°æ‰€æœ‰å­åŒ…çš„ `package.json` ç‰ˆæœ¬å·ã€‚
- **è‡ªåŠ¨å¤„ç†å†…éƒ¨ä¾èµ–**ï¼šå¦‚æœ `A` åŒ…ä¾èµ– `B` åŒ…ï¼Œä¸” `B` å‡çº§äº†ï¼Œ`A` çš„ç‰ˆæœ¬ä¹Ÿä¼šç›¸åº”è”åŠ¨ã€‚
- åˆ é™¤ Markdown è®°å½•å¹¶ç”Ÿæˆ `CHANGELOG.md`ã€‚

2. **æ„å»ºä¸æ‰§è¡Œå‘å¸ƒ (`release`)**ï¼š

- `turbo build`ï¼šåˆ©ç”¨ Turbo çš„ç¼“å­˜èƒ½åŠ›ï¼Œåªç¼–è¯‘æœ‰å˜åŠ¨çš„åŒ…ã€‚
- `changeset publish`ï¼šéå†æ‰€æœ‰åŒ…ï¼Œå¯¹æ¯” npm è¿œç«¯ç‰ˆæœ¬ï¼Œè‡ªåŠ¨æ‰§è¡Œ `npm publish`ã€‚

---

### 5. å…³é”®ï¼šè§£å†³å†…éƒ¨ä¾èµ– (`workspace:*`)

åœ¨ Turbo é¡¹ç›®ä¸­ï¼Œå­åŒ…ä¹‹é—´å¸¸äº’ç›¸å¼•ç”¨ï¼š`"ui-business": "workspace:*"`ã€‚
**å‘å¸ƒæ—¶ï¼ŒChangesets å’Œ pnpm ä¼šè‡ªåŠ¨å°† `workspace:*` è½¬æ¢ä¸ºçœŸå®çš„è¯­ä¹‰åŒ–ç‰ˆæœ¬å·ï¼ˆå¦‚ `^1.2.0`ï¼‰**ã€‚ä½ ä¸éœ€è¦æ‰‹åŠ¨ä¿®æ”¹æºç ä¸­çš„ç‰ˆæœ¬å·ã€‚

---

### 6. ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ (GitHub Actions)

å»ºè®®åˆ›å»ºä¸€ä¸ª `.github/workflows/release.yml`ï¼Œå®ç°"åˆå¹¶åˆ° main åˆ†æ”¯å³å‘å¸ƒ"ï¼š

```yaml
name: Release
on:
  push:
    branches: [main]

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: pnpm/action-setup@v2
      - uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: "pnpm"
          registry-url: "https://registry.npmjs.org"

      - name: Install dependencies
        run: pnpm install

      - name: Create Release Pull Request or Publish
        id: changesets
        uses: changeset/action@v1
        with:
          publish: pnpm release
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
```

---

### ğŸ’¡ æ’é›·æŒ‡å—

- **å‘å¸ƒç§æœ‰åŒ…**ï¼šå¦‚æœåœ¨å…¬å¸å†…ç½‘ï¼ˆNexus/Verdaccio ç§æœ‰ä»“åº“ï¼‰ï¼Œè®°å¾—åœ¨å­åŒ…çš„ `package.json` ä¸­é…ç½® `publishConfig: { "registry": "ä½ çš„ç§æœ‰åº“åœ°å€" }`ã€‚
- **æ„å»ºé¡ºåº**ï¼šç¡®ä¿ `turbo.json` ä¸­é…ç½®äº†æ­£ç¡®çš„ `dependsOn`ã€‚å¦‚æœä¸šåŠ¡åº“ä¾èµ–åŸºç¡€åº“ï¼Œå‘å¸ƒå‰çš„ `build` å¿…é¡»å…ˆå®ŒæˆåŸºç¡€åº“çš„æ„å»ºã€‚
- **.npmignore**ï¼šè®°å¾—åœ¨å­åŒ…ä¸­é…ç½®å¿½ç•¥ `src`ã€`tsconfig.json` ç­‰æºç æ–‡ä»¶ï¼Œåªå‘å¸ƒç¼–è¯‘åçš„ `dist` æˆ– `lib`ã€‚
