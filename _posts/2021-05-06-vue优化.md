---
title: 2021-05-06-vue优化
description: 优化项目卡顿现状，提升用户体验。
categories:
 - vue
tags:
 - echart3
 - 饼图
 - 柱状图
---

>

<!-- more -->

# 背景
项目越做越大，页面越来越多，导致项目也越来越卡顿。

## 解决思路
* 1、首屏优化
* 2、技术债务编码优化
* 3、打包优化，cdn

## 首屏优化

在Vue项目中，引入到工程中的所有js、css文件，编译时都会被打包进vendor.js，浏览器在加载该文件之后才能开始显示首屏。若是引入的库众多，那么vendor.js文件体积将会相当的大，影响首屏的体验。

1. 首先安装webpack的可视化资源分析工具，命令行执行：
```
'# NPM 
 npm i webpack-bundle-analyzer -D
 # Yarn 
 yarn add -D webpack-bundle-analyzer
```

2.1 然后在webpack的dev开发模式配置中，引入插件，代码如下：```const { BundleAnalyzerPlugin } = require('webpack-bundle-analyzer')```
```javascript
plugins: [
    new BundleAnalyzerPlugin()
]
```

2.2 vue-cli3中vue.config.js中加入配置
```
chainWebpack: (config) => {
    // 关闭prefetch: vue-cli3 默认会把所有通过import()按需加载的javascript文件加上 prefetch
    config.plugins.delete('prefetch');
    // 打包分析插件
    config.plugin('webpack-bundle-analyzer').use(require('webpack-bundle-analyzer').BundleAnalyzerPlugin);

    // 复写html指令，防止xss攻击
    config.module
      .rule('vue')
      .use('vue-loader')
      .loader('vue-loader')
      .tap((options) => {
        options.compilerOptions.directives = {
          html(node, directiveMeta) {
            (node.props || (node.props = [])).push({
              name: 'innerHTML',
              value: `$xss.process(_s(${directiveMeta.value}))`,
            });
          },
        };

        return options;
      });
}
```

3. 最后命令行执行npm run build --report , 浏览器会自动打开分析结果

4. app.xxx.js 文件过大

解决方案：

1. 代码分割 CommonsChunkPlugin
2. 提取第三方库 vendor
3. 外部引入第三方库 external
4. 设置缓存
5. 代码压缩 uglifyJsPlugin

引入CommonChunkPlugin，并在router/index.js中使用require.ensure()进行组件的引入：

